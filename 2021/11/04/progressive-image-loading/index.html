<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no" name="viewport"><meta content="✨小透明・宸✨" name="author"><meta content name="keywords"><meta content="其实这是之前自己写现在使用的这个主题的时候就想记下来的东西，不过一直咕到今天才写 …_φ(･ω･` )" name="description"><link href="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png" rel="icon shortcut" type="image/ico"><link href="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png" rel="icon"><link href="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png" rel="apple-touch-icon"><link href="/atom.xml" rel="alternate" type="application/atom+xml"><link crossorigin href="https://cdn.jsdelivr.net" rel="preconnect"><link crossorigin href="https://p.sda1.dev" rel="preconnect"><link href="https://comment.akarin.dev" rel="dns-prefetch"><link as="image" href="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/sidebar_header.avif" rel="preload"><link as="image" href="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg" rel="preload"><title>图片渐进式加载的实现方法（以及低分辨率图像占位符 LQIP 的基本介绍） | 存在感消失的地方|ω•`)</title><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://akarin.dev/2021/11/04/progressive-image-loading/"},"headline":"图片渐进式加载的实现方法（以及低分辨率图像占位符 LQIP 的基本介绍）","datePublished":"2021-11-04T14:48:47.000Z","dateModified":"2021-11-04T14:48:47.000Z","author":{"@type":"Person","name":"✨小透明・宸✨","image":{"@type":"ImageObject","url":"https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg"},"description":"身处寒夜 把握星光✨"},"publisher":{"@type":"Organization","name":"存在感消失的地方|ω•`)","logo":"https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png"},"keywords":"","description":"其实这是之前自己写现在使用的这个主题的时候就想记下来的东西，不过一直咕到今天才写 …_φ(･ω･` )"}</script><meta content="存在感消失的地方|ω•`)" property="og:site_name"><meta content="图片渐进式加载的实现方法（以及低分辨率图像占位符 LQIP 的基本介绍）" property="og:title"><meta content="其实这是之前自己写现在使用的这个主题的时候就想记下来的东西，不过一直咕到今天才写 …_φ(･ω･` )" property="og:description"><meta content="article" property="og:type"><meta content="https://akarin.dev/2021/11/04/progressive-image-loading/" property="og:url"><meta content="https://p.sda1.dev/12/aa60bd83ffd695d26883ec2c0de8ef2b/pb1Xl0JL.jpg" property="og:image"><meta content="2021-11-04T14:48:47.000Z" property="article:published_time"><meta content="2021-11-04T14:48:47.000Z" property="article:modified_time"><meta content="✨小透明・宸✨" property="article:author"><link href="../../../../css/mdui.min.css" rel="stylesheet"><link href="../../../../css/shiki.css" rel="stylesheet"><link href="../../../../css/style.css" rel="stylesheet"><style>*{--sidebar-image:image-set("https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/sidebar_header.avif" type("image/avif"),"https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/sidebar_header.webp" type("image/webp"),url(https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/sidebar_header.jpg));--sidebar-image-color:#958981;--banner-image:image-set("https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/daily_pic.avif" type("image/avif"),"https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/daily_pic.webp" type("image/webp"),url(https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/daily_pic.png));--banner-image-color:#f09ea3;--post-thumbnail-color:#f09ea3}.MathJax[jax=SVG][display=true]{text-align:center;margin:1em 0;display:block}.__s_0{--shiki-light:#383a42;--shiki-dark:gray}.__s_1{--shiki-light:#e45649;--shiki-dark:#569cd6}.__s_2{--shiki-light:#986801;--shiki-dark:#9cdcfe}.__s_3{--shiki-light:#383a42;--shiki-dark:#d4d4d4}.__s_4{--shiki-light:#50a14f;--shiki-dark:#ce9178}.__s_5{--shiki-light:#383a42;--shiki-dark:#ce9178}.__s_6{--shiki-light:#a0a1a7;--shiki-light-font-style:italic;--shiki-dark:#6a9955;--shiki-dark-font-style:inherit}.__s_7{--shiki-light:#383a42;--shiki-dark:#d4d4d4;--shiki-light-bg:#fafafa;--shiki-dark-bg:#1e1e1e}.__s_8{--shiki-light:#e45649;--shiki-dark:#d7ba7d}.__s_9{--shiki-light:#a626a4;--shiki-dark:#d4d4d4}.__s_a{--shiki-light:#986801;--shiki-dark:#d7ba7d}</style><meta content="Hexo 8.1.1" name="generator"></head><body class="mdui-drawer-body-left mdui-theme-accent-pink mdui-theme-primary-pink"><svg class="mdui-hidden"/><svg class="mdui-hidden"><path id="__i_0" d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/><path id="__i_1" d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/><path id="__i_2" d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4"/><path id="__i_3" d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"/><path id="__i_4" d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 10-2.5-1.5L15 12V4h5z"/><path id="__i_5" d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20 5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27zm0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93z"/><path id="__i_6" d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/><path id="__i_7" d="M22 18v4h-4v-3h-3v-3h-3l-2.26-2.26c-.55.17-1.13.26-1.74.26a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6c0 .61-.09 1.19-.26 1.74zM7 5a2 2 0 0 0-2 2 2 2 0 0 0 2 2 2 2 0 0 0 2-2 2 2 0 0 0-2-2"/><path id="__i_8" d="M6.5 20q-2.28 0-3.89-1.57Q1 16.85 1 14.58q0-1.95 1.17-3.48 1.18-1.53 3.08-1.95.58-2.02 2.14-3.4Q8.95 4.38 11 4.08v8.07L9.4 10.6 8 12l4 4 4-4-1.4-1.4-1.6 1.55V4.08q2.58.35 4.29 2.31T19 11q1.73.2 2.86 1.5 1.14 1.28 1.14 3 0 1.88-1.31 3.19T18.5 20Z"/><path id="__i_9" d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/><path id="__i_a" d="M7.41 8.58 12 13.17l4.59-4.59L18 10l-6 6-6-6z"/><path id="__i_b" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2M9 17H7v-7h2zm4 0h-2V7h2zm4 0h-2v-4h2z"/><path id="__i_c" d="M15.41 16.58 10.83 12l4.58-4.59L14 6l-6 6 6 6z"/><path id="__i_d" d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6z"/></svg>    <button class="mdui-fab mdui-m-a-2 mdui-shadow-0 mdui-text-color-grey-700" mdui-drawer="{target:'#akarin-drawer'}" style="z-index:1;position:fixed"><span class="mdui-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_0"></use></svg></span></button>  <nav class="mdui-drawer mdui-drawer-full-height mdui-shadow-6" id="akarin-drawer"> <div class="akarin-util-bg-cover mdui-p-x-2" id="akarin-drawer-media"> <img alt="✨小透明・宸✨ 的头像" class="akarin-hover-spin mdui-img-circle mdui-m-t-4" id="akarin-drawer-avatar" src="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg"> <div class="akarin-util-text-gradient mdui-card-media-covered"> <div class="mdui-card-primary"> <div class="mdui-typo-subheading">✨小透明・宸✨ </div> <div class="akarin-util-opacity-half mdui-typo-caption">存在感消失的地方|ω•`) </div> </div> </div> </div> <div class="mdui-list" mdui-collapse> <div> <a class="mdui-list-item mdui-ripple" href="../../../../"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_1"></use></svg></span> <span class="mdui-list-item-content">主页</span> </a> </div> <div> <a class="mdui-list-item mdui-ripple" href="../../../../about/"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_2"></use></svg></span> <span class="mdui-list-item-content">关于</span> </a> </div> <div> <a class="mdui-list-item mdui-ripple" href="../../../../friend/"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_3"></use></svg></span> <span class="mdui-list-item-content">友链</span> </a> </div> <div> <a class="mdui-list-item mdui-ripple" href="../../../../archives/"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_4"></use></svg></span> <span class="mdui-list-item-content">归档</span> <small class="akarin-drawer-badge mdui-color-theme-accent">38</small> </a> </div> <div> <a class="mdui-list-item mdui-ripple" href="../../../../atom.xml"> <i class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_5"></use></svg></i> <span class="mdui-list-item-content">RSS</span> </a> </div> <div class="mdui-divider"></div> <div> <a class="mdui-list-item mdui-ripple" href="https://github.com/TransparentLC" rel="noopener" target="_blank"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_6"></use></svg></span> <span class="mdui-list-item-content">GitHub</span> </a> </div> <div> <a class="mdui-list-item mdui-ripple" href="https://github.com/TransparentLC.gpg" rel="noopener" target="_blank"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_7"></use></svg></span> <span class="mdui-list-item-content">PGP 公钥</span> </a> </div> <div> <a class="mdui-list-item mdui-ripple" href="https://fuwafuwa.akarin.dev/" rel="noopener" target="_blank"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_8"></use></svg></span> <span class="mdui-list-item-content">下载站</span> </a> </div> <div class="mdui-divider"></div> <div class="mdui-collapse-item mdui-collapse-item-open"> <div class="mdui-collapse-item-header mdui-list-item mdui-ripple"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_9"></use></svg></span> <span class="mdui-list-item-content">深色模式</span> <span class="mdui-collapse-item-arrow mdui-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_a"></use></svg></span> </div> <div class="mdui-collapse-item-body mdui-list"> <div class="mdui-list-item mdui-ripple" data-dark="auto"> <span class="mdui-list-item-content">根据系统主题切换</span> </div> <div class="mdui-list-item mdui-ripple" data-dark="enable"> <span class="mdui-list-item-content">启用</span> </div> <div class="mdui-list-item mdui-ripple" data-dark="disable"> <span class="mdui-list-item-content">禁用</span> </div> </div> </div> <div class="mdui-collapse-item mdui-collapse-item-open"> <div class="mdui-collapse-item-header mdui-list-item mdui-ripple"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_b"></use></svg></span> <span class="mdui-list-item-content">访问统计</span> <span class="mdui-collapse-item-arrow mdui-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_a"></use></svg></span> </div> <div class="mdui-collapse-item-body mdui-list"> <div class="mdui-list-item mdui-ripple"> <span class="mdui-list-item-content">站点访问量</span> <small class="akarin-drawer-badge mdui-color-theme-accent" id="busuanzi_value_site_pv">Loading</small> </div> <div class="mdui-list-item mdui-ripple"> <span class="mdui-list-item-content">站点访客数</span> <small class="akarin-drawer-badge mdui-color-theme-accent" id="busuanzi_value_site_uv">Loading</small> </div> <div class="mdui-list-item mdui-ripple"> <span class="mdui-list-item-content">页面访问量</span> <small class="akarin-drawer-badge mdui-color-theme-accent" id="busuanzi_value_page_pv">Loading</small> </div> </div> </div> </div> </nav>  <picture id="akarin-top" title="返回顶部"> <source srcset="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/top.avif" type="image/avif"> <source srcset="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/top.webp" type="image/webp"> <img alt="返回顶部" src="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/top.png">   </picture>  <div style="padding-top:20px"></div> <div class="mdui-hidden-sm-down" style="padding-top:40px"></div> <div class="mdui-hidden-md-down" style="padding-top:40px"></div>  <main class="mdui-container" style="max-width:1024px"> <div class="akarin-util-rounded-5 mdui-card mdui-shadow-4"> <div class="akarin-post-bg akarin-util-bg-cover mdui-ripple" data-src="https://p.sda1.dev/12/aa60bd83ffd695d26883ec2c0de8ef2b/pb1Xl0JL.jpg" data-src-avif="https://p.sda1.dev/12/c560f69239ed1f598cefa9a78b13cd2c/Nbgu763c.jpg" data-src-webp="https://p.sda1.dev/12/72b3f713d8257b26aa4fdec2a538189e/EzIW6MIk.webp"> <div class="akarin-blurred akarin-post-bg akarin-util-bg-cover" style="background-image:url(data:image/webp;base64,UklGRiAEAABXRUJQVlA4IBQEAAAwEgCdASpAAC0APqU6mUmhqKeltV36AMAUiWwAnTLVPt/G+ZjWH8jsHBhrdHor2xXPfekn/Xb6TvIX+PtEXf3im56wYbheobwTlisGNNyzsfBJdK5EOa/Yz5APyfi0xR7B08VLuNUTbwVvfIwTaDMl56NuzZ4C9bVrXsTXdKnPE9zBv0agPk7z8M3tovbPACetyOKmKp57u6sgAP64AhOqQKv2ZOrf8soPYoXBLDv6y1jj2EfJtu7ZSwkirraf1GT/bWB23a4UJmUXLcPqgSlXAdNyeLPSvY4pYEgf1Iys2RLb6/TbGXvjEDSA70rkFXTgt9Q8X3vlLQh9muK6xiEUw4uG/0oOH6yAOg2Z7zpWD9LT3g8bEPr7oKiq0KT6O3MGftKPJ3sDEB0LuKuA1akryGtBYNkxNTqcmESdkvUjQ/580Oldp7kLrqLhXOSS2gr+tgHA3AC73bBb5AF61E46OPuI13d90rceRrC3FLbLXVT9SmN8Reg+XLuRc+qJ5ERBcwoSHmb/w3a5H3JXDxL39u1aikvNq8DHOwOqETWpN/Tic8+BG/S5IDc/2O34JYBnNS0z4tIDfmyrwdEcrbG7aU1lNOOmFNZ8INRJBgut4NQTV/wTPzS90WF18GuXye+T/XuAxrrZvlFD9TSiOR9+EmpWnG/mjOp4xnL+uO3RdIl7JXU9jfCHDcL9oEHf/b6WdzNzB9/Sz0BVMg5njTAqYjfqQ/97o7oL+xGUXReNqpKLkRN5V6sVSQlqn0vGVpzLk6vtZN7ItGgqejcUHjZwHViE/LQ8EEbDxxCMPfEjKB8/1crVQUibggEAGx/UWmdYC2hIPbWmjlLEnF3xvMukOGe/0Qmf+/c5ewBWbNGRajQww7JB9qrdoSECpiznfqAjoNfUfWw4Vwg4x6nXeRvNCEqSm4mGzSfc75tARkdLUklkD1XWMlSJUfu/glkLhM/a2GbZnRL3r68LZ7WnKO53YJ9/nlPNBDxP0Hcu052h4cHIyvcWwnIv9IJHAuHTU7VPay0Rr1+ogLlCtQXuL+pSjqVn95Gl73KwBvVo08Izzyddnq4z/f+5lH6re1p4TSZ9fuO7imXPHbk5okDA1/E3L2iT2mMfe6iDdFq8vPJN+j6Gwu/Kf7zci/vmiQFN8UXhuZhyHUGTXX+2ujMICBcc2NuVHKE9Dv+vjGKcKw0VU6m28Y36Ho8ipR/+m6IfLjuo9HdXtYm9Fh7zZgj7CdB7K/CpV/rugsV3kdxiTb8iGK0BwAwdwN/q0zPOX7X/Kz7NPAXjSsvwB7P9WUOK9P+cgbDa2JCHMkQJjXwgbrocKmoXxGuYOWpM9OjvGd1O+fZKqCN3bJbzM7gTfv9uN9pD07ooIwHE6MkdQj/hKMJz2pUIAAA)"></div> <div class="akarin-post-title akarin-util-text-gradient"> <div class="mdui-card-primary"> <div class="mdui-card-primary-title mdui-text-color-white-text"> 图片渐进式加载的实现方法（以及低分辨率图像占位符 LQIP 的基本介绍） </div> </div> </div> </div> <div class="mdui-card-header mdui-valign"> <div> <img alt="✨小透明・宸✨ 的头像" class="akarin-hover-spin mdui-card-header-avatar" src="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg"> <div class="mdui-card-header-title">✨小透明・宸✨</div> <div class="mdui-card-header-subtitle">2021-11-04 22:48:47</div> </div> </div> <article class="mdui-card-content mdui-p-a-3 mdui-typo"> <p>其实这是之前自己写现在使用的这个 Hexo 主题的时候就想记下来的东西，不过一直咕到今天才写 …_φ(･ω･&#96; )</p> <p>在我写主题的过程中，为了节省流量而大量地对图片使用了懒加载。而各位应该很容易就可以发现，对于文章的封面图还有个额外的“从模糊变清晰”的加载效果。</p> <video controls poster="https://p.sda1.dev/12/e1bf7ea924102d38b4c7c21c69f0bcac/6KjPgCbt.jpg"> <source src="https://cc-im-kefu-cos.7moor-fs1.com/im/4d2c3f00-7d4c-11e5-af15-41bf63ae4ea0/telIFazl.mp4" type="video/mp4; codecs=av01.0.05m.10"> <source src="https://s3plus.meituan.net/v1/mss_550586ef375b493da4aa79bebdfce4fa/csc-apply-file-web/prod/2021-11-03/8042b498-dca0-4752-bcc4-3b405280fdf1null" type="video/mp4; codecs=avc1.640032"> </video> <p>这类加载方式一般被称为渐进式加载（Progressive Loading），对于图片来说，也就是在加载的过程中先展示一部分模糊的图片，等加载完成了再展示完整的原始图片。虽然渐进式加载不能从根本上提高图片的加载速度，但是因为用户<strong>看到图片的时间提前了</strong>（虽然还不是完整图片），因此可以给用户一种“看上去加载得比较快”的错觉，而不是对着未加载时图片位置的一片空白干等，可以提升使用体验。</p> <h1 id="图片格式中的渐进解码功能"><a class="headerlink" href="#图片格式中的渐进解码功能" title="图片格式中的渐进解码功能"></a>图片格式中的渐进解码功能</h1><p>现在常用的一些图片格式中都加入了渐进式解码的功能，可以在只加载了图片的部分数据的情况下显示出模糊的图像。由于是解码器直接提供支持，因此展示图片时并不需要额外的配置，只需要在保存图片时注意设置“渐进&#x2F;连续（Progressive）”或者“交错（Interlace）”之类的选项就可以了。</p> <p>下面就是模拟较慢的网速下加载以相同质量压缩的非渐进式和渐进式 JPEG 图片的效果，非渐进式是像扫描仪一样从上往下逐渐显示，而渐进式就先显示了大致的轮廓，在加载过程中再逐渐变清晰，“扫描”完第二遍时就已经是可以接受的图片质量了。</p> <video controls poster="https://p.sda1.dev/12/e554dec8a70e0b826071005fc5ee720a/waCL5uzU.jpg"> <source src="https://cc-im-kefu-cos.7moor-fs1.com/im/4d2c3f00-7d4c-11e5-af15-41bf63ae4ea0/Qs1GK6PY.mp4" type="video/mp4; codecs=av01.0.05m.10"> <source src="https://s3plus.meituan.net/v1/mss_550586ef375b493da4aa79bebdfce4fa/csc-apply-file-web/prod/2021-11-03/8bb22ec9-43ab-4bc2-8f83-afa8bc6dd809null" type="video/mp4; codecs=avc1.640032"> </video> <p>如果使用 <a href="https://github.com/mozilla/mozjpeg" rel="noopener" target="_blank">mozjpeg</a> 压图的话，默认就已经启用了参数 <code>-progressive</code> 启用渐进式解码，但是默认的解码方式是按顺序解码 Y、U、V 三个通道（即使用 <code>-dc-scan-opt 1</code>），效果是图片会先以黑白形式显示，再逐渐填充错误的颜色，最后变成正常的颜色，这样看上去的效果不太好，因此可以通过使用 <code>-dc-scan-opt 0</code> 改为同时加载三个通道，就可以达到上面的效果。还可以无损地将已有的非渐进式 JPEG 图片（也被称为 Baseline JPEG）转换为渐进式，文件大小稍微会小一点。</p> <p>另外两个经典的图片格式 GIF 和 PNG 也支持渐进式解码，但是对这两个格式启用渐进式解码反而会使文件大小增加，实际使用也似乎不是很多。</p> <p>那现代图片格式 WebP 和 AVIF 呢？遗憾的是，它们都不支持渐进式解码 ╮(╯_╰)╭</p> <p>Google 已经在 WebP 的文档中表示<a href="https://developers.google.com/speed/webp/faq#does_webp_support_progressive_or_interlaced_display" rel="noopener" target="_blank">不支持渐进式解码的功能</a>了。而 AVIF 最初也不支持渐进式解码，后来有人在 GitHub 上提出了相关的 <a href="https://github.com/AOMediaCodec/av1-avif/issues/102" rel="noopener" target="_blank">Issue</a>，但是似乎是由于对编码格式的修改过于复杂而无法实装，作为替代有人提出了另一个 <a href="https://github.com/AOMediaCodec/libavif/issues/605" rel="noopener" target="_blank">Issue</a>，通过在 AVIF 中内置缩略图来实现类似的效果，不过也没有什么进展……所以大约的确也是不行的。</p> <h1 id="懒加载和“从模糊变清晰”的加载效果"><a class="headerlink" href="#懒加载和“从模糊变清晰”的加载效果" title="懒加载和“从模糊变清晰”的加载效果"></a>懒加载和“从模糊变清晰”的加载效果</h1><p>在和图片相关的优化中，懒加载其实是更有必要做的优化。毕竟渐进式的图片加载只能做到视觉上的优化，但是懒加载可是实打实地减少了 HTTP 请求数量和流量消耗。一般的懒加载是在未加载的图片的位置上放一个固定的占位图，等需要加载图片的时候再用原图替换掉，类似的还有“省流模式”，只是将加载图片的时机从出现在屏幕上变成了用户手动点击图片。总之，如果把这张占位图改成图片的缩略图之类的话，就是上面提到的“从模糊变清晰”的渐进式加载效果了。</p> <p>这个缩略图有哪些要求呢？</p> <ul> <li>缩略图应该立即显示在页面上，如果进行了额外的加载，那么加载之前图片仍然是一片空白。</li> <li>缩略图还应该尽可能地小。</li> <li>如果从缩略图直接切换到原图就太生硬了，应该有个渐变的效果，可以通过将缩略图的不透明度逐渐变成 0 来实现，于是这个缩略图应该作为单独的一层覆盖到原图上。</li> </ul> <p>因此这个缩略图应该以 Data URL 的形式直接嵌入到页面中，并且使用几十像素的尺寸就足够了。下面就是将一个 32x18 的缩略图（大小只有 434 B）覆盖在 1280x720 的原图上的演示，点击下面的按钮可以模拟图片被加载时显示的图片从缩略图平滑过渡到原图的效果：</p> <div style="position:relative"> <img id="example-0-blurred" src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQIAJQAlAAD/2wCEABcXFxcYFxocHBokJiImJDUwLCwwNVA5PTk9OVB5S1hLS1hLeWuBaWJpgWvAl4WFl8DeurC63v/w8P////////8BFxcXFxgXGhwcGiQmIiYkNTAsLDA1UDk9OT05UHlLWEtLWEt5a4FpYmmBa8CXhYWXwN66sLre//Dw///////////AABEIABIAIAMBIQACEQEDEQH/xABrAAADAQAAAAAAAAAAAAAAAAACBAUAEAACAgEEAQUAAAAAAAAAAAABAgMRAAQSITETBRRBcrEBAQEBAQAAAAAAAAAAAAAAAAQCAwERAAEDBAIDAQAAAAAAAAAAAAEAAgMEESExMoEiQUJx/9oADAMBAAIRAxEAPwCvBIXBLU1DvGoZt70XU4Gm0kSN5W9IxML6odXi04YG405+WrLqm+GAoi5ZK0KyXRPGHUEcm5dqspFnOUusqnnNh2lJi0DJ5WBDbrUnEV9QRqQIxA7JxczDLEAwjKyjcGvub4Vx+IzkrWk+z1WCpeXS0+VJ1TFoNEWJJ8bfuBB0fsMfHo/jlkdr/9k" style="width:100%;max-height:none;transition:opacity 1s;position:absolute"> <img data-src="https://p.sda1.dev/12/bece1d43a7d093583129fdc7202ca924/Fhdt09T7.jpg" data-src-avif="https://p.sda1.dev/12/3a708bab4022d35fa52f12344a6dabfb/m3nkyCIM.jpg" data-src-webp="https://p.sda1.dev/12/04d499bac3b61e1596f370c51686c18a/d1iL6gt0.webp" id="example-0-source" style="visibility:hidden;width:100%;max-height:none"> </div> <button id="example-0-load">加载图片</button> <button id="example-0-unload">恢复初始状态</button> <button id="example-0-blur">切换缩略图模糊</button>   <figure><pre class="__s_7 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_0">&#x3C;</span><span class="__s_1">div</span><span class="__s_2"> style</span><span class="__s_3">=</span><span class="__s_4">"</span><span class="__s_5">position:relative</span><span class="__s_4">"</span><span class="__s_0">></span></span>
<span class="line"><span class="__s_6">    &#x3C;!-- 缩略图，显示的尺寸和位置都要设定为和原图一致 --></span></span>
<span class="line"><span class="__s_0">    &#x3C;</span><span class="__s_1">img</span></span>
<span class="line"><span class="__s_2">        style</span><span class="__s_3">=</span><span class="__s_4">"</span><span class="__s_5">position:absolute;width:100%;transition:opacity 1s</span><span class="__s_4">"</span></span>
<span class="line"><span class="__s_2">        src</span><span class="__s_3">=</span><span class="__s_4">"data:image/jpeg;base64,..."</span></span>
<span class="line"><span class="__s_0">    ></span></span>
<span class="line"><span class="__s_6">    &#x3C;!-- 原图 --></span></span>
<span class="line"><span class="__s_0">    &#x3C;</span><span class="__s_1">img</span></span>
<span class="line"><span class="__s_2">        style</span><span class="__s_3">=</span><span class="__s_4">"</span><span class="__s_5">width:100%</span><span class="__s_4">"</span></span>
<span class="line"><span class="__s_2">        src</span><span class="__s_3">=</span><span class="__s_4">"https://..."</span></span>
<span class="line"><span class="__s_0">    ></span></span>
<span class="line"><span class="__s_0">&#x3C;/</span><span class="__s_1">div</span><span class="__s_0">></span></span></code></pre><code class="language">html</code></figure> <p>由于浏览器缩放显示图片时默认使用的是双线性插值（除此之外只能通过修改 <code>image-rendering: pixelated</code> 设置为邻近取样，没有更好的缩放算法了），在将缩略图放大数倍时会出现明显的菱形和十字图形，比较难看。在缩略图上通过 <code>filter: blur(10px)</code> 添加模糊一定程度上可以掩盖这个问题，上面的演示中也可以通过自由切换来比较使用与不使用模糊的视觉效果区别。</p> <p>但是，使用 CSS 的模糊滤镜又带来了别的问题。在演示中可以注意到，将缩略图模糊时缩略图的边缘也一起被模糊了，导致的后果就是点击“加载图片”时在边缘位置仍然是没有任何过渡地直接显示了图片，非常生硬。</p> <p>如何解决呢？我首先找到了<a href="https://css-tricks.com/the-blur-up-technique-for-loading-background-images/" rel="noopener" target="_blank">一篇来自 CSS-Tricks 的文章</a>，同样介绍了如何实现“从模糊变清晰”的渐进式加载效果，但是它使用了另一种不同的方法实现缩略图的模糊显示：不在 CSS 的 <code>filter</code> 中使用自带的 <code>blur</code> 模糊滤镜，而是以 SVG 滤镜的形式将模糊和修改透明度结合到一起。这个结合后的 SVG 滤镜是：</p> <figure><pre class="__s_7 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_0">&#x3C;</span><span class="__s_1">svg</span><span class="__s_2"> xmlns</span><span class="__s_3">=</span><span class="__s_4">"http://www.w3.org/2000/svg"</span><span class="__s_0">></span></span>
<span class="line"><span class="__s_0">    &#x3C;</span><span class="__s_1">filter</span><span class="__s_2"> id</span><span class="__s_3">=</span><span class="__s_4">"$"</span><span class="__s_0">></span></span>
<span class="line"><span class="__s_0">        &#x3C;</span><span class="__s_1">feGaussianBlur</span><span class="__s_2"> stdDeviation</span><span class="__s_3">=</span><span class="__s_4">"10"</span><span class="__s_0"> /></span></span>
<span class="line"><span class="__s_0">        &#x3C;</span><span class="__s_1">feComponentTransfer</span><span class="__s_0">></span></span>
<span class="line"><span class="__s_0">            &#x3C;</span><span class="__s_1">feFuncA</span><span class="__s_2"> type</span><span class="__s_3">=</span><span class="__s_4">"discrete"</span><span class="__s_2"> tableValues</span><span class="__s_3">=</span><span class="__s_4">"1 1"</span><span class="__s_0"> /></span></span>
<span class="line"><span class="__s_0">        &#x3C;/</span><span class="__s_1">feComponentTransfer</span><span class="__s_0">></span></span>
<span class="line"><span class="__s_0">    &#x3C;/</span><span class="__s_1">filter</span><span class="__s_0">></span></span>
<span class="line"><span class="__s_0">&#x3C;/</span><span class="__s_1">svg</span><span class="__s_0">></span></span></code></pre><code class="language">svg</code></figure> <p><code>&lt;feGaussianBlur&gt;</code> 和 CSS 自带的 <code>blur</code> 一样，表示对图片进行指定半径的模糊处理。而 <code>&lt;feComponentTransfer&gt;</code> 则是对图片的每个像素的 RGBA 通道颜色值进行映射（就像 Photoshop 里的“曲线”一样），这里的设定是将 A 通道固定为 1（范围为 0-1），也就是使整个图像变得不透明。</p> <p>给这个 SVG 滤镜任意添加一个 ID（可以短到只有一个字符），然后压缩，编码成使用 URL 编码的 Data URL，再像 HTML 中使用 <code>#</code> 指向有某个 ID 的元素一样引用这个滤镜，写入到 CSS 的 <code>filter</code> 中，就可以得到下面的 CSS 代码：</p> <figure><pre class="__s_7 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_8">filter</span><span class="__s_9">: url("</span><span class="__s_8">data</span><span class="__s_9">:image</span><span class="__s_3">/</span><span class="__s_8">svg</span><span class="__s_3">+</span><span class="__s_9">xml,%3Csvg xmlns='http:</span><span class="__s_3">//</span><span class="__s_9">www</span><span class="__s_a">.w3</span><span class="__s_9">.org</span><span class="__s_3">/2000/</span><span class="__s_9">svg'%3E%3Cfilter id='$'%3E%3CfeGaussianBlur stdDeviation='9'</span><span class="__s_3">/%3</span><span class="__s_9">E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'</span><span class="__s_3">/%3</span><span class="__s_9">E%3C</span><span class="__s_3">/</span><span class="__s_9">feComponentTransfer%3E%3C</span><span class="__s_3">/</span><span class="__s_9">filter%3E%3C</span><span class="__s_3">/</span><span class="__s_9">svg%3E#$"</span><span class="__s_3">)</span></span></code></pre><code class="language">css</code></figure> <p>这是目前这个主题正在对文章封面图的使用模糊方法。看上去似乎也没什么问题，但是在写这篇的时候我尝试对上面的演示中的缩略图使用，结果在图片边框出现了严重的色彩溢出现象，溢出的部分甚至还超出了图片的显示区域……</p> <figure class="akarin-blurred-container"> <div style="padding-bottom:min(76.5526%,480px)"></div> <img class="mdui-hoverable mdui-img-rounded" data-src="https://p.sda1.dev/12/e5726043a2abe026a37a8f6aac99aaef/ShAtGwVG.jpg" data-src-avif="https://p.sda1.dev/12/26eaa299c82c974e2119b6b10ef10484/mnHAu5nI.jpg" data-src-webp="https://p.sda1.dev/12/61d1a0b825f4bdae396a19d4fe77150a/fJE3y2jU.webp"> <img class="akarin-blurred mdui-hoverable mdui-img-rounded" src="data:image/webp;base64,UklGRhABAABXRUJQVlA4IAQBAABwBQCdASogABgAPrVCoEooqTErsBgMAOAWiWoAnSCUtlIIEIOAppJHDoO53LOAEGDApG0AAP73bxhwnfWFi/A/YUN+JL4K+bOb1q9m/Sw11lM1idmFIEQE6N/3ThsYdBIFl8Bq5sGayomS7QJm5VqvlP1qQIWUNAAgacrWWSgTRl1B3Tokimkdupya6QzAkkUABbcE8wOrrqkjal5RW8w5hq7xgArG81TnFL/8zx3/fn/3/DXv9IX5AAJB8Zcx6bAoG1Za1EnusLdUmn/MvERkBbX3SqzXR9iHgtTIbEkNg23wT2UZL7FF2tsnHfRXkiFzJ4DbH2VzuHBbNzSVzgpGto0MAA"> <noscript> <img class="mdui-center mdui-hoverable mdui-img-fluid mdui-img-rounded" src="https://p.sda1.dev/12/e5726043a2abe026a37a8f6aac99aaef/ShAtGwVG.jpg"> </noscript> </figure> <p>那为什么 CSS-Tricks 那边的使用以及对这个主题的封面图使用就没有问题呢？因为那两个情况下的图片都是通过 <code>background-image</code> 显示的，但是这里使用的是 <code>&lt;img&gt;</code>，稍微有点区别。至于为什么在 <code>&lt;img&gt;</code> 中使用就会在显示区域之外出现色彩溢出的部分，我也无法解释…… (;-_-)</p> <p>后来我又找到了一个 <a href="https://stackoverflow.com/questions/20443283#answer-48095387" rel="noopener" target="_blank">Stack Overflow 上的回答</a>，给出了另一个 SVG 模糊滤镜：</p> <figure><pre class="__s_7 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_0">&#x3C;</span><span class="__s_1">svg</span><span class="__s_2"> xmlns</span><span class="__s_3">=</span><span class="__s_4">"http://www.w3.org/2000/svg"</span><span class="__s_0">></span></span>
<span class="line"><span class="__s_0">    &#x3C;</span><span class="__s_1">filter</span><span class="__s_2"> id</span><span class="__s_3">=</span><span class="__s_4">"$"</span><span class="__s_0">></span></span>
<span class="line"><span class="__s_0">        &#x3C;</span><span class="__s_1">feGaussianBlur</span><span class="__s_2"> stdDeviation</span><span class="__s_3">=</span><span class="__s_4">"10"</span><span class="__s_0"> /></span></span>
<span class="line"><span class="__s_0">        &#x3C;</span><span class="__s_1">feColorMatrix</span><span class="__s_2"> type</span><span class="__s_3">=</span><span class="__s_4">"matrix"</span><span class="__s_2"> values</span><span class="__s_3">=</span><span class="__s_4">"1 0 0 0 0, 0 1 0 0 0, 0 0 1 0 0, 0 0 0 9 0"</span><span class="__s_0"> /></span></span>
<span class="line"><span class="__s_0">        &#x3C;</span><span class="__s_1">feComposite</span><span class="__s_2"> in2</span><span class="__s_3">=</span><span class="__s_4">"SourceGraphic"</span><span class="__s_2"> operator</span><span class="__s_3">=</span><span class="__s_4">"in"</span><span class="__s_0"> /></span></span>
<span class="line"><span class="__s_0">    &#x3C;/</span><span class="__s_1">filter</span><span class="__s_0">></span></span>
<span class="line"><span class="__s_0">&#x3C;/</span><span class="__s_1">svg</span><span class="__s_0">></span></span></code></pre><code class="language">svg</code></figure> <p><code>&lt;feColorMatrix&gt;</code> 是使用变换矩阵处理每个像素的 RGBA 通道颜色值，上面的滤镜中的矩阵相当于将 A 通道的颜色值乘上 9，其他通道不变，对于被模糊（实际上是半透明）的边缘位置来说基本上就和设成 1 差不多了，并且这种实现方法不会在显示区域之外再出现什么奇怪的东西。对应的 CSS 代码：</p> <figure><pre class="__s_7 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_8">filter</span><span class="__s_9">: url("</span><span class="__s_8">data</span><span class="__s_9">:image</span><span class="__s_3">/</span><span class="__s_8">svg</span><span class="__s_3">+</span><span class="__s_9">xml,%3Csvg xmlns='http:</span><span class="__s_3">//</span><span class="__s_9">www</span><span class="__s_a">.w3</span><span class="__s_9">.org</span><span class="__s_3">/2000/</span><span class="__s_9">svg'%3E%3Cfilter id='$'%3E%3CfeGaussianBlur stdDeviation='10'</span><span class="__s_3">/%3</span><span class="__s_9">E%3CfeColorMatrix type='matrix' values='1 0 0 0 0,0 1 0 0 0,0 0 1 0 0,0 0 0 9 0'</span><span class="__s_3">/%3</span><span class="__s_9">E%3CfeComposite in2='SourceGraphic' operator='in'</span><span class="__s_3">/%3</span><span class="__s_9">E%3C</span><span class="__s_3">/</span><span class="__s_9">filter%3E%3C</span><span class="__s_3">/</span><span class="__s_9">svg%3E#$"</span><span class="__s_3">);</span></span></code></pre><code class="language">css</code></figure> <p>用这个滤镜替代最初的演示中使用的 CSS 自带的模糊滤镜：</p> <div style="position:relative"> <img id="example-1-blurred" src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQIAJQAlAAD/2wCEABcXFxcYFxocHBokJiImJDUwLCwwNVA5PTk9OVB5S1hLS1hLeWuBaWJpgWvAl4WFl8DeurC63v/w8P////////8BFxcXFxgXGhwcGiQmIiYkNTAsLDA1UDk9OT05UHlLWEtLWEt5a4FpYmmBa8CXhYWXwN66sLre//Dw///////////AABEIABIAIAMBIQACEQEDEQH/xABrAAADAQAAAAAAAAAAAAAAAAACBAUAEAACAgEEAQUAAAAAAAAAAAABAgMRAAQSITETBRRBcrEBAQEBAQAAAAAAAAAAAAAAAAQCAwERAAEDBAIDAQAAAAAAAAAAAAEAAgMEESExMoEiQUJx/9oADAMBAAIRAxEAPwCvBIXBLU1DvGoZt70XU4Gm0kSN5W9IxML6odXi04YG405+WrLqm+GAoi5ZK0KyXRPGHUEcm5dqspFnOUusqnnNh2lJi0DJ5WBDbrUnEV9QRqQIxA7JxczDLEAwjKyjcGvub4Vx+IzkrWk+z1WCpeXS0+VJ1TFoNEWJJ8bfuBB0fsMfHo/jlkdr/9k" style="filter:url(&quot;data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22%3E%3Cfilter id=%22$%22%3E%3CfeGaussianBlur stdDeviation=%2210%22/%3E%3CfeColorMatrix type=%22matrix%22 values=%221 0 0 0 0,0 1 0 0 0,0 0 1 0 0,0 0 0 9 0%22/%3E%3CfeComposite in2=%22SourceGraphic%22 operator=%22in%22/%3E%3C/filter%3E%3C/svg%3E#$&quot;);width:100%;max-height:none;transition:opacity 1s;position:absolute"> <img data-src="https://p.sda1.dev/12/bece1d43a7d093583129fdc7202ca924/Fhdt09T7.jpg" data-src-avif="https://p.sda1.dev/12/3a708bab4022d35fa52f12344a6dabfb/m3nkyCIM.jpg" data-src-webp="https://p.sda1.dev/12/04d499bac3b61e1596f370c51686c18a/d1iL6gt0.webp" id="example-1-source" style="visibility:hidden;width:100%;max-height:none"> </div> <button id="example-1-load">加载图片</button> <button id="example-1-unload">恢复初始状态</button>   <p>这样的效果就很完美了！( つ•̀ω•́)つ</p> <h1 id="除了小尺寸的-JPEG，还能用什么作为缩略图？"><a class="headerlink" href="#除了小尺寸的-JPEG，还能用什么作为缩略图？" title="除了小尺寸的 JPEG，还能用什么作为缩略图？"></a>除了小尺寸的 JPEG，还能用什么作为缩略图？</h1><p>CSS-Tricks 的文章还提到了 Facebook 技术团队的<a href="https://engineering.fb.com/2015/08/06/android/the-technology-behind-preview-photos/" rel="noopener" target="_blank">另一篇文章</a>，介绍他们是如何在自家的 APP 中实现图片渐进式加载，使用的方法仍然是先立即显示模糊的缩略图再展示完整图片，但是他们的目标是<strong>将缩略图的大小压到 200 B 左右</strong>。为此他们使用了相同的质量和 Huffman 表等参数进行压图，这样得到的图片就有了固定的标头，只要传输剩下的部分，在客户端再和固定的标头拼接起来，就可以得到使用的缩略图了。</p> <blockquote> <p>So the final format became one byte for version number, one byte each for width and height, and finally the approximately 200 byte payload. The server would just send this format as part of the GraphQL response, and then the client could simply append the JPEG body to the predefined JPEG header, patch the width and height, and treat it as a regular JPEG image.</p> <p>After the standard JPEG decoding, the client could run the predetermined Gaussian blur and scale it to fit the window size.</p> <p>最终的数据格式先是各占 1 B 的版本号和图片的宽度和高度，剩下的部分就是 200 B 左右的负载。服务端只需要从 GraphQL 响应中返回这些数据，客户端简单地将负载拼接到预定义的 JPEG 头部后面，再填上宽度和高度，就可以当成一般的 JPEG 图片使用了。</p> <p>在进行 JPEG 图片解码后，客户端就可以对图片添加高斯模糊并把它缩放到需要的大小。</p> </blockquote> <figure class="akarin-blurred-container"> <div style="padding-bottom:min(30.775%,413px)"></div> <img class="mdui-hoverable mdui-img-rounded" data-src="https://p.sda1.dev/12/078404d8ab2b2cc14f0bf4fc4ddcb2c5/PCPEkNLq.jpg" data-src-avif="https://p.sda1.dev/12/95175c3768eef6ed81c6bdbb2de6bbf0/OB1G85E0.jpg" data-src-webp="https://p.sda1.dev/12/87f7ba58cab07ece16be1c6b87fac673/SdxZk5k0.webp"> <img class="akarin-blurred mdui-hoverable mdui-img-rounded" src="data:image/webp;base64,UklGRpgAAABXRUJQVlA4IIwAAADQAwCdASogAAoAPrVWoUsmiiwCADgFolnAAEfo79/4mrHbDMw2C0AA/vwuITE+/sch5KUqosx8VDMxq4qvg5/V1MgbKKbC94hc3G5g++z4z+pDwuJttG/Zf/EFjw3fm/HSQjtnVuOTfARzkCOrVEyKSbz9e4KGmQa9tYHL1N2B38Tzize1R0WcEKgAAA"> <noscript> <img class="mdui-center mdui-hoverable mdui-img-fluid mdui-img-rounded" src="https://p.sda1.dev/12/078404d8ab2b2cc14f0bf4fc4ddcb2c5/PCPEkNLq.jpg"> </noscript> </figure> <p>自己实现图片渐进式加载的时候当然不一定要做如此极端的优化，制作缩略图时，用任意一个软件把图片的宽度和高度压到 40px 左右，控制压缩 JPEG 的质量使大小在 2 KB 以内其实就可以了。</p> <p>但是用更少的数据来表示缩略图确实是可行的，这里就需要介绍 <a href="https://blurha.sh/" rel="noopener" target="_blank">BlurHash</a> 这个工具了。BlurHash 的算法主要是对原图进行了离散余弦变换，提取出最多 10x10&#x3D;100 个系数，以 0-18 的范围（也就是大约 4.25 bit 的精度，不过对于缩略图已经够用了）表示颜色，按照一些紧凑的规则编码成二进制数据，再使用特别选择的字母表进行 Base83 编码，保证在 URL 和 JSON 等地方不需要额外转义就可以直接传输。详细的编码规则可以参见<a href="https://github.com/woltapp/blurhash/blob/master/Algorithm.md" rel="noopener" target="_blank">这里</a>。</p> <figure class="akarin-blurred-container"> <div style="padding-bottom:min(45.0949%,480px)"></div> <img class="mdui-hoverable mdui-img-rounded" data-src="https://p.sda1.dev/12/3c58250178d463ef7b34d40ba3c32b6e/4OGhJAtT.jpg" data-src-avif="https://p.sda1.dev/12/93188b3f9a2694ff63c0c58246682786/HMRXqvGF.jpg" data-src-webp="https://p.sda1.dev/12/3468ba7ce4c33ec2db79f2eac2daa47a/r057l1uX.webp"> <img class="akarin-blurred mdui-hoverable mdui-img-rounded" src="data:image/webp;base64,UklGRsIAAABXRUJQVlA4ILYAAAAwBACdASogAA4APrVKnkomiWwCADgFolmAJ0fwTABvIAEt1MsK+cnmRNAA/vPxLb88w07tm2IsPip6s5Tsn8MSgE/3ajepZ74vVtKy5BBrCmTct+Bw2aaHlq8KgFK8tWUKE+AOvzARSv04W4iIKUl5XgSq3t0pjg4METEvAv3QIJCHeWfSW4BvVGxqZ7h/RMd6nTz0CN8M7heLm033fjAfMcKu7d3mzNnY1lB11rQmAPAHN4AAAA"> <noscript> <img class="mdui-center mdui-hoverable mdui-img-fluid mdui-img-rounded" src="https://p.sda1.dev/12/3c58250178d463ef7b34d40ba3c32b6e/4OGhJAtT.jpg"> </noscript> </figure> <p>在系数数量为 6x4 的情况下从上面的缩略图得到的 BlurHash 只有 52 B。即使将 10x10 个系数用满，由此得到的最长的 BlurHash 也只有 166 B，这个数据量比 Facebook 的极端优化还要小。</p> <p>需要展示缩略图的时候，只要使用解码库就可以直接将 BlurHash 解码成任意尺寸的位图。系数越少得到的图片就越模糊（或者说是平滑？），但是就算是 10x10 也比前面使用的添加了高斯模糊的低分辨率 JPEG 还要模糊。也许有人会因为想要在模糊的缩略图中多展示一些图片细节而仍然选择低分辨率 JPEG，不过这就是个人喜好不同了 (´▽｀)ノ♪</p> <blockquote> <p>2023-04-30 更新：</p> <p>以在前端开发领域目前被广泛使用的、跑得最快的 JS 打包器 esbuild 为代表作的 evanw 最近推出了 <a href="https://evanw.github.io/thumbhash/" rel="noopener" target="_blank">ThumbHash</a>，原理和使用方式与 BlurHash 非常类似。根据官网上的对比，在相同数据量的情况下从 ThumbHash 解码的图像比 BlurHash 有更多的细节，颜色也更接近原图。</p> <p>ThumbHash 不像 BlurHash 一样允许通过调节系数数量来控制数据量和解码图像的质量，不过如果本来就不想纠结这个的话其实并不算什么缺点。</p> </blockquote> <p>还有其他的一些实现缩略图的方式，和 BlurHash&#x2F;ThumbHash 不同的是它们不需要通过执行 JS 来解码：</p> <ul> <li>Golang 编写的 <a href="https://github.com/fogleman/primitive" rel="noopener" target="_blank">Primitive</a>，可以用数百个椭圆、矩形、三角形等简单的图形对图片进行拟合（如下图所示），输出可以是一个 SVG 文件</li> <li>Typescript 编写的 <a href="https://github.com/axe312ger/sqip" rel="noopener" target="_blank">SQIP</a>，和前者差不多，不过支持的模式更多一些</li> <li>甚至可以通过<a href="https://leanrada.com/notes/css-only-lqip/" rel="noopener" target="_blank">纯 CSS 的方式</a>，借助渐变来实现</li> </ul> <figure class="akarin-blurred-container"> <div style="padding-bottom:min(62.5%,450px)"></div> <img class="mdui-hoverable mdui-img-rounded" data-src="https://p.sda1.dev/12/6c6cd5de13b8cd23dd2985c4d3ac7d36/gocRFLuN.jpg" data-src-avif="https://p.sda1.dev/12/beb4a4956ea45b440675fad7bf90e80b/otUfpNyO.jpg" data-src-webp="https://p.sda1.dev/12/f7433d8bc5c33095a2b969d755cb5dec/ObVzo1Qv.webp"> <img class="akarin-blurred mdui-hoverable mdui-img-rounded" src="data:image/webp;base64,UklGRrQAAABXRUJQVlA4IKgAAAAQBQCdASogABQAPrVInkmqqCmlsBgMAOAWiUAWI9vgNTXsUwEfXki5AcVtKcxJg0IAAP7xD/XyPeT91br6qVF6E679kVj1Dn/OT2sHHDkheUCfWNlrO4Wht4IlibO1S1QMFGIRSm1VjBEw+vr/3H5ihow7X44pd6jbd+7s+00Xvo5fsJe2CXzAB7Dc4/XOk6lT2CZA2lEzEYM85L1BeVTfXtzkVKgAAAA"> <noscript> <img class="mdui-center mdui-hoverable mdui-img-fluid mdui-img-rounded" src="https://p.sda1.dev/12/6c6cd5de13b8cd23dd2985c4d3ac7d36/gocRFLuN.jpg"> </noscript> </figure> <p>这样的缩略图有一个专有名词：低分辨率图像占位符（Low Quality Image Placeholders, LQIP）。以这个为关键词进行搜索的话，大概还能找到其他的一些实现方法。</p> <blockquote> <p>封面图：<a href="https://www.pixiv.net/artworks/83265679" rel="noopener" target="_blank">Pixiv ID: 83265679 「チノちゃんと遊園地デート」 by チノマロン</a></p> </blockquote> <blockquote class="mdui-m-b-0 mdui-m-x-0 mdui-p-y-1" style="border-left:4px solid #0000005c"> <strong>本作品采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。不允许内容农场类网站、CSDN 用户和微信公众号转载，也不允许被自动抓取用于生成式 AI 相关服务。</strong> <br> <strong>本文作者：✨小透明・宸✨</strong> <br> <strong>本文链接：<a href="https://akarin.dev/2021/11/04/progressive-image-loading/">https://akarin.dev/2021/11/04/progressive-image-loading/</a></strong> </blockquote> </article> <div class="mdui-p-b-3 mdui-p-x-3 mdui-typo" id="artalk-container" style="box-sizing:border-box"></div> <script>document.documentMode&&(location.href="../../../../upgrade-browser.html"),window.switchDark=e=>{let t={auto:"mdui-theme-layout-auto",enable:"mdui-theme-layout-dark",disable:""};for(let l in(e=e||localStorage.getItem("dark"))in t||(e="auto"),t)t[l]&&document.body.classList[l===e?"add":"remove"](t[l]);localStorage.setItem("dark",e)},switchDark(),(()=>{let e,t,l,a,n,d="example-0-",o=(e=d+"blurred",document.getElementById(e)),r=(t=d+"source",document.getElementById(t)),i=(l=d+"load",document.getElementById(l)),c=(a=d+"unload",document.getElementById(a)),m=(n=d+"blur",document.getElementById(n));i.onclick=()=>{o.style.opacity=0,r.style.visibility=""},c.onclick=()=>{o.style.opacity=1,r.style.visibility="hidden"},m.onclick=()=>o.style.filter=o.style.filter?"":"blur(10px)"})(),(()=>{let e,t,l,a,n="example-1-",d=(e=n+"blurred",document.getElementById(e)),o=(t=n+"source",document.getElementById(t)),r=(l=n+"load",document.getElementById(l)),i=(a=n+"unload",document.getElementById(a));r.onclick=()=>{d.style.opacity=0,o.style.visibility=""},i.onclick=()=>{d.style.opacity=1,o.style.visibility="hidden"}})(),(()=>{let e=document.createElement("link");e.rel="stylesheet",e.href="https://cdn.jsdelivr.net/npm/artalk@2/dist/Artalk.css";let t=document.createElement("style");t.innerHTML=".atk-comment > .atk-main > .atk-body img:not([atk-emoticon]){max-height:160px}"+[["pink","#ff4081","#ff80ab"]].map(([e,t,l])=>`.mdui-theme-accent-${e} .artalk,.mdui-theme-accent-${e} .artalk-layer-wrap,.mdui-theme-accent-${e} .artalk.atk-dark-mode,.mdui-theme-accent-${e} .artalk-layer-wrap.atk-dark-mode{--at-color-main:${t};--at-color-light:${l}}`).join("");let l=document.createElement("script");l.src="https://cdn.jsdelivr.net/npm/artalk@2/dist/Artalk.js",l.async=!0,l.onload=()=>{Artalk.use(e=>{let t=0,l={},a=(e,a)=>{let n=`__atk_tex_id_${t++}__`;return l[n]={tex:e,isBlock:a},n},n={name:"blockMath",level:"block",tokenizer(e){let t=/^(?:\s{0,3})\$\$((?:[^\n]|\n[^\n])+?)\n{0,1}\$\$/.exec(e);if(t)return{type:"html",raw:t[0],text:a(t[1],!0)}}},d={name:"inlineMath",level:"inline",start(e){let t=e.search(/\$.*?\$/);return -1!==t?t:e.length},tokenizer(e){let t=/^\$(.*?)\$/.exec(e);if(t)return{type:"html",raw:t[0],text:a(t[1],!1)}}};e.on("mounted",()=>{e.getMarked().use({extensions:[n,d]}),e.updateConf({markedReplacers:[e=>e=e.replace(/(__atk_tex_id_\d+__)/g,(e,t)=>{let{tex:a,isBlock:n}=l[t];delete l[t];let d=`https://www.zhihu.com/equation?tex=${encodeURIComponent(a)}`;return n?`<p style="text-align:center"><img src="${d}"></p>`:`<img style="vertical-align:middle" src="${d}">`})]})})}),Artalk.use(e=>e.on("list-loaded",()=>e.getCommentNodes().forEach(e=>Array.from(e.getRender().$content.querySelectorAll("img:not([atk-emoticon])")).forEach(e=>{e.classList.add("mdui-img-rounded"),mediumZoom(e,{margin:16,scrollOffset:8,background:"rgba(0,0,0,.85)"})})))),Artalk.init({el:"#artalk-container",server:"https://comment.akarin.dev",site:"存在感消失的地方|ω•`)"})},document.head.appendChild(e),document.head.appendChild(t),document.body.appendChild(l)})();</script> </div>  <div class="mdui-m-t-2 mdui-valign"> <a class="mdui-btn mdui-btn-icon mdui-ripple" href="../../../../2022/02/15/disable-geckodriver-detection-with-addon/"> <span class="material-icons mdui-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_c"></use></svg></span> </a> <span class="mdui-m-l-1 mdui-text-left mdui-typo-body-1-opacity" title="使用浏览器扩展在运行 Selenium 的 Firefox 浏览器中伪装 navigator.webdriver">上一篇</span> <span class="mdui-text-center mdui-typo-body-1-opacity" style="flex-grow:1"> </span> <span class="mdui-m-r-1 mdui-text-right mdui-typo-body-1-opacity" title="RSA 算法的替代品：X25519/Ed25519 使用记录">下一篇</span> <a class="mdui-btn mdui-btn-icon mdui-ripple" href="../../../09/16/a-taste-of-curve25519/"> <span class="material-icons mdui-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_d"></use></svg></span> </a> </div> </main>  <footer class="mdui-container mdui-m-y-5 mdui-typo" style="max-width:1024px;display:flex"> <div class="mdui-text-left mdui-typo-body-1-opacity"> Copyright © 2026 ✨小透明・宸✨ <br> Hosted by <a href="https://github.com/TransparentLC/transparentlc.github.io" target="_blank">GitHub Pages</a> </div> <div style="flex-grow:1"></div> <div class="mdui-text-right mdui-typo-body-1-opacity"> Powered by <a href="https://hexo.io" target="_blank">Hexo</a> <span class="mdui-hidden-xs-down">8.1.1</span> <br> Theme - <a href="https://github.com/TransparentLC/hexo-theme-akarin" target="_blank">Akarin</a> </div> </footer>  <script src="../../../../js/mdui.min.js"></script> <script src="../../../../js/medium-zoom.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/instant.page@5/instantpage.min.js"></script> <script src="../../../../js/script.js"></script>  <script async src="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/js/bsz.min.js"></script> </body></html>