<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no" name="viewport"><meta content="✨小透明・宸✨" name="author"><meta content name="keywords"><meta content="来必力（LiveRe） 是一个来自韩国的评论系统，支持使用国内外的一批社交网站账户登录，免去注册过程。
……嘛，这个介绍当然是复制粘贴的了。不过在五年前甚至更久以前、使用 Hexo 搭建个人博客相当流行的时候，来必力确实是各种五花八门..." name="description"><link href="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png" rel="icon shortcut" type="image/ico"><link href="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png" rel="icon"><link href="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png" rel="apple-touch-icon"><link href="/atom.xml" rel="alternate" type="application/atom+xml"><link crossorigin href="https://cdn.jsdelivr.net" rel="preconnect"><link crossorigin href="https://p.sda1.dev" rel="preconnect"><link href="https://comment.akarin.dev" rel="dns-prefetch"><link as="image" href="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/sidebar_header.avif" rel="preload"><link as="image" href="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg" rel="preload"><title>将评论系统从来必力（LiveRe）迁移到 Artalk | 存在感消失的地方|ω•`)</title><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://akarin.dev/2025/01/18/migrate-from-livere-to-artalk/"},"headline":"将评论系统从来必力（LiveRe）迁移到 Artalk","datePublished":"2025-01-18T15:48:17.000Z","dateModified":"2025-01-18T15:48:17.000Z","author":{"@type":"Person","name":"✨小透明・宸✨","image":{"@type":"ImageObject","url":"https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg"},"description":"身处寒夜 把握星光✨"},"publisher":{"@type":"Organization","name":"存在感消失的地方|ω•`)","logo":"https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png"},"keywords":"","description":"来必力（LiveRe） 是一个来自韩国的评论系统，支持使用国内外的一批社交网站账户登录，免去注册过程。\n……嘛，这个介绍当然是复制粘贴的了。不过在五年前甚至更久以前、使用 Hexo 搭建个人博客相当流行的时候，来必力确实是各种五花八门..."}</script><meta content="存在感消失的地方|ω•`)" property="og:site_name"><meta content="将评论系统从来必力（LiveRe）迁移到 Artalk" property="og:title"><meta content="来必力（LiveRe） 是一个来自韩国的评论系统，支持使用国内外的一批社交网站账户登录，免去注册过程。
……嘛，这个介绍当然是复制粘贴的了。不过在五年前甚至更久以前、使用 Hexo 搭建个人博客相当流行的时候，来必力确实是各种五花八门..." property="og:description"><meta content="article" property="og:type"><meta content="https://akarin.dev/2025/01/18/migrate-from-livere-to-artalk/" property="og:url"><meta content="https://p.sda1.dev/21/bc6a40f534e6ad8954a2b28f3799b3ab/9HNH.jpg" property="og:image"><meta content="2025-01-18T15:48:17.000Z" property="article:published_time"><meta content="2025-01-18T15:48:17.000Z" property="article:modified_time"><meta content="✨小透明・宸✨" property="article:author"><link href="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io@798f9d53d869b37aba4e6da5586b23bc5ea50e56/css/mdui.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/combine/gh/TransparentLC/transparentlc.github.io@798f9d53d869b37aba4e6da5586b23bc5ea50e56/css/shiki.min.css,gh/TransparentLC/transparentlc.github.io@798f9d53d869b37aba4e6da5586b23bc5ea50e56/css/style.min.css" rel="stylesheet"><style>*{--sidebar-image:image-set("https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/sidebar_header.avif" type("image/avif"), "https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/sidebar_header.webp" type("image/webp"), url(https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/sidebar_header.jpg));--sidebar-image-color:#958981;--banner-image:image-set("https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/daily_pic.avif" type("image/avif"), "https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/daily_pic.webp" type("image/webp"), url(https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/daily_pic.png));--banner-image-color:#f09ea3;--post-thumbnail-color:#f09ea3}.MathJax[jax=SVG][display=true]{text-align:center;margin:1em 0;display:block}svg.registry{display:none}.__s_0{--shiki-light:#a626a4;--shiki-dark:#c586c0}.__s_1{--shiki-light:#383a42;--shiki-dark:#d4d4d4}.__s_2{--shiki-light:#0184bc;--shiki-dark:#dcdcaa}.__s_3{--shiki-light:#50a14f;--shiki-dark:#ce9178}.__s_4{--shiki-light:#a626a4;--shiki-dark:#569cd6}.__s_5{--shiki-light:#986801;--shiki-dark:#9cdcfe}.__s_6{--shiki-light:#e45649;--shiki-dark:#569cd6}.__s_7{--shiki-light:#986801;--shiki-dark:#569cd6}.__s_8{--shiki-light:#986801;--shiki-dark:#b5cea8}.__s_9{--shiki-light:#383a42;--shiki-dark:#d4d4d4;--shiki-light-bg:#fafafa;--shiki-dark-bg:#1e1e1e}.__s_a{--shiki-light:#383a42;--shiki-dark:gray}.__s_b{--shiki-light:#383a42;--shiki-dark:#9cdcfe}.__s_c{--shiki-light:#0184bc;--shiki-dark:#d4d4d4}.__s_d{--shiki-light:#4078f2;--shiki-dark:#dcdcaa}.__s_e{--shiki-light:#0184bc;--shiki-dark:#569cd6}.__s_f{--shiki-light:#e45649;--shiki-dark:#9cdcfe}.__s_g{--shiki-light:white;--shiki-dark:#f44747}.__s_h{--shiki-light:#c18401;--shiki-dark:#4ec9b0}.__s_i{--shiki-light:#0184bc;--shiki-dark:#4ec9b0}.__s_j{--shiki-light:#a0a1a7;--shiki-light-font-style:italic;--shiki-dark:#6a9955;--shiki-dark-font-style:inherit}.__s_k{--shiki-light:#986801;--shiki-dark:#4fc1ff}.__s_l{--shiki-light:#ca1243;--shiki-dark:#569cd6}.__s_m{--shiki-light:#50a14f;--shiki-dark:#d4d4d4}.__s_n{--shiki-light:#ca1243;--shiki-dark:#ce9178}.__s_o{--shiki-light:#ca1243;--shiki-dark:#d16969}.__s_p{--shiki-light:#0184bc;--shiki-dark:#d7ba7d}.__s_q{--shiki-light:#986801;--shiki-dark:#d16969}.__s_r{--shiki-light:#a626a4;--shiki-dark:#dcdcaa}.__s_s{--shiki-light:#c18401;--shiki-dark:#9cdcfe}.__s_t{--shiki-light:#0184bc;--shiki-dark:#9cdcfe}.__s_u{--shiki-light:#0184bc;--shiki-dark:#d16969}.__s_v{--shiki-light:#986801;--shiki-dark:#ce9178}.__s_w{--shiki-light:#0184bc;--shiki-dark:#ce9178}</style><meta content="Hexo 8.1.1" name="generator"></head><body class="mdui-drawer-body-left mdui-theme-accent-pink mdui-theme-primary-pink"><svg class="registry"><defs><path id="__i_0" d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/><path id="__i_1" d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/><path id="__i_2" d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4"/><path id="__i_3" d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"/><path id="__i_4" d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 10-2.5-1.5L15 12V4h5z"/><path id="__i_5" d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20 5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27zm0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93z"/><path id="__i_6" d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/><path id="__i_7" d="M22 18v4h-4v-3h-3v-3h-3l-2.26-2.26c-.55.17-1.13.26-1.74.26a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6c0 .61-.09 1.19-.26 1.74zM7 5a2 2 0 0 0-2 2 2 2 0 0 0 2 2 2 2 0 0 0 2-2 2 2 0 0 0-2-2"/><path id="__i_8" d="M6.5 20q-2.28 0-3.89-1.57Q1 16.85 1 14.58q0-1.95 1.17-3.48 1.18-1.53 3.08-1.95.58-2.02 2.14-3.4Q8.95 4.38 11 4.08v8.07L9.4 10.6 8 12l4 4 4-4-1.4-1.4-1.6 1.55V4.08q2.58.35 4.29 2.31T19 11q1.73.2 2.86 1.5 1.14 1.28 1.14 3 0 1.88-1.31 3.19T18.5 20Z"/><path id="__i_9" d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/><path id="__i_a" d="M7.41 8.58 12 13.17l4.59-4.59L18 10l-6 6-6-6z"/><path id="__i_b" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2M9 17H7v-7h2zm4 0h-2V7h2zm4 0h-2v-4h2z"/><path id="__i_c" d="M15.41 16.58 10.83 12l4.58-4.59L14 6l-6 6 6 6z"/><path id="__i_d" d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6z"/></defs></svg>    <button class="mdui-fab mdui-m-a-2 mdui-shadow-0 mdui-text-color-grey-700" mdui-drawer="{target:'#akarin-drawer'}" style="z-index:1;position:fixed"><span class="mdui-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_0"></use></svg></span></button>  <nav class="mdui-drawer mdui-drawer-full-height mdui-shadow-6" id="akarin-drawer"> <div class="akarin-util-bg-cover mdui-p-x-2" id="akarin-drawer-media"> <img alt="✨小透明・宸✨ 的头像" class="akarin-hover-spin mdui-img-circle mdui-m-t-4" id="akarin-drawer-avatar" src="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg"> <div class="akarin-util-text-gradient mdui-card-media-covered"> <div class="mdui-card-primary"> <div class="mdui-typo-subheading">✨小透明・宸✨ </div> <div class="akarin-util-opacity-half mdui-typo-caption">存在感消失的地方|ω•`) </div> </div> </div> </div> <div class="mdui-list" mdui-collapse> <div> <a class="mdui-list-item mdui-ripple" href="../../../../"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_1"></use></svg></span> <span class="mdui-list-item-content">主页</span> </a> </div> <div> <a class="mdui-list-item mdui-ripple" href="../../../../about/"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_2"></use></svg></span> <span class="mdui-list-item-content">关于</span> </a> </div> <div> <a class="mdui-list-item mdui-ripple" href="../../../../friend/"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_3"></use></svg></span> <span class="mdui-list-item-content">友链</span> </a> </div> <div> <a class="mdui-list-item mdui-ripple" href="../../../../archives/"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_4"></use></svg></span> <span class="mdui-list-item-content">归档</span> <small class="akarin-drawer-badge mdui-color-theme-accent">38</small> </a> </div> <div> <a class="mdui-list-item mdui-ripple" href="../../../../atom.xml"> <i class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_5"></use></svg></i> <span class="mdui-list-item-content">RSS</span> </a> </div> <div class="mdui-divider"></div> <div> <a class="mdui-list-item mdui-ripple" href="https://github.com/TransparentLC" rel="noopener" target="_blank"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_6"></use></svg></span> <span class="mdui-list-item-content">GitHub</span> </a> </div> <div> <a class="mdui-list-item mdui-ripple" href="https://github.com/TransparentLC.gpg" rel="noopener" target="_blank"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_7"></use></svg></span> <span class="mdui-list-item-content">PGP 公钥</span> </a> </div> <div> <a class="mdui-list-item mdui-ripple" href="https://fuwafuwa.akarin.dev/" rel="noopener" target="_blank"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_8"></use></svg></span> <span class="mdui-list-item-content">下载站</span> </a> </div> <div class="mdui-divider"></div> <div class="mdui-collapse-item mdui-collapse-item-open"> <div class="mdui-collapse-item-header mdui-list-item mdui-ripple"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_9"></use></svg></span> <span class="mdui-list-item-content">深色模式</span> <span class="mdui-collapse-item-arrow mdui-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_a"></use></svg></span> </div> <div class="mdui-collapse-item-body mdui-list"> <div class="mdui-list-item mdui-ripple" data-dark="auto"> <span class="mdui-list-item-content">根据系统主题切换</span> </div> <div class="mdui-list-item mdui-ripple" data-dark="enable"> <span class="mdui-list-item-content">启用</span> </div> <div class="mdui-list-item mdui-ripple" data-dark="disable"> <span class="mdui-list-item-content">禁用</span> </div> </div> </div> <div class="mdui-collapse-item mdui-collapse-item-open"> <div class="mdui-collapse-item-header mdui-list-item mdui-ripple"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_b"></use></svg></span> <span class="mdui-list-item-content">访问统计</span> <span class="mdui-collapse-item-arrow mdui-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_a"></use></svg></span> </div> <div class="mdui-collapse-item-body mdui-list"> <div class="mdui-list-item mdui-ripple"> <span class="mdui-list-item-content">站点访问量</span> <small class="akarin-drawer-badge mdui-color-theme-accent" id="busuanzi_value_site_pv">Loading</small> </div> <div class="mdui-list-item mdui-ripple"> <span class="mdui-list-item-content">站点访客数</span> <small class="akarin-drawer-badge mdui-color-theme-accent" id="busuanzi_value_site_uv">Loading</small> </div> <div class="mdui-list-item mdui-ripple"> <span class="mdui-list-item-content">页面访问量</span> <small class="akarin-drawer-badge mdui-color-theme-accent" id="busuanzi_value_page_pv">Loading</small> </div> </div> </div> </div> </nav>  <picture id="akarin-top" title="返回顶部"> <source srcset="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/top.avif" type="image/avif"> <source srcset="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/top.webp" type="image/webp"> <img alt="返回顶部" src="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/top.png">   </picture>  <div style="padding-top:20px"></div> <div class="mdui-hidden-sm-down" style="padding-top:40px"></div> <div class="mdui-hidden-md-down" style="padding-top:40px"></div>  <main class="mdui-container" style="max-width:1024px"> <div class="akarin-util-rounded-5 mdui-card mdui-shadow-4"> <div class="akarin-post-bg akarin-util-bg-cover mdui-ripple" data-src="https://p.sda1.dev/21/bc6a40f534e6ad8954a2b28f3799b3ab/9HNH.jpg" data-src-avif="https://p.sda1.dev/21/f57c1b96d9add0eff20c21c9d0839f7a/lBNt.avif" data-src-webp="https://p.sda1.dev/21/c67c474134190ed5cdfcf586e437283c/BaRa.webp"> <div class="akarin-blurred akarin-post-bg akarin-util-bg-cover" style="background-image:url(data:image/webp;base64,UklGRloBAABXRUJQVlA4IE4BAABwCACdASpAACcAPrVSoEyikpHStmRwC0SygGouCVo4HI3rNIKG5OxdzSaEg0wfBMrI7IOUDf115fV2oo0iRzLE23rjn3EdJLk1UWgAAP75sVAAke7QcOAGzroOiCOanR6jgbUe9uTzg4inCc9OsyI2pOMyXwK1LdGRjkt8H6Wl83VfWC+m2QMnCNqEkmkAP4wGsVFAcF907b7LBkorHgucbXTnuerO2OYKPqcJaJUjmrwRvkjKaUVhaw6KigSMjtnUBYpxzbc2/Nrj27mKGXVkj98L9496DW5GITWB8MsuF0R4wYT78T+8uImKse7a9tmpdFQU+F53APDj/LO9GYWD4gR7WY9trWutx0pwwJBn0diSsb8SbSylqeClET+b3JqlnuAAUKgLaUqKc4A5O2mvGBRQTdNGI3PABFqyDQ6Ub9aw3NdFh7aIsLEPEAAA)"></div> <div class="akarin-post-title akarin-util-text-gradient"> <div class="mdui-card-primary"> <div class="mdui-card-primary-title mdui-text-color-white-text"> 将评论系统从来必力（LiveRe）迁移到 Artalk </div> </div> </div> </div> <div class="mdui-card-header mdui-valign"> <div> <img alt="✨小透明・宸✨ 的头像" class="akarin-hover-spin mdui-card-header-avatar" src="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg"> <div class="mdui-card-header-title">✨小透明・宸✨</div> <div class="mdui-card-header-subtitle">2025-01-18 23:48:17</div> </div> </div> <article class="mdui-card-content mdui-p-a-3 mdui-typo"> <p><a href="https://livere.com/" rel="noopener" target="_blank">来必力（LiveRe）</a> 是一个来自韩国的评论系统，支持使用国内外的一批社交网站账户登录，免去注册过程。</p> <p>……嘛，这个介绍当然是复制粘贴的了。不过在五年前甚至更久以前、使用 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> 搭建个人博客相当流行的时候，来必力确实是各种五花八门的评论系统中相当有竞争力的选项之一。同期流行的其他评论系统中，多说和畅言已经寄了、<a href="https://disqus.com/" rel="noopener" target="_blank">Disqus</a> 需要翻墙、<a href="https://github.com/gitalk/gitalk" rel="noopener" target="_blank">Gitalk</a> 和 <a href="https://github.com/imsun/gitment" rel="noopener" target="_blank">Gitment</a> 这种使用 GitHub 的 issue 存储评论内容的系统嘛……毕竟不是每个路人都有 GitHub 账号的，而且 Gitment 也已经弃坑了。</p> <p>不过我一开始实际上没有对比这么多，选择使用 Hexo 和来必力都是因为那个时候看到认识的人的博客上在用这个，所以就跟着用了 (´ﾟωﾟ｀)</p> <p>一个评论系统当然应该有评论提醒的功能，这样站长才有可能及时地与评论者进行讨论和交流。来必力一开始是有评论的邮件提醒功能的，但是大概是在 2021 年的时候，不知道为什么这个邮件提醒功能就失效了，官方也没有给出任何相关的通知。当我意识到这一点的时候……那个时候正好我在我自己的服务器上自建了一个邮箱，于是我想到了通过定时模拟登录管理后台、爬取最近的评论内容、然后给自己发邮件的方式，曲线补上了这个缺失的邮件提醒功能。</p> <details> <summary>当时写的邮件提醒脚本</summary> <figure><pre class="__s_9 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_0">import</span><span class="__s_1"> email.header</span></span>
<span class="line"><span class="__s_0">import</span><span class="__s_1"> email.mime.text</span></span>
<span class="line"><span class="__s_0">import</span><span class="__s_1"> email.utils</span></span>
<span class="line"><span class="__s_0">import</span><span class="__s_1"> orjson</span></span>
<span class="line"><span class="__s_0">import</span><span class="__s_1"> requests</span></span>
<span class="line"><span class="__s_0">import</span><span class="__s_1"> smtplib</span></span>
<span class="line"><span class="__s_0">import</span><span class="__s_1"> time</span></span>
<span class="line"></span>
<span class="line"><span class="__s_2">__import__</span><span class="__s_1">(</span><span class="__s_3">'requests.models'</span><span class="__s_1">).Response.json = </span><span class="__s_4">lambda</span><span class="__s_5"> self</span><span class="__s_1">, **</span><span class="__s_5">kwargs</span><span class="__s_1">: orjson.loads(</span><span class="__s_6">self</span><span class="__s_1">.content)</span></span>
<span class="line"></span>
<span class="line"><span class="__s_1">USERNAME = </span><span class="__s_3">'...'</span></span>
<span class="line"><span class="__s_1">PASSWORD = </span><span class="__s_3">'...'</span></span>
<span class="line"><span class="__s_1">SMTP_HOST = </span><span class="__s_3">'...'</span></span>
<span class="line"><span class="__s_1">SMTP_USER = </span><span class="__s_3">'noreply@example.com'</span></span>
<span class="line"><span class="__s_1">SMTP_PASSWORD = </span><span class="__s_3">'...'</span></span>
<span class="line"><span class="__s_1">NOTIFY_TARGET = </span><span class="__s_3">'dummy@example.com'</span></span>
<span class="line"></span>
<span class="line"><span class="__s_1">d = time.strftime(</span><span class="__s_3">'%Y-%m-</span><span class="__s_7">%d</span><span class="__s_3">'</span><span class="__s_1">, time.localtime(time.time() - </span><span class="__s_8">86400</span><span class="__s_1">))</span></span>
<span class="line"><span class="__s_2">print</span><span class="__s_1">(</span><span class="__s_3">'Checking comment on'</span><span class="__s_1">, d)</span></span>
<span class="line"></span>
<span class="line"><span class="__s_1">s = requests.Session()</span></span>
<span class="line"><span class="__s_1">s.hooks[</span><span class="__s_3">'response'</span><span class="__s_1">].append(</span><span class="__s_4">lambda</span><span class="__s_5"> r</span><span class="__s_1">, *</span><span class="__s_5">args</span><span class="__s_1">, **</span><span class="__s_5">kwarg</span><span class="__s_1">: r.raise_for_status())</span></span>
<span class="line"></span>
<span class="line"><span class="__s_1">r = s.post(</span></span>
<span class="line"><span class="__s_3">    'https://was.livere.me/login'</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_5">    data</span><span class="__s_1">={</span></span>
<span class="line"><span class="__s_3">        'username'</span><span class="__s_1">: USERNAME,</span></span>
<span class="line"><span class="__s_3">        'password'</span><span class="__s_1">: PASSWORD,</span></span>
<span class="line"><span class="__s_1">    },</span></span>
<span class="line"><span class="__s_1">)</span></span>
<span class="line"><span class="__s_1">code = r.json()[</span><span class="__s_3">'code'</span><span class="__s_1">]</span></span>
<span class="line"></span>
<span class="line"><span class="__s_1">r = s.get(</span></span>
<span class="line"><span class="__s_3">    'https://livere.com/doLogin'</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_5">    params</span><span class="__s_1">={</span></span>
<span class="line"><span class="__s_3">        'code'</span><span class="__s_1">: code,</span></span>
<span class="line"><span class="__s_3">        'username'</span><span class="__s_1">: USERNAME,</span></span>
<span class="line"><span class="__s_1">    },</span></span>
<span class="line"><span class="__s_1">)</span></span>
<span class="line"><span class="__s_1">code = r.json()[</span><span class="__s_3">'secretCode'</span><span class="__s_1">]</span></span>
<span class="line"></span>
<span class="line"><span class="__s_1">r = s.get(</span></span>
<span class="line"><span class="__s_3">    'https://livere.com/login_callback'</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_5">    params</span><span class="__s_1">={</span></span>
<span class="line"><span class="__s_3">        'code'</span><span class="__s_1">: code,</span></span>
<span class="line"><span class="__s_1">    },</span></span>
<span class="line"><span class="__s_1">)</span></span>
<span class="line"></span>
<span class="line"><span class="__s_1">r = s.post(</span></span>
<span class="line"><span class="__s_3">    'https://livere.com/insight/managereply/period'</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_5">    data</span><span class="__s_1">={</span></span>
<span class="line"><span class="__s_3">        'startDate'</span><span class="__s_1">: d,</span></span>
<span class="line"><span class="__s_3">        'endDate'</span><span class="__s_1">: d,</span></span>
<span class="line"><span class="__s_3">        'sort'</span><span class="__s_1">: </span><span class="__s_3">'regdate'</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_1">    },</span></span>
<span class="line"><span class="__s_1">)</span></span>
<span class="line"></span>
<span class="line"><span class="__s_0">if</span><span class="__s_1"> resultData := r.json()[</span><span class="__s_3">'resultData'</span><span class="__s_1">]:</span></span>
<span class="line"><span class="__s_1">    replyContent = </span><span class="__s_3">'&#x3C;table>&#x3C;thead>&#x3C;tr>&#x3C;th>评论&#x3C;/th>&#x3C;th>页面&#x3C;/th>&#x3C;th>时间&#x3C;/th>&#x3C;/thead>&#x3C;tbody>'</span></span>
<span class="line"><span class="__s_0">    for</span><span class="__s_1"> reply </span><span class="__s_0">in</span><span class="__s_1"> resultData:</span></span>
<span class="line"><span class="__s_2">        print</span><span class="__s_1">(reply)</span></span>
<span class="line"><span class="__s_1">        replyContent += </span><span class="__s_3">'&#x3C;tr>&#x3C;td>&#x3C;strong></span><span class="__s_7">{3}</span><span class="__s_3">&#x3C;/strong>&#x3C;br></span><span class="__s_7">{4}</span><span class="__s_3">&#x3C;/td>&#x3C;td>&#x3C;a href="</span><span class="__s_7">{2}</span><span class="__s_3">" target="_blank"></span><span class="__s_7">{1}</span><span class="__s_3">&#x3C;/a>&#x3C;/td>&#x3C;td></span><span class="__s_7">{0}</span><span class="__s_3">&#x3C;/td>&#x3C;/tr>'</span><span class="__s_1">.format(</span></span>
<span class="line"><span class="__s_1">            time.strftime(</span><span class="__s_3">'%Y-%m-</span><span class="__s_7">%d</span><span class="__s_3"> %H:%M:%S'</span><span class="__s_1">, time.strptime(reply[</span><span class="__s_3">'regdate'</span><span class="__s_1">], </span><span class="__s_3">'%Y-%m-</span><span class="__s_7">%d</span><span class="__s_3">-%I:%M:%S %p'</span><span class="__s_1">)),</span></span>
<span class="line"><span class="__s_1">            reply[</span><span class="__s_3">'title'</span><span class="__s_1">],</span></span>
<span class="line"><span class="__s_1">            reply[</span><span class="__s_3">'site'</span><span class="__s_1">],</span></span>
<span class="line"><span class="__s_1">            reply[</span><span class="__s_3">'name'</span><span class="__s_1">],</span></span>
<span class="line"><span class="__s_1">            reply[</span><span class="__s_3">'content'</span><span class="__s_1">],</span></span>
<span class="line"><span class="__s_1">        )</span></span>
<span class="line"><span class="__s_1">    replyContent += </span><span class="__s_3">'&#x3C;/tbody>&#x3C;/table>'</span></span>
<span class="line"><span class="__s_0">    with</span><span class="__s_1"> smtplib.SMTP_SSL(SMTP_HOST) </span><span class="__s_0">as</span><span class="__s_1"> smtp:</span></span>
<span class="line"><span class="__s_1">        smtp.login(SMTP_USER, SMTP_PASSWORD)</span></span>
<span class="line"><span class="__s_1">        message = email.mime.text.MIMEText(</span></span>
<span class="line"><span class="__s_4">            f</span><span class="__s_3">'https://akarin.dev/ 在 </span><span class="__s_7">{</span><span class="__s_1">d</span><span class="__s_7">}</span><span class="__s_3"> 收到了 </span><span class="__s_7">{</span><span class="__s_2">len</span><span class="__s_1">(resultData)</span><span class="__s_7">}</span><span class="__s_3"> 条评论：&#x3C;br></span><span class="__s_7">{</span><span class="__s_1">replyContent</span><span class="__s_7">}</span><span class="__s_3">'</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_3">            'html'</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_3">            'utf-8'</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_1">        )</span></span>
<span class="line"><span class="__s_1">        message[</span><span class="__s_3">'From'</span><span class="__s_1">] = email.utils.formataddr((</span><span class="__s_3">'Akarin Server'</span><span class="__s_1">, SMTP_USER))</span></span>
<span class="line"><span class="__s_1">        message[</span><span class="__s_3">'To'</span><span class="__s_1">] = NOTIFY_TARGET</span></span>
<span class="line"><span class="__s_1">        message[</span><span class="__s_3">'Subject'</span><span class="__s_1">] = email.header.Header(</span><span class="__s_3">'[Akarin Server] LiveRe 评论提醒'</span><span class="__s_1">, </span><span class="__s_3">'utf-8'</span><span class="__s_1">).encode()</span></span>
<span class="line"><span class="__s_1">        smtp.sendmail(SMTP_USER, (NOTIFY_TARGET,), message.as_string())</span></span></code></pre><code class="language">py</code></figure> </details> <p>靠着这个脚本，我算是自己给来必力又续了几年的命。</p> <p>但是，最近我再一次意识到了我没能收到任何评论提醒，连自己写的这个提醒脚本都失效了。我检查了半天脚本，管理后台的各种 API 并没有变化，也不知道是哪里出了问题。</p> <p>直到我发现了一个非常尴尬的事情：</p> <figure class="akarin-blurred-container"> <div style="padding-bottom:min(79.3855%,480px)"></div> <img class="mdui-hoverable mdui-img-rounded" data-src="https://p.sda1.dev/21/3e29da8e97484954e9372d16bf0577d1/gkHJ.png" data-src-webp="https://p.sda1.dev/21/41513427bbbabf0133c7a6f00b3cf4e4/z9zR.webp"> <img class="akarin-blurred mdui-hoverable mdui-img-rounded" src="data:image/webp;base64,UklGRpYAAABXRUJQVlA4IIoAAAAwBACdASogABkAPrFEnUmpIpPb+qwAcAsEs4AAFu/b9iBXgiC/ELEaIAAA/vc1ek5AodyQ99hTXrG3yXmmeJjdrPvAcA/dHEdzy4jX1ONZiAPkYSZaeyJ4W4JhGyXAZiqsIyMDevFOcqp0hQyZhd84pCmtYvBA9n33qC45+3gFS9+OCtG98oAAAAA"> <noscript> <img class="mdui-center mdui-hoverable mdui-img-fluid mdui-img-rounded" src="https://p.sda1.dev/21/3e29da8e97484954e9372d16bf0577d1/gkHJ.png"> </noscript> </figure> <p>“已发布的评论 undefined”</p> <p>我甚至不能在后台查到已有的评论。F12 检查了一下获取评论的 API，如果选定的日期之间有评论的话，这个 API 就会返回“出错了”。</p> <p>来必力当然是有“意见反馈”的，这个按钮指向他们的邮箱。于是我在邮件里尝试报告邮件提醒失效和无法在后台查找评论的问题，发送之后，我收到的回复是这个：</p> <figure class="akarin-blurred-container"> <div style="padding-bottom:min(86.1338%,480px)"></div> <img class="mdui-hoverable mdui-img-rounded" data-src="https://p.sda1.dev/21/ca05db090c42ba687fda30630488dbf9/liF8.png" data-src-webp="https://p.sda1.dev/21/b46f70ec89c0cfb9321fd9a51511a931/P3jQ.webp"> <img class="akarin-blurred mdui-hoverable mdui-img-rounded" src="data:image/webp;base64,UklGRpwAAABXRUJQVlA4IJAAAADQBACdASogABwAPrVKnUmkiOwCADgFolpAC7/wHkf3+vSfGXZMTWzdadguFmjTgAD+9z1+4Va6X8mNsf7jRjlYZsqXgZXRsr+O6duX7WdyegpXgCrvASbGPOPmMqeO3ynRoWGWYEELRDwh4pOGnABtnY+b6J12UiiwC6dCKKR7Cu8T2LNgwXu5BJ6Sla6oAAA"> <noscript> <img class="mdui-center mdui-hoverable mdui-img-fluid mdui-img-rounded" src="https://p.sda1.dev/21/ca05db090c42ba687fda30630488dbf9/liF8.png"> </noscript> </figure> <p>啊，这……</p> <p>虽然现在评论还可以正常发送和加载，但是后台出这么严重的问题迟迟不修复，连反馈的邮箱都无法使用的话，我觉得这已经和停止运营准备跑路没什么区别了。趁现在还能看到评论内容，必须考虑迁移评论系统的事情了。</p> <p>之前在别人的博客上看到有使用 <a href="https://artalk.js.org/" rel="noopener" target="_blank">Artalk</a> 评论系统的，使用下来感觉还不错，评论也不会强制要求注册，所以就决定选择它作为替代品了。Artalk 需要自己部署，不过这没什么难度，而且自己部署的话也可以避免跑路这样的事情。</p> <p>安装 Artalk 是非常简单的，但是还有一个重要的问题是怎么把之前的评论数据也一起迁移过来。Artalk 提供了一个<a href="https://artransfer.netlify.app/" rel="noopener" target="_blank">迁移工具</a>，可以把其他评论系统的数据转换为 Artalk 使用的<a href="https://artalk.js.org/zh/guide/transfer.html#%E6%95%B0%E6%8D%AE%E8%A1%8C%E5%9B%8A" rel="noopener" target="_blank">数据格式</a>（官方称为 Artran），然后导入数据库。不过支持转换的评论系统并不包括来必力，实际上来必力就没有提供将评论数据导出的选项，所以只能自己爬取然后转换了。</p> <p>首先考虑一下怎么爬取来必力的评论数据。</p> <p>设置来必力的时候，需要在网站上加入一段 HTML 代码，以下以我自己的代码为例：</p> <figure><pre class="__s_9 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_a">&#x3C;</span><span class="__s_6">div</span><span class="__s_5"> id</span><span class="__s_1">=</span><span class="__s_3">"lv-container"</span><span class="__s_5"> data-id</span><span class="__s_1">=</span><span class="__s_3">"city"</span><span class="__s_5"> data-uid</span><span class="__s_1">=</span><span class="__s_3">"MTAyMC80NDUwOC8yMTAzOQ=="</span><span class="__s_a">></span></span>
<span class="line"><span class="__s_a">&#x3C;</span><span class="__s_6">script</span><span class="__s_a">></span></span>
<span class="line"><span class="__s_1">   (</span><span class="__s_4">function</span><span class="__s_1">(</span><span class="__s_b">d</span><span class="__s_1">, </span><span class="__s_b">s</span><span class="__s_1">) {</span></span>
<span class="line"><span class="__s_4">       var</span><span class="__s_b"> j</span><span class="__s_1">, </span><span class="__s_b">e</span><span class="__s_c"> =</span><span class="__s_b"> d</span><span class="__s_1">.</span><span class="__s_d">getElementsByTagName</span><span class="__s_1">(</span><span class="__s_b">s</span><span class="__s_1">)[</span><span class="__s_8">0</span><span class="__s_1">];</span></span>
<span class="line"><span class="__s_0">       if</span><span class="__s_1"> (</span><span class="__s_e">typeof</span><span class="__s_b"> LivereTower</span><span class="__s_c"> ===</span><span class="__s_3"> 'function'</span><span class="__s_1">) { </span><span class="__s_0">return</span><span class="__s_1">; }</span></span>
<span class="line"><span class="__s_b">       j</span><span class="__s_c"> =</span><span class="__s_b"> d</span><span class="__s_1">.</span><span class="__s_d">createElement</span><span class="__s_1">(</span><span class="__s_b">s</span><span class="__s_1">);</span></span>
<span class="line"><span class="__s_b">       j</span><span class="__s_1">.</span><span class="__s_f">src</span><span class="__s_c"> =</span><span class="__s_3"> 'https://cdn-city.livere.com/js/embed.dist.js'</span><span class="__s_1">;</span></span>
<span class="line"><span class="__s_b">       j</span><span class="__s_1">.</span><span class="__s_f">async</span><span class="__s_c"> =</span><span class="__s_7"> true</span><span class="__s_1">;</span></span>
<span class="line"><span class="__s_b">       e</span><span class="__s_1">.</span><span class="__s_f">parentNode</span><span class="__s_1">.</span><span class="__s_d">insertBefore</span><span class="__s_1">(</span><span class="__s_b">j</span><span class="__s_1">, </span><span class="__s_b">e</span><span class="__s_1">);</span></span>
<span class="line"><span class="__s_1">   })(</span><span class="__s_b">document</span><span class="__s_1">, </span><span class="__s_3">'script'</span><span class="__s_1">);</span></span>
<span class="line"><span class="__s_a">&#x3C;/</span><span class="__s_6">script</span><span class="__s_a">></span></span>
<span class="line"><span class="__s_a">&#x3C;/</span><span class="__s_6">div</span><span class="__s_a">></span></span></code></pre><code class="language">html</code></figure> <p>这个 <code>uid</code> 是一串 Base64，解码之后是 <code>1020/44508/21039</code>，将这三个数取出来记为 <code>consumerSeq</code>、<code>livereSeq</code>、<code>smartloginSeq</code>。其中 <code>consumerSeq</code> 大概指的是用户类型，<code>1020</code> 对应免费使用的 City 版，<code>livereSeq</code> 和 <code>smartloginSeq</code> 应该是相当于用户 ID 的东西。</p> <p>之后爬取评论需要请求两个 API，以我这里的“关于”页面为例。第一个请求是 <code>https://api-zero.livere.com/v1/common/config?refer=akarin.dev/about/&amp;consumerSeq=1020&amp;livereSeq=44508&amp;smartloginSeq=21039</code>，这里的 <code>refer</code> 实际上是网页的 <code>location.host + location.pathname</code>。</p> <p>部分后续会用到的响应如下：</p> <figure><pre class="__s_9 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_1">{</span></span>
<span class="line"><span class="__s_f">    "results"</span><span class="__s_1">: {</span></span>
<span class="line"><span class="__s_f">        "actions"</span><span class="__s_1">: {</span></span>
<span class="line"><span class="__s_g">            ...</span></span>
<span class="line"><span class="__s_1">        },</span></span>
<span class="line"><span class="__s_f">        "consumer"</span><span class="__s_1">: {</span></span>
<span class="line"><span class="__s_g">            ...</span></span>
<span class="line"><span class="__s_1">        },</span></span>
<span class="line"><span class="__s_f">        "livere"</span><span class="__s_1">: {</span></span>
<span class="line"><span class="__s_g">            ...</span></span>
<span class="line"><span class="__s_1">        },</span></span>
<span class="line"><span class="__s_f">        "smartlogin"</span><span class="__s_1">: {</span></span>
<span class="line"><span class="__s_g">            ...</span></span>
<span class="line"><span class="__s_1">        },</span></span>
<span class="line"><span class="__s_f">        "rep"</span><span class="__s_1">: {</span></span>
<span class="line"><span class="__s_f">            "repSeq"</span><span class="__s_1">: </span><span class="__s_8">4989047</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">            "title"</span><span class="__s_1">: </span><span class="__s_3">"存在感聚集（？）的地方|ω•`) | 存在感消失的地方|ω•`)"</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">            "refer"</span><span class="__s_1">: </span><span class="__s_3">"akarin.dev/about/"</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">            "logo"</span><span class="__s_1">: </span><span class="__s_3">"../img/favicon.png"</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">            "regdate"</span><span class="__s_1">: </span><span class="__s_3">"2020-02-17T04:11:04.000Z"</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">            "consumerSeq"</span><span class="__s_1">: </span><span class="__s_8">1020</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">            "livereSeq"</span><span class="__s_1">: </span><span class="__s_8">44508</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">            "parentCommentsCount"</span><span class="__s_1">: </span><span class="__s_8">28</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">            "totalCount"</span><span class="__s_1">: </span><span class="__s_8">62</span></span>
<span class="line"><span class="__s_1">        },</span></span>
<span class="line"><span class="__s_f">        "plugins"</span><span class="__s_1">: [</span></span>
<span class="line"><span class="__s_g">            ...</span></span>
<span class="line"><span class="__s_1">        ],</span></span>
<span class="line"><span class="__s_f">        "livereAdData"</span><span class="__s_1">: </span><span class="__s_e">null</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">        "livereAdList"</span><span class="__s_1">: [],</span></span>
<span class="line"><span class="__s_f">        "liveContentsData"</span><span class="__s_1">: </span><span class="__s_e">null</span></span>
<span class="line"><span class="__s_1">    },</span></span>
<span class="line"><span class="__s_f">    "resultCode"</span><span class="__s_1">: </span><span class="__s_8">200</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">    "resultMessage"</span><span class="__s_1">: </span><span class="__s_3">"Okay, livere"</span></span>
<span class="line"><span class="__s_1">}</span></span></code></pre><code class="language">json</code></figure> <figure><pre class="__s_9 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_4">type</span><span class="__s_h"> LiveReConfig</span><span class="__s_c"> =</span><span class="__s_1"> {</span></span>
<span class="line"><span class="__s_b">    rep</span><span class="__s_c">:</span><span class="__s_1"> {</span></span>
<span class="line"><span class="__s_b">        repSeq</span><span class="__s_c">?:</span><span class="__s_i"> number</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">        title</span><span class="__s_c">?:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">        refer</span><span class="__s_c">?:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">        logo</span><span class="__s_c">?:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">        regdate</span><span class="__s_c">?:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">        consumerSeq</span><span class="__s_c">?:</span><span class="__s_i"> number</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">        livereSeq</span><span class="__s_c">?:</span><span class="__s_i"> number</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">        parentCommentsCount</span><span class="__s_c">:</span><span class="__s_i"> number</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">        totalCount</span><span class="__s_c">:</span><span class="__s_i"> number</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_1">    },</span></span>
<span class="line"><span class="__s_1">};</span></span></code></pre><code class="language">ts</code></figure> <p>这个 <code>results.rep.repSeq</code> 就是相当于当前页面对应的评论列表的一个 ID，如果当前页面没有评论的话就不会有这个字段。</p> <p>第二个请求是 <code>https://api-zero.livere.com/v1/comments/list?repSeq=4989047&amp;consumerSeq=1020&amp;livereSeq=44508&amp;limit=9007199254740991</code>，这里可以使用 <code>offset</code> 和 <code>limit</code> 两个参数进行分页，但是 <code>limit</code> 似乎可以设成任意大的一个数。</p> <p>部分后续会用到的响应如下：</p> <figure><pre class="__s_9 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_1">{</span></span>
<span class="line"><span class="__s_f">    "results"</span><span class="__s_1">: {</span></span>
<span class="line"><span class="__s_f">        "parents"</span><span class="__s_1">: [</span></span>
<span class="line"><span class="__s_1">            {</span></span>
<span class="line"><span class="__s_f">                "replySeq"</span><span class="__s_1">: </span><span class="__s_8">56377701</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">                "name"</span><span class="__s_1">: </span><span class="__s_3">"NO NICKNAME"</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">                "memberId"</span><span class="__s_1">: </span><span class="__s_3">"UID_7A85086412F723A87421D7E3BF72A05B"</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">                "memberIcon"</span><span class="__s_1">: </span><span class="__s_e">null</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">                "memberUrl"</span><span class="__s_1">: </span><span class="__s_3">"https://qq.com/"</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">                "memberDomain"</span><span class="__s_1">: </span><span class="__s_3">"qq"</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">                "parentSeq"</span><span class="__s_1">: </span><span class="__s_8">56377701</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">                "directSeq"</span><span class="__s_1">: </span><span class="__s_8">0</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">                "title"</span><span class="__s_1">: </span><span class="__s_3">"存在感聚集（？）的地方|ω•`) | 存在感消失的地方|ω•`)"</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">                "site"</span><span class="__s_1">: </span><span class="__s_3">"https://akarin.dev/about/"</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">                "email"</span><span class="__s_1">: </span><span class="__s_e">null</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">                "ipAddress"</span><span class="__s_1">: </span><span class="__s_3">"61.161.154.184"</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">                "agent"</span><span class="__s_1">: </span><span class="__s_3">"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36 Core/1.94.192.400 QQBrowser/11.5.5250.400"</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">                "image1"</span><span class="__s_1">: </span><span class="__s_3">"https://d47jbcq60tnr6.cloudfront.net/2024123/11313-15jbtaz.unyu.png"</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">                "image2"</span><span class="__s_1">: </span><span class="__s_3">"https://d47jbcq60tnr6.cloudfront.net/2024123/5554-afg4zo.fy24.png"</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">                "image3"</span><span class="__s_1">: </span><span class="__s_3">"https://d47jbcq60tnr6.cloudfront.net/2024123/6389-r3sgl8.v59kl.png"</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">                "regdate"</span><span class="__s_1">: </span><span class="__s_3">"2024-12-03T09:21:49.000Z"</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">                "content"</span><span class="__s_1">: </span><span class="__s_3">"博主铁子，我有一个很小众的问题求助：一个年少时的遗憾，以前辜负了一个姑娘，有来往短信若干条备份在百度云，因为年份过于久远（十年前），想回顾再查看时已乱码（如图）。咨询了官方客服也没法解决。当年用的手机是vivo Y11i T_BBK."</span></span>
<span class="line"><span class="__s_1">            },</span></span>
<span class="line"><span class="__s_g">            ...</span></span>
<span class="line"><span class="__s_1">        ],</span></span>
<span class="line"><span class="__s_f">        "children"</span><span class="__s_1">: [</span></span>
<span class="line"><span class="__s_g">            ...</span></span>
<span class="line"><span class="__s_1">        ],</span></span>
<span class="line"><span class="__s_f">        "quotations"</span><span class="__s_1">: []</span></span>
<span class="line"><span class="__s_1">    },</span></span>
<span class="line"><span class="__s_f">    "resultCode"</span><span class="__s_1">: </span><span class="__s_8">200</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">    "resultMessage"</span><span class="__s_1">: </span><span class="__s_3">"Okay, livere"</span></span>
<span class="line"><span class="__s_1">}</span></span></code></pre><code class="language">json</code></figure> <figure><pre class="__s_9 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_4">type</span><span class="__s_h"> LiveReComment</span><span class="__s_c"> =</span><span class="__s_1"> {</span></span>
<span class="line"><span class="__s_b">    replySeq</span><span class="__s_c">:</span><span class="__s_i"> number</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    name</span><span class="__s_c">:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    memberId</span><span class="__s_c">:</span><span class="__s_i"> string</span><span class="__s_1">, </span><span class="__s_j">// 可能是邮箱</span></span>
<span class="line"><span class="__s_b">    memberIcon</span><span class="__s_c">:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    memberUrl</span><span class="__s_c">:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    memberDomain</span><span class="__s_c">:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    directSeq</span><span class="__s_c">:</span><span class="__s_i"> number</span><span class="__s_1">, </span><span class="__s_j">// 父评论ID或0</span></span>
<span class="line"><span class="__s_b">    ipAddress</span><span class="__s_c">:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    regdate</span><span class="__s_c">:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    content</span><span class="__s_c">:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    agent</span><span class="__s_c">?:</span><span class="__s_i"> string</span><span class="__s_1">, </span><span class="__s_j">// User-Agent</span></span>
<span class="line"><span class="__s_b">    image1</span><span class="__s_c">:</span><span class="__s_i"> string</span><span class="__s_c"> |</span><span class="__s_i"> null</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    image2</span><span class="__s_c">:</span><span class="__s_i"> string</span><span class="__s_c"> |</span><span class="__s_i"> null</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    image3</span><span class="__s_c">:</span><span class="__s_i"> string</span><span class="__s_c"> |</span><span class="__s_i"> null</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_1">};</span></span>
<span class="line"></span>
<span class="line"><span class="__s_4">type</span><span class="__s_h"> LiveReCommentList</span><span class="__s_c"> =</span><span class="__s_1"> {</span></span>
<span class="line"><span class="__s_b">    parents</span><span class="__s_c">:</span><span class="__s_h"> LiveReComment</span><span class="__s_1">[],</span></span>
<span class="line"><span class="__s_b">    children</span><span class="__s_c">:</span><span class="__s_h"> LiveReComment</span><span class="__s_1">[],</span></span>
<span class="line"><span class="__s_b">    quotations</span><span class="__s_c">:</span><span class="__s_h"> LiveReComment</span><span class="__s_1">[],</span></span>
<span class="line"><span class="__s_1">};</span></span></code></pre><code class="language">ts</code></figure> <p>这里的 <code>replySeq</code> 就是评论的 ID，<code>directSeq</code> 则是父评论的 ID（不存在时为 <code>0</code>），<code>image&#123;1,2,3&#125;</code> 是评论附上的图片链接。关于评论者信息，<code>email</code> 字段不知为什么总是 <code>null</code>，如果评论者是使用邮箱注册了来必力账号进行评论的话，<code>memberId</code> 就是注册时使用的邮箱。上面这位评论者是使用 QQ 登录的，由此也可见来必力是真的没有在维护了，这都获取不到用户名了……</p> <p>想要爬取所有的评论，就需要获取所有页面的 <code>location.pathname</code> 作为 <code>refer</code>，然后对每个页面都请求上面这两个 API。运行一下 <code>hexo generate</code> 然后复制粘贴终端中 <code>INFO Generated: ...</code> 的输出大概会更方便一些。</p> <p>然后考虑一下怎么转换到 Artran 的<a href="https://artalk.js.org/zh/guide/transfer.html#%E6%95%B0%E6%8D%AE%E8%A1%8C%E5%9B%8A" rel="noopener" target="_blank">数据格式</a>，首先写好类型定义：</p> <figure><pre class="__s_9 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_4">type</span><span class="__s_h"> Artran</span><span class="__s_c"> =</span><span class="__s_1"> {</span></span>
<span class="line"><span class="__s_b">    id</span><span class="__s_c">:</span><span class="__s_i"> number</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    rid</span><span class="__s_c">:</span><span class="__s_i"> number</span><span class="__s_1">, </span><span class="__s_j">// 在不存在父评论的时候，可以直接设为0</span></span>
<span class="line"><span class="__s_b">    content</span><span class="__s_c">:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    ua</span><span class="__s_c">:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    ip</span><span class="__s_c">:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    created_at</span><span class="__s_c">:</span><span class="__s_i"> string</span><span class="__s_1">, </span><span class="__s_j">// 格式：2021-10-28 20:50:15 +0800</span></span>
<span class="line"><span class="__s_b">    updated_at</span><span class="__s_c">:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    is_collapsed</span><span class="__s_c">:</span><span class="__s_i"> boolean</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    is_pending</span><span class="__s_c">?:</span><span class="__s_i"> boolean</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    vote_up</span><span class="__s_c">?:</span><span class="__s_i"> number</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    vote_down</span><span class="__s_c">?:</span><span class="__s_i"> number</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    nick</span><span class="__s_c">:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    email</span><span class="__s_c">:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    link</span><span class="__s_c">:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    password</span><span class="__s_c">?:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    badge_name</span><span class="__s_c">?:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    badge_color</span><span class="__s_c">?:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    page_key</span><span class="__s_c">:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    page_title</span><span class="__s_c">?:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    page_admin_only</span><span class="__s_c">?:</span><span class="__s_i"> boolean</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    site_name</span><span class="__s_c">?:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    site_urls</span><span class="__s_c">?:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_1">};</span></span></code></pre><code class="language">ts</code></figure> <p>根据<a href="https://cyp0633.icu/post/wp-comment-converter/" rel="noopener" target="_blank">这里</a>的说法，如果是导入的话 Artran 的部分字段是可以留空的。</p> <p>和爬取的来必力的评论数据一个个对应上去，最后就可以得到下面的完整代码：</p> <figure><pre class="__s_9 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_4">type</span><span class="__s_h"> Artran</span><span class="__s_c"> =</span><span class="__s_1"> {</span></span>
<span class="line"><span class="__s_c">    ...</span></span>
<span class="line"><span class="__s_1">};</span></span>
<span class="line"></span>
<span class="line"><span class="__s_4">type</span><span class="__s_h"> LiveReConfig</span><span class="__s_c"> =</span><span class="__s_1"> {</span></span>
<span class="line"><span class="__s_c">    ...</span></span>
<span class="line"><span class="__s_1">};</span></span>
<span class="line"></span>
<span class="line"><span class="__s_4">type</span><span class="__s_h"> LiveReComment</span><span class="__s_c"> =</span><span class="__s_1"> {</span></span>
<span class="line"><span class="__s_c">    ...</span></span>
<span class="line"><span class="__s_1">};</span></span>
<span class="line"></span>
<span class="line"><span class="__s_4">type</span><span class="__s_h"> LiveReCommentList</span><span class="__s_c"> =</span><span class="__s_1"> {</span></span>
<span class="line"><span class="__s_c">    ...</span></span>
<span class="line"><span class="__s_1">};</span></span>
<span class="line"></span>
<span class="line"><span class="__s_4">type</span><span class="__s_h"> LiveReResponse</span><span class="__s_1">&#x3C;</span><span class="__s_h">T</span><span class="__s_1">> </span><span class="__s_c">=</span><span class="__s_1"> {</span></span>
<span class="line"><span class="__s_b">    results</span><span class="__s_c">:</span><span class="__s_h"> T</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    resultCode</span><span class="__s_c">:</span><span class="__s_i"> number</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_b">    resultMessage</span><span class="__s_c">:</span><span class="__s_i"> string</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_1">};</span></span>
<span class="line"></span>
<span class="line"><span class="__s_4">const</span><span class="__s_k"> artrans</span><span class="__s_c">:</span><span class="__s_h"> Artran</span><span class="__s_1">[] </span><span class="__s_c">=</span><span class="__s_1"> [];</span></span>
<span class="line"></span>
<span class="line"><span class="__s_4">const</span><span class="__s_k"> uid</span><span class="__s_c"> =</span><span class="__s_3"> 'MTAyMC80NDUwOC8yMTAzOQ=='</span></span>
<span class="line"><span class="__s_4">const</span><span class="__s_1"> [</span><span class="__s_k">consumerSeq</span><span class="__s_1">, </span><span class="__s_k">livereSeq</span><span class="__s_1">, </span><span class="__s_k">smartloginSeq</span><span class="__s_1">] </span><span class="__s_c">=</span><span class="__s_d"> atob</span><span class="__s_1">(</span><span class="__s_b">uid</span><span class="__s_1">).</span><span class="__s_d">split</span><span class="__s_1">(</span><span class="__s_3">'/'</span><span class="__s_1">).</span><span class="__s_d">map</span><span class="__s_1">(</span><span class="__s_b">e</span><span class="__s_4"> =></span><span class="__s_d"> parseInt</span><span class="__s_1">(</span><span class="__s_b">e</span><span class="__s_1">));</span></span>
<span class="line"></span>
<span class="line"><span class="__s_4">const</span><span class="__s_k"> host</span><span class="__s_c"> =</span><span class="__s_3"> 'akarin.dev'</span><span class="__s_1">;</span></span>
<span class="line"></span>
<span class="line"><span class="__s_j">// 2021-10-28 20:50:15 +0800</span></span>
<span class="line"><span class="__s_4">const</span><span class="__s_d"> convertArtransDate</span><span class="__s_c"> =</span><span class="__s_1"> (</span><span class="__s_b">d</span><span class="__s_c">:</span><span class="__s_h"> Date</span><span class="__s_1">) </span><span class="__s_4">=></span><span class="__s_3"> `</span><span class="__s_l">${</span><span class="__s_b">d</span><span class="__s_m">.</span><span class="__s_d">getFullYear</span><span class="__s_1">()</span><span class="__s_l">}</span><span class="__s_3">-</span><span class="__s_l">${</span><span class="__s_1">(</span><span class="__s_b">d</span><span class="__s_m">.</span><span class="__s_d">getMonth</span><span class="__s_1">()</span><span class="__s_c"> +</span><span class="__s_8"> 1</span><span class="__s_1">)</span><span class="__s_m">.</span><span class="__s_d">toString</span><span class="__s_1">()</span><span class="__s_m">.</span><span class="__s_d">padStart</span><span class="__s_1">(</span><span class="__s_8">2</span><span class="__s_1">,</span><span class="__s_n"> '</span><span class="__s_3">0</span><span class="__s_n">'</span><span class="__s_1">)</span><span class="__s_l">}</span><span class="__s_3">-</span><span class="__s_l">${</span><span class="__s_b">d</span><span class="__s_m">.</span><span class="__s_d">getDate</span><span class="__s_1">()</span><span class="__s_m">.</span><span class="__s_d">toString</span><span class="__s_1">()</span><span class="__s_m">.</span><span class="__s_d">padStart</span><span class="__s_1">(</span><span class="__s_8">2</span><span class="__s_1">,</span><span class="__s_n"> '</span><span class="__s_3">0</span><span class="__s_n">'</span><span class="__s_1">)</span><span class="__s_l">}</span><span class="__s_l"> ${</span><span class="__s_b">d</span><span class="__s_m">.</span><span class="__s_d">toTimeString</span><span class="__s_1">()</span><span class="__s_m">.</span><span class="__s_d">replaceAll</span><span class="__s_1">(</span><span class="__s_n">'</span><span class="__s_3">GMT</span><span class="__s_n">'</span><span class="__s_1">,</span><span class="__s_n"> ''</span><span class="__s_1">)</span><span class="__s_m">.</span><span class="__s_d">replace</span><span class="__s_1">(</span><span class="__s_o">/</span><span class="__s_p">\(</span><span class="__s_q">.</span><span class="__s_p">+?\)</span><span class="__s_r">$</span><span class="__s_o">/</span><span class="__s_4">g</span><span class="__s_1">,</span><span class="__s_n"> ''</span><span class="__s_1">)</span><span class="__s_m">.</span><span class="__s_d">trim</span><span class="__s_1">()</span><span class="__s_l">}</span><span class="__s_3">`</span><span class="__s_1">;</span></span>
<span class="line"></span>
<span class="line"><span class="__s_j">// location.host + location.pathname</span></span>
<span class="line"><span class="__s_0">for</span><span class="__s_1"> (</span><span class="__s_4">const</span><span class="__s_k"> pathname</span><span class="__s_4"> of</span><span class="__s_1"> [</span></span>
<span class="line"><span class="__s_3">    '/about/'</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_c">    ...</span></span>
<span class="line"><span class="__s_1">]) {</span></span>
<span class="line"><span class="__s_4">    const</span><span class="__s_k"> u1</span><span class="__s_c"> =</span><span class="__s_4"> new</span><span class="__s_d"> URL</span><span class="__s_1">(</span><span class="__s_3">'https://api-zero.livere.com/v1/common/config'</span><span class="__s_1">);</span></span>
<span class="line"><span class="__s_b">    u1</span><span class="__s_1">.</span><span class="__s_f">searchParams</span><span class="__s_1">.</span><span class="__s_d">set</span><span class="__s_1">(</span><span class="__s_3">'consumerSeq'</span><span class="__s_1">, </span><span class="__s_b">consumerSeq</span><span class="__s_1">.</span><span class="__s_d">toString</span><span class="__s_1">());</span></span>
<span class="line"><span class="__s_b">    u1</span><span class="__s_1">.</span><span class="__s_f">searchParams</span><span class="__s_1">.</span><span class="__s_d">set</span><span class="__s_1">(</span><span class="__s_3">'livereSeq'</span><span class="__s_1">, </span><span class="__s_b">livereSeq</span><span class="__s_1">.</span><span class="__s_d">toString</span><span class="__s_1">());</span></span>
<span class="line"><span class="__s_b">    u1</span><span class="__s_1">.</span><span class="__s_f">searchParams</span><span class="__s_1">.</span><span class="__s_d">set</span><span class="__s_1">(</span><span class="__s_3">'smartloginSeq'</span><span class="__s_1">, </span><span class="__s_b">smartloginSeq</span><span class="__s_1">.</span><span class="__s_d">toString</span><span class="__s_1">());</span></span>
<span class="line"><span class="__s_b">    u1</span><span class="__s_1">.</span><span class="__s_f">searchParams</span><span class="__s_1">.</span><span class="__s_d">set</span><span class="__s_1">(</span><span class="__s_3">'refer'</span><span class="__s_1">, </span><span class="__s_b">host</span><span class="__s_c"> +</span><span class="__s_b"> pathname</span><span class="__s_1">);</span></span>
<span class="line"><span class="__s_4">    const</span><span class="__s_k"> r1</span><span class="__s_c">:</span><span class="__s_h"> LiveReResponse</span><span class="__s_1">&#x3C;</span><span class="__s_h">LiveReConfig</span><span class="__s_1">> </span><span class="__s_c">=</span><span class="__s_0"> await</span><span class="__s_d"> fetch</span><span class="__s_1">(</span><span class="__s_b">u1</span><span class="__s_1">).</span><span class="__s_d">then</span><span class="__s_1">(</span><span class="__s_b">r</span><span class="__s_4"> =></span><span class="__s_b"> r</span><span class="__s_1">.</span><span class="__s_d">json</span><span class="__s_1">());</span></span>
<span class="line"></span>
<span class="line"><span class="__s_j">    // 当前页面没有评论</span></span>
<span class="line"><span class="__s_0">    if</span><span class="__s_1"> (</span><span class="__s_c">!</span><span class="__s_b">r1</span><span class="__s_1">.</span><span class="__s_f">results</span><span class="__s_1">.</span><span class="__s_f">rep</span><span class="__s_1">.</span><span class="__s_f">repSeq</span><span class="__s_1">) </span><span class="__s_0">continue</span><span class="__s_1">;</span></span>
<span class="line"></span>
<span class="line"><span class="__s_4">    const</span><span class="__s_k"> u2</span><span class="__s_c"> =</span><span class="__s_4"> new</span><span class="__s_d"> URL</span><span class="__s_1">(</span><span class="__s_3">'https://api-zero.livere.com/v1/comments/list'</span><span class="__s_1">);</span></span>
<span class="line"><span class="__s_b">    u2</span><span class="__s_1">.</span><span class="__s_f">searchParams</span><span class="__s_1">.</span><span class="__s_d">set</span><span class="__s_1">(</span><span class="__s_3">'consumerSeq'</span><span class="__s_1">, </span><span class="__s_b">consumerSeq</span><span class="__s_1">.</span><span class="__s_d">toString</span><span class="__s_1">());</span></span>
<span class="line"><span class="__s_b">    u2</span><span class="__s_1">.</span><span class="__s_f">searchParams</span><span class="__s_1">.</span><span class="__s_d">set</span><span class="__s_1">(</span><span class="__s_3">'livereSeq'</span><span class="__s_1">, </span><span class="__s_b">livereSeq</span><span class="__s_1">.</span><span class="__s_d">toString</span><span class="__s_1">());</span></span>
<span class="line"><span class="__s_b">    u2</span><span class="__s_1">.</span><span class="__s_f">searchParams</span><span class="__s_1">.</span><span class="__s_d">set</span><span class="__s_1">(</span><span class="__s_3">'repSeq'</span><span class="__s_1">, </span><span class="__s_b">r1</span><span class="__s_1">.</span><span class="__s_f">results</span><span class="__s_1">.</span><span class="__s_f">rep</span><span class="__s_1">.</span><span class="__s_f">repSeq</span><span class="__s_1">.</span><span class="__s_d">toString</span><span class="__s_1">());</span></span>
<span class="line"><span class="__s_b">    u2</span><span class="__s_1">.</span><span class="__s_f">searchParams</span><span class="__s_1">.</span><span class="__s_d">set</span><span class="__s_1">(</span><span class="__s_3">'limit'</span><span class="__s_1">, </span><span class="__s_b">Number</span><span class="__s_1">.MAX_SAFE_INTEGER.</span><span class="__s_d">toString</span><span class="__s_1">());</span></span>
<span class="line"><span class="__s_4">    const</span><span class="__s_k"> r2</span><span class="__s_c">:</span><span class="__s_h"> LiveReResponse</span><span class="__s_1">&#x3C;</span><span class="__s_h">LiveReCommentList</span><span class="__s_1">> </span><span class="__s_c">=</span><span class="__s_0"> await</span><span class="__s_d"> fetch</span><span class="__s_1">(</span><span class="__s_b">u2</span><span class="__s_1">).</span><span class="__s_d">then</span><span class="__s_1">(</span><span class="__s_b">r</span><span class="__s_4"> =></span><span class="__s_b"> r</span><span class="__s_1">.</span><span class="__s_d">json</span><span class="__s_1">());</span></span>
<span class="line"></span>
<span class="line"><span class="__s_b">    artrans</span><span class="__s_1">.</span><span class="__s_d">push</span><span class="__s_1">(</span><span class="__s_c">...</span><span class="__s_1">[</span><span class="__s_c">...</span><span class="__s_b">r2</span><span class="__s_1">.</span><span class="__s_s">results</span><span class="__s_1">.</span><span class="__s_s">parents</span><span class="__s_1">, </span><span class="__s_c">...</span><span class="__s_b">r2</span><span class="__s_1">.</span><span class="__s_s">results</span><span class="__s_1">.</span><span class="__s_s">children</span><span class="__s_1">].</span><span class="__s_d">map</span><span class="__s_1">(</span><span class="__s_b">e</span><span class="__s_4"> =></span><span class="__s_1"> ({</span></span>
<span class="line"><span class="__s_f">        id</span><span class="__s_t">:</span><span class="__s_b"> e</span><span class="__s_1">.</span><span class="__s_f">replySeq</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">        rid</span><span class="__s_t">:</span><span class="__s_b"> e</span><span class="__s_1">.</span><span class="__s_f">directSeq</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">        content</span><span class="__s_t">:</span><span class="__s_b"> e</span><span class="__s_1">.</span><span class="__s_f">content</span><span class="__s_c"> +</span><span class="__s_1"> [</span><span class="__s_b">e</span><span class="__s_1">.</span><span class="__s_s">image1</span><span class="__s_1">, </span><span class="__s_b">e</span><span class="__s_1">.</span><span class="__s_s">image2</span><span class="__s_1">, </span><span class="__s_b">e</span><span class="__s_1">.</span><span class="__s_s">image3</span><span class="__s_1">].</span><span class="__s_d">filter</span><span class="__s_1">(</span><span class="__s_b">Boolean</span><span class="__s_1">).</span><span class="__s_d">map</span><span class="__s_1">(</span><span class="__s_b">e</span><span class="__s_4"> =></span><span class="__s_3"> `</span><span class="__s_p">\n\n</span><span class="__s_3">![](</span><span class="__s_l">${</span><span class="__s_b">e</span><span class="__s_l">}</span><span class="__s_3">)`</span><span class="__s_1">).</span><span class="__s_d">join</span><span class="__s_1">(</span><span class="__s_3">''</span><span class="__s_1">),</span></span>
<span class="line"><span class="__s_f">        ua</span><span class="__s_t">:</span><span class="__s_b"> e</span><span class="__s_1">.</span><span class="__s_f">agent</span><span class="__s_c"> ||</span><span class="__s_3"> 'Mozilla/5.0'</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">        ip</span><span class="__s_t">:</span><span class="__s_b"> e</span><span class="__s_1">.</span><span class="__s_f">ipAddress</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">        created_at</span><span class="__s_t">:</span><span class="__s_d"> convertArtransDate</span><span class="__s_1">(</span><span class="__s_4">new</span><span class="__s_d"> Date</span><span class="__s_1">(</span><span class="__s_b">e</span><span class="__s_1">.</span><span class="__s_f">regdate</span><span class="__s_1">)),</span></span>
<span class="line"><span class="__s_f">        updated_at</span><span class="__s_t">:</span><span class="__s_d"> convertArtransDate</span><span class="__s_1">(</span><span class="__s_4">new</span><span class="__s_d"> Date</span><span class="__s_1">(</span><span class="__s_b">e</span><span class="__s_1">.</span><span class="__s_f">regdate</span><span class="__s_1">)),</span></span>
<span class="line"><span class="__s_f">        is_collapsed</span><span class="__s_t">:</span><span class="__s_7"> false</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">        nick</span><span class="__s_t">:</span><span class="__s_b"> e</span><span class="__s_1">.</span><span class="__s_f">name</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_j">        // html - How can I validate an email address in JavaScript? - Stack Overflow</span></span>
<span class="line"><span class="__s_j">        // https://stackoverflow.com/a/1373724</span></span>
<span class="line"><span class="__s_f">        email</span><span class="__s_t">:</span><span class="__s_b"> e</span><span class="__s_1">.</span><span class="__s_f">memberId</span><span class="__s_1">.</span><span class="__s_d">match</span><span class="__s_1">(</span><span class="__s_u">/</span><span class="__s_v">[</span><span class="__s_q">a-z0-9!#$%&#x26;'*+/=?^_`{|}~-</span><span class="__s_v">]</span><span class="__s_p">+</span><span class="__s_w">(?:</span><span class="__s_p">\.</span><span class="__s_v">[</span><span class="__s_q">a-z0-9!#$%&#x26;'*+/=?^_`{|}~-</span><span class="__s_v">]</span><span class="__s_p">+</span><span class="__s_w">)</span><span class="__s_p">*</span><span class="__s_u">@</span><span class="__s_w">(?:</span><span class="__s_v">[</span><span class="__s_q">a-z0-9</span><span class="__s_v">]</span><span class="__s_w">(?:</span><span class="__s_v">[</span><span class="__s_q">a-z0-9-</span><span class="__s_v">]</span><span class="__s_p">*</span><span class="__s_v">[</span><span class="__s_q">a-z0-9</span><span class="__s_v">]</span><span class="__s_w">)</span><span class="__s_p">?\.</span><span class="__s_w">)</span><span class="__s_p">+</span><span class="__s_v">[</span><span class="__s_q">a-z0-9</span><span class="__s_v">]</span><span class="__s_w">(?:</span><span class="__s_v">[</span><span class="__s_q">a-z0-9-</span><span class="__s_v">]</span><span class="__s_p">*</span><span class="__s_v">[</span><span class="__s_q">a-z0-9</span><span class="__s_v">]</span><span class="__s_w">)</span><span class="__s_p">?</span><span class="__s_u">/</span><span class="__s_4">gi</span><span class="__s_1">)</span></span>
<span class="line"><span class="__s_c">            ?</span><span class="__s_b"> e</span><span class="__s_1">.</span><span class="__s_f">memberId</span></span>
<span class="line"><span class="__s_c">            :</span><span class="__s_3"> 'dummy@example.com'</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">        link</span><span class="__s_t">:</span><span class="__s_b"> e</span><span class="__s_1">.</span><span class="__s_f">memberUrl</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_f">        page_key</span><span class="__s_t">:</span><span class="__s_b"> pathname</span><span class="__s_1">,</span></span>
<span class="line"><span class="__s_1">    })));</span></span>
<span class="line"><span class="__s_1">}</span></span>
<span class="line"></span>
<span class="line"><span class="__s_b">artrans</span><span class="__s_1">.</span><span class="__s_d">sort</span><span class="__s_1">((</span><span class="__s_b">a</span><span class="__s_1">, </span><span class="__s_b">b</span><span class="__s_1">) </span><span class="__s_4">=></span><span class="__s_b"> a</span><span class="__s_1">.</span><span class="__s_f">id</span><span class="__s_c"> -</span><span class="__s_b"> b</span><span class="__s_1">.</span><span class="__s_f">id</span><span class="__s_1">);</span></span>
<span class="line"></span>
<span class="line"><span class="__s_j">// console.log(artrans);</span></span>
<span class="line"></span>
<span class="line"><span class="__s_b">console</span><span class="__s_1">.</span><span class="__s_d">log</span><span class="__s_1">(</span><span class="__s_k">JSON</span><span class="__s_1">.</span><span class="__s_d">stringify</span><span class="__s_1">(</span><span class="__s_b">artrans</span><span class="__s_1">, </span><span class="__s_7">undefined</span><span class="__s_1">, </span><span class="__s_8">2</span><span class="__s_1">));</span></span></code></pre><code class="language">ts</code></figure> <p>导入评论数据时，Artalk 会自动根据 Artran 里的用户信息创建用户，并将评论 ID 调整为自增值。</p> <blockquote> <p>封面图：<a href="https://www.pixiv.net/artworks/119247734" rel="noopener" target="_blank">Pixiv ID: 119247734 「🎀」 by 茶白ひな</a></p> </blockquote> <blockquote class="mdui-m-b-0 mdui-m-x-0 mdui-p-y-1" style="border-left:4px solid #0000005c"> <strong>本作品采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。不允许内容农场类网站、CSDN 用户和微信公众号转载，也不允许被自动抓取用于生成式 AI 相关服务。</strong> <br> <strong>本文作者：✨小透明・宸✨</strong> <br> <strong>本文链接：<a href="https://akarin.dev/2025/01/18/migrate-from-livere-to-artalk/">https://akarin.dev/2025/01/18/migrate-from-livere-to-artalk/</a></strong> </blockquote> </article> <div class="mdui-p-b-3 mdui-p-x-3 mdui-typo" id="artalk-container" style="box-sizing:border-box"></div> <script>document.documentMode&&(location.href="../../../../upgrade-browser.html"),window.switchDark=e=>{let t={auto:"mdui-theme-layout-auto",enable:"mdui-theme-layout-dark",disable:""};for(let a in(e=e||localStorage.getItem("dark"))in t||(e="auto"),t)t[a]&&document.body.classList[a===e?"add":"remove"](t[a]);localStorage.setItem("dark",e)},switchDark(),(()=>{let e=document.createElement("link");e.rel="stylesheet",e.href="https://cdn.jsdelivr.net/npm/artalk@2/dist/Artalk.css";let t=document.createElement("style");t.innerHTML=".atk-comment > .atk-main > .atk-body img:not([atk-emoticon]){max-height:160px}"+[["pink","#ff4081","#ff80ab"]].map(([e,t,a])=>`.mdui-theme-accent-${e} .artalk,.mdui-theme-accent-${e} .artalk-layer-wrap,.mdui-theme-accent-${e} .artalk.atk-dark-mode,.mdui-theme-accent-${e} .artalk-layer-wrap.atk-dark-mode{--at-color-main:${t};--at-color-light:${a}}`).join("");let a=document.createElement("script");a.src="https://cdn.jsdelivr.net/npm/artalk@2/dist/Artalk.js",a.async=!0,a.onload=()=>{Artalk.use(e=>{let t=0,a={},n=(e,n)=>{let r=`__atk_tex_id_${t++}__`;return a[r]={tex:e,isBlock:n},r},r={name:"blockMath",level:"block",tokenizer(e){let t=/^(?:\s{0,3})\$\$((?:[^\n]|\n[^\n])+?)\n{0,1}\$\$/.exec(e);if(t)return{type:"html",raw:t[0],text:n(t[1],!0)}}},l={name:"inlineMath",level:"inline",start(e){let t=e.search(/\$.*?\$/);return -1!==t?t:e.length},tokenizer(e){let t=/^\$(.*?)\$/.exec(e);if(t)return{type:"html",raw:t[0],text:n(t[1],!1)}}};e.on("mounted",()=>{e.getMarked().use({extensions:[r,l]}),e.updateConf({markedReplacers:[e=>e=e.replace(/(__atk_tex_id_\d+__)/g,(e,t)=>{let{tex:n,isBlock:r}=a[t];delete a[t];let l=`https://www.zhihu.com/equation?tex=${encodeURIComponent(n)}`;return r?`<p style="text-align:center"><img src="${l}"></p>`:`<img style="vertical-align:middle" src="${l}">`})]})})}),Artalk.use(e=>e.on("list-loaded",()=>e.getCommentNodes().forEach(e=>Array.from(e.getRender().$content.querySelectorAll("img:not([atk-emoticon])")).forEach(e=>{e.classList.add("mdui-img-rounded"),mediumZoom(e,{margin:16,scrollOffset:8,background:"rgba(0,0,0,.85)"})})))),Artalk.init({el:"#artalk-container",server:"https://comment.akarin.dev",site:"存在感消失的地方|ω•`)"})},document.head.appendChild(e),document.head.appendChild(t),document.body.appendChild(a)})();</script> </div>  <div class="mdui-m-t-2 mdui-valign"> <a class="mdui-btn mdui-btn-icon mdui-ripple" href="../../../03/25/interview-of-doujin-culture/"> <span class="material-icons mdui-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_c"></use></svg></span> </a> <span class="mdui-m-l-1 mdui-text-left mdui-typo-body-1-opacity" title="关于同人的访谈：一位东方同人创作者的经历和视角">上一篇</span> <span class="mdui-text-center mdui-typo-body-1-opacity" style="flex-grow:1"> </span> <span class="mdui-m-r-1 mdui-text-right mdui-typo-body-1-opacity" title="西方 Project 幡紫龙 C74 版汉化（魔改）记录">下一篇</span> <a class="mdui-btn mdui-btn-icon mdui-ripple" href="../../../../2024/01/19/banshiryuu-modification/"> <span class="material-icons mdui-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_d"></use></svg></span> </a> </div> </main>  <footer class="mdui-container mdui-m-y-5 mdui-typo" style="max-width:1024px;display:flex"> <div class="mdui-text-left mdui-typo-body-1-opacity"> Copyright © 2026 ✨小透明・宸✨ <br> Hosted by <a href="https://github.com/TransparentLC/transparentlc.github.io" target="_blank">GitHub Pages</a> </div> <div style="flex-grow:1"></div> <div class="mdui-text-right mdui-typo-body-1-opacity"> Powered by <a href="https://hexo.io" target="_blank">Hexo</a> <span class="mdui-hidden-xs-down">8.1.1</span> <br> Theme - <a href="https://github.com/TransparentLC/hexo-theme-akarin" target="_blank">Akarin</a> </div> </footer>  <script src="https://cdn.jsdelivr.net/combine/gh/TransparentLC/transparentlc.github.io@798f9d53d869b37aba4e6da5586b23bc5ea50e56/js/mdui.min.js,npm/medium-zoom@1/dist/medium-zoom.min.js,npm/instant.page@5/instantpage.min.js,gh/TransparentLC/transparentlc.github.io@798f9d53d869b37aba4e6da5586b23bc5ea50e56/js/script.min.js"></script> <script defer src="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/js/bsz.min.js"></script> </body></html>