<!doctype html><html lang="zh-Hans"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no" name="viewport"><meta content="webkit" name="renderer"><meta content="webkit" name="force-rendering"><meta content="✨小透明・宸✨" name="author"><meta content="" name="keywords"><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"><link href="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png" rel="icon shortcut" type="image/ico"><link href="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png" rel="icon"><link href="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png" rel="apple-touch-icon"><link href="/atom.xml" rel="alternate" type="application/atom+xml"><title>将评论系统从来必力（LiveRe）迁移到 Artalk | 存在感消失的地方|ω•`)</title><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://akarin.dev/2025/01/18/migrate-from-livere-to-artalk/"},"headline":"将评论系统从来必力（LiveRe）迁移到 Artalk","datePublished":"2025-01-18T15:48:17.000Z","dateModified":"2025-01-18T15:48:17.000Z","author":{"@type":"Person","name":"✨小透明・宸✨","image":{"@type":"ImageObject","url":"https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg"},"description":"身处寒夜 把握星光✨"},"publisher":{"@type":"Organization","name":"存在感消失的地方|ω•`)","logo":"https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png"},"keywords":"","description":null}</script><meta content="存在感消失的地方|ω•`)" property="og:site_name"><meta content="将评论系统从来必力（LiveRe）迁移到 Artalk" property="og:title"><meta content="" property="og:description"><meta content="article" property="og:type"><meta content="https://akarin.dev/2025/01/18/migrate-from-livere-to-artalk/" property="og:url"><meta content="https://p.sda1.dev/21/bc6a40f534e6ad8954a2b28f3799b3ab" property="og:image"><meta content="2025-01-18T15:48:17.000Z" property="article:published_time"><meta content="2025-01-18T15:48:17.000Z" property="article:modified_time"><meta content="✨小透明・宸✨" property="article:author"><script>document.documentMode&&(location.href="../../../../upgrade-browser.html")</script><script>document.addEventListener("WeixinJSBridgeReady",(()=>{const e=document.createElement("script");e.src="https://fastly.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/js/fuck-wechat.min.js",document.body.appendChild(e)}))</script><link href="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/css/mdui.min.css" rel="stylesheet"><link href="https://gcore.jsdelivr.net/combine/npm/prismjs@1/plugins/line-numbers/prism-line-numbers.min.css,npm/prism-themes@1/themes/prism-vsc-dark-plus.min.css,npm/aplayer@1/dist/APlayer.min.css,gh/TransparentLC/transparentlc.github.io@879beec/css/style.min.css" rel="stylesheet"><style>*{--sidebar-image:url(https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/sidebar_header.jpg);--sidebar-image-color:#958981;--banner-image:url(https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/daily_pic.png);--banner-image-color:#f09ea3;--post-thumbnail-color:#f09ea3;--copy-code-btn-color:#fff}.MathJax[jax=SVG][display=true]{display:block;text-align:center;margin:1em 0}</style><meta content="Hexo 7.3.0" name="generator"></head><body class="mdui-drawer-body-left mdui-theme-accent-pink mdui-theme-primary-pink"><script>window.switchDark=t=>{const a={auto:"mdui-theme-layout-auto",enable:"mdui-theme-layout-dark",disable:""};(t=t||localStorage.getItem("dark"))in a||(t="auto");for(const e in a)a[e]&&document.body.classList[e===t?"add":"remove"](a[e]);localStorage.setItem("dark",t)},switchDark()</script><button class="mdui-fab mdui-m-a-2 mdui-shadow-0 mdui-text-color-grey-700" mdui-drawer="{target:'#akarin-drawer'}" style="position:fixed;z-index:1"><i class="material-icons mdui-icon">menu</i></button><nav class="mdui-drawer mdui-drawer-full-height mdui-shadow-6" id="akarin-drawer"><div class="akarin-util-bg-cover mdui-p-x-2" id="akarin-drawer-media"><img class="akarin-hover-spin mdui-img-circle mdui-m-t-4" src="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg" id="akarin-drawer-avatar"><div class="akarin-util-text-gradient mdui-card-media-covered"><div class="mdui-card-primary"><div class="mdui-typo-subheading">✨小透明・宸✨</div><div class="akarin-util-opacity-half mdui-typo-caption">存在感消失的地方|ω•`)</div></div></div></div><div class="mdui-list" mdui-collapse><div><a href="../../../../" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">home</i> <span class="mdui-list-item-content">主页</span></a></div><div><a href="../../../../about/" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">person</i> <span class="mdui-list-item-content">关于</span></a></div><div><a href="../../../../friend/" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">link</i> <span class="mdui-list-item-content">友链</span></a></div><div><a href="https://github.com/TransparentLC" target="_blank" rel="noopener" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">code</i> <span class="mdui-list-item-content">GitHub</span></a></div><div><a href="https://github.com/TransparentLC.gpg" target="_blank" rel="noopener" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">vpn_key</i> <span class="mdui-list-item-content">PGP 公钥</span></a></div><div><a href="../../../../archives/" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">collections_bookmark</i> <span class="mdui-list-item-content">归档</span> <small class="akarin-drawer-badge mdui-color-theme-accent">34</small></a></div><div><a href="../../../../atom.xml" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">rss_feed</i> <span class="mdui-list-item-content">RSS</span></a></div><div class="mdui-divider"></div><div class="mdui-collapse-item mdui-collapse-item-open"><div class="mdui-ripple mdui-list-item mdui-collapse-item-header"><i class="material-icons mdui-icon mdui-list-item-icon">brightness_4</i> <span class="mdui-list-item-content">深色模式</span> <i class="material-icons mdui-icon mdui-collapse-item-arrow">keyboard_arrow_down</i></div><div class="mdui-list mdui-collapse-item-body"><div class="mdui-ripple mdui-list-item" data-dark="auto"><span class="mdui-list-item-content">根据系统主题切换</span></div><div class="mdui-ripple mdui-list-item" data-dark="enable"><span class="mdui-list-item-content">启用</span></div><div class="mdui-ripple mdui-list-item" data-dark="disable"><span class="mdui-list-item-content">禁用</span></div></div></div><div class="mdui-collapse-item mdui-collapse-item-open"><div class="mdui-ripple mdui-list-item mdui-collapse-item-header"><i class="material-icons mdui-icon mdui-list-item-icon">insert_chart</i> <span class="mdui-list-item-content">访问统计</span> <i class="material-icons mdui-icon mdui-collapse-item-arrow">keyboard_arrow_down</i></div><div class="mdui-list mdui-collapse-item-body"><div class="mdui-ripple mdui-list-item"><span class="mdui-list-item-content">站点访问量</span> <small class="akarin-drawer-badge mdui-color-theme-accent" id="busuanzi_value_site_pv">Loading</small></div><div class="mdui-ripple mdui-list-item"><span class="mdui-list-item-content">站点访客数</span> <small class="akarin-drawer-badge mdui-color-theme-accent" id="busuanzi_value_site_uv">Loading</small></div><div class="mdui-ripple mdui-list-item"><span class="mdui-list-item-content">页面访问量</span> <small class="akarin-drawer-badge mdui-color-theme-accent" id="busuanzi_value_page_pv">Loading</small></div></div></div></div></nav><picture id="akarin-top" title="返回顶部"><source srcset="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/top.avif" type="image/avif"><source srcset="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/top.webp" type="image/webp"><img src="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/top.png"></picture><div style="padding-top:20px"></div><div class="mdui-hidden-sm-down" style="padding-top:40px"></div><div class="mdui-hidden-md-down" style="padding-top:40px"></div><main class="mdui-container" style="max-width:1024px"><div class="akarin-util-rounded-5 mdui-card mdui-shadow-4"><div class="mdui-ripple akarin-post-bg akarin-util-bg-cover" data-src="https://p.sda1.dev/21/bc6a40f534e6ad8954a2b28f3799b3ab" data-src-avif="https://p.sda1.dev/21/f57c1b96d9add0eff20c21c9d0839f7a" data-src-webp="https://p.sda1.dev/21/c67c474134190ed5cdfcf586e437283c"><div class="akarin-blurred akarin-post-bg akarin-util-bg-cover" style="background-image:url(data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCAAnAEADASIAAhEBAxEB/8QAGwABAAIDAQEAAAAAAAAAAAAAAAEGAgQFAwf/xAAmEAACAgIBBAEEAwAAAAAAAAABAgADBBESBSExQWEjQnGBExVR/8QAFwEBAQEBAAAAAAAAAAAAAAAAAAEDAv/EAB4RAAICAgMBAQAAAAAAAAAAAAABAhExQQMSIRNx/9oADAMBAAIRAxEAPwD7/ERAEizOCsRWnIDySdD9Sciw102MPIHb8mVEdSazaUr4q7L93I71+jrtO4pPLpCm8IttOctjhHXgx8d9gwSANmUejqdt7WLyAspLozKCPqVMRsA+gVlx6fnL1DADFwXHZte/YM6nx1FTTuLG6ZsAgjYMQqBd6iZAQwJHY6MRAMMpqjUKLLVULxa0/A76/J1KLTnY1PUbbsbG5nQVmHk8j2Hz5lr/AKq5ltFihmZWXmT4LE/UnNswLsFq6q0Qqo2hHv8AO/LSuUVBrrb1qjSC9ycLqTX0W32rWg5P346ADEd9/wCmb/RUz0x0vqbVtVyVuPttquAKb+ULTOjAfJ/nstZAtjgFGJBPD3LQ2BetQTGvRV5Bu67JI8EnfcD0JouZ/GPH1Xm/0s6TPfDyq8vGrvQEBtgg+QQdERIwsSvDxq6KySF9nySTsmTM3VusGQiIkAPiaVmJksQfYOwYiCp0Z09MIChiFUehNkAAACIgNtkxEQQ//9k)"></div><div class="akarin-util-text-gradient akarin-post-title"><div class="mdui-card-primary"><div class="mdui-card-primary-title mdui-text-color-white-text">将评论系统从来必力（LiveRe）迁移到 Artalk</div></div></div></div><div class="mdui-valign mdui-card-header"><div><img class="akarin-hover-spin mdui-card-header-avatar" src="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg"><div class="mdui-card-header-title">✨小透明・宸✨</div><div class="mdui-card-header-subtitle">2025-01-18 23:48:17</div></div></div><article class="mdui-typo mdui-card-content mdui-p-a-3"><p><a href="https://livere.com/" target="_blank" rel="noopener">来必力（LiveRe）</a> 是一个来自韩国的评论系统，支持使用国内外的一批社交网站账户登录，免去注册过程。</p><p>……嘛，这个介绍当然是复制粘贴的了。不过在五年前甚至更久以前、使用 <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> 搭建个人博客相当流行的时候，来必力确实是各种五花八门的评论系统中相当有竞争力的选项之一。同期流行的其他评论系统中，多说和畅言已经寄了、<a href="https://disqus.com/" target="_blank" rel="noopener">Disqus</a> 需要翻墙、<a href="https://github.com/gitalk/gitalk" target="_blank" rel="noopener">Gitalk</a> 和 <a href="https://github.com/imsun/gitment" target="_blank" rel="noopener">Gitment</a> 这种使用 GitHub 的 issue 存储评论内容的系统嘛……毕竟不是每个路人都有 GitHub 账号的，而且 Gitment 也已经弃坑了。</p><p>不过我一开始实际上没有对比这么多，选择使用 Hexo 和来必力都是因为那个时候看到认识的人的博客上在用这个，所以就跟着用了 (´ﾟωﾟ｀)</p><p>一个评论系统当然应该有评论提醒的功能，这样站长才有可能及时地与评论者进行讨论和交流。来必力一开始是有评论的邮件提醒功能的，但是大概是在 2021 年的时候，不知道为什么这个邮件提醒功能就失效了，官方也没有给出任何相关的通知。当我意识到这一点的时候……那个时候正好我在我自己的服务器上自建了一个邮箱，于是我想到了通过定时模拟登录管理后台、爬取最近的评论内容、然后给自己发邮件的方式，曲线补上了这个缺失的邮件提醒功能。</p><details><summary>当时写的邮件提醒脚本</summary><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> email<span class="token punctuation">.</span>header
<span class="token keyword">import</span> email<span class="token punctuation">.</span>mime<span class="token punctuation">.</span>text
<span class="token keyword">import</span> email<span class="token punctuation">.</span>utils
<span class="token keyword">import</span> orjson
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> smtplib
<span class="token keyword">import</span> time

<span class="token builtin">__import__</span><span class="token punctuation">(</span><span class="token string">'requests.models'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Response<span class="token punctuation">.</span>json <span class="token operator">=</span> <span class="token keyword">lambda</span> self<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">:</span> orjson<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>self<span class="token punctuation">.</span>content<span class="token punctuation">)</span>

USERNAME <span class="token operator">=</span> <span class="token string">'...'</span>
PASSWORD <span class="token operator">=</span> <span class="token string">'...'</span>
SMTP_HOST <span class="token operator">=</span> <span class="token string">'...'</span>
SMTP_USER <span class="token operator">=</span> <span class="token string">'noreply@example.com'</span>
SMTP_PASSWORD <span class="token operator">=</span> <span class="token string">'...'</span>
NOTIFY_TARGET <span class="token operator">=</span> <span class="token string">'dummy@example.com'</span>

d <span class="token operator">=</span> time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">86400</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Checking comment on'</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span>

s <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>hooks<span class="token punctuation">[</span><span class="token string">'response'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token keyword">lambda</span> r<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwarg<span class="token punctuation">:</span> r<span class="token punctuation">.</span>raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

r <span class="token operator">=</span> s<span class="token punctuation">.</span>post<span class="token punctuation">(</span>
    <span class="token string">'https://was.livere.me/login'</span><span class="token punctuation">,</span>
    data<span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token string">'username'</span><span class="token punctuation">:</span> USERNAME<span class="token punctuation">,</span>
        <span class="token string">'password'</span><span class="token punctuation">:</span> PASSWORD<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
code <span class="token operator">=</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span>

r <span class="token operator">=</span> s<span class="token punctuation">.</span>get<span class="token punctuation">(</span>
    <span class="token string">'https://livere.com/doLogin'</span><span class="token punctuation">,</span>
    params<span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token string">'code'</span><span class="token punctuation">:</span> code<span class="token punctuation">,</span>
        <span class="token string">'username'</span><span class="token punctuation">:</span> USERNAME<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
code <span class="token operator">=</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'secretCode'</span><span class="token punctuation">]</span>

r <span class="token operator">=</span> s<span class="token punctuation">.</span>get<span class="token punctuation">(</span>
    <span class="token string">'https://livere.com/login_callback'</span><span class="token punctuation">,</span>
    params<span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token string">'code'</span><span class="token punctuation">:</span> code<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

r <span class="token operator">=</span> s<span class="token punctuation">.</span>post<span class="token punctuation">(</span>
    <span class="token string">'https://livere.com/insight/managereply/period'</span><span class="token punctuation">,</span>
    data<span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token string">'startDate'</span><span class="token punctuation">:</span> d<span class="token punctuation">,</span>
        <span class="token string">'endDate'</span><span class="token punctuation">:</span> d<span class="token punctuation">,</span>
        <span class="token string">'sort'</span><span class="token punctuation">:</span> <span class="token string">'regdate'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token keyword">if</span> resultData <span class="token operator">:=</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'resultData'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    replyContent <span class="token operator">=</span> <span class="token string">'&lt;table>&lt;thead>&lt;tr>&lt;th>评论&lt;/th>&lt;th>页面&lt;/th>&lt;th>时间&lt;/th>&lt;/thead>&lt;tbody>'</span>
    <span class="token keyword">for</span> reply <span class="token keyword">in</span> resultData<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>reply<span class="token punctuation">)</span>
        replyContent <span class="token operator">+=</span> <span class="token string">'&lt;tr>&lt;td>&lt;strong>{3}&lt;/strong>&lt;br>{4}&lt;/td>&lt;td>&lt;a href="{2}" target="_blank">{1}&lt;/a>&lt;/td>&lt;td>{0}&lt;/td>&lt;/tr>'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
            time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>reply<span class="token punctuation">[</span><span class="token string">'regdate'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'%Y-%m-%d-%I:%M:%S %p'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            reply<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            reply<span class="token punctuation">[</span><span class="token string">'site'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            reply<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            reply<span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
    replyContent <span class="token operator">+=</span> <span class="token string">'&lt;/tbody>&lt;/table>'</span>
    <span class="token keyword">with</span> smtplib<span class="token punctuation">.</span>SMTP_SSL<span class="token punctuation">(</span>SMTP_HOST<span class="token punctuation">)</span> <span class="token keyword">as</span> smtp<span class="token punctuation">:</span>
        smtp<span class="token punctuation">.</span>login<span class="token punctuation">(</span>SMTP_USER<span class="token punctuation">,</span> SMTP_PASSWORD<span class="token punctuation">)</span>
        message <span class="token operator">=</span> email<span class="token punctuation">.</span>mime<span class="token punctuation">.</span>text<span class="token punctuation">.</span>MIMEText<span class="token punctuation">(</span>
            <span class="token string-interpolation"><span class="token string">f'https://akarin.dev/ 在 </span><span class="token interpolation"><span class="token punctuation">{</span>d<span class="token punctuation">}</span></span><span class="token string"> 收到了 </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>resultData<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> 条评论：&lt;br></span><span class="token interpolation"><span class="token punctuation">{</span>replyContent<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">,</span>
            <span class="token string">'html'</span><span class="token punctuation">,</span>
            <span class="token string">'utf-8'</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
        message<span class="token punctuation">[</span><span class="token string">'From'</span><span class="token punctuation">]</span> <span class="token operator">=</span> email<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>formataddr<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'Akarin Server'</span><span class="token punctuation">,</span> SMTP_USER<span class="token punctuation">)</span><span class="token punctuation">)</span>
        message<span class="token punctuation">[</span><span class="token string">'To'</span><span class="token punctuation">]</span> <span class="token operator">=</span> NOTIFY_TARGET
        message<span class="token punctuation">[</span><span class="token string">'Subject'</span><span class="token punctuation">]</span> <span class="token operator">=</span> email<span class="token punctuation">.</span>header<span class="token punctuation">.</span>Header<span class="token punctuation">(</span><span class="token string">'[Akarin Server] LiveRe 评论提醒'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
        smtp<span class="token punctuation">.</span>sendmail<span class="token punctuation">(</span>SMTP_USER<span class="token punctuation">,</span> <span class="token punctuation">(</span>NOTIFY_TARGET<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span>as_string<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></details><p>靠着这个脚本，我算是自己给来必力又续了几年的命。</p><p>但是，最近我再一次意识到了我没能收到任何评论提醒，连自己写的这个提醒脚本都失效了。我检查了半天脚本，管理后台的各种 API 并没有变化，也不知道是哪里出了问题。</p><p>直到我发现了一个非常尴尬的事情：</p><figure class="akarin-blurred-container"><div style="padding-bottom:min(calc(100%/1009*801),801px,480px)"></div><img class="mdui-hoverable mdui-img-rounded" data-src="https://p.sda1.dev/21/3e29da8e97484954e9372d16bf0577d1" data-src-webp="https://p.sda1.dev/21/41513427bbbabf0133c7a6f00b3cf4e4"> <img class="mdui-hoverable mdui-img-rounded akarin-blurred" src="data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCAAZACADASIAAhEBAxEB/8QAGQAAAwEBAQAAAAAAAAAAAAAAAAMFAgQH/8QAKBAAAgICAQIDCQAAAAAAAAAAAQIAAwQREiGhBTFxExQiNFFSYcPT/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAL/xAAZEQEAAgMAAAAAAAAAAAAAAAAAAiEREjH/2gAMAwEAAhEDEQA/APY7sysWWm2twFsKDhyf870oOpToyaGrQo76I38alT3kzG9tTZntirSbGu2RyIB9To9Y4W+IebYOMW+oyGH64VLXNcpS95r1vl2M0L0Zgobr6SYbc5gQ2Dj6I18y384zGsz+dSW00LWPtsLHuohIx6nW3K2wPJww6a0J1cGj4QECsjymlUhhGwgf/9k"><noscript><img class="mdui-hoverable mdui-img-rounded mdui-center mdui-img-fluid" src="https://p.sda1.dev/21/3e29da8e97484954e9372d16bf0577d1" alt="undefined" title="undefined"></noscript></figure><p>“已发布的评论 undefined”</p><p>我甚至不能在后台查到已有的评论。F12 检查了一下获取评论的 API，如果选定的日期之间有评论的话，这个 API 就会返回“出错了”。</p><p>来必力当然是有“意见反馈”的，这个按钮指向他们的邮箱。于是我在邮件里尝试报告邮件提醒失效和无法在后台查找评论的问题，发送之后，我收到的回复是这个：</p><figure class="akarin-blurred-container"><div style="padding-bottom:min(calc(100%/613*528),528px,480px)"></div><img class="mdui-hoverable mdui-img-rounded" data-src="https://p.sda1.dev/21/ca05db090c42ba687fda30630488dbf9" data-src-webp="https://p.sda1.dev/21/b46f70ec89c0cfb9321fd9a51511a931"> <img class="mdui-hoverable mdui-img-rounded akarin-blurred" src="data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCAAcACADASIAAhEBAxEB/8QAGgAAAgIDAAAAAAAAAAAAAAAAAwUAAgEEB//EACoQAAEDAQQKAwEAAAAAAAAAAAEAAgMhBBETMRIUIlFTcZGS0eEjMkFi/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/xAAYEQEAAwEAAAAAAAAAAAAAAAAAARFhQf/aAAwDAQACEQMRAD8A77oEG8WgZ5V8rO3xmdvtKmRhzrmyyVNKe0TVZg4Fr5AebfKsRfUky2+Mzp7UaSPs9p5UQ4xbIwNKdp/lzfCv84zfH0PlK0vCES2Y3OwpACTSn5ycj49noHRSDIVAp0KC+y2WF+gyGl19XvzNd6Y2WCJ8bb2kU/HFRVG4DheASOS2MSLhM7Qj6lBud3FTUoNzu4oP/9k"><noscript><img class="mdui-hoverable mdui-img-rounded mdui-center mdui-img-fluid" src="https://p.sda1.dev/21/ca05db090c42ba687fda30630488dbf9" alt="undefined" title="undefined"></noscript></figure><p>啊，这……</p><p>虽然现在评论还可以正常发送和加载，但是后台出这么严重的问题迟迟不修复，连反馈的邮箱都无法使用的话，我觉得这已经和停止运营准备跑路没什么区别了。趁现在还能看到评论内容，必须考虑迁移评论系统的事情了。</p><p>之前在别人的博客上看到有使用 <a href="https://artalk.js.org/" target="_blank" rel="noopener">Artalk</a> 评论系统的，使用下来感觉还不错，评论也不会强制要求注册，所以就决定选择它作为替代品了。Artalk 需要自己部署，不过这没什么难度，而且自己部署的话也可以避免跑路这样的事情。</p><p>安装 Artalk 是非常简单的，但是还有一个重要的问题是怎么把之前的评论数据也一起迁移过来。Artalk 提供了一个<a href="https://artransfer.netlify.app/" target="_blank" rel="noopener">迁移工具</a>，可以把其他评论系统的数据转换为 Artalk 使用的<a href="https://artalk.js.org/zh/guide/transfer.html#%E6%95%B0%E6%8D%AE%E8%A1%8C%E5%9B%8A" target="_blank" rel="noopener">数据格式</a>（官方称为 Artran），然后导入数据库。不过支持转换的评论系统并不包括来必力，实际上来必力就没有提供将评论数据导出的选项，所以只能自己爬取然后转换了。</p><p>首先考虑一下怎么爬取来必力的评论数据。</p><p>设置来必力的时候，需要在网站上加入一段 HTML 代码，以下以我自己的代码为例：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lv-container<span class="token punctuation">"</span></span> <span class="token attr-name">data-id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>city<span class="token punctuation">"</span></span> <span class="token attr-name">data-uid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>MTAyMC80NDUwOC8yMTAzOQ==<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
   <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">d<span class="token punctuation">,</span> s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">var</span> j<span class="token punctuation">,</span> e <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> LivereTower <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
       j <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
       j<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'https://cdn-city.livere.com/js/embed.dist.js'</span><span class="token punctuation">;</span>
       j<span class="token punctuation">.</span>async <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
       e<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> <span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个 <code>uid</code> 是一串 Base64，解码之后是 <code>1020/44508/21039</code>，将这三个数取出来记为 <code>consumerSeq</code>、<code>livereSeq</code>、<code>smartloginSeq</code>。其中 <code>consumerSeq</code> 大概指的是用户类型，<code>1020</code> 对应免费使用的 City 版，<code>livereSeq</code> 和 <code>smartloginSeq</code> 应该是相当于用户 ID 的东西。</p><p>之后爬取评论需要请求两个 API，以我这里的“关于”页面为例。第一个请求是 <code>https://api-zero.livere.com/v1/common/config?refer=akarin.dev/about/&consumerSeq=1020&livereSeq=44508&smartloginSeq=21039</code>，这里的 <code>refer</code> 实际上是网页的 <code>location.host + location.pathname</code>。</p><p>部分后续会用到的响应如下：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"results"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"actions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            ...
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"consumer"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            ...
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"livere"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            ...
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"smartlogin"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            ...
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"rep"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"repSeq"</span><span class="token operator">:</span> <span class="token number">4989047</span><span class="token punctuation">,</span>
            <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"存在感聚集（？）的地方|ω•`) | 存在感消失的地方|ω•`)"</span><span class="token punctuation">,</span>
            <span class="token property">"refer"</span><span class="token operator">:</span> <span class="token string">"akarin.dev/about/"</span><span class="token punctuation">,</span>
            <span class="token property">"logo"</span><span class="token operator">:</span> <span class="token string">"../img/favicon.png"</span><span class="token punctuation">,</span>
            <span class="token property">"regdate"</span><span class="token operator">:</span> <span class="token string">"2020-02-17T04:11:04.000Z"</span><span class="token punctuation">,</span>
            <span class="token property">"consumerSeq"</span><span class="token operator">:</span> <span class="token number">1020</span><span class="token punctuation">,</span>
            <span class="token property">"livereSeq"</span><span class="token operator">:</span> <span class="token number">44508</span><span class="token punctuation">,</span>
            <span class="token property">"parentCommentsCount"</span><span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span>
            <span class="token property">"totalCount"</span><span class="token operator">:</span> <span class="token number">62</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            ...
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"livereAdData"</span><span class="token operator">:</span> <span class="token keyword null">null</span><span class="token punctuation">,</span>
        <span class="token property">"livereAdList"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"liveContentsData"</span><span class="token operator">:</span> <span class="token keyword null">null</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"resultCode"</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    <span class="token property">"resultMessage"</span><span class="token operator">:</span> <span class="token string">"Okay, livere"</span>
<span class="token punctuation">}</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="language-typescript line-numbers" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">LiveReConfig</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    rep<span class="token operator">:</span> <span class="token punctuation">{</span>
        repSeq<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
        title<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
        refer<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
        logo<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
        regdate<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
        consumerSeq<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
        livereSeq<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
        parentCommentsCount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
        totalCount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个 <code>results.rep.repSeq</code> 就是相当于当前页面对应的评论列表的一个 ID，如果当前页面没有评论的话就不会有这个字段。</p><p>第二个请求是 <code>https://api-zero.livere.com/v1/comments/list?repSeq=4989047&consumerSeq=1020&livereSeq=44508&limit=9007199254740991</code>，这里可以使用 <code>offset</code> 和 <code>limit</code> 两个参数进行分页，但是 <code>limit</code> 似乎可以设成任意大的一个数。</p><p>部分后续会用到的响应如下：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"results"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"parents"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token property">"replySeq"</span><span class="token operator">:</span> <span class="token number">56377701</span><span class="token punctuation">,</span>
                <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"NO NICKNAME"</span><span class="token punctuation">,</span>
                <span class="token property">"memberId"</span><span class="token operator">:</span> <span class="token string">"UID_7A85086412F723A87421D7E3BF72A05B"</span><span class="token punctuation">,</span>
                <span class="token property">"memberIcon"</span><span class="token operator">:</span> <span class="token keyword null">null</span><span class="token punctuation">,</span>
                <span class="token property">"memberUrl"</span><span class="token operator">:</span> <span class="token string">"https://qq.com/"</span><span class="token punctuation">,</span>
                <span class="token property">"memberDomain"</span><span class="token operator">:</span> <span class="token string">"qq"</span><span class="token punctuation">,</span>
                <span class="token property">"parentSeq"</span><span class="token operator">:</span> <span class="token number">56377701</span><span class="token punctuation">,</span>
                <span class="token property">"directSeq"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"存在感聚集（？）的地方|ω•`) | 存在感消失的地方|ω•`)"</span><span class="token punctuation">,</span>
                <span class="token property">"site"</span><span class="token operator">:</span> <span class="token string">"https://akarin.dev/about/"</span><span class="token punctuation">,</span>
                <span class="token property">"email"</span><span class="token operator">:</span> <span class="token keyword null">null</span><span class="token punctuation">,</span>
                <span class="token property">"ipAddress"</span><span class="token operator">:</span> <span class="token string">"61.161.154.184"</span><span class="token punctuation">,</span>
                <span class="token property">"agent"</span><span class="token operator">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36 Core/1.94.192.400 QQBrowser/11.5.5250.400"</span><span class="token punctuation">,</span>
                <span class="token property">"image1"</span><span class="token operator">:</span> <span class="token string">"https://d47jbcq60tnr6.cloudfront.net/2024123/11313-15jbtaz.unyu.png"</span><span class="token punctuation">,</span>
                <span class="token property">"image2"</span><span class="token operator">:</span> <span class="token string">"https://d47jbcq60tnr6.cloudfront.net/2024123/5554-afg4zo.fy24.png"</span><span class="token punctuation">,</span>
                <span class="token property">"image3"</span><span class="token operator">:</span> <span class="token string">"https://d47jbcq60tnr6.cloudfront.net/2024123/6389-r3sgl8.v59kl.png"</span><span class="token punctuation">,</span>
                <span class="token property">"regdate"</span><span class="token operator">:</span> <span class="token string">"2024-12-03T09:21:49.000Z"</span><span class="token punctuation">,</span>
                <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"博主铁子，我有一个很小众的问题求助：一个年少时的遗憾，以前辜负了一个姑娘，有来往短信若干条备份在百度云，因为年份过于久远（十年前），想回顾再查看时已乱码（如图）。咨询了官方客服也没法解决。当年用的手机是vivo Y11i T_BBK."</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            ...
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"children"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            ...
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"quotations"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"resultCode"</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    <span class="token property">"resultMessage"</span><span class="token operator">:</span> <span class="token string">"Okay, livere"</span>
<span class="token punctuation">}</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="language-typescript line-numbers" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">LiveReComment</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    replySeq<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    memberId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token comment">// 可能是邮箱</span>
    memberIcon<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    memberUrl<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    memberDomain<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    directSeq<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token comment">// 父评论ID或0</span>
    ipAddress<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    regdate<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    content<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    agent<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token comment">// User-Agent</span>
    image1<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    image2<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    image3<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">LiveReCommentList</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    parents<span class="token operator">:</span> LiveReComment<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    children<span class="token operator">:</span> LiveReComment<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    quotations<span class="token operator">:</span> LiveReComment<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里的 <code>replySeq</code> 就是评论的 ID，<code>directSeq</code> 则是父评论的 ID（不存在时为 <code>0</code>），<code>image{1,2,3}</code> 是评论附上的图片链接。关于评论者信息，<code>email</code> 字段不知为什么总是 <code>null</code>，如果评论者是使用邮箱注册了来必力账号进行评论的话，<code>memberId</code> 就是注册时使用的邮箱。上面这位评论者是使用 QQ 登录的，由此也可见来必力是真的没有在维护了，这都获取不到用户名了……</p><p>想要爬取所有的评论，就需要获取所有页面的 <code>location.pathname</code> 作为 <code>refer</code>，然后对每个页面都请求上面这两个 API。运行一下 <code>hexo generate</code> 然后复制粘贴终端中 <code>INFO Generated: ...</code> 的输出大概会更方便一些。</p><p>然后考虑一下怎么转换到 Artran 的<a href="https://artalk.js.org/zh/guide/transfer.html#%E6%95%B0%E6%8D%AE%E8%A1%8C%E5%9B%8A" target="_blank" rel="noopener">数据格式</a>，首先写好类型定义：</p><pre class="language-typescript line-numbers" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Artran</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    rid<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token comment">// 在不存在父评论的时候，可以直接设为0</span>
    content<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    ua<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    ip<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    created_at<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token comment">// 格式：2021-10-28 20:50:15 +0800</span>
    updated_at<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    is_collapsed<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">,</span>
    is_pending<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">,</span>
    vote_up<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    vote_down<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    nick<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    link<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    password<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    badge_name<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    badge_color<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    page_key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    page_title<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    page_admin_only<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">,</span>
    site_name<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    site_urls<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>根据<a href="https://cyp0633.icu/post/wp-comment-converter/" target="_blank" rel="noopener">这里</a>的说法，如果是导入的话 Artran 的部分字段是可以留空的。</p><p>和爬取的来必力的评论数据一个个对应上去，最后就可以得到下面的完整代码：</p><pre class="language-typescript line-numbers" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Artran</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">LiveReConfig</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">LiveReComment</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">LiveReCommentList</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">LiveReResponse<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    results<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span>
    resultCode<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    resultMessage<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> artrans<span class="token operator">:</span> Artran<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> uid <span class="token operator">=</span> <span class="token string">'MTAyMC80NDUwOC8yMTAzOQ=='</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>consumerSeq<span class="token punctuation">,</span> livereSeq<span class="token punctuation">,</span> smartloginSeq<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">atob</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>e <span class="token operator">=></span> <span class="token function">parseInt</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> host <span class="token operator">=</span> <span class="token string">'akarin.dev'</span><span class="token punctuation">;</span>

<span class="token comment">// 2021-10-28 20:50:15 +0800</span>
<span class="token keyword">const</span> <span class="token function function-variable">convertArtransDate</span> <span class="token operator">=</span> <span class="token punctuation">(</span>d<span class="token operator">:</span> Date<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token string template-punctuation">`</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>d<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation interpolation-punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation interpolation-punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>d<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation interpolation-punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>d<span class="token punctuation">.</span><span class="token function">toTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">'GMT'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token language-regex regex-source">\(.+?\)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation interpolation-punctuation">}</span></span><span class="token string template-punctuation">`</span></span><span class="token punctuation">;</span>

<span class="token comment">// location.host + location.pathname</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> pathname <span class="token keyword">of</span> <span class="token punctuation">[</span>
    <span class="token string">'/about/'</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> u1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">URL</span></span><span class="token punctuation">(</span><span class="token string">'https://api-zero.livere.com/v1/common/config'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    u1<span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'consumerSeq'</span><span class="token punctuation">,</span> consumerSeq<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    u1<span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'livereSeq'</span><span class="token punctuation">,</span> livereSeq<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    u1<span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'smartloginSeq'</span><span class="token punctuation">,</span> smartloginSeq<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    u1<span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'refer'</span><span class="token punctuation">,</span> host <span class="token operator">+</span> pathname<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> r1<span class="token operator">:</span> LiveReResponse<span class="token operator">&lt;</span>LiveReConfig<span class="token operator">></span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>u1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>r <span class="token operator">=></span> r<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 当前页面没有评论</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>r1<span class="token punctuation">.</span>results<span class="token punctuation">.</span>rep<span class="token punctuation">.</span>repSeq<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> u2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">URL</span></span><span class="token punctuation">(</span><span class="token string">'https://api-zero.livere.com/v1/comments/list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    u2<span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'consumerSeq'</span><span class="token punctuation">,</span> consumerSeq<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    u2<span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'livereSeq'</span><span class="token punctuation">,</span> livereSeq<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    u2<span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'repSeq'</span><span class="token punctuation">,</span> r1<span class="token punctuation">.</span>results<span class="token punctuation">.</span>rep<span class="token punctuation">.</span>repSeq<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    u2<span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'limit'</span><span class="token punctuation">,</span> Number<span class="token punctuation">.</span><span class="token constant">MAX_SAFE_INTEGER</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> r2<span class="token operator">:</span> LiveReResponse<span class="token operator">&lt;</span>LiveReCommentList<span class="token operator">></span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>u2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>r <span class="token operator">=></span> r<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    artrans<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">[</span><span class="token operator">...</span>r2<span class="token punctuation">.</span>results<span class="token punctuation">.</span>parents<span class="token punctuation">,</span> <span class="token operator">...</span>r2<span class="token punctuation">.</span>results<span class="token punctuation">.</span>children<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>e <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
        id<span class="token operator">:</span> e<span class="token punctuation">.</span>replySeq<span class="token punctuation">,</span>
        rid<span class="token operator">:</span> e<span class="token punctuation">.</span>directSeq<span class="token punctuation">,</span>
        content<span class="token operator">:</span> e<span class="token punctuation">.</span>content <span class="token operator">+</span> <span class="token punctuation">[</span>e<span class="token punctuation">.</span>image1<span class="token punctuation">,</span> e<span class="token punctuation">.</span>image2<span class="token punctuation">,</span> e<span class="token punctuation">.</span>image3<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>e <span class="token operator">=></span> <span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">\n\n![](</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>e<span class="token punctuation interpolation-punctuation">}</span></span><span class="token string">)</span><span class="token string template-punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        ua<span class="token operator">:</span> e<span class="token punctuation">.</span>agent <span class="token operator">||</span> <span class="token string">'Mozilla/5.0'</span><span class="token punctuation">,</span>
        ip<span class="token operator">:</span> e<span class="token punctuation">.</span>ipAddress<span class="token punctuation">,</span>
        created_at<span class="token operator">:</span> <span class="token function">convertArtransDate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>regdate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        updated_at<span class="token operator">:</span> <span class="token function">convertArtransDate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>regdate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        is_collapsed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        nick<span class="token operator">:</span> e<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
        <span class="token comment">// html - How can I validate an email address in JavaScript? - Stack Overflow</span>
        <span class="token comment">// https://stackoverflow.com/a/1373724</span>
        email<span class="token operator">:</span> e<span class="token punctuation">.</span>memberId<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token language-regex regex-source">[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?</span><span class="token regex-delimiter">/</span><span class="token regex-flags">gi</span></span><span class="token punctuation">)</span>
            <span class="token operator">?</span> e<span class="token punctuation">.</span>memberId
            <span class="token operator">:</span> <span class="token string">'dummy@example.com'</span><span class="token punctuation">,</span>
        link<span class="token operator">:</span> e<span class="token punctuation">.</span>memberUrl<span class="token punctuation">,</span>
        page_key<span class="token operator">:</span> pathname<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

artrans<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=></span> a<span class="token punctuation">.</span>id <span class="token operator">-</span> b<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// console.log(artrans);</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>artrans<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>导入评论数据时，Artalk 会自动根据 Artran 里的用户信息创建用户，并将评论 ID 调整为自增值。</p><blockquote><p>封面图：<a href="https://www.pixiv.net/artworks/119247734" target="_blank" rel="noopener">Pixiv ID: 119247734 「🎀」 by 茶白ひな</a></p></blockquote><blockquote class="mdui-m-b-0 mdui-m-x-0 mdui-p-y-1" style="border-left:4px solid rgba(0,0,0,.36)"><strong>本作品采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。不允许内容农场类网站、CSDN 用户和微信公众号转载，也不允许被自动抓取用于生成式 AI 相关服务。</strong><br><strong>本文作者：✨小透明・宸✨</strong><br><strong>本文链接：<a href="https://akarin.dev/2025/01/18/migrate-from-livere-to-artalk/">https://akarin.dev/2025/01/18/migrate-from-livere-to-artalk/</a></strong></blockquote></article><div class="mdui-typo mdui-p-b-3 mdui-p-x-3" style="box-sizing:border-box" id="artalk-container"></div><script>(()=>{const e=document.createElement("link");e.rel="stylesheet",e.href="https://cdn.jsdelivr.net/npm/artalk@2/dist/Artalk.css";const t=document.createElement("style");t.innerHTML=".atk-comment > .atk-main > .atk-body img:not([atk-emoticon]){max-height:160px}"+[["pink","#ff4081","#ff80ab"]].map((([e,t,n])=>`.mdui-theme-accent-${e} .artalk,.mdui-theme-accent-${e} .artalk-layer-wrap,.mdui-theme-accent-${e} .artalk.atk-dark-mode,.mdui-theme-accent-${e} .artalk-layer-wrap.atk-dark-mode{--at-color-main:${t};--at-color-light:${n}}`)).join("");const n=document.createElement("script");n.src="https://cdn.jsdelivr.net/npm/artalk@2/dist/Artalk.js",n.async=!0,n.onload=()=>{Artalk.use((e=>{let t=0;const n={},a=(e,a)=>{const r=`__atk_tex_id_${t++}__`;return n[r]={tex:e,isBlock:a},r},r={name:"blockMath",level:"block",tokenizer:e=>{const t=/^(?:\s{0,3})\$\$((?:[^\n]|\n[^\n])+?)\n{0,1}\$\$/.exec(e);if(t)return{type:"html",raw:t[0],text:a(t[1],!0)}}},o={name:"inlineMath",level:"inline",start:e=>{const t=e.search(/\$.*?\$/);return-1!==t?t:e.length},tokenizer:e=>{const t=/^\$(.*?)\$/.exec(e);if(t)return{type:"html",raw:t[0],text:a(t[1],!1)}}};e.on("mounted",(()=>{e.getMarked().use({extensions:[r,o]}),e.updateConf({markedReplacers:[e=>e=e.replace(/(__atk_tex_id_\d+__)/g,((e,t)=>{const{tex:a,isBlock:r}=n[t];delete n[t];const o=`https://www.zhihu.com/equation?tex=${encodeURIComponent(a)}`;return r?`<p style="text-align:center"><img src="${o}"></p>`:`<img style="vertical-align:middle" src="${o}">`}))]})}))})),Artalk.use((e=>e.on("list-loaded",(()=>e.getCommentNodes().forEach((e=>Array.from(e.getRender().$content.querySelectorAll("img:not([atk-emoticon])")).forEach((e=>{e.classList.add("mdui-img-rounded"),mediumZoom(e,{margin:16,scrollOffset:8,background:"rgba(0,0,0,.85)"})})))))))),Artalk.init({el:"#artalk-container",server:"https://comment.akarin.dev",site:"存在感消失的地方|ω•`)"})},document.head.appendChild(e),document.head.appendChild(t),document.body.appendChild(n)})()</script></div><div class="mdui-valign mdui-m-t-2"><button class="mdui-ripple mdui-btn mdui-btn-icon" disabled><i class="material-icons mdui-icon">chevron_left</i></button> <span class="mdui-typo-body-1-opacity mdui-text-center" style="flex-grow:1"></span> <span class="mdui-typo-body-1-opacity mdui-text-right mdui-m-r-1" title="西方 Project 幡紫龙 C74 版汉化（魔改）记录">下一篇</span> <a href="../../../../2024/01/19/banshiryuu-modification/" class="mdui-ripple mdui-btn mdui-btn-icon"><i class="material-icons mdui-icon">chevron_right</i></a></div></main><footer class="mdui-typo mdui-container mdui-m-y-5" style="display:flex;max-width:1024px"><div class="mdui-typo-body-1-opacity mdui-text-left">Copyright © 2025 ✨小透明・宸✨<br>Hosted by <a href="https://github.com/TransparentLC/transparentlc.github.io" target="_blank">Github Pages</a></div><div style="flex-grow:1"></div><div class="mdui-typo-body-1-opacity mdui-text-right">Powered by <a href="https://hexo.io" target="_blank">Hexo</a> <span class="mdui-hidden-xs-down">7.3.0</span><br>Theme - <a href="https://github.com/TransparentLC/hexo-theme-akarin" target="_blank">Akarin</a></div></footer><script src="https://gcore.jsdelivr.net/combine/gh/TransparentLC/transparentlc.github.io/js/mdui.min.js,npm/medium-zoom@1/dist/medium-zoom.min.js,npm/instant.page@5/instantpage.min.js,npm/aplayer@1/dist/APlayer.min.js,gh/TransparentLC/transparentlc.github.io@879beec/js/script.min.js"></script><script src="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/js/bsz.min.js" async></script></body></html>