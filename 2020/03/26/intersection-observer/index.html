<!doctype html><html lang="zh-Hans"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no" name="viewport"><meta content="webkit" name="renderer"><meta content="webkit" name="force-rendering"><meta content="✨小透明・宸✨" name="author"><meta content="" name="keywords"><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"><link href="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png" rel="icon shortcut" type="image/ico"><link href="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png" rel="icon"><link href="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png" rel="apple-touch-icon"><link href="/atom.xml" rel="alternate" type="application/atom+xml"><title>用 Intersection Observer 来自己造个图片懒加载的轮子₍₍ (ง ˙ω˙)ว ⁾⁾ | 存在感消失的地方|ω•`)</title><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://akarin.dev/2020/03/26/intersection-observer/"},"headline":"用 Intersection Observer 来自己造个图片懒加载的轮子₍₍ (ง ˙ω˙)ว ⁾⁾","datePublished":"2020-03-26T06:33:08.000Z","dateModified":"2020-03-26T06:33:08.000Z","author":{"@type":"Person","name":"✨小透明・宸✨","image":{"@type":"ImageObject","url":"https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg"},"description":"身处寒夜 把握星光✨"},"publisher":{"@type":"Organization","name":"存在感消失的地方|ω•`)","logo":"https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png"},"keywords":"","description":"一些食用方法和实例～　除了懒加载，还可以用来实现别的功能呢( ॑꒳ ॑ )"}</script><meta content="存在感消失的地方|ω•`)" property="og:site_name"><meta content="用 Intersection Observer 来自己造个图片懒加载的轮子₍₍ (ง ˙ω˙)ว ⁾⁾" property="og:title"><meta content="一些食用方法和实例～　除了懒加载，还可以用来实现别的功能呢( ॑꒳ ॑ )" property="og:description"><meta content="article" property="og:type"><meta content="https://akarin.dev/2020/03/26/intersection-observer/" property="og:url"><meta content="https://p.sda1.dev/12/1958df29e1b59d600768f6216e860a85/c9Ow1FmU.jpg" property="og:image"><meta content="2020-03-26T06:33:08.000Z" property="article:published_time"><meta content="2020-03-26T06:33:08.000Z" property="article:modified_time"><meta content="✨小透明・宸✨" property="article:author"><script>document.documentMode&&(location.href="../../../../upgrade-browser.html")</script><script>document.addEventListener("WeixinJSBridgeReady",(()=>{const e=document.createElement("script");e.src="https://fastly.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/js/fuck-wechat.min.js",document.body.appendChild(e)}))</script><link href="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/css/mdui.min.css" rel="stylesheet"><link href="https://gcore.jsdelivr.net/combine/npm/prismjs@1/plugins/line-numbers/prism-line-numbers.min.css,npm/prism-themes@1/themes/prism-vsc-dark-plus.min.css,npm/aplayer@1/dist/APlayer.min.css,gh/TransparentLC/transparentlc.github.io@879beec/css/style.min.css" rel="stylesheet"><style>*{--sidebar-image:url(https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/sidebar_header.jpg);--sidebar-image-color:#958981;--banner-image:url(https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/daily_pic.png);--banner-image-color:#f09ea3;--post-thumbnail-color:#f09ea3;--copy-code-btn-color:#fff}.MathJax[jax=SVG][display=true]{display:block;text-align:center;margin:1em 0}</style><meta content="Hexo 7.3.0" name="generator"></head><body class="mdui-drawer-body-left mdui-theme-accent-pink mdui-theme-primary-pink"><script>window.switchDark=t=>{const a={auto:"mdui-theme-layout-auto",enable:"mdui-theme-layout-dark",disable:""};(t=t||localStorage.getItem("dark"))in a||(t="auto");for(const e in a)a[e]&&document.body.classList[e===t?"add":"remove"](a[e]);localStorage.setItem("dark",t)},switchDark()</script><button class="mdui-fab mdui-m-a-2 mdui-shadow-0 mdui-text-color-grey-700" mdui-drawer="{target:'#akarin-drawer'}" style="position:fixed;z-index:1"><i class="material-icons mdui-icon">menu</i></button><nav class="mdui-drawer mdui-drawer-full-height mdui-shadow-6" id="akarin-drawer"><div class="akarin-util-bg-cover mdui-p-x-2" id="akarin-drawer-media"><img class="akarin-hover-spin mdui-img-circle mdui-m-t-4" src="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg" id="akarin-drawer-avatar"><div class="akarin-util-text-gradient mdui-card-media-covered"><div class="mdui-card-primary"><div class="mdui-typo-subheading">✨小透明・宸✨</div><div class="akarin-util-opacity-half mdui-typo-caption">存在感消失的地方|ω•`)</div></div></div></div><div class="mdui-list" mdui-collapse><div><a href="../../../../" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">home</i> <span class="mdui-list-item-content">主页</span></a></div><div><a href="../../../../about/" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">person</i> <span class="mdui-list-item-content">关于</span></a></div><div><a href="../../../../friend/" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">link</i> <span class="mdui-list-item-content">友链</span></a></div><div><a href="https://github.com/TransparentLC" target="_blank" rel="noopener" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">code</i> <span class="mdui-list-item-content">GitHub</span></a></div><div><a href="https://github.com/TransparentLC.gpg" target="_blank" rel="noopener" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">vpn_key</i> <span class="mdui-list-item-content">PGP 公钥</span></a></div><div><a href="../../../../archives/" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">collections_bookmark</i> <span class="mdui-list-item-content">归档</span> <small class="akarin-drawer-badge mdui-color-theme-accent">33</small></a></div><div><a href="../../../../atom.xml" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">rss_feed</i> <span class="mdui-list-item-content">RSS</span></a></div><div class="mdui-divider"></div><div class="mdui-collapse-item mdui-collapse-item-open"><div class="mdui-ripple mdui-list-item mdui-collapse-item-header"><i class="material-icons mdui-icon mdui-list-item-icon">brightness_4</i> <span class="mdui-list-item-content">深色模式</span> <i class="material-icons mdui-icon mdui-collapse-item-arrow">keyboard_arrow_down</i></div><div class="mdui-list mdui-collapse-item-body"><div class="mdui-ripple mdui-list-item" data-dark="auto"><span class="mdui-list-item-content">根据系统主题切换</span></div><div class="mdui-ripple mdui-list-item" data-dark="enable"><span class="mdui-list-item-content">启用</span></div><div class="mdui-ripple mdui-list-item" data-dark="disable"><span class="mdui-list-item-content">禁用</span></div></div></div><div class="mdui-collapse-item mdui-collapse-item-open"><div class="mdui-ripple mdui-list-item mdui-collapse-item-header"><i class="material-icons mdui-icon mdui-list-item-icon">insert_chart</i> <span class="mdui-list-item-content">访问统计</span> <i class="material-icons mdui-icon mdui-collapse-item-arrow">keyboard_arrow_down</i></div><div class="mdui-list mdui-collapse-item-body"><div class="mdui-ripple mdui-list-item"><span class="mdui-list-item-content">站点访问量</span> <small class="akarin-drawer-badge mdui-color-theme-accent" id="busuanzi_value_site_pv">Loading</small></div><div class="mdui-ripple mdui-list-item"><span class="mdui-list-item-content">站点访客数</span> <small class="akarin-drawer-badge mdui-color-theme-accent" id="busuanzi_value_site_uv">Loading</small></div><div class="mdui-ripple mdui-list-item"><span class="mdui-list-item-content">页面访问量</span> <small class="akarin-drawer-badge mdui-color-theme-accent" id="busuanzi_value_page_pv">Loading</small></div></div></div></div></nav><picture id="akarin-top" title="返回顶部"><source srcset="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/top.avif" type="image/avif"><source srcset="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/top.webp" type="image/webp"><img src="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/top.png"></picture><div style="padding-top:20px"></div><div class="mdui-hidden-sm-down" style="padding-top:40px"></div><div class="mdui-hidden-md-down" style="padding-top:40px"></div><main class="mdui-container" style="max-width:1024px"><div class="akarin-util-rounded-5 mdui-card mdui-shadow-4"><div class="mdui-ripple akarin-post-bg akarin-util-bg-cover" data-src="https://p.sda1.dev/12/1958df29e1b59d600768f6216e860a85/c9Ow1FmU.jpg" data-src-avif="https://vfile.meituan.net/mmdb/6073b2c140bf1f43d53c70251e20435928501.jpg" data-src-webp="https://p.sda1.dev/12/1711e51129eb72b8eb3b56c3c36198d8/zcCwMPCf.webp"><div class="akarin-blurred akarin-post-bg akarin-util-bg-cover" style="background-image:url(data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCABAAD8DASIAAhEBAxEB/8QAGgAAAgMBAQAAAAAAAAAAAAAABQYCBAcBA//EAC0QAAIBAwMDAwMDBQAAAAAAAAECAwAEEQUSIRMxQQYycSIjURVCYWJygbHB/8QAGQEAAwEBAQAAAAAAAAAAAAAABAUGAwIH/8QAKhEAAgEEAQIEBgMAAAAAAAAAAQIDAAQRMRITIQUyQUIiUVJxgbEUI5H/2gAMAwEAAhEDEQA/AF1asLUdlSAxV6SK8+q/DESgcnCkkD5FMlhYu6qzHaD2oLY3y21tcwvCHMygLk+wjzTfpcMtwIlWI7XVgHzwhT8/NTd3fT5fpFTGWIVsfSO9V1j4TagL/JRhKqgumfrJxrWqIW1qVxzmmi1tUZAaBrHNBIyugCKFy2e5IycURivsxoPKjFLzNK47trZ+9HNa28bDpp5s4GflXjfwqucUAI5plu4HeIOXAzS/JG6KXPtzRsLDjulM6kOTxxWW5rrZI+nvT5Z2ehzxsHsgrKD2kbk/5ohH6b0+4tkmFt0SD5kLBhTWW+h4sro4B7HVKoLSbqRvDIhYEMN+n4rMo3jEhEhKEIxJPPtGaeNJu9Qs7saeYC+8DfgkFfGQaE3ekRvKGWF1iHnB806Xlpp15r0cTxOPsncytt3OP2kfFI7jisUSq/KNslA21qlgllluLh2j4yrhZinkbGj3rxvL2aaR4lUCKBRvkzuIHnJrmnda7leNQftuVdvAINE9Sa0srIpFAvSIxtH791eujwWtjZrOjs7T4zWSxno67Zx29xrtrnjPgkFgpOD7AasXpSECNZCdqgYpW1GdRGuxyd3uHwaParJBHGSuN5Y5Oc81nt3dOrmmFpHlVNIfELgh3XIJNWdPm+qNs5xwQw5p4trlIQsJVSCPuDuMGsnhv2OOcj8U02WoP1FYkqHwMdxiiJ4eYoK2uTCw3nO6dNQVI4p7i6KtbKpkKj+n/p7VnX6vcLdW907cxz9ZlAx37iimuX6vFFZo+TI4Z/hKWXVAC7MMZFT1y+HAz5avfCoQ0EjMD/YPU5wK2KW3t5IkmgKMsgV0BxjbtAAH8YFReXpqvMb4GQFBAAPHA5pI0PX4IYE0+7lKlWPSYjgIeQDTI8q2CG5yjxkZ3DBB/toiJOXFQ3c6FKrp3iaQyJ8Kn4mI9B60D1C5ilkYIcBeCPyR5pHvZG3+41Z1LUFmuJXVcZY+aBFpJGp8q8EAqRJ6kjOdZqy1jKhygIqxb3E8EiM6E4oqPUegnhiPkKwqSazoEu4dQIcdzkViLqE+4f6KKawuceQn8GqNq6alqMhZyjBCASPC4FMS6BHMIkSViBy+fOKGJeaMsoeO4QMPJ4pns762IJSdDwOzClVxbqZAVcFTVFaX86xcWUqVAGqB3eiPB1JWK8e00Lk1UtYm1jYtl+ceRim+/vrcwOjzIA4x3FK7zaPBkiaMDz9QyaItLdEYOzeXVB+I388sTxBORbdAIrSWVuVo9Z6JPMQFQniuxepNKgB6USsfyQT2+SKjL60dhsjYqP4wn+qMa7iHZWX7k5/VKFsLhhllYD5AY/df/9k)"></div><div class="akarin-util-text-gradient akarin-post-title"><div class="mdui-card-primary"><div class="mdui-card-primary-title mdui-text-color-white-text">用 Intersection Observer 来自己造个图片懒加载的轮子₍₍ (ง ˙ω˙)ว ⁾⁾</div></div></div></div><div class="mdui-valign mdui-card-header"><div><img class="akarin-hover-spin mdui-card-header-avatar" src="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg"><div class="mdui-card-header-title">✨小透明・宸✨</div><div class="mdui-card-header-subtitle">2020-03-26 14:33:08</div></div></div><article class="mdui-p-a-3 mdui-card-content mdui-typo"><blockquote><p>封面图：<a href="https://www.pixiv.net/artworks/80105763" target="_blank" rel="noopener">Pixiv ID: 80105763 「アッカリーン」 by cedar</a></p></blockquote><p>Intersection Observer 这东西之前我是一直没听说过的，至于为什么发现了它……这个过程就有点奇怪了(〃′▽`)</p><ol><li>寒假的时候尝试着用 <a href="https://cn.vuejs.org/" target="_blank" rel="noopener">Vue</a> 和 <a href="https://mdui.org/" target="_blank" rel="noopener">MDUI</a> 搞了点大新闻。</li><li>在搜索其他 Material Design 风格的界面框架时，发现了 <a href="https://vuetifyjs.com/zh-Hans/" target="_blank" rel="noopener">Vuetify</a> 这个 Vue 组件库。</li><li>翻了 Vuetify 的文档，它的功能比 MDUI 丰富了不少，居然还有个<a href="https://vuetifyjs.com/zh-Hans/components/lazy/" target="_blank" rel="noopener">懒加载</a>功能！</li><li>懒加载的实现靠的是 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Intersection_Observer_API" target="_blank" rel="noopener">Intersection Observer</a>，这是……哎？这么神奇的东西原来浏览器就自带啊！(｡•́ - •̀｡)</li></ol><figure class="akarin-blurred-container"><div style="padding-bottom:min(calc(100%/407*270),270px,480px)"></div><img class="mdui-hoverable mdui-img-rounded" data-src="https://p.sda1.dev/12/5488809427a89f0731d38401e9258b65/d7GkPfHd.jpg" data-src-webp="https://p.sda1.dev/12/2765f4225f2b684e7524ab25113b7928/Myt3lN8w.webp" data-src-avif="https://p.sda1.dev/12/461d227259db82848c4e267714c44530/b7bOjWIV.jpg"> <img class="mdui-hoverable mdui-img-rounded akarin-blurred" src="data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCAAVACADASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAABwAGAwT/xAAjEAACAQQBBQADAAAAAAAAAAABAgMABAUREgYTITEyUWGR/8QAFgEBAQEAAAAAAAAAAAAAAAAABQQG/8QAHxEBAAICAQUBAAAAAAAAAAAAAQIhAAMEBRESQXET/9oADAMBAAIRAxEAPwA56Zuo++sVzF3YnIH5NN2M6fwscsvJg4XX2h0PA1qibpqwtBeQiUxyMGGhGrmk26y9o11OrIxSKRDEAxX4Gt1NHd5yYw71huh1beVtYkjxD5npzWIxlyJwicFjQOZFGg361QVlBaLPII4jrdNWMvI3Z1aPuMxbk2+Tsg2VVvA9UW9S43tXrlFIQ+RvQP8APFM6eo7Di/lKJJGmV9sRV7gFBWafAR2ovYkig4CbiNluRUGt7NgkmkYyXDN6HytVVZ/i1GT7W8N6cAbpe2dudrXELbOhWc62NjiBusJ1zgoIViuY5GGk+KqqrjKQ04xptfmf/9k"><noscript><img class="mdui-hoverable mdui-img-rounded mdui-center mdui-img-fluid" src="https://p.sda1.dev/12/5488809427a89f0731d38401e9258b65/d7GkPfHd.jpg" alt="undefined" title="undefined"></noscript></figure><h1 id="基本的食用方法"><a href="#基本的食用方法" class="headerlink" title="基本的食用方法"></a>基本的食用方法</h1><p>Intersection Observer 可以用于检测网页上两个元素的交集的变化，并且在这个“交集”改变到一定程度时自动调用一个函数。</p><p>下面是一个实例，虽然是一片空白，但是可以试着滑啊滑～当两个一组的色块组合开始显示/移出、显示/移出了一半、完全显示/移出时下面的输出都会更新。</p><div style="max-height:200px;overflow-y:auto" id="demo-1-main"><div><div style="height:300px"></div><div id="demo-1-target-1"><div style="height:75px;background-color:red"></div><div style="height:75px;background-color:green"></div></div><div style="height:300px"></div><div id="demo-1-target-2"><div style="height:75px;background-color:#00f"></div><div style="height:75px;background-color:#ff0"></div></div><div style="height:300px"></div></div></div><pre id="demo-1-log"></pre><script>!function(e){var t=new IntersectionObserver((function(t){var n="";t.forEach((function(e){for(var t in e)n+=t+": "+e[t]+"<br>"})),e.getElementById("demo-1-log").innerHTML=n}),{root:e.getElementById("demo-1-main"),rootMargin:"0px 0px 0px 0px",threshold:[0,.5,1]});t.observe(e.getElementById("demo-1-target-1")),t.observe(e.getElementById("demo-1-target-2"))}(document)</script><p>首先要创建一个 Intersection Observer 对象，并设定好要自动调用的函数以及根元素：</p><pre class="language-javascript line-numbers" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token function function-variable">callback</span> <span class="token operator">=</span> <span class="token parameter">entries</span> <span class="token operator">=></span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>entries<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionServer</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token property literal-property">root</span><span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token property literal-property">rootMargin</span><span class="token operator">:</span> <span class="token string">'1px 2px 4px 8px'</span><span class="token punctuation">,</span>
    <span class="token property literal-property">threshold</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>callback</code> 是调用的函数，稍后再说明～</li><li><code>root</code> 是<strong>根元素</strong>的 DOM，不设定的话就是浏览器窗口。</li><li><code>rootMargin</code> 是根元素的<strong>边距</strong>（相当于将根元素的范围扩大了），写法和 CSS 的 <code>margin</code> 是一样的。</li><li><code>threshold</code> 是其他元素和根元素的<strong>交集的阈值</strong>，交集为 <code>0</code> 代表该元素在根元素之外，<code>1</code> 代表该元素完全与根元素完全重合。阈值可以设为一个或多个值（数组），不设定的话就是 <code>0</code>。</li></ul><p>这样就相当于有了一个属于上面的“根元素”的“观察器”，接下来就可以设定它要观察哪些元素与根元素的交集变化了：</p><pre class="language-javascript line-numbers" data-language="javascript"><code class="language-javascript"><span class="token comment">// 开始观察某个元素</span>
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'target-1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'target-2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 还可以取消观察某个元素</span>
observer<span class="token punctuation">.</span><span class="token function">unobserve</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'target-1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 或者取消观察所有元素</span>
observer<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用 <code>observe</code> <strong>开始观察某个元素时</strong>，或是某个被观察的元素（可能不唯一）与根元素的交集<strong>增加或减少</strong>并且<strong>经过了上面设定的阈值</strong>时，就会执行 <code>callback</code> 函数。调用函数时使用的唯一的参数是由 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/IntersectionObserverEntry" target="_blank" rel="noopener"><code>IntersectionObserverEntry</code></a> 对象组成的数组。</p><figure class="akarin-blurred-container"><div style="padding-bottom:min(calc(100%/1516*373),373px,480px)"></div><img class="mdui-hoverable mdui-img-rounded" data-src="https://p.sda1.dev/12/e80c19e2d59403d7f43f0e7553b5a3f7/GMBKBE0V.png" data-src-webp="https://p.sda1.dev/12/0a9d0922ada1c16b80968e4cf2912ebb/glnf0VDN.webp"> <img class="mdui-hoverable mdui-img-rounded akarin-blurred" src="data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCAAIACADASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAMEB//EABsQAQADAAMBAAAAAAAAAAAAAAEAAhFRYZGB/8QAFAEBAAAAAAAAAAAAAAAAAAAAAv/EABURAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIRAxEAPwDcUs3cWWCtnNE+MRErECmynD4xp35EQyv/2Q"><noscript><img class="mdui-hoverable mdui-img-rounded mdui-center mdui-img-fluid" src="https://p.sda1.dev/12/e80c19e2d59403d7f43f0e7553b5a3f7/GMBKBE0V.png" alt="undefined" title="undefined"></noscript></figure><p>这个对象包含了和元素交叉的事件有关的一些信息，部分比较常用的属性：</p><ul><li><code>time</code> 是从新建“观察器”到触发函数间隔的时间，单位是毫秒。</li><li><code>isIntersecting</code> 和 <code>intersectionRatio</code> 分别表示被观察的元素和根元素是否有交集以及交集的大小，对应上面的 <code>threshold</code>。</li><li><code>target</code> 是被观察的元素。</li></ul><p>触发函数时，<code>intersectionRatio</code> 和设定的 <code>threshold</code> 可能会有少量的误差～例如设定 <code>threshold</code> 为 <code>0.5</code>，进入和离开根元素时 <code>intersectionRatio</code> 会略高于 / 略低于 <code>0.5</code>。另外<strong>开始观察某个元素时会立即触发一次函数</strong>，因此虽然设定了 <code>threshold</code> 但是在这里仍然需要对 <code>intersectionRatio</code> 进行检查。</p><p>上面的演示的完整代码：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>demo-1-main<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token css language-css value"><span class="token property">max-height</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span> <span class="token property">overflow-y</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token css language-css value"><span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>demo-1-target-1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token css language-css value"><span class="token property">height</span><span class="token punctuation">:</span> 75px<span class="token punctuation">;</span> <span class="token property">background-color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token css language-css value"><span class="token property">height</span><span class="token punctuation">:</span> 75px<span class="token punctuation">;</span> <span class="token property">background-color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token css language-css value"><span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>demo-1-target-2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token css language-css value"><span class="token property">height</span><span class="token punctuation">:</span> 75px<span class="token punctuation">;</span> <span class="token property">background-color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token css language-css value"><span class="token property">height</span><span class="token punctuation">:</span> 75px<span class="token punctuation">;</span> <span class="token property">background-color</span><span class="token punctuation">:</span> yellow<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token css language-css value"><span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>demo-1-log<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token parameter">entries</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    entries<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            text <span class="token operator">+=</span> key <span class="token operator">+</span> <span class="token string">': '</span> <span class="token operator">+</span> e<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'&lt;br>'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'demo-1-log'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> text<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token property literal-property">root</span><span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'demo-1-main'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token property literal-property">rootMargin</span><span class="token operator">:</span> <span class="token string">'0px 0px 0px 0px'</span><span class="token punctuation">,</span>
    <span class="token property literal-property">threshold</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'demo-1-target-1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'demo-1-target-2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="实例：“懒加载”"><a href="#实例：“懒加载”" class="headerlink" title="实例：“懒加载”"></a>实例：“懒加载”</h1><p>如果一个网页上有很多图片的话，不是所有人都会一直滑到底的，那些没有显示出来的图片实际上也没有被加载的必要，所以就有了“懒加载”这种操作，当图片（的占位符）进入页面时再加载～</p><p><em>实际上“图片”也可以替换成其他需要按需加载的东西，比如在用 Vue 折腾的单页应用上，不同页面的 JS 代码也可以懒加载了。</em></p><p>以前的各种懒加载实现，都需要自己<strong>手动获取屏幕 / 图片的尺寸和位置</strong>，然后来个 <code>setInterval</code> 定时进行比较或者写进 <code>onscroll</code> 事件，后者还得加个去抖（debounce）或节流（throttle）。</p><p>……但是手动计算不麻烦吗？这么多参数怎么可能记得住？真的不会弄混吗？(╯‵□′)╯︵┻━┻</p><figure class="akarin-blurred-container"><div style="padding-bottom:min(calc(100%/1069*720),720px,480px)"></div><img class="mdui-hoverable mdui-img-rounded" data-src="https://p.sda1.dev/12/02b71d177caeb33c5451b81ec438ce1a/rUbmlKqT.png" data-src-webp="https://p.sda1.dev/12/b131cb086e2cd17bceaae99c6fb43a71/uaLp47UN.webp"> <img class="mdui-hoverable mdui-img-rounded akarin-blurred" src="data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCAAWACADASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAQDBQf/xAAkEAACAQMDBAMBAAAAAAAAAAABAgADBBESITEFExRBIzJRYv/EABcBAAMBAAAAAAAAAAAAAAAAAAEDBAL/xAAdEQEAAgICAwAAAAAAAAAAAAABAAIDESFREjFB/9oADAMBAAIRAxEAPwD2VKakuGLHfPJlK07TVgq4GNzrMnTOamSOJZa0RUq5YrheRFgdkfbDiqO6MoTp9jWTbUyg/s1Tp1ohBVMYIMKqqMKAIm9HRJ2td8E51tTNdqnbp0xpO+S0rS0u13HZU59F4iVWpQXVT5D53fdmbDz/AH2OP6in5efkFIjb6kiIgamnggn/2Q"><noscript><img class="mdui-hoverable mdui-img-rounded mdui-center mdui-img-fluid" src="https://p.sda1.dev/12/02b71d177caeb33c5451b81ec438ce1a/rUbmlKqT.png" alt="undefined" title="undefined"></noscript></figure><p>也有用 jQuery 实现的例子，不过这种落后的东西就没有什么学习的必要了嘛……</p><p>但是 Intersection Observer 就很适合拿来实现懒加载哦੭ ᐕ)੭*⁾⁾ 只要以窗口为根元素，观察所有的 <code>&lt;img></code>，在回调函数里设定它们的 <code>src</code>，就可以简单地实现懒加载了(⑉･̆-･̆⑉)</p><pre class="language-javascript line-numbers" data-language="javascript"><code class="language-javascript"><span class="token comment">// 图片的URL不写在src而是写在别的属性里</span>
<span class="token comment">// 例如：&lt;img data-src="image.jpg"></span>

<span class="token comment">// 新建“观察器”</span>
<span class="token comment">// 可以设定一些垂直方向的边距，提前一段时间加载图片</span>
<span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token parameter">entries</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    entries<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token comment">// 只有图片进入根元素时才执行</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>e<span class="token punctuation">.</span>isIntersecting<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

        <span class="token comment">// 设定为src的值，图片加载过以后就可以取消观察了</span>
        <span class="token keyword">let</span> t <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>t<span class="token punctuation">.</span>src<span class="token punctuation">)</span> t<span class="token punctuation">.</span>src <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'data-src'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        observer<span class="token punctuation">.</span><span class="token function">unobserve</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token property literal-property">rootMargin</span><span class="token operator">:</span> <span class="token string">'64px 0px'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 观察所有图片的位置</span>
document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'img[data-src]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>而且这个功能已经在本站实装了～用的就是上面的自己写的代码(*´∀`*)</p><p><del>其实现在用着的主题是自带懒加载功能的，不过用的是<a href="https://github.com/jieyou/lazyload" target="_blank" rel="noopener">一个 jQuery 插件</a>，很久之前还被我砍掉了</del></p><p><del>然后我发现了另一个<a href="https://github.com/tuupola/lazyload" target="_blank" rel="noopener">原生 JS 实现的懒加载插件</a>，也是用到了 Intersection Observer，所以我自己造了个轮子？！</del></p><h1 id="实例：“无限滚动”"><a href="#实例：“无限滚动”" class="headerlink" title="实例：“无限滚动”"></a>实例：“无限滚动”</h1><p>很多“信息流”的网站，例如○乎和○浪微博，都实现了无限滚动功能，滑到页面底部就自动再加载一些东西放到时间线上。<del>于是用户就这样不知不觉沉浸于由算法推荐的“信息饲料”中，出不去了</del></p><p>加载可以用 AJAX 实现，然后用 Intersection Observer 检查“信息流”的末尾是否出现，出现后就立即加载更多数据。下面的实例中，往下滑啊滑，出现“我们是有底线的”这行字就会自动加载下一个色块了～（为了展示效果，添加了少量的延迟）</p><div style="max-height:200px;overflow-y:auto" id="demo-2-main"><div id="demo-2-timeline"><div style="height:75px;background-color:red"></div><div style="height:75px;background-color:green"></div><div style="height:75px;background-color:#00f"></div><div style="height:75px;background-color:#ff0"></div></div><div style="text-align:center" id="demo-2-end">我们是有底线的</div></div><script>!function(e){new IntersectionObserver((function(t){t[0].isIntersecting&&setTimeout((function(){var t=e.createElement("div");t.style.cssText="height:75px;background-color:rgb("+[1,2,3].map((function(){return Math.floor(256*Math.random())})).join()+")",e.getElementById("demo-2-timeline").appendChild(t)}),200)}),{root:e.getElementById("demo-2-main")}).observe(e.getElementById("demo-2-end"))}(document)</script><pre class="language-javascript line-numbers" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>e<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isIntersecting<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>cssText <span class="token operator">=</span> <span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">height:75px;background-color:rgb(</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token number">256</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation interpolation-punctuation">}</span></span><span class="token string">)</span><span class="token string template-punctuation">`</span></span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'timeline'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token property literal-property">root</span><span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'main'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="实例：视频的“小窗播放”"><a href="#实例：视频的“小窗播放”" class="headerlink" title="实例：视频的“小窗播放”"></a>实例：视频的“小窗播放”</h1><p>这个例子是得到了 <a href="https://css-tricks.com/a-few-functional-uses-for-intersection-observer-to-know-when-an-element-is-in-view/#article-header-id-2" target="_blank" rel="noopener">CSS-Tricks 的一篇文章</a>的启发，不过那里面提到的是检测到视频离开窗口就自动暂停播放，其实还可以有更多的功能嘛……(・▽・〃)</p><p>经常上睿站看视频的小伙伴应该比较熟悉这个“小窗播放”的功能，在查看评论区的时候视频会自动切换到右下角的一个小窗口继续播放～</p><figure class="akarin-blurred-container"><div style="padding-bottom:min(calc(100%/2674*912),912px,480px)"></div><img class="mdui-hoverable mdui-img-rounded" data-src="https://p.sda1.dev/12/e7c6cef2e68b834582df38bcdf2d0b17/eKkYSkZQ.jpg" data-src-webp="https://p.sda1.dev/12/732434afad7fd4338815e4627cf8e12a/hyI6CG8_.webp" data-src-avif="https://p.sda1.dev/12/f833008de463a1bfff5e48023499081e/8gp89lQ-.jpg"> <img class="mdui-hoverable mdui-img-rounded akarin-blurred" src="data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCAALACADASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAABAUGA//EACYQAAICAQQBAgcAAAAAAAAAAAECAwQFABESIQYTMRQWIkFRYsH/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/EABgRAQEBAQEAAAAAAAAAAAAAAAEAMSFh/9oADAMBAAIRAxEAPwCzrZzP2myDwyY9EhvTwIhqySPxilKAkiVdOPG8rbyq3EurCJILLxc4EKKwTb7MW0Z8qePvYnmNBRJK7O7K7ryLncno63p46njbZipwiJCnIgEnckn86LnIHs64ASsoA9+vY/zSyZGizio049Nqi7Rnr6uZ7GjySJiB0NS9+R5PKKsTndPhIn2/ZZTsdNqX/9k"><noscript><img class="mdui-hoverable mdui-img-rounded mdui-center mdui-img-fluid" src="https://p.sda1.dev/12/e7c6cef2e68b834582df38bcdf2d0b17/eKkYSkZQ.jpg" alt="undefined" title="undefined"></noscript></figure><p>查看评论区的时候视频会出现在浏览器窗口外面，因此用 Intersection Observer 动态改变视频的位置就能实现上面的效果。我自己写了个简单的实例，点<a href="https://jsbin.com/rakovoyexu/edit?html,output" target="_blank" rel="noopener">这里</a>就能查看效果了(´ﾟωﾟ｀)</p><hr><blockquote><p> <br>W3C 呢……<ruby><a href="https://github.com/w3c/IntersectionObserver/blob/master/explainer.md" target="_blank" rel="noopener">最近</a><rt>2017 年</rt></ruby>发表了一个报告说呢……浏览器会通过<ruby>一些渠道<rt>Intersection Observer</rt></ruby>去影响、干预元素的交集，你对这个看法有什么回应呢？</p></blockquote><p>Intersection Observer 是个比较新的功能，如果问浏览器资词不资词，大多数都是资词的，除了<del>思想江化的</del> IE 和（旧版）Safari。</p><figure class="akarin-blurred-container"><div style="padding-bottom:min(calc(100%/1740*767),767px,480px)"></div><img class="mdui-hoverable mdui-img-rounded" data-src="https://p.sda1.dev/12/a4c2325dd7b4cc912a383dc54983b209/6XyVJpV-.png" data-src-webp="https://p.sda1.dev/12/c1d5f69e8bca28b7c0ddc730f38638fc/jV7c9NrU.webp"> <img class="mdui-hoverable mdui-img-rounded akarin-blurred" src="data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCAAOACADASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAwYAAQUH/8QAIxAAAQMEAgIDAQAAAAAAAAAAAQIDEQAEEiEFkRNSIzJBgf/EABcBAAMBAAAAAAAAAAAAAAAAAAECAwX/xAAdEQACAgIDAQAAAAAAAAAAAAABAgARAzEEEhMh/9oADAMBAAIRAxEAPwDrYyMxHVESXJCcwP5Stf2HKZl5xdunM4ENlQlO9HVCbt+VCEPh1j4obToSE619azvVgaKwvyMKOyHtY38jtkj2HdTJExmO6x/FzPkBxssPWVz3FW9bci6GiE26ClxKjC17A/NAU5yAShdAxW7I3Qn/2Q"><noscript><img class="mdui-hoverable mdui-img-rounded mdui-center mdui-img-fluid" src="https://p.sda1.dev/12/a4c2325dd7b4cc912a383dc54983b209/6XyVJpV-.png" alt="undefined" title="undefined"></noscript></figure><p>为了给这些<del>思想江化的</del>浏览器提高姿势水平，可以使用 W3C 钦定的一个 <a href="https://github.com/w3c/IntersectionObserver/blob/master/polyfill/intersection-observer.js" target="_blank" rel="noopener">Polyfill</a>。</p><pre class="language-javascript line-numbers" data-language="javascript"><code class="language-javascript">window<span class="token punctuation">.</span>IntersectionObserver<span class="token operator">||</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> n<span class="token operator">=</span>e<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"script"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>n<span class="token punctuation">.</span>src<span class="token operator">=</span><span class="token string">"https://cdn.jsdelivr.net/gh/w3c/IntersectionObserver/polyfill/intersection-observer.min.js"</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="line-numbers-rows" aria-hidden="true"><span></span></span></code></pre><blockquote class="mdui-m-b-0 mdui-m-x-0 mdui-p-y-1" style="border-left:4px solid rgba(0,0,0,.36)"><strong>本作品采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。不允许内容农场类网站、CSDN 用户和微信公众号转载。</strong><br><strong>本文作者：✨小透明・宸✨</strong><br><strong>本文链接：<a href="https://akarin.dev/2020/03/26/intersection-observer/">https://akarin.dev/2020/03/26/intersection-observer/</a></strong></blockquote></article><div class="mdui-p-a-3 mdui-color-white" id="lv-container" data-id="city" data-uid="MTAyMC80NDUwOC8yMTAzOQ=="><script>(()=>{const e=document.createElement("script");e.src="https://cdn-city.livere.com/js/embed.dist.js",e.async=!0,document.body.appendChild(e)})()</script></div></div><div class="mdui-valign mdui-m-t-2"><a href="../../../04/25/phar-packaging/" class="mdui-ripple mdui-btn mdui-btn-icon"><i class="material-icons mdui-icon">chevron_left</i> </a><span class="mdui-typo-body-1-opacity mdui-text-left mdui-m-l-1" title="Phar 包的使用方法">上一篇</span> <span class="mdui-typo-body-1-opacity mdui-text-center" style="flex-grow:1"></span> <span class="mdui-typo-body-1-opacity mdui-text-right mdui-m-r-1" title="在 Javascript 和 PHP 中进行加密和解密">下一篇</span> <a href="../../../02/26/crypto-in-js-and-php/" class="mdui-ripple mdui-btn mdui-btn-icon"><i class="material-icons mdui-icon">chevron_right</i></a></div></main><footer class="mdui-container mdui-m-y-5 mdui-typo" style="display:flex;max-width:1024px"><div class="mdui-typo-body-1-opacity mdui-text-left">Copyright © 2024 ✨小透明・宸✨<br>Hosted by <a href="https://github.com/TransparentLC/transparentlc.github.io" target="_blank">Github Pages</a></div><div style="flex-grow:1"></div><div class="mdui-typo-body-1-opacity mdui-text-right">Powered by <a href="https://hexo.io" target="_blank">Hexo</a> <span class="mdui-hidden-xs-down">7.3.0</span><br>Theme - <a href="https://github.com/TransparentLC/hexo-theme-akarin" target="_blank">Akarin</a></div></footer><script src="https://gcore.jsdelivr.net/combine/gh/TransparentLC/transparentlc.github.io/js/mdui.min.js,npm/medium-zoom@1/dist/medium-zoom.min.js,npm/instant.page@5/instantpage.min.js,npm/aplayer@1/dist/APlayer.min.js,gh/TransparentLC/transparentlc.github.io@879beec/js/script.min.js"></script><script src="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/js/bsz.min.js" async></script></body></html>