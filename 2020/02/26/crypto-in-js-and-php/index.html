<!doctype html><html lang="zh-Hans"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no" name="viewport"><meta content="webkit" name="renderer"><meta content="webkit" name="force-rendering"><meta content="✨小透明・宸✨" name="author"><meta content="" name="keywords"><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"><link href="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png" rel="icon shortcut" type="image/ico"><link href="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png" rel="icon"><link href="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png" rel="apple-touch-icon"><link href="/atom.xml" rel="alternate" type="application/atom+xml"><title>在 Javascript 和 PHP 中进行加密和解密 | 存在感消失的地方|ω•`)</title><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://akarin.dev/2020/02/26/crypto-in-js-and-php/"},"headline":"在 Javascript 和 PHP 中进行加密和解密","datePublished":"2020-02-26T14:09:56.000Z","dateModified":"2020-02-26T14:09:56.000Z","author":{"@type":"Person","name":"✨小透明・宸✨","image":{"@type":"ImageObject","url":"https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg"},"description":"身处寒夜 把握星光✨"},"publisher":{"@type":"Organization","name":"存在感消失的地方|ω•`)","logo":"https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png"},"keywords":"","description":"学了一学期的（入门）密码学，不自己试着用一下怎么行嘛(´･_･`)"}</script><meta content="存在感消失的地方|ω•`)" property="og:site_name"><meta content="在 Javascript 和 PHP 中进行加密和解密" property="og:title"><meta content="学了一学期的（入门）密码学，不自己试着用一下怎么行嘛(´･_･`)" property="og:description"><meta content="article" property="og:type"><meta content="https://akarin.dev/2020/02/26/crypto-in-js-and-php/" property="og:url"><meta content="https://p.sda1.dev/12/6ea1796aea679bf193ba2d34e9cc06c9/bx5LiArk.jpg" property="og:image"><meta content="2020-02-26T14:09:56.000Z" property="article:published_time"><meta content="2020-02-26T14:09:56.000Z" property="article:modified_time"><meta content="✨小透明・宸✨" property="article:author"><script>document.documentMode&&(location.href="../../../../upgrade-browser.html")</script><link href="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/css/mdui.min.css" rel="stylesheet"><link href="https://gcore.jsdelivr.net/combine/npm/prismjs@1/plugins/line-numbers/prism-line-numbers.min.css,npm/prism-themes@1/themes/prism-vsc-dark-plus.min.css,npm/aplayer@1/dist/APlayer.min.css,gh/TransparentLC/transparentlc.github.io@879beec/css/style.min.css" rel="stylesheet"><style>*{--sidebar-image:url(https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/sidebar_header.jpg);--sidebar-image-color:#958981;--banner-image:url(https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/daily_pic.png);--banner-image-color:#f09ea3;--post-thumbnail-color:#f09ea3;--copy-code-btn-color:#fff}.MathJax[jax=SVG][display=true]{display:block;text-align:center;margin:1em 0}</style><meta content="Hexo 7.3.0" name="generator"></head><body class="mdui-drawer-body-left mdui-theme-accent-pink mdui-theme-primary-pink"><script>window.switchDark=t=>{const a={auto:"mdui-theme-layout-auto",enable:"mdui-theme-layout-dark",disable:""};(t=t||localStorage.getItem("dark"))in a||(t="auto");for(const e in a)a[e]&&document.body.classList[e===t?"add":"remove"](a[e]);localStorage.setItem("dark",t)},switchDark()</script><button class="mdui-fab mdui-m-a-2 mdui-shadow-0 mdui-text-color-grey-700" mdui-drawer="{target:'#akarin-drawer'}" style="position:fixed;z-index:1"><i class="material-icons mdui-icon">menu</i></button><nav class="mdui-drawer mdui-drawer-full-height mdui-shadow-6" id="akarin-drawer"><div class="akarin-util-bg-cover mdui-p-x-2" id="akarin-drawer-media"><img class="akarin-hover-spin mdui-img-circle mdui-m-t-4" src="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg" id="akarin-drawer-avatar"><div class="akarin-util-text-gradient mdui-card-media-covered"><div class="mdui-card-primary"><div class="mdui-typo-subheading">✨小透明・宸✨</div><div class="akarin-util-opacity-half mdui-typo-caption">存在感消失的地方|ω•`)</div></div></div></div><div class="mdui-list" mdui-collapse><div><a href="../../../../" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">home</i> <span class="mdui-list-item-content">主页</span></a></div><div><a href="../../../../about/" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">person</i> <span class="mdui-list-item-content">关于</span></a></div><div><a href="../../../../friend/" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">link</i> <span class="mdui-list-item-content">友链</span></a></div><div><a href="https://github.com/TransparentLC" target="_blank" rel="noopener" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">code</i> <span class="mdui-list-item-content">GitHub</span></a></div><div><a href="https://github.com/TransparentLC.gpg" target="_blank" rel="noopener" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">vpn_key</i> <span class="mdui-list-item-content">PGP 公钥</span></a></div><div><a href="../../../../archives/" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">collections_bookmark</i> <span class="mdui-list-item-content">归档</span> <small class="akarin-drawer-badge mdui-color-theme-accent">34</small></a></div><div><a href="../../../../atom.xml" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">rss_feed</i> <span class="mdui-list-item-content">RSS</span></a></div><div class="mdui-divider"></div><div class="mdui-collapse-item mdui-collapse-item-open"><div class="mdui-ripple mdui-list-item mdui-collapse-item-header"><i class="material-icons mdui-icon mdui-list-item-icon">brightness_4</i> <span class="mdui-list-item-content">深色模式</span> <i class="material-icons mdui-icon mdui-collapse-item-arrow">keyboard_arrow_down</i></div><div class="mdui-list mdui-collapse-item-body"><div class="mdui-ripple mdui-list-item" data-dark="auto"><span class="mdui-list-item-content">根据系统主题切换</span></div><div class="mdui-ripple mdui-list-item" data-dark="enable"><span class="mdui-list-item-content">启用</span></div><div class="mdui-ripple mdui-list-item" data-dark="disable"><span class="mdui-list-item-content">禁用</span></div></div></div><div class="mdui-collapse-item mdui-collapse-item-open"><div class="mdui-ripple mdui-list-item mdui-collapse-item-header"><i class="material-icons mdui-icon mdui-list-item-icon">insert_chart</i> <span class="mdui-list-item-content">访问统计</span> <i class="material-icons mdui-icon mdui-collapse-item-arrow">keyboard_arrow_down</i></div><div class="mdui-list mdui-collapse-item-body"><div class="mdui-ripple mdui-list-item"><span class="mdui-list-item-content">站点访问量</span> <small class="akarin-drawer-badge mdui-color-theme-accent" id="busuanzi_value_site_pv">Loading</small></div><div class="mdui-ripple mdui-list-item"><span class="mdui-list-item-content">站点访客数</span> <small class="akarin-drawer-badge mdui-color-theme-accent" id="busuanzi_value_site_uv">Loading</small></div><div class="mdui-ripple mdui-list-item"><span class="mdui-list-item-content">页面访问量</span> <small class="akarin-drawer-badge mdui-color-theme-accent" id="busuanzi_value_page_pv">Loading</small></div></div></div></div></nav><picture id="akarin-top" title="返回顶部"><source srcset="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/top.avif" type="image/avif"><source srcset="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/top.webp" type="image/webp"><img src="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/top.png"></picture><div style="padding-top:20px"></div><div class="mdui-hidden-sm-down" style="padding-top:40px"></div><div class="mdui-hidden-md-down" style="padding-top:40px"></div><main class="mdui-container" style="max-width:1024px"><div class="akarin-util-rounded-5 mdui-card mdui-shadow-4"><div class="mdui-ripple akarin-post-bg akarin-util-bg-cover" data-src="https://p.sda1.dev/12/6ea1796aea679bf193ba2d34e9cc06c9/bx5LiArk.jpg" data-src-avif="https://vfile.meituan.net/mmdb/1b1f1958fbd8d0cd78f0e3b2e2d4ded323497.jpg" data-src-webp="https://p.sda1.dev/12/5ba887e52d4c0eb4144105b45fd7cea1/gcXQxji2.webp"><div class="akarin-blurred akarin-post-bg akarin-util-bg-cover" style="background-image:url(data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCAAwAEADASIAAhEBAxEB/8QAGwAAAwEAAwEAAAAAAAAAAAAAAwQFBgABAgf/xAArEAACAQMEAQMDBAMAAAAAAAABAgMABBEFEiExExRBYSKBkTJCUXEGYrH/xAAYAQADAQEAAAAAAAAAAAAAAAACAwQFAP/EACURAAICAQMDBAMAAAAAAAAAAAECAxEABBIhIkFhBRMxUSMycf/aAAwDAQACEQMRAD8A+k1rbO+hhsYfUzKrYOAeyKQ1mC1tIg8cQEjtxzx+Kyrbn5Ykt7mnavWI6qqqbHPOJ9K9IlRnlkkG0igF75tPW20pLLMuPnj/ALWf1PS5NUuUM8/jghbMXhyJDkDJZqFZIrzJHI30jLbfmrjyRruw2SO6xwnWXJsnNV4xC9KSeMg3X+OWl1tMt1eM6/pczFiPzW0s52dAsm3yDvaMA1JaWJM5DHuiLMiFHXrdTo22HxinBcVz4yndXSwADGWPQoVtqXlkCSKBnoiutRt3m2yRjdgYIpCC3kWRXdSoU55rQ/GIyzEChnKkJhJJ6sjapcma5dpFbYMeP+KmI0spIiQcD27q3c2RuYti9/tPXJrM6ba+ruQjzyQ3UDHGOmQ9/epJYwJf24OaKSKsNJXTWEunmso4J/DJlywJHsw5X7tVeKPU5ry2nUBYclZIzjK8gkmtO0alCCuanRT+O+kixkM3B+QorlCoV6bvjIZJTKp7Ec4LVdL9XFF4pBG8b5BIyOiOvjsV4MRSEQx7nCHBJ7I9zTKu3nLeoLgE/RgiiQ790pwN2T30K4gvtXbXOLFIN2+xQ/mG0nUtyeCc4dThWPTU/OfqA+Kzgf07MGj3hu1PXwQaqWk3qEOzOU7Ru/saGWKZ9O4AvaReJeSISqLosLH0cduIfxUeXRbJ5HvULpcKwbg8Z9z969apqM/qGhjYqicce9ct7kzRBv3qCj/NWtp2Co5AIY5NFrlaWWJGYFQbPY4ZDK4I8hFLIjJfxORnxBjjrPFGjkKOVB/2A/uiyhZBuH6gKF4xY4+DlEbk7gDyRiN47xQPcRjLxAvj+QOSKY3phpEYFHAcEV0MtuVlwcdf3UiwzE97p7dwSCSP5jlyw/Bo2q1YYuMbtyNlMh3XlMg03pMe25mJyCU4Fe9mVBFFjUgg9EULOT8cYfsoF+6Njwc//9k)"></div><div class="akarin-util-text-gradient akarin-post-title"><div class="mdui-card-primary"><div class="mdui-card-primary-title mdui-text-color-white-text">在 Javascript 和 PHP 中进行加密和解密</div></div></div></div><div class="mdui-valign mdui-card-header"><div><img class="akarin-hover-spin mdui-card-header-avatar" src="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg"><div class="mdui-card-header-title">✨小透明・宸✨</div><div class="mdui-card-header-subtitle">2020-02-26 22:09:56</div></div></div><article class="mdui-typo mdui-card-content mdui-p-a-3"><blockquote><p>封面图：<a href="https://www.pixiv.net/artworks/77846017" target="_blank" rel="noopener">Pixiv ID: 77846017 「京あか」 by ネリヲ</a></p></blockquote><p>因为上个学期的课程里有学习到了一点入门的密码学（逃 所以就顺便想尝试一下在编程中进行加密解密相关的操作～(ﾉ*･ω･)ﾉ</p><p>在开始之前，先简单地过一遍相关的一些概念：</p><ul><li>明文：没有加密的数据</li><li>密文：加密后的数据</li><li>对称加密：使用**同一个密钥（如果是除 CBC 以外模式的分组密码，还需要 IV）**进行加密和解密</li><li>非对称加密：任何人都可以使用公开的<strong>公钥</strong>加密，只有藏着<strong>私钥</strong>的人才能解密</li><li>Hash：把任意长度的输入变换成<strong>固定长度的、尽可能避免产生碰撞的</strong>输出，是<strong>不可逆</strong>操作</li><li>Base64：使用可打印的字符表示二进制数据的一种<strong>编码方式</strong>，因为任何人都可以直接进行编码和解码，所以<strong>不是加密算法</strong></li></ul><p>这里的目标是在前端 Javascript 环境和后端 PHP 环境，分别使用一下 RSA 和 AES 这两种常见的非对称和对称加密算法～</p><p>用到的各种开源库：</p><ul><li><a href="https://github.com/brix/crypto-js" target="_blank" rel="noopener">CryptoJS</a>：用 Javascript 实现了多种对称加密算法和 Hash 算法的函数库。</li><li><a href="https://github.com/travist/jsencrypt" target="_blank" rel="noopener">JSEncrypt</a>：用 Javascript 实现了 RSA 的加密解密、验证签名、密钥生成。</li><li><a href="https://www.php.net/manual/zh/book.openssl.php" target="_blank" rel="noopener">OpenSSL</a>：广泛用于安全通信的一个库，支持大多数的加密算法和 Hash 算法，这里用到的是 PHP 自带的相关扩展。</li><li><a href="https://github.com/phpseclib/phpseclib" target="_blank" rel="noopener">phpseclib</a>：一个以面向对象的方式封装了 RSA 和其他一些对称加密算法的 PHP composer 包，实际上还是在调用 PHP 的 OpenSSL 之类的加密扩展。（如果没有安装扩展的话，这个库自己也已经用 PHP 把各种算法实现了一遍……）</li></ul><hr><h1 id="AES-对称加解密"><a href="#AES-对称加解密" class="headerlink" title="AES 对称加解密"></a>AES 对称加解密</h1><h2 id="CryptoJS"><a href="#CryptoJS" class="headerlink" title="CryptoJS"></a>CryptoJS</h2><p>在开始进行加解密之前，有必要先介绍一下 CryptoJS 中的 <code>WordArray</code>～</p><p>由于 JS 中直接操作数值型数据的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Typed_arrays" target="_blank" rel="noopener">TypedArray</a> 是一个相对比较新的标准，而 CryptoJS 这个库开发于 TypedArray 进入 JS 标准之前，所以 CryptoJS 中明文、密文、密钥和 Hash 一直都是使用了一个自建的 WordArray 对象，通过一个相当于 UInt32 数值组成的数组和一个标志位来代表原始的二进制数据：</p><figure class="akarin-blurred-container"><div style="padding-bottom:min(calc(100%/1251*334),334px,480px)"></div><img class="mdui-hoverable mdui-img-rounded" data-src="https://p.sda1.dev/12/5c4a22653ee073346c8bf50f6e26ffcc/EB5DNjq5.png" data-src-webp="https://p.sda1.dev/12/7fbd6ac9d44a7811e42dd220e4e1132b/Zlt6MuP4.webp"> <img class="mdui-hoverable mdui-img-rounded akarin-blurred" src="data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCAAJACADASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAgMEAQf/xAAhEAACAQMDBQAAAAAAAAAAAAABAgADETISUXEhIjFDYf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oADAMBAAIRAxEAPwDuhzsNI+ECOps4varTW52HWKq5ngwduYqYrQufYjcCb37iQjysNclhX//Z"><noscript><img class="mdui-hoverable mdui-img-rounded mdui-center mdui-img-fluid" src="https://p.sda1.dev/12/5c4a22653ee073346c8bf50f6e26ffcc/EB5DNjq5.png" alt="undefined" title="undefined"></noscript></figure><p>（由于字节序不同，虽然也可以使用 <code>CryptoJS.lib.WordArray.create(new Uint32Array([...]))</code> 得到 WordArray ，但是里面的 <code>words</code> 和输入的 <code>Uint32Array</code> 是不同的）</p><p>加密和解密都是本质上都是对二进制数据进行操作，CryptoJS 也支持一些“编码”标准，可以与 WordArray 相互转换：</p><pre class="language-javascript line-numbers" data-language="javascript"><code class="language-javascript"><span class="token comment">// 三个数据实际上都是QWERTYUIOP123456</span>
<span class="token comment">// 使用CryptoJS.enc.*.parse将数据转换为WordArray</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'QWERTYUIOP123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Hex<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'51574552545955494f50313233343536'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> c <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'UVdFUlRZVUlPUDEyMzQ1Ng=='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用CryptoJS.enc.*.stringify将WordArray转换为数据：</span>
CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "QWERTYUIOP123456"</span>
CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Hex<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "51574552545955494f50313233343536"</span>
CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "UVdFUlRZVUlPUDEyMzQ1Ng=="</span>

<span class="token comment">// 也可以对WordArray使用.toString(CryptoJS.enc.*)，和CryptoJS.enc.*.stringify是等效的</span>
a<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">)</span><span class="token punctuation">;</span>
b<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Hex<span class="token punctuation">)</span><span class="token punctuation">;</span>
c<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>除了已有的编码，还可以在 <code>CryptoJS.enc</code> 中加入一个有 <code>stringify</code> 和 <code>parse</code> 两个函数的对象自行扩充。比如下面的一段代码就添加了对 <code>Uint8Array</code> 的支持（<a href="https://gist.github.com/lettergram/ba6733a854f835bca22b" target="_blank" rel="noopener">原代码出处</a>）：</p><pre class="language-javascript line-numbers" data-language="javascript"><code class="language-javascript">CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Uint8 <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将WordArray转换为数据，虽然是stringify但是不一定要求是字符串</span>
    <span class="token function function-variable">stringify</span><span class="token operator">:</span> <span class="token parameter">wordArray</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> words <span class="token operator">=</span> wordArray<span class="token punctuation">.</span>words<span class="token punctuation">;</span>
        <span class="token keyword">let</span> sigBytes <span class="token operator">=</span> wordArray<span class="token punctuation">.</span>sigBytes<span class="token punctuation">;</span>
        <span class="token keyword">let</span> u8arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>sigBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> sigBytes<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            u8arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>words<span class="token punctuation">[</span>i <span class="token operator">>>></span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">>>></span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">-</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> u8arr<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 将数据转换为WordArray</span>
    <span class="token function function-variable">parse</span><span class="token operator">:</span> <span class="token parameter">u8arr</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> len <span class="token operator">=</span> u8arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token keyword">let</span> words <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            words<span class="token punctuation">[</span>i <span class="token operator">>>></span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">|=</span> <span class="token punctuation">(</span>u8arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">-</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> CryptoJS<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>WordArray<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>words<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// "ABCD"</span>
CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Uint8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0x41</span><span class="token punctuation">,</span> <span class="token number">0x42</span><span class="token punctuation">,</span> <span class="token number">0x43</span><span class="token punctuation">,</span> <span class="token number">0x44</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">)</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>调用 <code>CryptoJS.*.encrypt</code> 函数可以进行加密，并<del>钦定</del>加密模式、填充模式和 IV，比如加密明文 <code>ABCD</code>：</p><pre class="language-javascript line-numbers" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> message <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'ABCD'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> key <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'0123456789ABCDEF'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> iv <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'FEDCBA9876543210'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> cipher <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token constant">AES</span><span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">iv</span><span class="token operator">:</span> iv<span class="token punctuation">,</span> <span class="token comment">// 如果是ECB模式就不需要钦定IV</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span> CryptoJS<span class="token punctuation">.</span>mode<span class="token punctuation">.</span><span class="token constant">CBC</span><span class="token punctuation">,</span> <span class="token comment">// 不钦定的话，默认也是这个</span>
    <span class="token literal-property property">padding</span><span class="token operator">:</span> CryptoJS<span class="token punctuation">.</span>pad<span class="token punctuation">.</span>Pkcs7<span class="token punctuation">,</span> <span class="token comment">// 不钦定的话，默认也是这个</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>容易踩坑的一点是上面的 <code>cipher</code> 并不是 WordArray，而是一个<strong>包含了加密算法、加密模式、密文、密钥、IV 等信息的对象</strong>。对这个 <code>cipher</code> 直接 <code>toString</code> 可以得到 Base64 编码后的数据，但是只有从这个对象的 <code>ciphertext</code> 获取对应的 WordArray 才能使用 <code>CryptoJS.enc.*.stringify</code> 和 <code>.toString(CryptoJS.enc.*)</code> 任意转换为一般的数据，否则就会报错了(´･_･`)</p><figure class="akarin-blurred-container"><div style="padding-bottom:min(calc(100%/1318*677),677px,480px)"></div><img class="mdui-hoverable mdui-img-rounded" data-src="https://p.sda1.dev/12/ef35748a7717c66e0a41d0f21aa8a39a/rYtlmgq3.png" data-src-webp="https://p.sda1.dev/12/1c1f669f93715767db85016d7b5526e0/EZ6NYFiQ.webp"> <img class="mdui-hoverable mdui-img-rounded akarin-blurred" src="data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCAAQACADASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAwIH/8QAIBAAAQQCAgMBAAAAAAAAAAAAAQACAxExgUFSE1Fxsf/EABUBAQEAAAAAAAAAAAAAAAAAAAIB/8QAFxEBAQEBAAAAAAAAAAAAAAAAAAEhQf/aAAwDAQACEQMRAD8A3VzyyQgEhvNJBI3tLV8UikJEpzpV5TeH57JXmAZrmHMko0rF9nbCKKX2Xj6Qf1KCTya0oUf/2Q"><noscript><img class="mdui-hoverable mdui-img-rounded mdui-center mdui-img-fluid" src="https://p.sda1.dev/12/ef35748a7717c66e0a41d0f21aa8a39a/rYtlmgq3.png" alt="undefined" title="undefined"></noscript></figure><pre class="language-javascript line-numbers" data-language="javascript"><code class="language-javascript"><span class="token comment">// "1Wl2Kg1/0Vh+fJPX+UsJaA=="</span>
cipher<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cipher<span class="token punctuation">.</span>ciphertext<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">)</span><span class="token punctuation">;</span>
CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cipher<span class="token punctuation">.</span>ciphertext<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// "d569762a0d7fd1587e7c93d7f94b0968"</span>
cipher<span class="token punctuation">.</span>ciphertext<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Hex<span class="token punctuation">)</span><span class="token punctuation">;</span>
CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Hex<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cipher<span class="token punctuation">.</span>ciphertext<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 报错</span>
cipher<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">)</span><span class="token punctuation">;</span>
CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cipher<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>至于解密操作……当然是把 <code>encrypt</code> 改成 <code>decrypt</code> 了，但是和加密一样也有一个坑：</p><p><strong>用来解密的是上面提到的“对象”，而不是 WordArray</strong>。直接传一个 WordArray 进去是无法正常解密的，然而解密之后得到的又是 WordArray。一开始使用 CryptoJS 的时候总是发现解密得到的东西是空白的，其实就是在这个地方踩了坑┐(´-｀)┌</p><p>在实际中，收到的密文显然不会是上面的“对象”的形式（如果把加密算法、密钥、IV 之类的也传过来的话……？！），因此就需要模仿上面的 <code>cipher</code>，**用 WordArray 临时创建一个只有 <code>ciphertext</code> 这个属性的“对象”**用来解密：</p><pre class="language-javascript line-numbers" data-language="javascript"><code class="language-javascript"><span class="token comment">// 使用上面的“对象”解密，可以得到ABCD</span>
CryptoJS<span class="token punctuation">.</span><span class="token constant">AES</span><span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>cipher<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">iv</span><span class="token operator">:</span> iv<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 直接使用WordArray解密，得到的是空字符串</span>
CryptoJS<span class="token punctuation">.</span><span class="token constant">AES</span><span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>
    CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'1Wl2Kg1/0Vh+fJPX+UsJaA=='</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    key<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">iv</span><span class="token operator">:</span> iv<span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 临时用WordArray创建一个“对象”，也能得到ABCD</span>
CryptoJS<span class="token punctuation">.</span><span class="token constant">AES</span><span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span><span class="token literal-property property">ciphertext</span><span class="token operator">:</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'1Wl2Kg1/0Vh+fJPX+UsJaA=='</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    key<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">iv</span><span class="token operator">:</span> iv<span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>嗯……总的来说，使用 CryptoJS 进行加解密是比较麻烦的一件事，而且它的<a href="https://github.com/brix/crypto-js/blob/develop/docs/QuickStartGuide.wiki" target="_blank" rel="noopener">官方文档</a>也只是介绍了一下支持的算法，甚至没有一段演示用的代码（<a href="https://github.com/brix/crypto-js/blob/develop/README.md" target="_blank" rel="noopener">README.md</a> 里面倒是简单地介绍了一下用法）。至于加密和解密时涉及到的那个“对象”和 WordArray 的区别，不自己摸索一下估计就很难弄明白呢……(ฅ́дฅ̀)</p><p>另外，用 CryptoJS 计算 Hash 既可以输入字符串也可以输入 WordArray，得到的还是 WordArray：</p><pre class="language-javascript line-numbers" data-language="javascript"><code class="language-javascript"><span class="token comment">// "cb08ca4a7bb5f9683c19133a84872ca7"</span>
CryptoJS<span class="token punctuation">.</span><span class="token constant">MD5</span><span class="token punctuation">(</span><span class="token string">'ABCD'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Hex<span class="token punctuation">)</span><span class="token punctuation">;</span>
CryptoJS<span class="token punctuation">.</span><span class="token constant">MD5</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Hex<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'41424344'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Hex<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span></span></code></pre><h2 id="OpenSSL"><a href="#OpenSSL" class="headerlink" title="OpenSSL"></a>OpenSSL</h2><p>在 PHP 中进行 AES 加密和解密分别用到的是 <a href="https://www.php.net/manual/zh/function.openssl-encrypt.php" target="_blank" rel="noopener"><code>openssl_encrypt</code></a> 和 <a href="https://www.php.net/manual/zh/function.openssl-decrypt.php" target="_blank" rel="noopener"><code>openssl_decrypt</code></a> 两个函数，参数的顺序也基本相同：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">openssl_encrypt</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$method</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$iv</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">openssl_decrypt</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$method</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$iv</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span></span></code></pre><p><code>$data</code> 是明文和密文，<code>$method</code> 是加密方式，<code>$key</code> 是密钥。<code>$option</code> 可以统一设定调用上面的函数加密和解密时<strong>密文</strong>的格式：默认为 <code>0</code> 代表使用 Base64，设为 <code>OPENSSL_RAW_DATA</code> 就代表直接使用字符串。但是<strong>明文、密钥和 IV</strong> 仍然是固定使用<strong>字符串</strong>而不是 Base64。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">// 使用Base64编码：</span>
<span class="token keyword">echo</span> <span class="token function">openssl_encrypt</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ABCD'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'AES-128-CBC'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'0123456789ABCDEF'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'FEDCBA9876543210'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "1Wl2Kg1/0Vh+fJPX+UsJaA=="</span>
<span class="token keyword">echo</span> <span class="token function">openssl_decrypt</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'1Wl2Kg1/0Vh+fJPX+UsJaA=='</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'AES-128-CBC'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'0123456789ABCDEF'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'FEDCBA9876543210'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "ABCD"</span>

<span class="token comment">// 不使用Base64编码：</span>
<span class="token keyword">echo</span> <span class="token function">bin2hex</span><span class="token punctuation">(</span><span class="token function">openssl_encrypt</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ABCD'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'AES-128-CBC'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'0123456789ABCDEF'</span><span class="token punctuation">,</span> <span class="token constant">OPENSSL_RAW_DATA</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'FEDCBA9876543210'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "d569762a0d7fd1587e7c93d7f94b0968"</span>
<span class="token keyword">echo</span> <span class="token function">openssl_decrypt</span><span class="token punctuation">(</span><span class="token function">hex2bin</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'d569762a0d7fd1587e7c93d7f94b0968'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'AES-128-CBC'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'0123456789ABCDEF'</span><span class="token punctuation">,</span> <span class="token constant">OPENSSL_RAW_DATA</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'FEDCBA9876543210'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "ABCD"</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>前面提到的 CryptoJS 可以在十六进制、Base64 和字符串之间进行转换，而 PHP 这边除了加密时自带的可选的 Base64 编码，也可以直接使用 <code>bin2hex</code> / <code>hex2bin</code>、<code>base64_encode</code> / <code>base64_decode</code> 这些函数实现数据类型的转换，PHP 的字符串本身也是可以用来存储二进制数据的～</p><h2 id="phpseclib"><a href="#phpseclib" class="headerlink" title="phpseclib"></a>phpseclib</h2><pre class="line-numbers language-none"><code class="language-none">composer require phpseclib/phpseclib<span class="line-numbers-rows" aria-hidden="true"><span></span></span></code></pre><p>OpenSSL 扩展使用的是面向过程的写法，一个函数一个函数地调用，调用一次函数时要把明文 / 密文、密钥、加密方式等参数都写一遍，结果是把一行代码弄得很长，参数含义不清晰，比较难看_(:_」∠)_</p><p>phpseclib 采用了面向对象的写法，加密解密前新建一个对象作为“AES 加密 / 解密器”，一次性设定好密钥，就可以直接用来加密 / 解密了∠( ᐛ 」∠)_</p><p>phpseclib 统一使用原始数据也就是字符串进行加密和解密，本身不会进行任何的数据格式转换，需要自己手动调用相关函数。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">require_once</span> <span class="token constant">__DIR__</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/vendor/autoload.php'</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">phpseclib<span class="token punctuation">\</span>Crypt<span class="token punctuation">\</span>AES</span><span class="token punctuation">;</span>

<span class="token variable">$aes</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AES</span><span class="token punctuation">(</span><span class="token class-name static-context">AES</span><span class="token operator">::</span><span class="token constant">MODE_CBC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$aes</span><span class="token operator">-></span><span class="token function">setKey</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'0123456789ABCDEF'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$aes</span><span class="token operator">-></span><span class="token function">setIV</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'FEDCBA9876543210'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$aes</span><span class="token operator">-></span><span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ABCD'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "1Wl2Kg1/0Vh+fJPX+UsJaA=="</span>
<span class="token keyword">echo</span> <span class="token variable">$aes</span><span class="token operator">-></span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token function">hex2bin</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'d569762a0d7fd1587e7c93d7f94b0968'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "ABCD"</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>↑这种写法舒服多了(〃′▽`)</p><h1 id="RSA-非对称加解密"><a href="#RSA-非对称加解密" class="headerlink" title="RSA 非对称加解密"></a>RSA 非对称加解密</h1><h2 id="JSEncrypt"><a href="#JSEncrypt" class="headerlink" title="JSEncrypt"></a>JSEncrypt</h2><p>JSEncrypt 的使用还是比较简单的，生成一对 RSA 公钥和私钥：</p><pre class="language-javascript line-numbers" data-language="javascript"><code class="language-javascript"><span class="token comment">// 钦定使用512位的密钥</span>
<span class="token keyword">let</span> rsa <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSEncrypt</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">default_key_size</span><span class="token operator">:</span> <span class="token number">512</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 随机生成公钥和私钥</span>
<span class="token comment">// 可以填写一个回调函数进行异步操作，不写的话就是同步操作</span>
<span class="token comment">// 异步操作比同步操作明显慢了不少……</span>
rsa<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rsa<span class="token punctuation">.</span><span class="token function">getPrivateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rsa<span class="token punctuation">.</span><span class="token function">getPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>生成密钥需要的时间是随着位数增加而指数上升的。生成 512 位密钥一般需要 10-30 ms，1024 位一般需要 100-200 ms，2048 位需要 1000-2000 ms，至于 4096 位……生成一次需要几十秒，浏览器会直接卡死，在前端直接使用的话大概是不行的(っ’-‘)╮</p><p>JSEncrypt 也支持自己指定密钥，进行加密和解密操作，<strong>密文统一使用 Base64 编码</strong>：</p><pre class="language-javascript line-numbers" data-language="javascript"><code class="language-javascript"><span class="token comment">// 设定公钥并进行加密</span>
rsa<span class="token punctuation">.</span><span class="token function">setPublicKey</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">
-----BEGIN PUBLIC KEY-----
MFswDQYJKoZIhvcNAQEBBQADSgAwRwJAfVNVmlMys1Ur/DHm+Hy+5ZiSYbI1JQWj
LjXOWazsdgHA2dhNeb5lyBeoV0jDY4kxbNIqoK8SC0DdqvSbf43uHQIDAQAB
-----END PUBLIC KEY-----
</span><span class="token string template-punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rsa<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token string">'ABCD'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "YqMFMygirIkg4JHmjH7FUk4AeluSWZjsaoHJlm5flyYQtWPdK+se2BF5WAnxKMS9eckSbijXFwFKDBmwTsirqg=="</span>

<span class="token comment">// 设定私钥并进行解密</span>
rsa<span class="token punctuation">.</span><span class="token function">setPrivateKey</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">
-----BEGIN RSA PRIVATE KEY-----
MIIBOAIBAAJAfVNVmlMys1Ur/DHm+Hy+5ZiSYbI1JQWjLjXOWazsdgHA2dhNeb5l
yBeoV0jDY4kxbNIqoK8SC0DdqvSbf43uHQIDAQABAkBh6TZKsE8+/f60NERvw/3c
IDvUqcaNWv8mvhCtzMScWB79WA5tj78VDeu+c89S3HVRzwp1IpdaKXwLUeeGlvMB
AiEAxl99A8cey501bOFGW/4p6xgePDyGMKCnaxERj7Jn2UECIQChu3wu8fdh3VcY
kyVjqu6Q5zAtbdv4N5npX/F7SWYh3QIgb9TRE1ojwEHmJnVxRtcoJoK4ONkeBTfs
ae17avj2loECICdI8jY5Ah0cdZ57h5Z5G6/I6FPwnoDhiJo+etq2jn9lAiBAGRen
ktqwA3k6arwEpjEj89ZqYiTzIFbCngH1oKbp9A==
-----END RSA PRIVATE KEY-----
</span><span class="token string template-punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rsa<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token string">'YqMFMygirIkg4JHmjH7FUk4AeluSWZjsaoHJlm5flyYQtWPdK+se2BF5WAnxKMS9eckSbijXFwFKDBmwTsirqg=='</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "ABCD"</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>先回想一下 RSA 的基本算法：</p><ol><li>取素数 ​<mjx-container class="MathJax" jax="SVG"><svg focusable="false" height="1.439ex" role="img" style="vertical-align:-.439ex" viewBox="0 -442 503 636" width="1.138ex" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z" id="MJX-1-TEX-I-1D45D"></path></defs><g transform="scale(1,-1)" fill="currentColor" stroke="currentColor" stroke-width="0"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45D" xlink:href="#MJX-1-TEX-I-1D45D"></use></g></g></g></svg></mjx-container>​ 和 ​<mjx-container class="MathJax" jax="SVG"><svg focusable="false" height="1.439ex" role="img" style="vertical-align:-.439ex" viewBox="0 -442 460 636" width="1.041ex" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M33 157Q33 258 109 349T280 441Q340 441 372 389Q373 390 377 395T388 406T404 418Q438 442 450 442Q454 442 457 439T460 434Q460 425 391 149Q320 -135 320 -139Q320 -147 365 -148H390Q396 -156 396 -157T393 -175Q389 -188 383 -194H370Q339 -192 262 -192Q234 -192 211 -192T174 -192T157 -193Q143 -193 143 -185Q143 -182 145 -170Q149 -154 152 -151T172 -148Q220 -148 230 -141Q238 -136 258 -53T279 32Q279 33 272 29Q224 -10 172 -10Q117 -10 75 30T33 157ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z" id="MJX-2-TEX-I-1D45E"></path></defs><g transform="scale(1,-1)" fill="currentColor" stroke="currentColor" stroke-width="0"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45E" xlink:href="#MJX-2-TEX-I-1D45E"></use></g></g></g></svg></mjx-container>​ 。</li><li>计算 ​<mjx-container class="MathJax" jax="SVG"><svg focusable="false" height="1.758ex" role="img" style="vertical-align:-.439ex" viewBox="0 -583 2896.6 777" width="6.553ex" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z" id="MJX-3-TEX-I-1D45B"></path><path d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" id="MJX-3-TEX-N-3D"></path><path d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z" id="MJX-3-TEX-I-1D45D"></path><path d="M33 157Q33 258 109 349T280 441Q340 441 372 389Q373 390 377 395T388 406T404 418Q438 442 450 442Q454 442 457 439T460 434Q460 425 391 149Q320 -135 320 -139Q320 -147 365 -148H390Q396 -156 396 -157T393 -175Q389 -188 383 -194H370Q339 -192 262 -192Q234 -192 211 -192T174 -192T157 -193Q143 -193 143 -185Q143 -182 145 -170Q149 -154 152 -151T172 -148Q220 -148 230 -141Q238 -136 258 -53T279 32Q279 33 272 29Q224 -10 172 -10Q117 -10 75 30T33 157ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z" id="MJX-3-TEX-I-1D45E"></path></defs><g transform="scale(1,-1)" fill="currentColor" stroke="currentColor" stroke-width="0"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45B" xlink:href="#MJX-3-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(877.8,0)"><use data-c="3D" xlink:href="#MJX-3-TEX-N-3D"></use></g><g data-mml-node="mi" transform="translate(1933.6,0)"><use data-c="1D45D" xlink:href="#MJX-3-TEX-I-1D45D"></use></g><g data-mml-node="mi" transform="translate(2436.6,0)"><use data-c="1D45E" xlink:href="#MJX-3-TEX-I-1D45E"></use></g></g></g></svg></mjx-container>​ ， ​<mjx-container class="MathJax" jax="SVG"><svg focusable="false" height="2.262ex" role="img" style="vertical-align:-.566ex" viewBox="0 -750 9368.4 1000" width="21.196ex" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M409 688Q413 694 421 694H429H442Q448 688 448 686Q448 679 418 563Q411 535 404 504T392 458L388 442Q388 441 397 441T429 435T477 418Q521 397 550 357T579 260T548 151T471 65T374 11T279 -10H275L251 -105Q245 -128 238 -160Q230 -192 227 -198T215 -205H209Q189 -205 189 -198Q189 -193 211 -103L234 -11Q234 -10 226 -10Q221 -10 206 -8T161 6T107 36T62 89T43 171Q43 231 76 284T157 370T254 422T342 441Q347 441 348 445L378 567Q409 686 409 688ZM122 150Q122 116 134 91T167 53T203 35T237 27H244L337 404Q333 404 326 403T297 395T255 379T211 350T170 304Q152 276 137 237Q122 191 122 150ZM500 282Q500 320 484 347T444 385T405 400T381 404H378L332 217L284 29Q284 27 285 27Q293 27 317 33T357 47Q400 66 431 100T475 170T494 234T500 282Z" id="MJX-4-TEX-I-1D719"></path><path d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z" id="MJX-4-TEX-N-28"></path><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z" id="MJX-4-TEX-I-1D45B"></path><path d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" id="MJX-4-TEX-N-29"></path><path d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" id="MJX-4-TEX-N-3D"></path><path d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z" id="MJX-4-TEX-N-2212"></path><path d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" id="MJX-4-TEX-N-31"></path><path d="M33 157Q33 258 109 349T280 441Q340 441 372 389Q373 390 377 395T388 406T404 418Q438 442 450 442Q454 442 457 439T460 434Q460 425 391 149Q320 -135 320 -139Q320 -147 365 -148H390Q396 -156 396 -157T393 -175Q389 -188 383 -194H370Q339 -192 262 -192Q234 -192 211 -192T174 -192T157 -193Q143 -193 143 -185Q143 -182 145 -170Q149 -154 152 -151T172 -148Q220 -148 230 -141Q238 -136 258 -53T279 32Q279 33 272 29Q224 -10 172 -10Q117 -10 75 30T33 157ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z" id="MJX-4-TEX-I-1D45E"></path></defs><g transform="scale(1,-1)" fill="currentColor" stroke="currentColor" stroke-width="0"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D719" xlink:href="#MJX-4-TEX-I-1D719"></use></g><g data-mml-node="mo" transform="translate(596,0)"><use data-c="28" xlink:href="#MJX-4-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(985,0)"><use data-c="1D45B" xlink:href="#MJX-4-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(1585,0)"><use data-c="29" xlink:href="#MJX-4-TEX-N-29"></use></g><g data-mml-node="mo" transform="translate(2251.8,0)"><use data-c="3D" xlink:href="#MJX-4-TEX-N-3D"></use></g><g data-mml-node="mo" transform="translate(3307.6,0)"><use data-c="28" xlink:href="#MJX-4-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(3696.6,0)"><use data-c="1D45B" xlink:href="#MJX-4-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(4518.8,0)"><use data-c="2212" xlink:href="#MJX-4-TEX-N-2212"></use></g><g data-mml-node="mn" transform="translate(5519,0)"><use data-c="31" xlink:href="#MJX-4-TEX-N-31"></use></g><g data-mml-node="mo" transform="translate(6019,0)"><use data-c="29" xlink:href="#MJX-4-TEX-N-29"></use></g><g data-mml-node="mo" transform="translate(6408,0)"><use data-c="28" xlink:href="#MJX-4-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(6797,0)"><use data-c="1D45E" xlink:href="#MJX-4-TEX-I-1D45E"></use></g><g data-mml-node="mo" transform="translate(7479.2,0)"><use data-c="2212" xlink:href="#MJX-4-TEX-N-2212"></use></g><g data-mml-node="mn" transform="translate(8479.4,0)"><use data-c="31" xlink:href="#MJX-4-TEX-N-31"></use></g><g data-mml-node="mo" transform="translate(8979.4,0)"><use data-c="29" xlink:href="#MJX-4-TEX-N-29"></use></g></g></g></svg></mjx-container>​ 。</li><li>取整数 ​<mjx-container class="MathJax" jax="SVG"><svg focusable="false" height="1.025ex" role="img" style="vertical-align:-.025ex" viewBox="0 -442 466 453" width="1.054ex" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z" id="MJX-5-TEX-I-1D452"></path></defs><g transform="scale(1,-1)" fill="currentColor" stroke="currentColor" stroke-width="0"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D452" xlink:href="#MJX-5-TEX-I-1D452"></use></g></g></g></svg></mjx-container>​ 满足 ​<mjx-container class="MathJax" jax="SVG"><svg focusable="false" height="2.262ex" role="img" style="vertical-align:-.566ex" viewBox="0 -750 6926.2 1000" width="15.67ex" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z" id="MJX-6-TEX-I-1D454"></path><path d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z" id="MJX-6-TEX-I-1D450"></path><path d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z" id="MJX-6-TEX-I-1D451"></path><path d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z" id="MJX-6-TEX-N-28"></path><path d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z" id="MJX-6-TEX-I-1D452"></path><path d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z" id="MJX-6-TEX-N-2C"></path><path d="M409 688Q413 694 421 694H429H442Q448 688 448 686Q448 679 418 563Q411 535 404 504T392 458L388 442Q388 441 397 441T429 435T477 418Q521 397 550 357T579 260T548 151T471 65T374 11T279 -10H275L251 -105Q245 -128 238 -160Q230 -192 227 -198T215 -205H209Q189 -205 189 -198Q189 -193 211 -103L234 -11Q234 -10 226 -10Q221 -10 206 -8T161 6T107 36T62 89T43 171Q43 231 76 284T157 370T254 422T342 441Q347 441 348 445L378 567Q409 686 409 688ZM122 150Q122 116 134 91T167 53T203 35T237 27H244L337 404Q333 404 326 403T297 395T255 379T211 350T170 304Q152 276 137 237Q122 191 122 150ZM500 282Q500 320 484 347T444 385T405 400T381 404H378L332 217L284 29Q284 27 285 27Q293 27 317 33T357 47Q400 66 431 100T475 170T494 234T500 282Z" id="MJX-6-TEX-I-1D719"></path><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z" id="MJX-6-TEX-I-1D45B"></path><path d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" id="MJX-6-TEX-N-29"></path><path d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" id="MJX-6-TEX-N-3D"></path><path d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" id="MJX-6-TEX-N-31"></path></defs><g transform="scale(1,-1)" fill="currentColor" stroke="currentColor" stroke-width="0"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D454" xlink:href="#MJX-6-TEX-I-1D454"></use></g><g data-mml-node="mi" transform="translate(477,0)"><use data-c="1D450" xlink:href="#MJX-6-TEX-I-1D450"></use></g><g data-mml-node="mi" transform="translate(910,0)"><use data-c="1D451" xlink:href="#MJX-6-TEX-I-1D451"></use></g><g data-mml-node="mo" transform="translate(1430,0)"><use data-c="28" xlink:href="#MJX-6-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(1819,0)"><use data-c="1D452" xlink:href="#MJX-6-TEX-I-1D452"></use></g><g data-mml-node="mo" transform="translate(2285,0)"><use data-c="2C" xlink:href="#MJX-6-TEX-N-2C"></use></g><g data-mml-node="mi" transform="translate(2729.7,0)"><use data-c="1D719" xlink:href="#MJX-6-TEX-I-1D719"></use></g><g data-mml-node="mo" transform="translate(3325.7,0)"><use data-c="28" xlink:href="#MJX-6-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(3714.7,0)"><use data-c="1D45B" xlink:href="#MJX-6-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(4314.7,0)"><use data-c="29" xlink:href="#MJX-6-TEX-N-29"></use></g><g data-mml-node="mo" transform="translate(4703.7,0)"><use data-c="29" xlink:href="#MJX-6-TEX-N-29"></use></g><g data-mml-node="mo" transform="translate(5370.4,0)"><use data-c="3D" xlink:href="#MJX-6-TEX-N-3D"></use></g><g data-mml-node="mn" transform="translate(6426.2,0)"><use data-c="31" xlink:href="#MJX-6-TEX-N-31"></use></g></g></g></svg></mjx-container>​ 。</li><li>计算 ​<mjx-container class="MathJax" jax="SVG"><svg focusable="false" height="2.452ex" role="img" style="vertical-align:-.566ex" viewBox="0 -833.9 7724.8 1083.9" width="17.477ex" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z" id="MJX-7-TEX-I-1D451"></path><path d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" id="MJX-7-TEX-N-3D"></path><path d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z" id="MJX-7-TEX-I-1D452"></path><path d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z" id="MJX-7-TEX-N-2212"></path><path d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" id="MJX-7-TEX-N-31"></path><path d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q351 442 364 440T387 434T406 426T421 417T432 406T441 395T448 384T452 374T455 366L457 361L460 365Q463 369 466 373T475 384T488 397T503 410T523 422T546 432T572 439T603 442Q729 442 740 329Q741 322 741 190V104Q741 66 743 59T754 49Q775 46 803 46H819V0H811L788 1Q764 2 737 2T699 3Q596 3 587 0H579V46H595Q656 46 656 62Q657 64 657 200Q656 335 655 343Q649 371 635 385T611 402T585 404Q540 404 506 370Q479 343 472 315T464 232V168V108Q464 78 465 68T468 55T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" id="MJX-7-TEX-N-6D"></path><path d="M28 214Q28 309 93 378T250 448Q340 448 405 380T471 215Q471 120 407 55T250 -10Q153 -10 91 57T28 214ZM250 30Q372 30 372 193V225V250Q372 272 371 288T364 326T348 362T317 390T268 410Q263 411 252 411Q222 411 195 399Q152 377 139 338T126 246V226Q126 130 145 91Q177 30 250 30Z" id="MJX-7-TEX-N-6F"></path><path d="M376 495Q376 511 376 535T377 568Q377 613 367 624T316 637H298V660Q298 683 300 683L310 684Q320 685 339 686T376 688Q393 689 413 690T443 693T454 694H457V390Q457 84 458 81Q461 61 472 55T517 46H535V0Q533 0 459 -5T380 -11H373V44L365 37Q307 -11 235 -11Q158 -11 96 50T34 215Q34 315 97 378T244 442Q319 442 376 393V495ZM373 342Q328 405 260 405Q211 405 173 369Q146 341 139 305T131 211Q131 155 138 120T173 59Q203 26 251 26Q322 26 373 103V342Z" id="MJX-7-TEX-N-64"></path><path d="M409 688Q413 694 421 694H429H442Q448 688 448 686Q448 679 418 563Q411 535 404 504T392 458L388 442Q388 441 397 441T429 435T477 418Q521 397 550 357T579 260T548 151T471 65T374 11T279 -10H275L251 -105Q245 -128 238 -160Q230 -192 227 -198T215 -205H209Q189 -205 189 -198Q189 -193 211 -103L234 -11Q234 -10 226 -10Q221 -10 206 -8T161 6T107 36T62 89T43 171Q43 231 76 284T157 370T254 422T342 441Q347 441 348 445L378 567Q409 686 409 688ZM122 150Q122 116 134 91T167 53T203 35T237 27H244L337 404Q333 404 326 403T297 395T255 379T211 350T170 304Q152 276 137 237Q122 191 122 150ZM500 282Q500 320 484 347T444 385T405 400T381 404H378L332 217L284 29Q284 27 285 27Q293 27 317 33T357 47Q400 66 431 100T475 170T494 234T500 282Z" id="MJX-7-TEX-I-1D719"></path><path d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z" id="MJX-7-TEX-N-28"></path><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z" id="MJX-7-TEX-I-1D45B"></path><path d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" id="MJX-7-TEX-N-29"></path></defs><g transform="scale(1,-1)" fill="currentColor" stroke="currentColor" stroke-width="0"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D451" xlink:href="#MJX-7-TEX-I-1D451"></use></g><g data-mml-node="mo" transform="translate(797.8,0)"><use data-c="3D" xlink:href="#MJX-7-TEX-N-3D"></use></g><g data-mml-node="msup" transform="translate(1853.6,0)"><g data-mml-node="mi"><use data-c="1D452" xlink:href="#MJX-7-TEX-I-1D452"></use></g><g data-mml-node="TeXAtom" transform="translate(499,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><use data-c="2212" xlink:href="#MJX-7-TEX-N-2212"></use></g><g data-mml-node="mn" transform="translate(778,0)"><use data-c="31" xlink:href="#MJX-7-TEX-N-31"></use></g></g></g><g data-mml-node="mo" transform="translate(3584,0)"><use data-c="6D" xlink:href="#MJX-7-TEX-N-6D"></use><use data-c="6F" xlink:href="#MJX-7-TEX-N-6F" transform="translate(833,0)"></use><use data-c="64" xlink:href="#MJX-7-TEX-N-64" transform="translate(1333,0)"></use></g><g data-mml-node="mi" transform="translate(5750.8,0)"><use data-c="1D719" xlink:href="#MJX-7-TEX-I-1D719"></use></g><g data-mml-node="mo" transform="translate(6346.8,0)"><use data-c="28" xlink:href="#MJX-7-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(6735.8,0)"><use data-c="1D45B" xlink:href="#MJX-7-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(7335.8,0)"><use data-c="29" xlink:href="#MJX-7-TEX-N-29"></use></g></g></g></svg></mjx-container>​ 。</li><li>私钥是 ​<mjx-container class="MathJax" jax="SVG"><svg focusable="false" height="1.593ex" role="img" style="vertical-align:-.023ex" viewBox="0 -694 520 704" width="1.176ex" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z" id="MJX-8-TEX-I-1D451"></path></defs><g transform="scale(1,-1)" fill="currentColor" stroke="currentColor" stroke-width="0"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D451" xlink:href="#MJX-8-TEX-I-1D451"></use></g></g></g></svg></mjx-container>​ ，公钥是 ​<mjx-container class="MathJax" jax="SVG"><svg focusable="false" height="2.262ex" role="img" style="vertical-align:-.566ex" viewBox="0 -750 2288.7 1000" width="5.178ex" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z" id="MJX-9-TEX-N-28"></path><path d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z" id="MJX-9-TEX-I-1D452"></path><path d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z" id="MJX-9-TEX-N-2C"></path><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z" id="MJX-9-TEX-I-1D45B"></path><path d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" id="MJX-9-TEX-N-29"></path></defs><g transform="scale(1,-1)" fill="currentColor" stroke="currentColor" stroke-width="0"><g data-mml-node="math"><g data-mml-node="mo"><use data-c="28" xlink:href="#MJX-9-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(389,0)"><use data-c="1D452" xlink:href="#MJX-9-TEX-I-1D452"></use></g><g data-mml-node="mo" transform="translate(855,0)"><use data-c="2C" xlink:href="#MJX-9-TEX-N-2C"></use></g><g data-mml-node="mi" transform="translate(1299.7,0)"><use data-c="1D45B" xlink:href="#MJX-9-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(1899.7,0)"><use data-c="29" xlink:href="#MJX-9-TEX-N-29"></use></g></g></g></svg></mjx-container>​ 。</li><li>加密： ​<mjx-container class="MathJax" jax="SVG"><svg focusable="false" height="1.756ex" role="img" style="vertical-align:-.186ex" viewBox="0 -694 6101.6 776" width="13.805ex" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z" id="MJX-10-TEX-I-1D450"></path><path d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" id="MJX-10-TEX-N-3D"></path><path d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z" id="MJX-10-TEX-I-1D45A"></path><path d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z" id="MJX-10-TEX-I-1D452"></path><path d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q351 442 364 440T387 434T406 426T421 417T432 406T441 395T448 384T452 374T455 366L457 361L460 365Q463 369 466 373T475 384T488 397T503 410T523 422T546 432T572 439T603 442Q729 442 740 329Q741 322 741 190V104Q741 66 743 59T754 49Q775 46 803 46H819V0H811L788 1Q764 2 737 2T699 3Q596 3 587 0H579V46H595Q656 46 656 62Q657 64 657 200Q656 335 655 343Q649 371 635 385T611 402T585 404Q540 404 506 370Q479 343 472 315T464 232V168V108Q464 78 465 68T468 55T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" id="MJX-10-TEX-N-6D"></path><path d="M28 214Q28 309 93 378T250 448Q340 448 405 380T471 215Q471 120 407 55T250 -10Q153 -10 91 57T28 214ZM250 30Q372 30 372 193V225V250Q372 272 371 288T364 326T348 362T317 390T268 410Q263 411 252 411Q222 411 195 399Q152 377 139 338T126 246V226Q126 130 145 91Q177 30 250 30Z" id="MJX-10-TEX-N-6F"></path><path d="M376 495Q376 511 376 535T377 568Q377 613 367 624T316 637H298V660Q298 683 300 683L310 684Q320 685 339 686T376 688Q393 689 413 690T443 693T454 694H457V390Q457 84 458 81Q461 61 472 55T517 46H535V0Q533 0 459 -5T380 -11H373V44L365 37Q307 -11 235 -11Q158 -11 96 50T34 215Q34 315 97 378T244 442Q319 442 376 393V495ZM373 342Q328 405 260 405Q211 405 173 369Q146 341 139 305T131 211Q131 155 138 120T173 59Q203 26 251 26Q322 26 373 103V342Z" id="MJX-10-TEX-N-64"></path><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z" id="MJX-10-TEX-I-1D45B"></path></defs><g transform="scale(1,-1)" fill="currentColor" stroke="currentColor" stroke-width="0"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D450" xlink:href="#MJX-10-TEX-I-1D450"></use></g><g data-mml-node="mo" transform="translate(710.8,0)"><use data-c="3D" xlink:href="#MJX-10-TEX-N-3D"></use></g><g data-mml-node="msup" transform="translate(1766.6,0)"><g data-mml-node="mi"><use data-c="1D45A" xlink:href="#MJX-10-TEX-I-1D45A"></use></g><g data-mml-node="mi" transform="translate(911,363) scale(0.707)"><use data-c="1D452" xlink:href="#MJX-10-TEX-I-1D452"></use></g></g><g data-mml-node="mo" transform="translate(3334.8,0)"><use data-c="6D" xlink:href="#MJX-10-TEX-N-6D"></use><use data-c="6F" xlink:href="#MJX-10-TEX-N-6F" transform="translate(833,0)"></use><use data-c="64" xlink:href="#MJX-10-TEX-N-64" transform="translate(1333,0)"></use></g><g data-mml-node="mi" transform="translate(5501.6,0)"><use data-c="1D45B" xlink:href="#MJX-10-TEX-I-1D45B"></use></g></g></g></svg></mjx-container>​ ，解密： ​<mjx-container class="MathJax" jax="SVG"><svg focusable="false" height="2.117ex" role="img" style="vertical-align:-.186ex" viewBox="0 -853.7 6139.8 935.7" width="13.891ex" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z" id="MJX-11-TEX-I-1D45A"></path><path d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" id="MJX-11-TEX-N-3D"></path><path d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z" id="MJX-11-TEX-I-1D450"></path><path d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z" id="MJX-11-TEX-I-1D451"></path><path d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q351 442 364 440T387 434T406 426T421 417T432 406T441 395T448 384T452 374T455 366L457 361L460 365Q463 369 466 373T475 384T488 397T503 410T523 422T546 432T572 439T603 442Q729 442 740 329Q741 322 741 190V104Q741 66 743 59T754 49Q775 46 803 46H819V0H811L788 1Q764 2 737 2T699 3Q596 3 587 0H579V46H595Q656 46 656 62Q657 64 657 200Q656 335 655 343Q649 371 635 385T611 402T585 404Q540 404 506 370Q479 343 472 315T464 232V168V108Q464 78 465 68T468 55T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" id="MJX-11-TEX-N-6D"></path><path d="M28 214Q28 309 93 378T250 448Q340 448 405 380T471 215Q471 120 407 55T250 -10Q153 -10 91 57T28 214ZM250 30Q372 30 372 193V225V250Q372 272 371 288T364 326T348 362T317 390T268 410Q263 411 252 411Q222 411 195 399Q152 377 139 338T126 246V226Q126 130 145 91Q177 30 250 30Z" id="MJX-11-TEX-N-6F"></path><path d="M376 495Q376 511 376 535T377 568Q377 613 367 624T316 637H298V660Q298 683 300 683L310 684Q320 685 339 686T376 688Q393 689 413 690T443 693T454 694H457V390Q457 84 458 81Q461 61 472 55T517 46H535V0Q533 0 459 -5T380 -11H373V44L365 37Q307 -11 235 -11Q158 -11 96 50T34 215Q34 315 97 378T244 442Q319 442 376 393V495ZM373 342Q328 405 260 405Q211 405 173 369Q146 341 139 305T131 211Q131 155 138 120T173 59Q203 26 251 26Q322 26 373 103V342Z" id="MJX-11-TEX-N-64"></path><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z" id="MJX-11-TEX-I-1D45B"></path></defs><g transform="scale(1,-1)" fill="currentColor" stroke="currentColor" stroke-width="0"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45A" xlink:href="#MJX-11-TEX-I-1D45A"></use></g><g data-mml-node="mo" transform="translate(1155.8,0)"><use data-c="3D" xlink:href="#MJX-11-TEX-N-3D"></use></g><g data-mml-node="msup" transform="translate(2211.6,0)"><g data-mml-node="mi"><use data-c="1D450" xlink:href="#MJX-11-TEX-I-1D450"></use></g><g data-mml-node="mi" transform="translate(466,363) scale(0.707)"><use data-c="1D451" xlink:href="#MJX-11-TEX-I-1D451"></use></g></g><g data-mml-node="mo" transform="translate(3373,0)"><use data-c="6D" xlink:href="#MJX-11-TEX-N-6D"></use><use data-c="6F" xlink:href="#MJX-11-TEX-N-6F" transform="translate(833,0)"></use><use data-c="64" xlink:href="#MJX-11-TEX-N-64" transform="translate(1333,0)"></use></g><g data-mml-node="mi" transform="translate(5539.8,0)"><use data-c="1D45B" xlink:href="#MJX-11-TEX-I-1D45B"></use></g></g></g></svg></mjx-container>​ 。</li></ol><p>RSA 算法的保密性取决于将 ​<mjx-container class="MathJax" jax="SVG"><svg focusable="false" height="1.025ex" role="img" style="vertical-align:-.025ex" viewBox="0 -442 600 453" width="1.357ex" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z" id="MJX-12-TEX-I-1D45B"></path></defs><g transform="scale(1,-1)" fill="currentColor" stroke="currentColor" stroke-width="0"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45B" xlink:href="#MJX-12-TEX-I-1D45B"></use></g></g></g></svg></mjx-container>​ 分解成 ​<mjx-container class="MathJax" jax="SVG"><svg focusable="false" height="1.439ex" role="img" style="vertical-align:-.439ex" viewBox="0 -442 503 636" width="1.138ex" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z" id="MJX-13-TEX-I-1D45D"></path></defs><g transform="scale(1,-1)" fill="currentColor" stroke="currentColor" stroke-width="0"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45D" xlink:href="#MJX-13-TEX-I-1D45D"></use></g></g></g></svg></mjx-container>​ 和 ​<mjx-container class="MathJax" jax="SVG"><svg focusable="false" height="1.439ex" role="img" style="vertical-align:-.439ex" viewBox="0 -442 460 636" width="1.041ex" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M33 157Q33 258 109 349T280 441Q340 441 372 389Q373 390 377 395T388 406T404 418Q438 442 450 442Q454 442 457 439T460 434Q460 425 391 149Q320 -135 320 -139Q320 -147 365 -148H390Q396 -156 396 -157T393 -175Q389 -188 383 -194H370Q339 -192 262 -192Q234 -192 211 -192T174 -192T157 -193Q143 -193 143 -185Q143 -182 145 -170Q149 -154 152 -151T172 -148Q220 -148 230 -141Q238 -136 258 -53T279 32Q279 33 272 29Q224 -10 172 -10Q117 -10 75 30T33 157ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z" id="MJX-14-TEX-I-1D45E"></path></defs><g transform="scale(1,-1)" fill="currentColor" stroke="currentColor" stroke-width="0"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45E" xlink:href="#MJX-14-TEX-I-1D45E"></use></g></g></g></svg></mjx-container>​ 的难度，不过根据<a href="https://en.wikipedia.org/wiki/RSA_numbers#RSA-240" target="_blank" rel="noopener">维基百科上的记录</a>，在 2019 年已经有了 795 位的数被分解的记录，目前的主流是使用至少 1024 位的密钥，不过这里作为测试就还是使用 512 位的密钥了～</p><p>这种以一行“BEGIN”和“END”的分割线标记开始和结束、正文使用 Base64 编码的 RSA 密钥格式就是 PEM 格式（私钥又分为 PKCS#1 和 PKCS#8 两种标准，分别以 <code>BEGIN RSA PRIVATE KEY</code> 和 <code>BEGIN PRIVATE KEY</code> 开头）。虽然按照上面的算法，私钥涉及到的参数比公钥少，但是 PEM 格式中私钥的长度反而比公钥长了很多，这是因为这里的“私钥”实际上还包含了上面涉及到的几乎所有参数（其中就包括 ​<mjx-container class="MathJax" jax="SVG"><svg focusable="false" height="1.025ex" role="img" style="vertical-align:-.025ex" viewBox="0 -442 466 453" width="1.054ex" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z" id="MJX-15-TEX-I-1D452"></path></defs><g transform="scale(1,-1)" fill="currentColor" stroke="currentColor" stroke-width="0"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D452" xlink:href="#MJX-15-TEX-I-1D452"></use></g></g></g></svg></mjx-container>​ 和 ​<mjx-container class="MathJax" jax="SVG"><svg focusable="false" height="1.025ex" role="img" style="vertical-align:-.025ex" viewBox="0 -442 600 453" width="1.357ex" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z" id="MJX-16-TEX-I-1D45B"></path></defs><g transform="scale(1,-1)" fill="currentColor" stroke="currentColor" stroke-width="0"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45B" xlink:href="#MJX-16-TEX-I-1D45B"></use></g></g></g></svg></mjx-container>​ ），因此完全可以从私钥中直接“提取”出公钥，设定了私钥则既可以加密也可以解密，但设定了公钥就只能进行加密。</p><p>由于 RSA 加密的使用的填充方案在密文中添加了一些随机数，所以即使是同样的密钥加密同样的明文，得到的密文也会不同。</p><h2 id="OpenSSL-1"><a href="#OpenSSL-1" class="headerlink" title="OpenSSL"></a>OpenSSL</h2><p>和前面的 AES 加密一样，使用 OpenSSL 扩展弄 RSA 加密也是有点麻烦 ┐(´-｀)┌</p><p>使用 OpenSSL 时，一般也是先生成私钥，再根据私钥提取出公钥。对应到 PHP 这边就是使用 <a href="https://www.php.net/manual/zh/function.openssl-pkey-new.php" target="_blank" rel="noopener"><code>openssl_pkey_new</code></a> 和 <a href="https://www.php.net/manual/zh/function.openssl-pkey-export.php" target="_blank" rel="noopener"><code>openssl_pkey_export</code></a> 两个函数：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">openssl_pkey_new</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'config'</span> <span class="token operator">=></span> <span class="token function">realpath</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'./openssl.cnf'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'private_key_bits'</span> <span class="token operator">=></span> <span class="token number">512</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'private_key_type'</span> <span class="token operator">=></span> <span class="token constant">OPENSSL_KEYTYPE_RSA</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">openssl_pkey_export</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">,</span> <span class="token variable">$private_key</span><span class="token punctuation">,</span> <span class="token constant">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'config'</span> <span class="token operator">=></span> <span class="token function">realpath</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'./openssl.cnf'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$public_key</span> <span class="token operator">=</span> <span class="token function">openssl_pkey_get_details</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这段代码看上去没什么问题，但是官方文档提示“必须安装有效的 <code>openssl.cnf</code> 以保证此函数正确运行”。为什么生成一个 RSA 密钥还需要<strong>额外的配置文件</strong>？为什么获取私钥是<strong>将私钥写入参数中指定的引用的变量</strong>，但是获取公钥（和其他 RSA 算法中涉及到的参数）又使用了<strong>返回关联数组</strong>的形式？这种写法有点特别啊……</p><p>Linux 平台上 OpenSSL 本身就是标配，所以 PHP 可以根据环境变量找到 <code>openssl.cnf</code>。Windows 版的 PHP 也自带了一个 <code>openssl.cnf</code>，但是如果不配置环境变量的话就需要手动指定路径了（也就是上面的 <code>config</code> ）。</p><p>OpenSSL 的加密和解密中的<strong>密文同样是统一使用字符串</strong>，有需要的话可以自己另外使用 Base64 编码 / 解码。然而进行 RSA 加密和解密也是使用了“写入参数中指定的引用变量”的形式，和前面的使用返回值的 AES 加密解密也不一样：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">// 设定公钥并进行加密</span>
<span class="token variable">$public_key</span> <span class="token operator">=</span> <span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span> <span class="token constant">KEY</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token constant">BEGIN</span> <span class="token keyword">PUBLIC</span> <span class="token constant">KEY</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
MFswDQYJKoZIhvcNAQEBBQADSgAwRwJAfVNVmlMys1Ur<span class="token operator">/</span>DHm<span class="token operator">+</span>Hy<span class="token operator">+</span><span class="token number">5</span>ZiSYbI1JQWj
LjXOWazsdgHA2dhNeb5lyBeoV0jDY4kxbNIqoK8SC0DdqvSbf43uHQIDAQAB
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token constant">END</span> <span class="token keyword">PUBLIC</span> <span class="token constant">KEY</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token constant">KEY</span><span class="token punctuation">;</span>
<span class="token function">openssl_public_encrypt</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ABCD'</span><span class="token punctuation">,</span> <span class="token variable">$encrypted</span><span class="token punctuation">,</span> <span class="token variable">$public_key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$encrypted</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "YqMFMygirIkg4JHmjH7FUk4AeluSWZjsaoHJlm5flyYQtWPdK+se2BF5WAnxKMS9eckSbijXFwFKDBmwTsirqg=="</span>

<span class="token comment">// 设定私钥并进行解密</span>
<span class="token variable">$private_key</span> <span class="token operator">=</span> <span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span> <span class="token constant">KEY</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token constant">BEGIN</span> <span class="token constant">RSA</span> <span class="token keyword">PRIVATE</span> <span class="token constant">KEY</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
MIIBOAIBAAJAfVNVmlMys1Ur<span class="token operator">/</span>DHm<span class="token operator">+</span>Hy<span class="token operator">+</span><span class="token number">5</span>ZiSYbI1JQWjLjXOWazsdgHA2dhNeb5l
yBeoV0jDY4kxbNIqoK8SC0DdqvSbf43uHQIDAQABAkBh6TZKsE8<span class="token operator">+</span><span class="token operator">/</span>f60NERvw<span class="token operator">/</span><span class="token number">3</span>c
IDvUqcaNWv8mvhCtzMScWB79WA5tj78VDeu<span class="token operator">+</span>c89S3HVRzwp1IpdaKXwLUeeGlvMB
AiEAxl99A8cey501bOFGW<span class="token operator">/</span><span class="token number">4</span>p6xgePDyGMKCnaxERj7Jn2UECIQChu3wu8fdh3VcY
kyVjqu6Q5zAtbdv4N5npX<span class="token operator">/</span>F7SWYh3QIgb9TRE1ojwEHmJnVxRtcoJoK4ONkeBTfs
ae17avj2loECICdI8jY5Ah0cdZ57h5Z5G6<span class="token operator">/</span>I6FPwnoDhiJo<span class="token operator">+</span>etq2jn9lAiBAGRen
ktqwA3k6arwEpjEj89ZqYiTzIFbCngH1oKbp9A<span class="token operator">==</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token constant">END</span> <span class="token constant">RSA</span> <span class="token keyword">PRIVATE</span> <span class="token constant">KEY</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token constant">KEY</span><span class="token punctuation">;</span>
<span class="token function">openssl_private_decrypt</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'YqMFMygirIkg4JHmjH7FUk4AeluSWZjsaoHJlm5flyYQtWPdK+se2BF5WAnxKMS9eckSbijXFwFKDBmwTsirqg=='</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$decrypted</span><span class="token punctuation">,</span> <span class="token variable">$private_key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$decrypted</span><span class="token punctuation">;</span> <span class="token comment">// "ABCD"</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="phpseclib-1"><a href="#phpseclib-1" class="headerlink" title="phpseclib"></a>phpseclib</h2><p>由于使用了面向对象的写法，使用 phpseclib 的代码仍然是看上去非常舒服，非常清晰……至少不会有“把函数执行的结果写入参数中指定的引用变量”这种特别的写法了|•’-‘•)</p><p>生成密钥：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">require_once</span> <span class="token constant">__DIR__</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/vendor/autoload.php'</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">phpseclib<span class="token punctuation">\</span>Crypt<span class="token punctuation">\</span>RSA</span><span class="token punctuation">;</span>

<span class="token variable">$rsa</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RSA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$rsakey</span> <span class="token operator">=</span> <span class="token variable">$rsa</span><span class="token operator">-></span><span class="token function">createKey</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$rsakey</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'privatekey'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$rsakey</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'publickey'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>加密和解密：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">require_once</span> <span class="token constant">__DIR__</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/vendor/autoload.php'</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">phpseclib<span class="token punctuation">\</span>Crypt<span class="token punctuation">\</span>RSA</span><span class="token punctuation">;</span>

<span class="token variable">$rsa</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RSA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$rsa</span><span class="token operator">-></span><span class="token function">setEncryptionMode</span><span class="token punctuation">(</span><span class="token class-name static-context">RSA</span><span class="token operator">::</span><span class="token constant">ENCRYPTION_PKCS1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 设定公钥并进行加密</span>
<span class="token variable">$public_key</span> <span class="token operator">=</span> <span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span> <span class="token constant">KEY</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token constant">BEGIN</span> <span class="token keyword">PUBLIC</span> <span class="token constant">KEY</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
MFswDQYJKoZIhvcNAQEBBQADSgAwRwJAfVNVmlMys1Ur<span class="token operator">/</span>DHm<span class="token operator">+</span>Hy<span class="token operator">+</span><span class="token number">5</span>ZiSYbI1JQWj
LjXOWazsdgHA2dhNeb5lyBeoV0jDY4kxbNIqoK8SC0DdqvSbf43uHQIDAQAB
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token constant">END</span> <span class="token keyword">PUBLIC</span> <span class="token constant">KEY</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token constant">KEY</span><span class="token punctuation">;</span>
<span class="token variable">$rsa</span><span class="token operator">-></span><span class="token function">loadKey</span><span class="token punctuation">(</span><span class="token variable">$public_key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$rsa</span><span class="token operator">-></span><span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ABCD'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "YqMFMygirIkg4JHmjH7FUk4AeluSWZjsaoHJlm5flyYQtWPdK+se2BF5WAnxKMS9eckSbijXFwFKDBmwTsirqg=="</span>

<span class="token comment">// 设定私钥并进行解密</span>
<span class="token variable">$private_key</span> <span class="token operator">=</span> <span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span> <span class="token constant">KEY</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token constant">BEGIN</span> <span class="token constant">RSA</span> <span class="token keyword">PRIVATE</span> <span class="token constant">KEY</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
MIIBOAIBAAJAfVNVmlMys1Ur<span class="token operator">/</span>DHm<span class="token operator">+</span>Hy<span class="token operator">+</span><span class="token number">5</span>ZiSYbI1JQWjLjXOWazsdgHA2dhNeb5l
yBeoV0jDY4kxbNIqoK8SC0DdqvSbf43uHQIDAQABAkBh6TZKsE8<span class="token operator">+</span><span class="token operator">/</span>f60NERvw<span class="token operator">/</span><span class="token number">3</span>c
IDvUqcaNWv8mvhCtzMScWB79WA5tj78VDeu<span class="token operator">+</span>c89S3HVRzwp1IpdaKXwLUeeGlvMB
AiEAxl99A8cey501bOFGW<span class="token operator">/</span><span class="token number">4</span>p6xgePDyGMKCnaxERj7Jn2UECIQChu3wu8fdh3VcY
kyVjqu6Q5zAtbdv4N5npX<span class="token operator">/</span>F7SWYh3QIgb9TRE1ojwEHmJnVxRtcoJoK4ONkeBTfs
ae17avj2loECICdI8jY5Ah0cdZ57h5Z5G6<span class="token operator">/</span>I6FPwnoDhiJo<span class="token operator">+</span>etq2jn9lAiBAGRen
ktqwA3k6arwEpjEj89ZqYiTzIFbCngH1oKbp9A<span class="token operator">==</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token constant">END</span> <span class="token constant">RSA</span> <span class="token keyword">PRIVATE</span> <span class="token constant">KEY</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token constant">KEY</span><span class="token punctuation">;</span>
<span class="token variable">$rsa</span><span class="token operator">-></span><span class="token function">loadKey</span><span class="token punctuation">(</span><span class="token variable">$private_key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$rsa</span><span class="token operator">-></span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'YqMFMygirIkg4JHmjH7FUk4AeluSWZjsaoHJlm5flyYQtWPdK+se2BF5WAnxKMS9eckSbijXFwFKDBmwTsirqg=='</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "ABCD"</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote class="mdui-m-b-0 mdui-m-x-0 mdui-p-y-1" style="border-left:4px solid rgba(0,0,0,.36)"><strong>本作品采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。不允许内容农场类网站、CSDN 用户和微信公众号转载，也不允许被自动抓取用于生成式 AI 相关服务。</strong><br><strong>本文作者：✨小透明・宸✨</strong><br><strong>本文链接：<a href="https://akarin.dev/2020/02/26/crypto-in-js-and-php/">https://akarin.dev/2020/02/26/crypto-in-js-and-php/</a></strong></blockquote></article><div class="mdui-typo mdui-p-b-3 mdui-p-x-3" style="box-sizing:border-box" id="artalk-container"></div><script>(()=>{const e=document.createElement("link");e.rel="stylesheet",e.href="https://cdn.jsdelivr.net/npm/artalk@2/dist/Artalk.css";const t=document.createElement("style");t.innerHTML=".atk-comment > .atk-main > .atk-body img:not([atk-emoticon]){max-height:160px}"+[["pink","#ff4081","#ff80ab"]].map((([e,t,n])=>`.mdui-theme-accent-${e} .artalk,.mdui-theme-accent-${e} .artalk-layer-wrap,.mdui-theme-accent-${e} .artalk.atk-dark-mode,.mdui-theme-accent-${e} .artalk-layer-wrap.atk-dark-mode{--at-color-main:${t};--at-color-light:${n}}`)).join("");const n=document.createElement("script");n.src="https://cdn.jsdelivr.net/npm/artalk@2/dist/Artalk.js",n.async=!0,n.onload=()=>{Artalk.use((e=>{let t=0;const n={},a=(e,a)=>{const r=`__atk_tex_id_${t++}__`;return n[r]={tex:e,isBlock:a},r},r={name:"blockMath",level:"block",tokenizer:e=>{const t=/^(?:\s{0,3})\$\$((?:[^\n]|\n[^\n])+?)\n{0,1}\$\$/.exec(e);if(t)return{type:"html",raw:t[0],text:a(t[1],!0)}}},o={name:"inlineMath",level:"inline",start:e=>{const t=e.search(/\$.*?\$/);return-1!==t?t:e.length},tokenizer:e=>{const t=/^\$(.*?)\$/.exec(e);if(t)return{type:"html",raw:t[0],text:a(t[1],!1)}}};e.on("mounted",(()=>{e.getMarked().use({extensions:[r,o]}),e.updateConf({markedReplacers:[e=>e=e.replace(/(__atk_tex_id_\d+__)/g,((e,t)=>{const{tex:a,isBlock:r}=n[t];delete n[t];const o=`https://www.zhihu.com/equation?tex=${encodeURIComponent(a)}`;return r?`<p style="text-align:center"><img src="${o}"></p>`:`<img style="vertical-align:middle" src="${o}">`}))]})}))})),Artalk.use((e=>e.on("list-loaded",(()=>e.getCommentNodes().forEach((e=>Array.from(e.getRender().$content.querySelectorAll("img:not([atk-emoticon])")).forEach((e=>{e.classList.add("mdui-img-rounded"),mediumZoom(e,{margin:16,scrollOffset:8,background:"rgba(0,0,0,.85)"})})))))))),Artalk.init({el:"#artalk-container",server:"https://comment.akarin.dev",site:"存在感消失的地方|ω•`)"})},document.head.appendChild(e),document.head.appendChild(t),document.body.appendChild(n)})()</script></div><div class="mdui-valign mdui-m-t-2"><a href="../../../03/26/intersection-observer/" class="mdui-ripple mdui-btn mdui-btn-icon"><i class="material-icons mdui-icon">chevron_left</i> </a><span class="mdui-typo-body-1-opacity mdui-text-left mdui-m-l-1" title="用 Intersection Observer 来自己造个图片懒加载的轮子₍₍ (ง ˙ω˙)ว ⁾⁾">上一篇</span> <span class="mdui-typo-body-1-opacity mdui-text-center" style="flex-grow:1"></span> <span class="mdui-typo-body-1-opacity mdui-text-right mdui-m-r-1" title="搞事情：用“图床”传视频，自带免费 CDN 加速（已失效，科普向）">下一篇</span> <a href="../../07/alicdn-video-hosting/" class="mdui-ripple mdui-btn mdui-btn-icon"><i class="material-icons mdui-icon">chevron_right</i></a></div></main><footer class="mdui-typo mdui-container mdui-m-y-5" style="display:flex;max-width:1024px"><div class="mdui-typo-body-1-opacity mdui-text-left">Copyright © 2025 ✨小透明・宸✨<br>Hosted by <a href="https://github.com/TransparentLC/transparentlc.github.io" target="_blank">Github Pages</a></div><div style="flex-grow:1"></div><div class="mdui-typo-body-1-opacity mdui-text-right">Powered by <a href="https://hexo.io" target="_blank">Hexo</a> <span class="mdui-hidden-xs-down">7.3.0</span><br>Theme - <a href="https://github.com/TransparentLC/hexo-theme-akarin" target="_blank">Akarin</a></div></footer><script src="https://gcore.jsdelivr.net/combine/gh/TransparentLC/transparentlc.github.io/js/mdui.min.js,npm/medium-zoom@1/dist/medium-zoom.min.js,npm/instant.page@5/instantpage.min.js,npm/aplayer@1/dist/APlayer.min.js,gh/TransparentLC/transparentlc.github.io@879beec/js/script.min.js"></script><script src="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/js/bsz.min.js" async></script></body></html>