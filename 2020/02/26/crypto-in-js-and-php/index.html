<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no" name="viewport"><meta content="✨小透明・宸✨" name="author"><meta content name="keywords"><meta content="学了一学期的（入门）密码学，不自己试着用一下怎么行嘛(´･_･`)" name="description"><link href="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png" rel="icon shortcut" type="image/ico"><link href="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png" rel="icon"><link href="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png" rel="apple-touch-icon"><link href="/atom.xml" rel="alternate" type="application/atom+xml"><link crossorigin href="https://cdn.jsdelivr.net" rel="preconnect"><link crossorigin href="https://p.sda1.dev" rel="preconnect"><link href="https://comment.akarin.dev" rel="dns-prefetch"><link as="image" href="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/sidebar_header.avif" rel="preload"><link as="image" href="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg" rel="preload"><title>在 Javascript 和 PHP 中进行加密和解密 | 存在感消失的地方|ω•`)</title><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://akarin.dev/2020/02/26/crypto-in-js-and-php/"},"headline":"在 Javascript 和 PHP 中进行加密和解密","datePublished":"2020-02-26T14:09:56.000Z","dateModified":"2020-02-26T14:09:56.000Z","author":{"@type":"Person","name":"✨小透明・宸✨","image":{"@type":"ImageObject","url":"https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg"},"description":"身处寒夜 把握星光✨"},"publisher":{"@type":"Organization","name":"存在感消失的地方|ω•`)","logo":"https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png"},"keywords":"","description":"学了一学期的（入门）密码学，不自己试着用一下怎么行嘛(´･_･`)"}</script><meta content="存在感消失的地方|ω•`)" property="og:site_name"><meta content="在 Javascript 和 PHP 中进行加密和解密" property="og:title"><meta content="学了一学期的（入门）密码学，不自己试着用一下怎么行嘛(´･_･`)" property="og:description"><meta content="article" property="og:type"><meta content="https://akarin.dev/2020/02/26/crypto-in-js-and-php/" property="og:url"><meta content="https://p.sda1.dev/12/6ea1796aea679bf193ba2d34e9cc06c9/bx5LiArk.jpg" property="og:image"><meta content="2020-02-26T14:09:56.000Z" property="article:published_time"><meta content="2020-02-26T14:09:56.000Z" property="article:modified_time"><meta content="✨小透明・宸✨" property="article:author"><link href="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io@d890fff5e3f54d08eeb80c40baa290c0b2bfffb6/css/mdui.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/combine/gh/TransparentLC/transparentlc.github.io@d890fff5e3f54d08eeb80c40baa290c0b2bfffb6/css/shiki.min.css,gh/TransparentLC/transparentlc.github.io@d890fff5e3f54d08eeb80c40baa290c0b2bfffb6/css/style.min.css" rel="stylesheet"><style>*{--sidebar-image:image-set("https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/sidebar_header.avif" type("image/avif"), "https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/sidebar_header.webp" type("image/webp"), url(https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/sidebar_header.jpg));--sidebar-image-color:#958981;--banner-image:image-set("https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/daily_pic.avif" type("image/avif"), "https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/daily_pic.webp" type("image/webp"), url(https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/daily_pic.png));--banner-image-color:#f09ea3;--post-thumbnail-color:#f09ea3}.__s_0{--shiki-light:#a0a1a7;--shiki-light-font-style:italic;--shiki-dark:#6a9955;--shiki-dark-font-style:inherit}.__s_1{--shiki-light:#a626a4;--shiki-dark:#569cd6}.__s_2{--shiki-light:#383a42;--shiki-dark:#9cdcfe}.__s_3{--shiki-light:#0184bc;--shiki-dark:#d4d4d4}.__s_4{--shiki-light:#383a42;--shiki-dark:#d4d4d4}.__s_5{--shiki-light:#e45649;--shiki-dark:#9cdcfe}.__s_6{--shiki-light:#4078f2;--shiki-dark:#dcdcaa}.__s_7{--shiki-light:#50a14f;--shiki-dark:#ce9178}.__s_8{--shiki-light:#383a42;--shiki-dark:#d4d4d4;--shiki-light-bg:#fafafa;--shiki-dark-bg:#1e1e1e}.__s_9{--shiki-light:#0184bc;--shiki-dark:#9cdcfe}.__s_a{--shiki-light:#a626a4;--shiki-dark:#c586c0}.__s_b{--shiki-light:#986801;--shiki-dark:#b5cea8}.__s_c{--shiki-light:#e45649;--shiki-dark:#4fc1ff}.__s_d{--shiki-light:#986801;--shiki-dark:#4fc1ff}.__s_e{--shiki-light:#0184bc;--shiki-dark:#dcdcaa}.__s_f{--shiki-light:#986801;--shiki-dark:#d4d4d4}.__s_h{--shiki-light:#986801;--shiki-dark:#569cd6}.__s_i{--shiki-light:#c18401;--shiki-dark:#4ec9b0}</style><meta content="Hexo 8.1.1" name="generator"></head><body class="mdui-drawer-body-left mdui-theme-accent-pink mdui-theme-primary-pink"><svg class="registry"><defs><path id="__i_0" d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/><path id="__i_1" d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/><path id="__i_2" d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4"/><path id="__i_3" d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"/><path id="__i_4" d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 10-2.5-1.5L15 12V4h5z"/><path id="__i_5" d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20 5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27zm0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93z"/><path id="__i_6" d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/><path id="__i_7" d="M22 18v4h-4v-3h-3v-3h-3l-2.26-2.26c-.55.17-1.13.26-1.74.26a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6c0 .61-.09 1.19-.26 1.74zM7 5a2 2 0 0 0-2 2 2 2 0 0 0 2 2 2 2 0 0 0 2-2 2 2 0 0 0-2-2"/><path id="__i_8" d="M6.5 20q-2.28 0-3.89-1.57Q1 16.85 1 14.58q0-1.95 1.17-3.48 1.18-1.53 3.08-1.95.58-2.02 2.14-3.4Q8.95 4.38 11 4.08v8.07L9.4 10.6 8 12l4 4 4-4-1.4-1.4-1.6 1.55V4.08q2.58.35 4.29 2.31T19 11q1.73.2 2.86 1.5 1.14 1.28 1.14 3 0 1.88-1.31 3.19T18.5 20Z"/><path id="__i_9" d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/><path id="__i_a" d="M7.41 8.58 12 13.17l4.59-4.59L18 10l-6 6-6-6z"/><path id="__i_b" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2M9 17H7v-7h2zm4 0h-2V7h2zm4 0h-2v-4h2z"/><path id="__i_c" d="M15.41 16.58 10.83 12l4.58-4.59L14 6l-6 6 6 6z"/><path id="__i_d" d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6z"/></defs></svg><svg class="registry"><defs><path id="__m_0" d="M23 287q1 3 2 8t5 22 10 31 15 33 20 30 26 22 33 9q75 0 96-64l10 9q62 55 118 55 65 0 102-47t37-114q0-108-76-199T249-10q-22 0-39 6-11 5-23 15t-19 17l-7 8q-1-1-22-87t-21-87q0-6 8-7t37-3h25q6-7 6-9t-3-18q-3-12-6-15t-13-4h-11q-9 0-34 1t-62 1q-70 0-89-2h-8q-7 7-7 11 2 27 13 35h20q34 1 39 12 3 6 61 239t61 247q1 5 1 14 0 41-25 41-22 0-37-28t-23-61-12-36q-2-2-16-2H29q-6 6-6 9m155-185q22-76 74-76 30 0 58 23t46 58q18 34 36 108t19 110v6q0 74-61 74-11 0-22-3t-22-9-20-13-17-15-15-15-11-14-8-10l-3-4q0-1-3-14t-11-44-14-52q-26-106-26-110"/><path id="__m_1" d="M33 157q0 101 76 192t171 92q60 0 92-52 1 1 5 6t11 11 16 12q34 24 46 24 4 0 7-3t3-5q0-9-69-285-71-284-71-288 0-8 45-9h25q6-8 6-9t-3-18q-4-13-10-19h-13q-31 2-108 2h-88q-14 0-17-1-14 0-14 8 0 3 2 15 4 16 7 19t20 3q48 0 58 7 8 5 28 88t21 85q0 1-7-3-48-39-100-39-55 0-97 40T33 157m319 169q-23 79-75 79-35 0-67-31t-50-81q-29-79-41-164v-11q0-8-1-12 0-45 18-62t43-18q54 0 111 72l8 11z"/><path id="__m_2" d="M21 287q1 6 3 16t12 38 20 47 33 37 46 17q36 0 60-18t30-34 6-21q0-2 1-2l11 11q61 64 139 64 54 0 87-27t34-79-38-157-38-127q0-26 17-26 6 0 9 1 29 5 52 38t35 80q2 8 20 8 20 0 20-8 0-1-4-15-8-29-22-57t-46-56-69-27q-47 0-68 27t-21 56q0 19 36 120t37 152q0 59-44 59h-5q-86 0-145-101l-7-12-33-134Q156 26 151 16q-13-27-43-27-13 0-21 6T76 7t-2 10q0 13 38 163t40 163q1 5 1 23 0 39-24 39-38 0-63-100-6-20-6-21-2-6-19-6H27q-6 6-6 9"/><path id="__m_3" d="M56 347q0 13 14 20h637q15-8 15-20 0-11-14-19l-318-1H72q-16 5-16 20m0-194q0 15 16 20h636q14-10 14-20 0-13-15-20H70q-14 7-14 20"/><path id="__m_4" d="M409 688q4 6 12 6h21q6-6 6-8 0-7-30-123-7-28-14-59t-12-46l-4-16q0-1 9-1t32-6 48-17q44-21 73-61t29-97-31-109-77-86-97-54-95-21h-4l-24-95q-6-23-13-55-8-32-11-38t-12-7h-6q-20 0-20 7 0 5 22 95l23 92q0 1-8 1-5 0-20 2T161 6t-54 30-45 53-19 82q0 60 33 113t81 86 97 52 88 19q5 0 6 4l30 122q31 119 31 121M122 150q0-34 12-59t33-38 36-18 34-8h7l93 377q-4 0-11-1t-29-8-42-16-44-29-41-46q-18-28-33-67-15-46-15-87m378 132q0 38-16 65t-40 38-39 15-24 4h-3l-46-187-48-188q0-2 1-2 8 0 32 6t40 14q43 19 74 53t44 70 19 64 6 48"/><path id="__m_5" d="M94 250q0 69 10 131t23 107 37 88 38 67 42 52 33 34 25 21h17q14 0 14-9 0-3-17-21t-41-53-49-86-42-138-17-193 17-192 41-139 49-86 42-53 17-21q0-9-15-9h-16l-28 24q-94 85-137 212T94 250"/><path id="__m_6" d="m60 749 4 1h22l28-24q94-85 137-212t43-264q0-68-10-131T261 12t-37-88-38-67-41-51-32-33-23-19l-4-4H63q-3 0-5 3t-3 9q1 1 11 13Q221-64 221 250T66 725q-10 12-11 13 0 8 5 11"/><path id="__m_7" d="M84 237v13l14 20h581q15-8 15-20t-15-20H98q-14 7-14 20Z"/><path id="__m_8" d="m213 578-13-5q-14-5-40-10t-58-7H83v46h19q47 2 87 15t56 24 28 22q2 3 12 3 9 0 17-6V361l1-300q7-7 12-9t24-4 62-2h26V0h-11q-21 3-159 3-136 0-157-3H88v46h64q16 0 25 1t16 3 8 2 6 5 6 4z"/><path id="__m_9" d="M39 168q0 57 19 104t49 78 67 52 70 31 63 9h3q45 0 78-22t33-65q0-90-111-118-49-13-134-14-37 0-38-2 0-2-6-35t-7-58q0-47 21-74t63-28 93 19 92 66q9 10 12 10 4 0 13-9t10-14-9-16-30-27-46-31-63-25-76-10q-79 0-122 53T39 168m334 185q-6 52-68 52-33 0-61-14t-45-34-29-41-16-36-5-19q0-1 20-1 113 0 158 24t46 69"/><path id="__m_a" d="M311 43q-15-13-44-28T206 0q-63 0-101 45T66 160q0 105 77 193t171 89q47 0 87-48l3 4q2 3 5 6t9 8 13 7 16 3q14 0 23-9t10-19q0-15-57-242T363-80q-18-54-77-89t-135-36q-141 0-141 68 0 26 18 46t46 20q15 0 28-9t14-31q0-10-2-19t-7-14-8-10-7-8l-2-2h1q10-3 60-3 38 0 60 12 23 11 43 33t28 47q6 19 16 62 13 48 13 56m73 285-4 11q-3 11-5 15t-6 14-10 14-13 11-18 9-22 3q-44 0-85-53-30-39-50-119t-20-116q0-79 62-79 56 0 110 70l8 10z"/><path id="__m_b" d="M34 159q0 109 86 196t186 87q56 0 88-24t33-63q0-29-19-49t-48-21q-19 0-30 10t-11 30 11 34 22 21 14 6h1q0 2-6 6t-21 8-34 4q-30 0-57-14-21-9-43-31-44-44-64-124t-21-116q0-46 26-69 22-24 58-24h4q112 0 185 85 9 10 12 10 4 0 13-9t10-14-9-15-29-28-45-30-64-25-80-11q-75 0-121 48T34 159"/><path id="__m_c" d="M366 683q1 0 72 5t73 6q12 0 12-8 0-7-73-302T375 83t-1-15q0-42 28-42 9 1 20 9 21 20 41 96 6 20 10 21 2 1 10 1h8q15 0 15-8 0-5-3-16-13-50-30-81T445 8 417-8q-8-2-24-2-34 0-57 15t-30 31l-6 15q-1 1-4-1l-4-4q-59-56-120-56-55 0-97 40T33 157q0 48 20 98t48 86q47 57 94 79t85 22q56 0 84-42 5-6 5-4 1 4 27 109t28 111q0 13-7 16t-39 5h-21q-6 6-6 8t2 19q5 19 13 19m-14-357q-23 79-75 79-35 0-67-31t-50-81q-29-79-41-164v-11q0-8-1-12 0-45 18-62t43-18q54 0 111 72l8 11z"/><path id="__m_d" d="M78 35v25l16 43 43 18q28 0 50-25t23-88q0-35-9-68t-21-57-26-41-24-27-13-9q-4 0-13 9t-9 13 11 16 25 30 26 50 16 73V9l-1-1q-2-1-5-2t-6-3-9-2-12-1q-27 0-44 17Z"/><path id="__m_e" d="M41 46h14q39 0 47 14v62q0 17 1 39t0 42v66q0 35-1 59v23q-3 19-14 25t-45 9H25v23q0 23 2 23l10 1q10 1 28 2t37 2q17 1 36 2t29 3 11 1h3v-40q0-38 1-38t5 5 12 15 19 18 29 19 38 16 51 5q15 0 28-2t23-6 19-8 15-9 11-11 9-11 7-11 4-10 3-8l2-5 3 4 6 8q3 4 9 11t13 13 15 13 20 12 23 10 26 7 31 3q126 0 137-113 1-7 1-139v-86q0-38 2-45t11-10q21-3 49-3h16V0h-8l-23 1q-24 1-51 1t-38 1Q596 3 587 0h-8v46h16q61 0 61 16 1 2 1 138-1 135-2 143-6 28-20 42t-24 17-26 2q-45 0-79-34-27-27-34-55t-8-83V108q0-30 1-40t3-13 9-6q21-3 49-3h16V0h-8l-24 1q-23 1-50 1t-38 1Q319 3 310 0h-8v46h16q61 0 61 16 1 2 1 138-1 135-2 143-6 28-20 42t-24 17-26 2q-45 0-79-34-27-27-34-55t-8-83V108q0-30 1-40t3-13 9-6q21-3 49-3h16V0h-8l-23 1q-24 1-51 1t-38 1Q42 3 33 0h-8v46z"/><path id="__m_f" d="M28 214q0 95 65 164t157 70q90 0 155-68t66-165q0-95-64-160T250-10q-97 0-159 67T28 214M250 30q122 0 122 163v57q0 22-1 38t-7 38-16 36-31 28-49 20q-5 1-16 1-30 0-57-12-43-22-56-61t-13-92v-20q0-96 19-135 32-61 105-61"/><path id="__m_g" d="M376 495v40q0 24 1 33 0 45-10 56t-51 13h-18v23q0 23 2 23l10 1q10 1 29 2t37 2q17 1 37 2t30 3 11 1h3V390q0-306 1-309 3-20 14-26t45-9h18V0q-2 0-76-5t-79-6h-7v55l-8-7q-58-48-130-48-77 0-139 61T34 215q0 100 63 163t147 64q75 0 132-49zm-3-153q-45 63-113 63-49 0-87-36-27-28-34-64t-8-94q0-56 7-91t35-61q30-33 78-33 71 0 122 77z"/><path id="__m_h" d="M21 287q1 6 3 16t12 38 20 47 32 37 44 17 43-7 30-18 16-22 8-19l2-7q0-2 1-2l11 11q60 64 141 64 17 0 31-2t26-7 19-10 15-12 10-13 8-13 4-12 3-9 2-7l8 10q63 75 149 75 54 0 87-27t34-79q0-51-38-158T704 50q1-14 5-19t15-5q28 0 52 30t39 82q3 11 6 13t16 2q20 0 20-8 0-1-4-15-8-29-22-57t-46-56-69-27q-47 0-68 27t-21 56q0 19 36 120t37 152q0 59-44 59h-5q-86 0-145-101l-7-12-33-134Q433 26 428 16q-13-27-43-27-13 0-21 7T353 8t-3 10q0 11 34 143l36 146q3 15 3 38 0 59-44 59h-5q-86 0-145-101l-7-12-33-134Q156 26 151 16q-13-27-43-27-13 0-21 6T76 7t-2 10q0 13 38 164 39 154 39 161 3 15 3 27 0 36-25 36-22 0-37-28t-23-61-12-36q-2-2-16-2H27q-6 6-6 9"/></defs></svg>    <button class="mdui-fab mdui-m-a-2 mdui-shadow-0 mdui-text-color-grey-700" mdui-drawer="{target:'#akarin-drawer'}" style="z-index:1;position:fixed"><span class="mdui-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_0"></use></svg></span></button>  <nav class="mdui-drawer mdui-drawer-full-height mdui-shadow-6" id="akarin-drawer"> <div class="akarin-util-bg-cover mdui-p-x-2" id="akarin-drawer-media"> <img alt="✨小透明・宸✨ 的头像" class="akarin-hover-spin mdui-img-circle mdui-m-t-4" id="akarin-drawer-avatar" src="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg"> <div class="akarin-util-text-gradient mdui-card-media-covered"> <div class="mdui-card-primary"> <div class="mdui-typo-subheading">✨小透明・宸✨ </div> <div class="akarin-util-opacity-half mdui-typo-caption">存在感消失的地方|ω•`) </div> </div> </div> </div> <div class="mdui-list" mdui-collapse> <div> <a class="mdui-list-item mdui-ripple" href="../../../../"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_1"></use></svg></span> <span class="mdui-list-item-content">主页</span> </a> </div> <div> <a class="mdui-list-item mdui-ripple" href="../../../../about/"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_2"></use></svg></span> <span class="mdui-list-item-content">关于</span> </a> </div> <div> <a class="mdui-list-item mdui-ripple" href="../../../../friend/"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_3"></use></svg></span> <span class="mdui-list-item-content">友链</span> </a> </div> <div> <a class="mdui-list-item mdui-ripple" href="../../../../archives/"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_4"></use></svg></span> <span class="mdui-list-item-content">归档</span> <small class="akarin-drawer-badge mdui-color-theme-accent">38</small> </a> </div> <div> <a class="mdui-list-item mdui-ripple" href="../../../../atom.xml"> <i class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_5"></use></svg></i> <span class="mdui-list-item-content">RSS</span> </a> </div> <div class="mdui-divider"></div> <div> <a class="mdui-list-item mdui-ripple" href="https://github.com/TransparentLC" rel="noopener" target="_blank"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_6"></use></svg></span> <span class="mdui-list-item-content">GitHub</span> </a> </div> <div> <a class="mdui-list-item mdui-ripple" href="https://github.com/TransparentLC.gpg" rel="noopener" target="_blank"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_7"></use></svg></span> <span class="mdui-list-item-content">PGP 公钥</span> </a> </div> <div> <a class="mdui-list-item mdui-ripple" href="https://fuwafuwa.akarin.dev/" rel="noopener" target="_blank"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_8"></use></svg></span> <span class="mdui-list-item-content">下载站</span> </a> </div> <div class="mdui-divider"></div> <div class="mdui-collapse-item mdui-collapse-item-open"> <div class="mdui-collapse-item-header mdui-list-item mdui-ripple"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_9"></use></svg></span> <span class="mdui-list-item-content">深色模式</span> <span class="mdui-collapse-item-arrow mdui-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_a"></use></svg></span> </div> <div class="mdui-collapse-item-body mdui-list"> <div class="mdui-list-item mdui-ripple" data-dark="auto"> <span class="mdui-list-item-content">根据系统主题切换</span> </div> <div class="mdui-list-item mdui-ripple" data-dark="enable"> <span class="mdui-list-item-content">启用</span> </div> <div class="mdui-list-item mdui-ripple" data-dark="disable"> <span class="mdui-list-item-content">禁用</span> </div> </div> </div> <div class="mdui-collapse-item mdui-collapse-item-open"> <div class="mdui-collapse-item-header mdui-list-item mdui-ripple"> <span class="mdui-icon mdui-list-item-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_b"></use></svg></span> <span class="mdui-list-item-content">访问统计</span> <span class="mdui-collapse-item-arrow mdui-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_a"></use></svg></span> </div> <div class="mdui-collapse-item-body mdui-list"> <div class="mdui-list-item mdui-ripple"> <span class="mdui-list-item-content">站点访问量</span> <small class="akarin-drawer-badge mdui-color-theme-accent" id="busuanzi_value_site_pv">Loading</small> </div> <div class="mdui-list-item mdui-ripple"> <span class="mdui-list-item-content">站点访客数</span> <small class="akarin-drawer-badge mdui-color-theme-accent" id="busuanzi_value_site_uv">Loading</small> </div> <div class="mdui-list-item mdui-ripple"> <span class="mdui-list-item-content">页面访问量</span> <small class="akarin-drawer-badge mdui-color-theme-accent" id="busuanzi_value_page_pv">Loading</small> </div> </div> </div> </div> </nav>  <picture id="akarin-top" title="返回顶部"> <source srcset="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/top.avif" type="image/avif"> <source srcset="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/top.webp" type="image/webp"> <img alt="返回顶部" src="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/top.png">   </picture>  <div style="padding-top:20px"></div> <div class="mdui-hidden-sm-down" style="padding-top:40px"></div> <div class="mdui-hidden-md-down" style="padding-top:40px"></div>  <main class="mdui-container" style="max-width:1024px"> <div class="akarin-util-rounded-5 mdui-card mdui-shadow-4"> <div class="akarin-post-bg akarin-util-bg-cover mdui-ripple" data-src="https://p.sda1.dev/12/6ea1796aea679bf193ba2d34e9cc06c9/bx5LiArk.jpg" data-src-avif="https://vfile.meituan.net/mmdb/1b1f1958fbd8d0cd78f0e3b2e2d4ded323497.jpg" data-src-webp="https://p.sda1.dev/12/5ba887e52d4c0eb4144105b45fd7cea1/gcXQxji2.webp"> <div class="akarin-blurred akarin-post-bg akarin-util-bg-cover" style="background-image:url(data:image/webp;base64,UklGRqICAABXRUJQVlA4IJYCAABwDgCdASpAADAAPrVOoUwoqKqmKrQMAOAWiWwAnTlBfgHH8ZvedPA2812e7zXZ5c7m8XYs+YiPD421jvRgeIYB0agEdL7+h3cDEtn1XXNRSrbog6/NuyjCkqSh35lFYitH3eN6DKn5tSM5Ukx2LXvrQiX/rCXu3HA3mlwAAP7zbD9UVymLph5nd3mSbB8eBt+t2OkggK3v3m7LB1uCZT3yJSXq+7bosAJiO82Ama84xveblP1/7qBmehGFaYRVqni/ySi6HjVDY39ztpUAb7q/B+0x7kpH5SLC+tuDbMZTUtFnNqBx7jjg+lrpXLiNCjUM7l3P66/kAKb0oS3fAr2MHQMmXqF36S5/n7xqc4GC3kXJ9ZewUIrdDjYjr9J1lkU3BJPeOIOGPn77mrB7OvN9GShuWpeotC833DMYH6oqX4QWGxku9nXtlkbQ34fy2VqCBKC4NweGq/DC6pKBTc4koM7SL11zg6BI8M5zkRvuFeCDn5A51zGsjV1jVMGSuOS/VqnK8Ol/6EBypH272+/MNuVP2NkEBfyXkvHrnzk9QNEprH2XVIeinv0GvA7/xh8XWIpY0nqxM5K9vcESswfDI24dmSxeANZKETntQZFGcVjv5i9/1a34pr7bNCXzwEvrhcDCvvBZKsQLngqhdQmwiBQVM5CdJHj4QneHbyR5DIffhQ7jWv2GPKUIa7wqw1+Nuew5ALNhwiSdnlk8B5UIogAciwyNJQvjHjBuAmjML2feUv89Wj6/cpzx9BBuoMjv7NyqX0Iw9Ndf9aot1fFynqYFVrg3CZydUMp5ZGR0l2IwJy81LKzqzbZB5y/H1tQsUPqKhGxeDQ+95lmaSu50/e/zo03y0SKjhwSOvinXyLjrZ9AAAA)"></div> <div class="akarin-post-title akarin-util-text-gradient"> <div class="mdui-card-primary"> <div class="mdui-card-primary-title mdui-text-color-white-text"> 在 Javascript 和 PHP 中进行加密和解密 </div> </div> </div> </div> <div class="mdui-card-header mdui-valign"> <div> <img alt="✨小透明・宸✨ 的头像" class="akarin-hover-spin mdui-card-header-avatar" src="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg"> <div class="mdui-card-header-title">✨小透明・宸✨</div> <div class="mdui-card-header-subtitle">2020-02-26 22:09:56</div> </div> </div> <article class="mdui-card-content mdui-p-a-3 mdui-typo"> <blockquote> <p>封面图：<a href="https://www.pixiv.net/artworks/77846017" rel="noopener" target="_blank">Pixiv ID: 77846017 「京あか」 by ネリヲ</a></p> </blockquote> <p>因为上个学期的课程里有学习到了一点入门的密码学（逃 所以就顺便想尝试一下在编程中进行加密解密相关的操作～(ﾉ*･ω･)ﾉ</p> <p>在开始之前，先简单地过一遍相关的一些概念：</p> <ul> <li>明文：没有加密的数据</li> <li>密文：加密后的数据</li> <li>对称加密：使用**同一个密钥（如果是除 CBC 以外模式的分组密码，还需要 IV）**进行加密和解密</li> <li>非对称加密：任何人都可以使用公开的<strong>公钥</strong>加密，只有藏着<strong>私钥</strong>的人才能解密</li> <li>Hash：把任意长度的输入变换成<strong>固定长度的、尽可能避免产生碰撞的</strong>输出，是<strong>不可逆</strong>操作</li> <li>Base64：使用可打印的字符表示二进制数据的一种<strong>编码方式</strong>，因为任何人都可以直接进行编码和解码，所以<strong>不是加密算法</strong></li> </ul> <p>这里的目标是在前端 Javascript 环境和后端 PHP 环境，分别使用一下 RSA 和 AES 这两种常见的非对称和对称加密算法～</p> <p>用到的各种开源库：</p> <ul> <li><a href="https://github.com/brix/crypto-js" rel="noopener" target="_blank">CryptoJS</a>：用 Javascript 实现了多种对称加密算法和 Hash 算法的函数库。</li> <li><a href="https://github.com/travist/jsencrypt" rel="noopener" target="_blank">JSEncrypt</a>：用 Javascript 实现了 RSA 的加密解密、验证签名、密钥生成。</li> <li><a href="https://www.php.net/manual/zh/book.openssl.php" rel="noopener" target="_blank">OpenSSL</a>：广泛用于安全通信的一个库，支持大多数的加密算法和 Hash 算法，这里用到的是 PHP 自带的相关扩展。</li> <li><a href="https://github.com/phpseclib/phpseclib" rel="noopener" target="_blank">phpseclib</a>：一个以面向对象的方式封装了 RSA 和其他一些对称加密算法的 PHP composer 包，实际上还是在调用 PHP 的 OpenSSL 之类的加密扩展。（如果没有安装扩展的话，这个库自己也已经用 PHP 把各种算法实现了一遍……）</li> </ul> <hr> <h1 id="AES-对称加解密"><a class="headerlink" href="#AES-对称加解密" title="AES 对称加解密"></a>AES 对称加解密</h1><h2 id="CryptoJS"><a class="headerlink" href="#CryptoJS" title="CryptoJS"></a>CryptoJS</h2><p>在开始进行加解密之前，有必要先介绍一下 CryptoJS 中的 <code>WordArray</code>～</p> <p>由于 JS 中直接操作数值型数据的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Typed_arrays" rel="noopener" target="_blank">TypedArray</a> 是一个相对比较新的标准，而 CryptoJS 这个库开发于 TypedArray 进入 JS 标准之前，所以 CryptoJS 中明文、密文、密钥和 Hash 一直都是使用了一个自建的 WordArray 对象，通过一个相当于 UInt32 数值组成的数组和一个标志位来代表原始的二进制数据：</p> <figure class="akarin-blurred-container"> <div style="padding-bottom:min(26.6986%,334px)"></div> <img class="mdui-hoverable mdui-img-rounded" data-src="https://p.sda1.dev/12/5c4a22653ee073346c8bf50f6e26ffcc/EB5DNjq5.png" data-src-webp="https://p.sda1.dev/12/7fbd6ac9d44a7811e42dd220e4e1132b/Zlt6MuP4.webp"> <img class="akarin-blurred mdui-hoverable mdui-img-rounded" src="data:image/webp;base64,UklGRkoAAABXRUJQVlA4ID4AAAAQAwCdASogAAkAPrVInkmkiGwCADgFolpYOsANzWjIFoAA/vPHGU/1yR/ScZBlRMZvAfoVd4I+vE6ghQgAAA"> <noscript> <img class="mdui-center mdui-hoverable mdui-img-fluid mdui-img-rounded" src="https://p.sda1.dev/12/5c4a22653ee073346c8bf50f6e26ffcc/EB5DNjq5.png"> </noscript> </figure> <p>（由于字节序不同，虽然也可以使用 <code>CryptoJS.lib.WordArray.create(new Uint32Array([...]))</code> 得到 WordArray ，但是里面的 <code>words</code> 和输入的 <code>Uint32Array</code> 是不同的）</p> <p>加密和解密都是本质上都是对二进制数据进行操作，CryptoJS 也支持一些“编码”标准，可以与 WordArray 相互转换：</p> <figure><pre class="__s_8 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_0">// 三个数据实际上都是QWERTYUIOP123456</span></span>
<span class="line"><span class="__s_0">// 使用CryptoJS.enc.*.parse将数据转换为WordArray</span></span>
<span class="line"><span class="__s_1">let</span><span class="__s_2"> a</span><span class="__s_3"> =</span><span class="__s_2"> CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Utf8</span><span class="__s_4">.</span><span class="__s_6">parse</span><span class="__s_4">(</span><span class="__s_7">'QWERTYUIOP123456'</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_1">let</span><span class="__s_2"> b</span><span class="__s_3"> =</span><span class="__s_2"> CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Hex</span><span class="__s_4">.</span><span class="__s_6">parse</span><span class="__s_4">(</span><span class="__s_7">'51574552545955494f50313233343536'</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_1">let</span><span class="__s_2"> c</span><span class="__s_3"> =</span><span class="__s_2"> CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Base64</span><span class="__s_4">.</span><span class="__s_6">parse</span><span class="__s_4">(</span><span class="__s_7">'UVdFUlRZVUlPUDEyMzQ1Ng=='</span><span class="__s_4">);</span></span>
<span class="line"></span>
<span class="line"><span class="__s_0">// 使用CryptoJS.enc.*.stringify将WordArray转换为数据：</span></span>
<span class="line"><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Utf8</span><span class="__s_4">.</span><span class="__s_6">stringify</span><span class="__s_4">(</span><span class="__s_2">a</span><span class="__s_4">); </span><span class="__s_0">// "QWERTYUIOP123456"</span></span>
<span class="line"><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Hex</span><span class="__s_4">.</span><span class="__s_6">stringify</span><span class="__s_4">(</span><span class="__s_2">b</span><span class="__s_4">); </span><span class="__s_0">// "51574552545955494f50313233343536"</span></span>
<span class="line"><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Base64</span><span class="__s_4">.</span><span class="__s_6">stringify</span><span class="__s_4">(</span><span class="__s_2">c</span><span class="__s_4">); </span><span class="__s_0">// "UVdFUlRZVUlPUDEyMzQ1Ng=="</span></span>
<span class="line"></span>
<span class="line"><span class="__s_0">// 也可以对WordArray使用.toString(CryptoJS.enc.*)，和CryptoJS.enc.*.stringify是等效的</span></span>
<span class="line"><span class="__s_2">a</span><span class="__s_4">.</span><span class="__s_6">toString</span><span class="__s_4">(</span><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Utf8</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_2">b</span><span class="__s_4">.</span><span class="__s_6">toString</span><span class="__s_4">(</span><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Hex</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_2">c</span><span class="__s_4">.</span><span class="__s_6">toString</span><span class="__s_4">(</span><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Base64</span><span class="__s_4">);</span></span></code></pre><code class="language">js</code></figure> <p>除了已有的编码，还可以在 <code>CryptoJS.enc</code> 中加入一个有 <code>stringify</code> 和 <code>parse</code> 两个函数的对象自行扩充。比如下面的一段代码就添加了对 <code>Uint8Array</code> 的支持（<a href="https://gist.github.com/lettergram/ba6733a854f835bca22b" rel="noopener" target="_blank">原代码出处</a>）：</p> <figure><pre class="__s_8 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Uint8</span><span class="__s_3"> =</span><span class="__s_4"> {</span></span>
<span class="line"><span class="__s_0">    // 将WordArray转换为数据，虽然是stringify但是不一定要求是字符串</span></span>
<span class="line"><span class="__s_6">    stringify</span><span class="__s_9">:</span><span class="__s_2"> wordArray</span><span class="__s_1"> =></span><span class="__s_4"> {</span></span>
<span class="line"><span class="__s_1">        let</span><span class="__s_2"> words</span><span class="__s_3"> =</span><span class="__s_2"> wordArray</span><span class="__s_4">.</span><span class="__s_5">words</span><span class="__s_4">;</span></span>
<span class="line"><span class="__s_1">        let</span><span class="__s_2"> sigBytes</span><span class="__s_3"> =</span><span class="__s_2"> wordArray</span><span class="__s_4">.</span><span class="__s_5">sigBytes</span><span class="__s_4">;</span></span>
<span class="line"><span class="__s_1">        let</span><span class="__s_2"> u8arr</span><span class="__s_3"> =</span><span class="__s_1"> new</span><span class="__s_6"> Uint8Array</span><span class="__s_4">(</span><span class="__s_2">sigBytes</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_a">        for</span><span class="__s_4"> (</span><span class="__s_1">let</span><span class="__s_2"> i</span><span class="__s_3"> =</span><span class="__s_b"> 0</span><span class="__s_4">; </span><span class="__s_2">i</span><span class="__s_3"> &#x3C;</span><span class="__s_2"> sigBytes</span><span class="__s_4">; </span><span class="__s_2">i</span><span class="__s_3">++</span><span class="__s_4">) {</span></span>
<span class="line"><span class="__s_2">            u8arr</span><span class="__s_4">[</span><span class="__s_2">i</span><span class="__s_4">] </span><span class="__s_3">=</span><span class="__s_4"> (</span><span class="__s_2">words</span><span class="__s_4">[</span><span class="__s_2">i</span><span class="__s_3"> >>></span><span class="__s_b"> 2</span><span class="__s_4">] </span><span class="__s_3">>>></span><span class="__s_4"> (</span><span class="__s_b">24</span><span class="__s_3"> -</span><span class="__s_4"> (</span><span class="__s_2">i</span><span class="__s_3"> %</span><span class="__s_b"> 4</span><span class="__s_4">) </span><span class="__s_3">*</span><span class="__s_b"> 8</span><span class="__s_4">)) </span><span class="__s_3">&#x26;</span><span class="__s_b"> 0xFF</span><span class="__s_4">;</span></span>
<span class="line"><span class="__s_4">        }</span></span>
<span class="line"><span class="__s_a">        return</span><span class="__s_2"> u8arr</span><span class="__s_4">;</span></span>
<span class="line"><span class="__s_4">    },</span></span>
<span class="line"><span class="__s_0">    // 将数据转换为WordArray</span></span>
<span class="line"><span class="__s_6">    parse</span><span class="__s_9">:</span><span class="__s_2"> u8arr</span><span class="__s_1"> =></span><span class="__s_4"> {</span></span>
<span class="line"><span class="__s_1">        let</span><span class="__s_2"> len</span><span class="__s_3"> =</span><span class="__s_2"> u8arr</span><span class="__s_4">.</span><span class="__s_5">length</span><span class="__s_4">;</span></span>
<span class="line"><span class="__s_1">        let</span><span class="__s_2"> words</span><span class="__s_3"> =</span><span class="__s_4"> [];</span></span>
<span class="line"><span class="__s_a">        for</span><span class="__s_4"> (</span><span class="__s_1">let</span><span class="__s_2"> i</span><span class="__s_3"> =</span><span class="__s_b"> 0</span><span class="__s_4">; </span><span class="__s_2">i</span><span class="__s_3"> &#x3C;</span><span class="__s_2"> len</span><span class="__s_4">; </span><span class="__s_2">i</span><span class="__s_3">++</span><span class="__s_4">) {</span></span>
<span class="line"><span class="__s_2">            words</span><span class="__s_4">[</span><span class="__s_2">i</span><span class="__s_3"> >>></span><span class="__s_b"> 2</span><span class="__s_4">] </span><span class="__s_3">|=</span><span class="__s_4"> (</span><span class="__s_2">u8arr</span><span class="__s_4">[</span><span class="__s_2">i</span><span class="__s_4">] </span><span class="__s_3">&#x26;</span><span class="__s_b"> 0xFF</span><span class="__s_4">) </span><span class="__s_3">&#x3C;&#x3C;</span><span class="__s_4"> (</span><span class="__s_b">24</span><span class="__s_3"> -</span><span class="__s_4"> (</span><span class="__s_2">i</span><span class="__s_3"> %</span><span class="__s_b"> 4</span><span class="__s_4">) </span><span class="__s_3">*</span><span class="__s_b"> 8</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_4">        }</span></span>
<span class="line"><span class="__s_a">        return</span><span class="__s_2"> CryptoJS</span><span class="__s_4">.</span><span class="__s_5">lib</span><span class="__s_4">.</span><span class="__s_5">WordArray</span><span class="__s_4">.</span><span class="__s_6">create</span><span class="__s_4">(</span><span class="__s_2">words</span><span class="__s_4">, </span><span class="__s_2">len</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_4">    }</span></span>
<span class="line"><span class="__s_4">};</span></span>
<span class="line"></span>
<span class="line"><span class="__s_0">// "ABCD"</span></span>
<span class="line"><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Uint8</span><span class="__s_4">.</span><span class="__s_6">parse</span><span class="__s_4">(</span><span class="__s_1">new</span><span class="__s_6"> Uint8Array</span><span class="__s_4">([</span><span class="__s_b">0x41</span><span class="__s_4">, </span><span class="__s_b">0x42</span><span class="__s_4">, </span><span class="__s_b">0x43</span><span class="__s_4">, </span><span class="__s_b">0x44</span><span class="__s_4">])).</span><span class="__s_6">toString</span><span class="__s_4">(</span><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Utf8</span><span class="__s_4">)</span></span></code></pre><code class="language">js</code></figure> <p>调用 <code>CryptoJS.*.encrypt</code> 函数可以进行加密，并<del>钦定</del>加密模式、填充模式和 IV，比如加密明文 <code>ABCD</code>：</p> <figure><pre class="__s_8 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_1">let</span><span class="__s_2"> message</span><span class="__s_3"> =</span><span class="__s_2"> CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Utf8</span><span class="__s_4">.</span><span class="__s_6">parse</span><span class="__s_4">(</span><span class="__s_7">'ABCD'</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_1">let</span><span class="__s_2"> key</span><span class="__s_3"> =</span><span class="__s_2"> CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Utf8</span><span class="__s_4">.</span><span class="__s_6">parse</span><span class="__s_4">(</span><span class="__s_7">'0123456789ABCDEF'</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_1">let</span><span class="__s_2"> iv</span><span class="__s_3"> =</span><span class="__s_2"> CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Utf8</span><span class="__s_4">.</span><span class="__s_6">parse</span><span class="__s_4">(</span><span class="__s_7">'FEDCBA9876543210'</span><span class="__s_4">);</span></span>
<span class="line"></span>
<span class="line"><span class="__s_1">let</span><span class="__s_2"> cipher</span><span class="__s_3"> =</span><span class="__s_2"> CryptoJS</span><span class="__s_4">.</span><span class="__s_c">AES</span><span class="__s_4">.</span><span class="__s_6">encrypt</span><span class="__s_4">(</span><span class="__s_2">message</span><span class="__s_4">, </span><span class="__s_2">key</span><span class="__s_4">, {</span></span>
<span class="line"><span class="__s_5">    iv</span><span class="__s_9">:</span><span class="__s_2"> iv</span><span class="__s_4">, </span><span class="__s_0">// 如果是ECB模式就不需要钦定IV</span></span>
<span class="line"><span class="__s_5">    mode</span><span class="__s_9">:</span><span class="__s_2"> CryptoJS</span><span class="__s_4">.</span><span class="__s_5">mode</span><span class="__s_4">.</span><span class="__s_d">CBC</span><span class="__s_4">, </span><span class="__s_0">// 不钦定的话，默认也是这个</span></span>
<span class="line"><span class="__s_5">    padding</span><span class="__s_9">:</span><span class="__s_2"> CryptoJS</span><span class="__s_4">.</span><span class="__s_5">pad</span><span class="__s_4">.</span><span class="__s_5">Pkcs7</span><span class="__s_4">, </span><span class="__s_0">// 不钦定的话，默认也是这个</span></span>
<span class="line"><span class="__s_4">});</span></span></code></pre><code class="language">js</code></figure> <p>容易踩坑的一点是上面的 <code>cipher</code> 并不是 WordArray，而是一个<strong>包含了加密算法、加密模式、密文、密钥、IV 等信息的对象</strong>。对这个 <code>cipher</code> 直接 <code>toString</code> 可以得到 Base64 编码后的数据，但是只有从这个对象的 <code>ciphertext</code> 获取对应的 WordArray 才能使用 <code>CryptoJS.enc.*.stringify</code> 和 <code>.toString(CryptoJS.enc.*)</code> 任意转换为一般的数据，否则就会报错了(´･_･&#96;)</p> <figure class="akarin-blurred-container"> <div style="padding-bottom:min(51.3657%,480px)"></div> <img class="mdui-hoverable mdui-img-rounded" data-src="https://p.sda1.dev/12/ef35748a7717c66e0a41d0f21aa8a39a/rYtlmgq3.png" data-src-webp="https://p.sda1.dev/12/1c1f669f93715767db85016d7b5526e0/EZ6NYFiQ.webp"> <img class="akarin-blurred mdui-hoverable mdui-img-rounded" src="data:image/webp;base64,UklGRmAAAABXRUJQVlA4IFQAAACQAwCdASogABAAPrVInkmkiGwCADgFolnALsAId/9GUwNyP8AAAP73C9+lpu9YJ64Z/sdIAYI20luU0nDnl+kheXGHIB2Gb5AGPg8oQgTtgALrNAA"> <noscript> <img class="mdui-center mdui-hoverable mdui-img-fluid mdui-img-rounded" src="https://p.sda1.dev/12/ef35748a7717c66e0a41d0f21aa8a39a/rYtlmgq3.png"> </noscript> </figure> <figure><pre class="__s_8 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_0">// "1Wl2Kg1/0Vh+fJPX+UsJaA=="</span></span>
<span class="line"><span class="__s_2">cipher</span><span class="__s_4">.</span><span class="__s_6">toString</span><span class="__s_4">();</span></span>
<span class="line"><span class="__s_2">cipher</span><span class="__s_4">.</span><span class="__s_5">ciphertext</span><span class="__s_4">.</span><span class="__s_6">toString</span><span class="__s_4">(</span><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Base64</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Base64</span><span class="__s_4">.</span><span class="__s_6">stringify</span><span class="__s_4">(</span><span class="__s_2">cipher</span><span class="__s_4">.</span><span class="__s_5">ciphertext</span><span class="__s_4">);</span></span>
<span class="line"></span>
<span class="line"><span class="__s_0">// "d569762a0d7fd1587e7c93d7f94b0968"</span></span>
<span class="line"><span class="__s_2">cipher</span><span class="__s_4">.</span><span class="__s_5">ciphertext</span><span class="__s_4">.</span><span class="__s_6">toString</span><span class="__s_4">(</span><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Hex</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Hex</span><span class="__s_4">.</span><span class="__s_6">stringify</span><span class="__s_4">(</span><span class="__s_2">cipher</span><span class="__s_4">.</span><span class="__s_5">ciphertext</span><span class="__s_4">);</span></span>
<span class="line"></span>
<span class="line"><span class="__s_0">// 报错</span></span>
<span class="line"><span class="__s_2">cipher</span><span class="__s_4">.</span><span class="__s_6">toString</span><span class="__s_4">(</span><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Base64</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Base64</span><span class="__s_4">.</span><span class="__s_6">stringify</span><span class="__s_4">(</span><span class="__s_2">cipher</span><span class="__s_4">);</span></span></code></pre><code class="language">js</code></figure> <p>至于解密操作……当然是把 <code>encrypt</code> 改成 <code>decrypt</code> 了，但是和加密一样也有一个坑：</p> <p><strong>用来解密的是上面提到的“对象”，而不是 WordArray</strong>。直接传一个 WordArray 进去是无法正常解密的，然而解密之后得到的又是 WordArray。一开始使用 CryptoJS 的时候总是发现解密得到的东西是空白的，其实就是在这个地方踩了坑┐(´-｀)┌</p> <p>在实际中，收到的密文显然不会是上面的“对象”的形式（如果把加密算法、密钥、IV 之类的也传过来的话……？！），因此就需要模仿上面的 <code>cipher</code>，**用 WordArray 临时创建一个只有 <code>ciphertext</code> 这个属性的“对象”**用来解密：</p> <figure><pre class="__s_8 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_0">// 使用上面的“对象”解密，可以得到ABCD</span></span>
<span class="line"><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_c">AES</span><span class="__s_4">.</span><span class="__s_6">decrypt</span><span class="__s_4">(</span><span class="__s_2">cipher</span><span class="__s_4">, </span><span class="__s_2">key</span><span class="__s_4">, {</span><span class="__s_5">iv</span><span class="__s_9">:</span><span class="__s_2"> iv</span><span class="__s_4">}).</span><span class="__s_6">toString</span><span class="__s_4">(</span><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Utf8</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_0">// 直接使用WordArray解密，得到的是空字符串</span></span>
<span class="line"><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_c">AES</span><span class="__s_4">.</span><span class="__s_6">decrypt</span><span class="__s_4">(</span></span>
<span class="line"><span class="__s_2">    CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Base64</span><span class="__s_4">.</span><span class="__s_6">parse</span><span class="__s_4">(</span><span class="__s_7">'1Wl2Kg1/0Vh+fJPX+UsJaA=='</span><span class="__s_4">),</span></span>
<span class="line"><span class="__s_2">    key</span><span class="__s_4">, {</span><span class="__s_5">iv</span><span class="__s_9">:</span><span class="__s_2"> iv</span><span class="__s_4">}</span></span>
<span class="line"><span class="__s_4">).</span><span class="__s_6">toString</span><span class="__s_4">(</span><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Utf8</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_0">// 临时用WordArray创建一个“对象”，也能得到ABCD</span></span>
<span class="line"><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_c">AES</span><span class="__s_4">.</span><span class="__s_6">decrypt</span><span class="__s_4">(</span></span>
<span class="line"><span class="__s_4">    {</span><span class="__s_5">ciphertext</span><span class="__s_9">:</span><span class="__s_2"> CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Base64</span><span class="__s_4">.</span><span class="__s_6">parse</span><span class="__s_4">(</span><span class="__s_7">'1Wl2Kg1/0Vh+fJPX+UsJaA=='</span><span class="__s_4">)},</span></span>
<span class="line"><span class="__s_2">    key</span><span class="__s_4">, {</span><span class="__s_5">iv</span><span class="__s_9">:</span><span class="__s_2"> iv</span><span class="__s_4">}</span></span>
<span class="line"><span class="__s_4">).</span><span class="__s_6">toString</span><span class="__s_4">(</span><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Utf8</span><span class="__s_4">);</span></span></code></pre><code class="language">js</code></figure> <p>嗯……总的来说，使用 CryptoJS 进行加解密是比较麻烦的一件事，而且它的<a href="https://github.com/brix/crypto-js/blob/develop/docs/QuickStartGuide.wiki" rel="noopener" target="_blank">官方文档</a>也只是介绍了一下支持的算法，甚至没有一段演示用的代码（<a href="https://github.com/brix/crypto-js/blob/develop/README.md" rel="noopener" target="_blank">README.md</a> 里面倒是简单地介绍了一下用法）。至于加密和解密时涉及到的那个“对象”和 WordArray 的区别，不自己摸索一下估计就很难弄明白呢……(ฅ́дฅ̀)</p> <p>另外，用 CryptoJS 计算 Hash 既可以输入字符串也可以输入 WordArray，得到的还是 WordArray：</p> <figure><pre class="__s_8 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_0">// "cb08ca4a7bb5f9683c19133a84872ca7"</span></span>
<span class="line"><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_6">MD5</span><span class="__s_4">(</span><span class="__s_7">'ABCD'</span><span class="__s_4">).</span><span class="__s_6">toString</span><span class="__s_4">(</span><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Hex</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_6">MD5</span><span class="__s_4">(</span><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Hex</span><span class="__s_4">.</span><span class="__s_6">parse</span><span class="__s_4">(</span><span class="__s_7">'41424344'</span><span class="__s_4">)).</span><span class="__s_6">toString</span><span class="__s_4">(</span><span class="__s_2">CryptoJS</span><span class="__s_4">.</span><span class="__s_5">enc</span><span class="__s_4">.</span><span class="__s_5">Hex</span><span class="__s_4">);</span></span></code></pre><code class="language">js</code></figure> <h2 id="OpenSSL"><a class="headerlink" href="#OpenSSL" title="OpenSSL"></a>OpenSSL</h2><p>在 PHP 中进行 AES 加密和解密分别用到的是 <a href="https://www.php.net/manual/zh/function.openssl-encrypt.php" rel="noopener" target="_blank"><code>openssl_encrypt</code></a> 和 <a href="https://www.php.net/manual/zh/function.openssl-decrypt.php" rel="noopener" target="_blank"><code>openssl_decrypt</code></a> 两个函数，参数的顺序也基本相同：</p> <figure><pre class="__s_8 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_e">openssl_encrypt</span><span class="__s_4">(</span><span class="__s_1">string</span><span class="__s_5"> $data</span><span class="__s_4">, </span><span class="__s_1">string</span><span class="__s_5"> $method</span><span class="__s_4">, </span><span class="__s_1">string</span><span class="__s_5"> $key</span><span class="__s_4">, </span><span class="__s_1">int</span><span class="__s_5"> $options</span><span class="__s_4"> = </span><span class="__s_b">0</span><span class="__s_4">, </span><span class="__s_1">string</span><span class="__s_5"> $iv</span><span class="__s_4"> = </span><span class="__s_7">""</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_e">openssl_decrypt</span><span class="__s_4">(</span><span class="__s_1">string</span><span class="__s_5"> $data</span><span class="__s_4">, </span><span class="__s_1">string</span><span class="__s_5"> $method</span><span class="__s_4">, </span><span class="__s_1">string</span><span class="__s_5"> $key</span><span class="__s_4">, </span><span class="__s_1">int</span><span class="__s_5"> $options</span><span class="__s_4"> = </span><span class="__s_b">0</span><span class="__s_4">, </span><span class="__s_1">string</span><span class="__s_5"> $iv</span><span class="__s_4"> = </span><span class="__s_7">""</span><span class="__s_4">);</span></span></code></pre><code class="language">php</code></figure> <p><code>$data</code> 是明文和密文，<code>$method</code> 是加密方式，<code>$key</code> 是密钥。<code>$option</code> 可以统一设定调用上面的函数加密和解密时<strong>密文</strong>的格式：默认为 <code>0</code> 代表使用 Base64，设为 <code>OPENSSL_RAW_DATA</code> 就代表直接使用字符串。但是<strong>明文、密钥和 IV</strong> 仍然是固定使用<strong>字符串</strong>而不是 Base64。</p> <figure><pre class="__s_8 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_0">// 使用Base64编码：</span></span>
<span class="line"><span class="__s_e">echo</span><span class="__s_e"> openssl_encrypt</span><span class="__s_4">(</span><span class="__s_7">'ABCD'</span><span class="__s_4">, </span><span class="__s_7">'AES-128-CBC'</span><span class="__s_4">, </span><span class="__s_7">'0123456789ABCDEF'</span><span class="__s_4">, </span><span class="__s_b">0</span><span class="__s_4">, </span><span class="__s_7">'FEDCBA9876543210'</span><span class="__s_4">); </span><span class="__s_0">// "1Wl2Kg1/0Vh+fJPX+UsJaA=="</span></span>
<span class="line"><span class="__s_e">echo</span><span class="__s_e"> openssl_decrypt</span><span class="__s_4">(</span><span class="__s_7">'1Wl2Kg1/0Vh+fJPX+UsJaA=='</span><span class="__s_4">, </span><span class="__s_7">'AES-128-CBC'</span><span class="__s_4">, </span><span class="__s_7">'0123456789ABCDEF'</span><span class="__s_4">, </span><span class="__s_b">0</span><span class="__s_4">, </span><span class="__s_7">'FEDCBA9876543210'</span><span class="__s_4">); </span><span class="__s_0">// "ABCD"</span></span>
<span class="line"></span>
<span class="line"><span class="__s_0">// 不使用Base64编码：</span></span>
<span class="line"><span class="__s_e">echo</span><span class="__s_e"> bin2hex</span><span class="__s_4">(</span><span class="__s_e">openssl_encrypt</span><span class="__s_4">(</span><span class="__s_7">'ABCD'</span><span class="__s_4">, </span><span class="__s_7">'AES-128-CBC'</span><span class="__s_4">, </span><span class="__s_7">'0123456789ABCDEF'</span><span class="__s_4">, </span><span class="__s_f">OPENSSL_RAW_DATA</span><span class="__s_4">, </span><span class="__s_7">'FEDCBA9876543210'</span><span class="__s_4">)); </span><span class="__s_0">// "d569762a0d7fd1587e7c93d7f94b0968"</span></span>
<span class="line"><span class="__s_e">echo</span><span class="__s_e"> openssl_decrypt</span><span class="__s_4">(</span><span class="__s_e">hex2bin</span><span class="__s_4">(</span><span class="__s_7">'d569762a0d7fd1587e7c93d7f94b0968'</span><span class="__s_4">), </span><span class="__s_7">'AES-128-CBC'</span><span class="__s_4">, </span><span class="__s_7">'0123456789ABCDEF'</span><span class="__s_4">, </span><span class="__s_f">OPENSSL_RAW_DATA</span><span class="__s_4">, </span><span class="__s_7">'FEDCBA9876543210'</span><span class="__s_4">); </span><span class="__s_0">// "ABCD"</span></span></code></pre><code class="language">php</code></figure> <p>前面提到的 CryptoJS 可以在十六进制、Base64 和字符串之间进行转换，而 PHP 这边除了加密时自带的可选的 Base64 编码，也可以直接使用 <code>bin2hex</code> &#x2F; <code>hex2bin</code>、<code>base64_encode</code> &#x2F; <code>base64_decode</code> 这些函数实现数据类型的转换，PHP 的字符串本身也是可以用来存储二进制数据的～</p> <h2 id="phpseclib"><a class="headerlink" href="#phpseclib" title="phpseclib"></a>phpseclib</h2><figure><pre class="__s_8 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_g">composer require phpseclib/phpseclib</span></span></code></pre><code class="language">plaintext</code></figure> <p>OpenSSL 扩展使用的是面向过程的写法，一个函数一个函数地调用，调用一次函数时要把明文 &#x2F; 密文、密钥、加密方式等参数都写一遍，结果是把一行代码弄得很长，参数含义不清晰，比较难看_(:_」∠)_</p> <p>phpseclib 采用了面向对象的写法，加密解密前新建一个对象作为“AES 加密 &#x2F; 解密器”，一次性设定好密钥，就可以直接用来加密 &#x2F; 解密了∠( ᐛ 」∠)_</p> <p>phpseclib 统一使用原始数据也就是字符串进行加密和解密，本身不会进行任何的数据格式转换，需要自己手动调用相关函数。</p> <figure><pre class="__s_8 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_a">require_once</span><span class="__s_h"> __DIR__</span><span class="__s_4"> .</span><span class="__s_7"> '/vendor/autoload.php'</span><span class="__s_4">;</span></span>
<span class="line"></span>
<span class="line"><span class="__s_1">use</span><span class="__s_4"> phpseclib\Crypt\</span><span class="__s_i">AES</span><span class="__s_4">;</span></span>
<span class="line"></span>
<span class="line"><span class="__s_5">$aes</span><span class="__s_4"> = </span><span class="__s_1">new</span><span class="__s_i"> AES</span><span class="__s_4">(</span><span class="__s_i">AES</span><span class="__s_4">::</span><span class="__s_f">MODE_CBC</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_5">$aes</span><span class="__s_4">-></span><span class="__s_6">setKey</span><span class="__s_4">(</span><span class="__s_7">'0123456789ABCDEF'</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_5">$aes</span><span class="__s_4">-></span><span class="__s_6">setIV</span><span class="__s_4">(</span><span class="__s_7">'FEDCBA9876543210'</span><span class="__s_4">);</span></span>
<span class="line"></span>
<span class="line"><span class="__s_e">echo</span><span class="__s_e"> base64_encode</span><span class="__s_4">(</span><span class="__s_5">$aes</span><span class="__s_4">-></span><span class="__s_6">encrypt</span><span class="__s_4">(</span><span class="__s_7">'ABCD'</span><span class="__s_4">)); </span><span class="__s_0">// "1Wl2Kg1/0Vh+fJPX+UsJaA=="</span></span>
<span class="line"><span class="__s_e">echo</span><span class="__s_5"> $aes</span><span class="__s_4">-></span><span class="__s_6">decrypt</span><span class="__s_4">(</span><span class="__s_e">hex2bin</span><span class="__s_4">(</span><span class="__s_7">'d569762a0d7fd1587e7c93d7f94b0968'</span><span class="__s_4">)); </span><span class="__s_0">// "ABCD"</span></span></code></pre><code class="language">php</code></figure> <p>↑这种写法舒服多了(〃′▽&#96;)</p> <h1 id="RSA-非对称加解密"><a class="headerlink" href="#RSA-非对称加解密" title="RSA 非对称加解密"></a>RSA 非对称加解密</h1><h2 id="JSEncrypt"><a class="headerlink" href="#JSEncrypt" title="JSEncrypt"></a>JSEncrypt</h2><p>JSEncrypt 的使用还是比较简单的，生成一对 RSA 公钥和私钥：</p> <figure><pre class="__s_8 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_0">// 钦定使用512位的密钥</span></span>
<span class="line"><span class="__s_1">let</span><span class="__s_2"> rsa</span><span class="__s_3"> =</span><span class="__s_1"> new</span><span class="__s_6"> JSEncrypt</span><span class="__s_4">({</span><span class="__s_5">default_key_size</span><span class="__s_9">:</span><span class="__s_b"> 512</span><span class="__s_4">});</span></span>
<span class="line"></span>
<span class="line"><span class="__s_0">// 随机生成公钥和私钥</span></span>
<span class="line"><span class="__s_0">// 可以填写一个回调函数进行异步操作，不写的话就是同步操作</span></span>
<span class="line"><span class="__s_0">// 异步操作比同步操作明显慢了不少……</span></span>
<span class="line"><span class="__s_2">rsa</span><span class="__s_4">.</span><span class="__s_6">getKey</span><span class="__s_4">(() </span><span class="__s_1">=></span><span class="__s_4"> {</span></span>
<span class="line"><span class="__s_2">    console</span><span class="__s_4">.</span><span class="__s_6">log</span><span class="__s_4">(</span><span class="__s_2">rsa</span><span class="__s_4">.</span><span class="__s_6">getPrivateKey</span><span class="__s_4">());</span></span>
<span class="line"><span class="__s_2">    console</span><span class="__s_4">.</span><span class="__s_6">log</span><span class="__s_4">(</span><span class="__s_2">rsa</span><span class="__s_4">.</span><span class="__s_6">getPublicKey</span><span class="__s_4">());</span></span>
<span class="line"><span class="__s_4">});</span></span></code></pre><code class="language">js</code></figure> <p>生成密钥需要的时间是随着位数增加而指数上升的。生成 512 位密钥一般需要 10-30 ms，1024 位一般需要 100-200 ms，2048 位需要 1000-2000 ms，至于 4096 位……生成一次需要几十秒，浏览器会直接卡死，在前端直接使用的话大概是不行的(っ’-‘)╮</p> <p>JSEncrypt 也支持自己指定密钥，进行加密和解密操作，<strong>密文统一使用 Base64 编码</strong>：</p> <figure><pre class="__s_8 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_0">// 设定公钥并进行加密</span></span>
<span class="line"><span class="__s_2">rsa</span><span class="__s_4">.</span><span class="__s_6">setPublicKey</span><span class="__s_4">(</span><span class="__s_7">`</span></span>
<span class="line"><span class="__s_7">-----BEGIN PUBLIC KEY-----</span></span>
<span class="line"><span class="__s_7">MFswDQYJKoZIhvcNAQEBBQADSgAwRwJAfVNVmlMys1Ur/DHm+Hy+5ZiSYbI1JQWj</span></span>
<span class="line"><span class="__s_7">LjXOWazsdgHA2dhNeb5lyBeoV0jDY4kxbNIqoK8SC0DdqvSbf43uHQIDAQAB</span></span>
<span class="line"><span class="__s_7">-----END PUBLIC KEY-----</span></span>
<span class="line"><span class="__s_7">`</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_2">rsa</span><span class="__s_4">.</span><span class="__s_6">encrypt</span><span class="__s_4">(</span><span class="__s_7">'ABCD'</span><span class="__s_4">); </span><span class="__s_0">// "YqMFMygirIkg4JHmjH7FUk4AeluSWZjsaoHJlm5flyYQtWPdK+se2BF5WAnxKMS9eckSbijXFwFKDBmwTsirqg=="</span></span>
<span class="line"></span>
<span class="line"><span class="__s_0">// 设定私钥并进行解密</span></span>
<span class="line"><span class="__s_2">rsa</span><span class="__s_4">.</span><span class="__s_6">setPrivateKey</span><span class="__s_4">(</span><span class="__s_7">`</span></span>
<span class="line"><span class="__s_7">-----BEGIN RSA PRIVATE KEY-----</span></span>
<span class="line"><span class="__s_7">MIIBOAIBAAJAfVNVmlMys1Ur/DHm+Hy+5ZiSYbI1JQWjLjXOWazsdgHA2dhNeb5l</span></span>
<span class="line"><span class="__s_7">yBeoV0jDY4kxbNIqoK8SC0DdqvSbf43uHQIDAQABAkBh6TZKsE8+/f60NERvw/3c</span></span>
<span class="line"><span class="__s_7">IDvUqcaNWv8mvhCtzMScWB79WA5tj78VDeu+c89S3HVRzwp1IpdaKXwLUeeGlvMB</span></span>
<span class="line"><span class="__s_7">AiEAxl99A8cey501bOFGW/4p6xgePDyGMKCnaxERj7Jn2UECIQChu3wu8fdh3VcY</span></span>
<span class="line"><span class="__s_7">kyVjqu6Q5zAtbdv4N5npX/F7SWYh3QIgb9TRE1ojwEHmJnVxRtcoJoK4ONkeBTfs</span></span>
<span class="line"><span class="__s_7">ae17avj2loECICdI8jY5Ah0cdZ57h5Z5G6/I6FPwnoDhiJo+etq2jn9lAiBAGRen</span></span>
<span class="line"><span class="__s_7">ktqwA3k6arwEpjEj89ZqYiTzIFbCngH1oKbp9A==</span></span>
<span class="line"><span class="__s_7">-----END RSA PRIVATE KEY-----</span></span>
<span class="line"><span class="__s_7">`</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_2">rsa</span><span class="__s_4">.</span><span class="__s_6">decrypt</span><span class="__s_4">(</span><span class="__s_7">'YqMFMygirIkg4JHmjH7FUk4AeluSWZjsaoHJlm5flyYQtWPdK+se2BF5WAnxKMS9eckSbijXFwFKDBmwTsirqg=='</span><span class="__s_4">); </span><span class="__s_0">// "ABCD"</span></span></code></pre><code class="language">js</code></figure> <p>先回想一下 RSA 的基本算法：</p> <ol> <li>取素数 <mjx-container class="MathJax" jax="SVG"><svg width="1.138ex" height="1.439ex" style="vertical-align:-.439ex" viewBox="0 -442 503 636"><use transform="scale(1 -1)" fill="currentColor" stroke="currentColor" stroke-width="0" href="#__m_0"/></svg></mjx-container> 和 <mjx-container class="MathJax" jax="SVG"><svg width="1.041ex" height="1.439ex" style="vertical-align:-.439ex" viewBox="0 -442 460 636"><use transform="scale(1 -1)" fill="currentColor" stroke="currentColor" stroke-width="0" href="#__m_1"/></svg></mjx-container> 。</li> <li>计算 <mjx-container class="MathJax" jax="SVG"><svg width="6.553ex" height="1.758ex" style="vertical-align:-.439ex" viewBox="0 -583 2896.6 777"><g fill="currentColor" stroke="currentColor" stroke-width="0"><use transform="scale(1 -1)" href="#__m_2"/><use transform="matrix(1 0 0 -1 877.8 0)" href="#__m_3"/><use transform="matrix(1 0 0 -1 1933.6 0)" href="#__m_0"/><use transform="matrix(1 0 0 -1 2436.6 0)" href="#__m_1"/></g></svg></mjx-container> ， <mjx-container class="MathJax" jax="SVG"><svg width="21.196ex" height="2.262ex" style="vertical-align:-.566ex" viewBox="0 -750 9368.4 1000"><g fill="currentColor" stroke="currentColor" stroke-width="0"><use transform="scale(1 -1)" href="#__m_4"/><use transform="matrix(1 0 0 -1 596 0)" href="#__m_5"/><use transform="matrix(1 0 0 -1 985 0)" href="#__m_2"/><use transform="matrix(1 0 0 -1 1585 0)" href="#__m_6"/><use transform="matrix(1 0 0 -1 2251.8 0)" href="#__m_3"/><use transform="matrix(1 0 0 -1 3307.6 0)" href="#__m_5"/><use transform="matrix(1 0 0 -1 3696.6 0)" href="#__m_2"/><use transform="matrix(1 0 0 -1 4518.8 0)" href="#__m_7"/><use transform="matrix(1 0 0 -1 5519 0)" href="#__m_8"/><use transform="matrix(1 0 0 -1 6019 0)" href="#__m_6"/><use transform="matrix(1 0 0 -1 6408 0)" href="#__m_5"/><use transform="matrix(1 0 0 -1 6797 0)" href="#__m_1"/><use transform="matrix(1 0 0 -1 7479.2 0)" href="#__m_7"/><use transform="matrix(1 0 0 -1 8479.4 0)" href="#__m_8"/><use transform="matrix(1 0 0 -1 8979.4 0)" href="#__m_6"/></g></svg></mjx-container> 。</li> <li>取整数 <mjx-container class="MathJax" jax="SVG"><svg width="1.054ex" height="1.025ex" style="vertical-align:-.025ex" viewBox="0 -442 466 453"><use transform="scale(1 -1)" fill="currentColor" stroke="currentColor" stroke-width="0" href="#__m_9"/></svg></mjx-container> 满足 <mjx-container class="MathJax" jax="SVG"><svg width="15.67ex" height="2.262ex" style="vertical-align:-.566ex" viewBox="0 -750 6926.2 1000"><g fill="currentColor" stroke="currentColor" stroke-width="0"><use transform="scale(1 -1)" href="#__m_a"/><use transform="matrix(1 0 0 -1 477 0)" href="#__m_b"/><use transform="matrix(1 0 0 -1 910 0)" href="#__m_c"/><use transform="matrix(1 0 0 -1 1430 0)" href="#__m_5"/><use transform="matrix(1 0 0 -1 1819 0)" href="#__m_9"/><use transform="matrix(1 0 0 -1 2285 0)" href="#__m_d"/><use transform="matrix(1 0 0 -1 2729.7 0)" href="#__m_4"/><use transform="matrix(1 0 0 -1 3325.7 0)" href="#__m_5"/><use transform="matrix(1 0 0 -1 3714.7 0)" href="#__m_2"/><use transform="matrix(1 0 0 -1 4314.7 0)" href="#__m_6"/><use transform="matrix(1 0 0 -1 4703.7 0)" href="#__m_6"/><use transform="matrix(1 0 0 -1 5370.4 0)" href="#__m_3"/><use transform="matrix(1 0 0 -1 6426.2 0)" href="#__m_8"/></g></svg></mjx-container> 。</li> <li>计算 <mjx-container class="MathJax" jax="SVG"><svg width="17.477ex" height="2.452ex" style="vertical-align:-.566ex" viewBox="0 -833.9 7724.8 1083.9"><g fill="currentColor" stroke="currentColor" stroke-width="0"><use transform="scale(1 -1)" href="#__m_c"/><use transform="matrix(1 0 0 -1 797.8 0)" href="#__m_3"/><use transform="matrix(1 0 0 -1 1853.6 0)" href="#__m_9"/><use transform="matrix(.707 0 0 -.707 2352.6 -363)" href="#__m_7"/><use transform="matrix(.707 0 0 -.707 2902.646 -363)" href="#__m_8"/><g transform="matrix(1 0 0 -1 3584 0)"><use href="#__m_e"/><use transform="translate(833)" href="#__m_f"/><use transform="translate(1333)" href="#__m_g"/></g><use transform="matrix(1 0 0 -1 5750.8 0)" href="#__m_4"/><use transform="matrix(1 0 0 -1 6346.8 0)" href="#__m_5"/><use transform="matrix(1 0 0 -1 6735.8 0)" href="#__m_2"/><use transform="matrix(1 0 0 -1 7335.8 0)" href="#__m_6"/></g></svg></mjx-container> 。</li> <li>私钥是 <mjx-container class="MathJax" jax="SVG"><svg width="1.176ex" height="1.593ex" style="vertical-align:-.023ex" viewBox="0 -694 520 704"><use transform="scale(1 -1)" fill="currentColor" stroke="currentColor" stroke-width="0" href="#__m_c"/></svg></mjx-container> ，公钥是 <mjx-container class="MathJax" jax="SVG"><svg width="5.178ex" height="2.262ex" style="vertical-align:-.566ex" viewBox="0 -750 2288.7 1000"><g fill="currentColor" stroke="currentColor" stroke-width="0"><use transform="scale(1 -1)" href="#__m_5"/><use transform="matrix(1 0 0 -1 389 0)" href="#__m_9"/><use transform="matrix(1 0 0 -1 855 0)" href="#__m_d"/><use transform="matrix(1 0 0 -1 1299.7 0)" href="#__m_2"/><use transform="matrix(1 0 0 -1 1899.7 0)" href="#__m_6"/></g></svg></mjx-container> 。</li> <li>加密： <mjx-container class="MathJax" jax="SVG"><svg width="13.805ex" height="1.756ex" style="vertical-align:-.186ex" viewBox="0 -694 6101.6 776"><g fill="currentColor" stroke="currentColor" stroke-width="0"><use transform="scale(1 -1)" href="#__m_b"/><use transform="matrix(1 0 0 -1 710.8 0)" href="#__m_3"/><use transform="matrix(1 0 0 -1 1766.6 0)" href="#__m_h"/><use transform="matrix(.707 0 0 -.707 2677.6 -363)" href="#__m_9"/><g transform="matrix(1 0 0 -1 3334.8 0)"><use href="#__m_e"/><use transform="translate(833)" href="#__m_f"/><use transform="translate(1333)" href="#__m_g"/></g><use transform="matrix(1 0 0 -1 5501.6 0)" href="#__m_2"/></g></svg></mjx-container> ，解密： <mjx-container class="MathJax" jax="SVG"><svg width="13.891ex" height="2.117ex" style="vertical-align:-.186ex" viewBox="0 -853.7 6139.8 935.7"><g fill="currentColor" stroke="currentColor" stroke-width="0"><use transform="scale(1 -1)" href="#__m_h"/><use transform="matrix(1 0 0 -1 1155.8 0)" href="#__m_3"/><use transform="matrix(1 0 0 -1 2211.6 0)" href="#__m_b"/><use transform="matrix(.707 0 0 -.707 2677.6 -363)" href="#__m_c"/><g transform="matrix(1 0 0 -1 3373 0)"><use href="#__m_e"/><use transform="translate(833)" href="#__m_f"/><use transform="translate(1333)" href="#__m_g"/></g><use transform="matrix(1 0 0 -1 5539.8 0)" href="#__m_2"/></g></svg></mjx-container> 。</li> </ol> <p>RSA 算法的保密性取决于将 <mjx-container class="MathJax" jax="SVG"><svg width="1.357ex" height="1.025ex" style="vertical-align:-.025ex" viewBox="0 -442 600 453"><use transform="scale(1 -1)" fill="currentColor" stroke="currentColor" stroke-width="0" href="#__m_2"/></svg></mjx-container> 分解成 <mjx-container class="MathJax" jax="SVG"><svg width="1.138ex" height="1.439ex" style="vertical-align:-.439ex" viewBox="0 -442 503 636"><use transform="scale(1 -1)" fill="currentColor" stroke="currentColor" stroke-width="0" href="#__m_0"/></svg></mjx-container> 和 <mjx-container class="MathJax" jax="SVG"><svg width="1.041ex" height="1.439ex" style="vertical-align:-.439ex" viewBox="0 -442 460 636"><use transform="scale(1 -1)" fill="currentColor" stroke="currentColor" stroke-width="0" href="#__m_1"/></svg></mjx-container> 的难度，不过根据<a href="https://en.wikipedia.org/wiki/RSA_numbers#RSA-240" rel="noopener" target="_blank">维基百科上的记录</a>，在 2019 年已经有了 795 位的数被分解的记录，目前的主流是使用至少 1024 位的密钥，不过这里作为测试就还是使用 512 位的密钥了～</p> <p>这种以一行“BEGIN”和“END”的分割线标记开始和结束、正文使用 Base64 编码的 RSA 密钥格式就是 PEM 格式（私钥又分为 PKCS#1 和 PKCS#8 两种标准，分别以 <code>BEGIN RSA PRIVATE KEY</code> 和 <code>BEGIN PRIVATE KEY</code> 开头）。虽然按照上面的算法，私钥涉及到的参数比公钥少，但是 PEM 格式中私钥的长度反而比公钥长了很多，这是因为这里的“私钥”实际上还包含了上面涉及到的几乎所有参数（其中就包括 <mjx-container class="MathJax" jax="SVG"><svg width="1.054ex" height="1.025ex" style="vertical-align:-.025ex" viewBox="0 -442 466 453"><use transform="scale(1 -1)" fill="currentColor" stroke="currentColor" stroke-width="0" href="#__m_9"/></svg></mjx-container> 和 <mjx-container class="MathJax" jax="SVG"><svg width="1.357ex" height="1.025ex" style="vertical-align:-.025ex" viewBox="0 -442 600 453"><use transform="scale(1 -1)" fill="currentColor" stroke="currentColor" stroke-width="0" href="#__m_2"/></svg></mjx-container> ），因此完全可以从私钥中直接“提取”出公钥，设定了私钥则既可以加密也可以解密，但设定了公钥就只能进行加密。</p> <p>由于 RSA 加密的使用的填充方案在密文中添加了一些随机数，所以即使是同样的密钥加密同样的明文，得到的密文也会不同。</p> <h2 id="OpenSSL-1"><a class="headerlink" href="#OpenSSL-1" title="OpenSSL"></a>OpenSSL</h2><p>和前面的 AES 加密一样，使用 OpenSSL 扩展弄 RSA 加密也是有点麻烦 ┐(´-｀)┌</p> <p>使用 OpenSSL 时，一般也是先生成私钥，再根据私钥提取出公钥。对应到 PHP 这边就是使用 <a href="https://www.php.net/manual/zh/function.openssl-pkey-new.php" rel="noopener" target="_blank"><code>openssl_pkey_new</code></a> 和 <a href="https://www.php.net/manual/zh/function.openssl-pkey-export.php" rel="noopener" target="_blank"><code>openssl_pkey_export</code></a> 两个函数：</p> <figure><pre class="__s_8 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_5">$res</span><span class="__s_4"> = </span><span class="__s_e">openssl_pkey_new</span><span class="__s_4">([</span></span>
<span class="line"><span class="__s_7">    'config'</span><span class="__s_4"> => </span><span class="__s_e">realpath</span><span class="__s_4">(</span><span class="__s_7">'./openssl.cnf'</span><span class="__s_4">),</span></span>
<span class="line"><span class="__s_7">    'private_key_bits'</span><span class="__s_4"> => </span><span class="__s_b">512</span><span class="__s_4">,</span></span>
<span class="line"><span class="__s_7">    'private_key_type'</span><span class="__s_4"> => </span><span class="__s_f">OPENSSL_KEYTYPE_RSA</span><span class="__s_4">,</span></span>
<span class="line"><span class="__s_4">]);</span></span>
<span class="line"><span class="__s_e">openssl_pkey_export</span><span class="__s_4">(</span><span class="__s_5">$res</span><span class="__s_4">, </span><span class="__s_5">$private_key</span><span class="__s_4">, </span><span class="__s_h">null</span><span class="__s_4">, [</span></span>
<span class="line"><span class="__s_7">    'config'</span><span class="__s_4"> => </span><span class="__s_e">realpath</span><span class="__s_4">(</span><span class="__s_7">'./openssl.cnf'</span><span class="__s_4">),</span></span>
<span class="line"><span class="__s_4">]);</span></span>
<span class="line"><span class="__s_5">$public_key</span><span class="__s_4"> = </span><span class="__s_e">openssl_pkey_get_details</span><span class="__s_4">(</span><span class="__s_5">$res</span><span class="__s_4">)[</span><span class="__s_7">'key'</span><span class="__s_4">];</span></span></code></pre><code class="language">php</code></figure> <p>这段代码看上去没什么问题，但是官方文档提示“必须安装有效的 <code>openssl.cnf</code> 以保证此函数正确运行”。为什么生成一个 RSA 密钥还需要<strong>额外的配置文件</strong>？为什么获取私钥是<strong>将私钥写入参数中指定的引用的变量</strong>，但是获取公钥（和其他 RSA 算法中涉及到的参数）又使用了<strong>返回关联数组</strong>的形式？这种写法有点特别啊……</p> <p>Linux 平台上 OpenSSL 本身就是标配，所以 PHP 可以根据环境变量找到 <code>openssl.cnf</code>。Windows 版的 PHP 也自带了一个 <code>openssl.cnf</code>，但是如果不配置环境变量的话就需要手动指定路径了（也就是上面的 <code>config</code> ）。</p> <p>OpenSSL 的加密和解密中的<strong>密文同样是统一使用字符串</strong>，有需要的话可以自己另外使用 Base64 编码 &#x2F; 解码。然而进行 RSA 加密和解密也是使用了“写入参数中指定的引用变量”的形式，和前面的使用返回值的 AES 加密解密也不一样：</p> <figure><pre class="__s_8 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_0">// 设定公钥并进行加密</span></span>
<span class="line"><span class="__s_5">$public_key</span><span class="__s_4"> = </span><span class="__s_7">&#x3C;&#x3C;&#x3C; </span><span class="__s_4">KEY</span></span>
<span class="line"><span class="__s_7">-----BEGIN PUBLIC KEY-----</span></span>
<span class="line"><span class="__s_7">MFswDQYJKoZIhvcNAQEBBQADSgAwRwJAfVNVmlMys1Ur/DHm+Hy+5ZiSYbI1JQWj</span></span>
<span class="line"><span class="__s_7">LjXOWazsdgHA2dhNeb5lyBeoV0jDY4kxbNIqoK8SC0DdqvSbf43uHQIDAQAB</span></span>
<span class="line"><span class="__s_7">-----END PUBLIC KEY-----</span></span>
<span class="line"><span class="__s_4">KEY</span><span class="__s_4">;</span></span>
<span class="line"><span class="__s_e">openssl_public_encrypt</span><span class="__s_4">(</span><span class="__s_7">'ABCD'</span><span class="__s_4">, </span><span class="__s_5">$encrypted</span><span class="__s_4">, </span><span class="__s_5">$public_key</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_e">echo</span><span class="__s_e"> base64_encode</span><span class="__s_4">(</span><span class="__s_5">$encrypted</span><span class="__s_4">); </span><span class="__s_0">// "YqMFMygirIkg4JHmjH7FUk4AeluSWZjsaoHJlm5flyYQtWPdK+se2BF5WAnxKMS9eckSbijXFwFKDBmwTsirqg=="</span></span>
<span class="line"></span>
<span class="line"><span class="__s_0">// 设定私钥并进行解密</span></span>
<span class="line"><span class="__s_5">$private_key</span><span class="__s_4"> = </span><span class="__s_7">&#x3C;&#x3C;&#x3C; </span><span class="__s_4">KEY</span></span>
<span class="line"><span class="__s_7">-----BEGIN RSA PRIVATE KEY-----</span></span>
<span class="line"><span class="__s_7">MIIBOAIBAAJAfVNVmlMys1Ur/DHm+Hy+5ZiSYbI1JQWjLjXOWazsdgHA2dhNeb5l</span></span>
<span class="line"><span class="__s_7">yBeoV0jDY4kxbNIqoK8SC0DdqvSbf43uHQIDAQABAkBh6TZKsE8+/f60NERvw/3c</span></span>
<span class="line"><span class="__s_7">IDvUqcaNWv8mvhCtzMScWB79WA5tj78VDeu+c89S3HVRzwp1IpdaKXwLUeeGlvMB</span></span>
<span class="line"><span class="__s_7">AiEAxl99A8cey501bOFGW/4p6xgePDyGMKCnaxERj7Jn2UECIQChu3wu8fdh3VcY</span></span>
<span class="line"><span class="__s_7">kyVjqu6Q5zAtbdv4N5npX/F7SWYh3QIgb9TRE1ojwEHmJnVxRtcoJoK4ONkeBTfs</span></span>
<span class="line"><span class="__s_7">ae17avj2loECICdI8jY5Ah0cdZ57h5Z5G6/I6FPwnoDhiJo+etq2jn9lAiBAGRen</span></span>
<span class="line"><span class="__s_7">ktqwA3k6arwEpjEj89ZqYiTzIFbCngH1oKbp9A==</span></span>
<span class="line"><span class="__s_7">-----END RSA PRIVATE KEY-----</span></span>
<span class="line"><span class="__s_4">KEY</span><span class="__s_4">;</span></span>
<span class="line"><span class="__s_e">openssl_private_decrypt</span><span class="__s_4">(</span><span class="__s_e">base64_decode</span><span class="__s_4">(</span><span class="__s_7">'YqMFMygirIkg4JHmjH7FUk4AeluSWZjsaoHJlm5flyYQtWPdK+se2BF5WAnxKMS9eckSbijXFwFKDBmwTsirqg=='</span><span class="__s_4">), </span><span class="__s_5">$decrypted</span><span class="__s_4">, </span><span class="__s_5">$private_key</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_e">echo</span><span class="__s_5"> $decrypted</span><span class="__s_4">; </span><span class="__s_0">// "ABCD"</span></span></code></pre><code class="language">php</code></figure> <h2 id="phpseclib-1"><a class="headerlink" href="#phpseclib-1" title="phpseclib"></a>phpseclib</h2><p>由于使用了面向对象的写法，使用 phpseclib 的代码仍然是看上去非常舒服，非常清晰……至少不会有“把函数执行的结果写入参数中指定的引用变量”这种特别的写法了|•’-‘•)</p> <p>生成密钥：</p> <figure><pre class="__s_8 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_a">require_once</span><span class="__s_h"> __DIR__</span><span class="__s_4"> .</span><span class="__s_7"> '/vendor/autoload.php'</span><span class="__s_4">;</span></span>
<span class="line"></span>
<span class="line"><span class="__s_1">use</span><span class="__s_4"> phpseclib\Crypt\</span><span class="__s_i">RSA</span><span class="__s_4">;</span></span>
<span class="line"></span>
<span class="line"><span class="__s_5">$rsa</span><span class="__s_4"> = </span><span class="__s_1">new</span><span class="__s_i"> RSA</span><span class="__s_4">();</span></span>
<span class="line"><span class="__s_5">$rsakey</span><span class="__s_4"> = </span><span class="__s_5">$rsa</span><span class="__s_4">-></span><span class="__s_6">createKey</span><span class="__s_4">(</span><span class="__s_b">512</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_e">echo</span><span class="__s_5"> $rsakey</span><span class="__s_4">[</span><span class="__s_7">'privatekey'</span><span class="__s_4">];</span></span>
<span class="line"><span class="__s_e">echo</span><span class="__s_5"> $rsakey</span><span class="__s_4">[</span><span class="__s_7">'publickey'</span><span class="__s_4">];</span></span></code></pre><code class="language">php</code></figure> <p>加密和解密：</p> <figure><pre class="__s_8 dark-plus one-light shiki shiki-themes" tabindex="0"><code><span class="line"><span class="__s_a">require_once</span><span class="__s_h"> __DIR__</span><span class="__s_4"> .</span><span class="__s_7"> '/vendor/autoload.php'</span><span class="__s_4">;</span></span>
<span class="line"></span>
<span class="line"><span class="__s_1">use</span><span class="__s_4"> phpseclib\Crypt\</span><span class="__s_i">RSA</span><span class="__s_4">;</span></span>
<span class="line"></span>
<span class="line"><span class="__s_5">$rsa</span><span class="__s_4"> = </span><span class="__s_1">new</span><span class="__s_i"> RSA</span><span class="__s_4">();</span></span>
<span class="line"><span class="__s_5">$rsa</span><span class="__s_4">-></span><span class="__s_6">setEncryptionMode</span><span class="__s_4">(</span><span class="__s_i">RSA</span><span class="__s_4">::</span><span class="__s_f">ENCRYPTION_PKCS1</span><span class="__s_4">);</span></span>
<span class="line"></span>
<span class="line"><span class="__s_0">// 设定公钥并进行加密</span></span>
<span class="line"><span class="__s_5">$public_key</span><span class="__s_4"> = </span><span class="__s_7">&#x3C;&#x3C;&#x3C; </span><span class="__s_4">KEY</span></span>
<span class="line"><span class="__s_7">-----BEGIN PUBLIC KEY-----</span></span>
<span class="line"><span class="__s_7">MFswDQYJKoZIhvcNAQEBBQADSgAwRwJAfVNVmlMys1Ur/DHm+Hy+5ZiSYbI1JQWj</span></span>
<span class="line"><span class="__s_7">LjXOWazsdgHA2dhNeb5lyBeoV0jDY4kxbNIqoK8SC0DdqvSbf43uHQIDAQAB</span></span>
<span class="line"><span class="__s_7">-----END PUBLIC KEY-----</span></span>
<span class="line"><span class="__s_4">KEY</span><span class="__s_4">;</span></span>
<span class="line"><span class="__s_5">$rsa</span><span class="__s_4">-></span><span class="__s_6">loadKey</span><span class="__s_4">(</span><span class="__s_5">$public_key</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_e">echo</span><span class="__s_e"> base64_encode</span><span class="__s_4">(</span><span class="__s_5">$rsa</span><span class="__s_4">-></span><span class="__s_6">encrypt</span><span class="__s_4">(</span><span class="__s_7">'ABCD'</span><span class="__s_4">)); </span><span class="__s_0">// "YqMFMygirIkg4JHmjH7FUk4AeluSWZjsaoHJlm5flyYQtWPdK+se2BF5WAnxKMS9eckSbijXFwFKDBmwTsirqg=="</span></span>
<span class="line"></span>
<span class="line"><span class="__s_0">// 设定私钥并进行解密</span></span>
<span class="line"><span class="__s_5">$private_key</span><span class="__s_4"> = </span><span class="__s_7">&#x3C;&#x3C;&#x3C; </span><span class="__s_4">KEY</span></span>
<span class="line"><span class="__s_7">-----BEGIN RSA PRIVATE KEY-----</span></span>
<span class="line"><span class="__s_7">MIIBOAIBAAJAfVNVmlMys1Ur/DHm+Hy+5ZiSYbI1JQWjLjXOWazsdgHA2dhNeb5l</span></span>
<span class="line"><span class="__s_7">yBeoV0jDY4kxbNIqoK8SC0DdqvSbf43uHQIDAQABAkBh6TZKsE8+/f60NERvw/3c</span></span>
<span class="line"><span class="__s_7">IDvUqcaNWv8mvhCtzMScWB79WA5tj78VDeu+c89S3HVRzwp1IpdaKXwLUeeGlvMB</span></span>
<span class="line"><span class="__s_7">AiEAxl99A8cey501bOFGW/4p6xgePDyGMKCnaxERj7Jn2UECIQChu3wu8fdh3VcY</span></span>
<span class="line"><span class="__s_7">kyVjqu6Q5zAtbdv4N5npX/F7SWYh3QIgb9TRE1ojwEHmJnVxRtcoJoK4ONkeBTfs</span></span>
<span class="line"><span class="__s_7">ae17avj2loECICdI8jY5Ah0cdZ57h5Z5G6/I6FPwnoDhiJo+etq2jn9lAiBAGRen</span></span>
<span class="line"><span class="__s_7">ktqwA3k6arwEpjEj89ZqYiTzIFbCngH1oKbp9A==</span></span>
<span class="line"><span class="__s_7">-----END RSA PRIVATE KEY-----</span></span>
<span class="line"><span class="__s_4">KEY</span><span class="__s_4">;</span></span>
<span class="line"><span class="__s_5">$rsa</span><span class="__s_4">-></span><span class="__s_6">loadKey</span><span class="__s_4">(</span><span class="__s_5">$private_key</span><span class="__s_4">);</span></span>
<span class="line"><span class="__s_e">echo</span><span class="__s_5"> $rsa</span><span class="__s_4">-></span><span class="__s_6">decrypt</span><span class="__s_4">(</span><span class="__s_e">base64_decode</span><span class="__s_4">(</span><span class="__s_7">'YqMFMygirIkg4JHmjH7FUk4AeluSWZjsaoHJlm5flyYQtWPdK+se2BF5WAnxKMS9eckSbijXFwFKDBmwTsirqg=='</span><span class="__s_4">)); </span><span class="__s_0">// "ABCD"</span></span></code></pre><code class="language">php</code></figure> <blockquote class="mdui-m-b-0 mdui-m-x-0 mdui-p-y-1" style="border-left:4px solid #0000005c"> <strong>本作品采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。不允许内容农场类网站、CSDN 用户和微信公众号转载，也不允许被自动抓取用于生成式 AI 相关服务。</strong> <br> <strong>本文作者：✨小透明・宸✨</strong> <br> <strong>本文链接：<a href="https://akarin.dev/2020/02/26/crypto-in-js-and-php/">https://akarin.dev/2020/02/26/crypto-in-js-and-php/</a></strong> </blockquote> </article> <div class="mdui-p-b-3 mdui-p-x-3 mdui-typo" id="artalk-container" style="box-sizing:border-box"></div> <script>document.documentMode&&(location.href="../../../../upgrade-browser.html"),window.switchDark=e=>{let t={auto:"mdui-theme-layout-auto",enable:"mdui-theme-layout-dark",disable:""};for(let a in(e=e||localStorage.getItem("dark"))in t||(e="auto"),t)t[a]&&document.body.classList[a===e?"add":"remove"](t[a]);localStorage.setItem("dark",e)},switchDark(),(()=>{let e=document.createElement("link");e.rel="stylesheet",e.href="https://cdn.jsdelivr.net/npm/artalk@2/dist/Artalk.css";let t=document.createElement("style");t.innerHTML=".atk-comment > .atk-main > .atk-body img:not([atk-emoticon]){max-height:160px}"+[["pink","#ff4081","#ff80ab"]].map(([e,t,a])=>`.mdui-theme-accent-${e} .artalk,.mdui-theme-accent-${e} .artalk-layer-wrap,.mdui-theme-accent-${e} .artalk.atk-dark-mode,.mdui-theme-accent-${e} .artalk-layer-wrap.atk-dark-mode{--at-color-main:${t};--at-color-light:${a}}`).join("");let a=document.createElement("script");a.src="https://cdn.jsdelivr.net/npm/artalk@2/dist/Artalk.js",a.async=!0,a.onload=()=>{Artalk.use(e=>{let t=0,a={},n=(e,n)=>{let r=`__atk_tex_id_${t++}__`;return a[r]={tex:e,isBlock:n},r},r={name:"blockMath",level:"block",tokenizer(e){let t=/^(?:\s{0,3})\$\$((?:[^\n]|\n[^\n])+?)\n{0,1}\$\$/.exec(e);if(t)return{type:"html",raw:t[0],text:n(t[1],!0)}}},l={name:"inlineMath",level:"inline",start(e){let t=e.search(/\$.*?\$/);return -1!==t?t:e.length},tokenizer(e){let t=/^\$(.*?)\$/.exec(e);if(t)return{type:"html",raw:t[0],text:n(t[1],!1)}}};e.on("mounted",()=>{e.getMarked().use({extensions:[r,l]}),e.updateConf({markedReplacers:[e=>e=e.replace(/(__atk_tex_id_\d+__)/g,(e,t)=>{let{tex:n,isBlock:r}=a[t];delete a[t];let l=`https://www.zhihu.com/equation?tex=${encodeURIComponent(n)}`;return r?`<p style="text-align:center"><img src="${l}"></p>`:`<img style="vertical-align:middle" src="${l}">`})]})})}),Artalk.use(e=>e.on("list-loaded",()=>e.getCommentNodes().forEach(e=>Array.from(e.getRender().$content.querySelectorAll("img:not([atk-emoticon])")).forEach(e=>{e.classList.add("mdui-img-rounded"),mediumZoom(e,{margin:16,scrollOffset:8,background:"rgba(0,0,0,.85)"})})))),Artalk.init({el:"#artalk-container",server:"https://comment.akarin.dev",site:"存在感消失的地方|ω•`)"})},document.head.appendChild(e),document.head.appendChild(t),document.body.appendChild(a)})();</script> </div>  <div class="mdui-m-t-2 mdui-valign"> <a class="mdui-btn mdui-btn-icon mdui-ripple" href="../../../03/26/intersection-observer/"> <span class="material-icons mdui-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_c"></use></svg></span> </a> <span class="mdui-m-l-1 mdui-text-left mdui-typo-body-1-opacity" title="用 Intersection Observer 来自己造个图片懒加载的轮子₍₍ (ง ˙ω˙)ว ⁾⁾">上一篇</span> <span class="mdui-text-center mdui-typo-body-1-opacity" style="flex-grow:1"> </span> <span class="mdui-m-r-1 mdui-text-right mdui-typo-body-1-opacity" title="搞事情：用“图床”传视频，自带免费 CDN 加速（已失效，科普向）">下一篇</span> <a class="mdui-btn mdui-btn-icon mdui-ripple" href="../../07/alicdn-video-hosting/"> <span class="material-icons mdui-icon"><svg viewbox="0 0 24 24"><use xlink:href="#__i_d"></use></svg></span> </a> </div> </main>  <footer class="mdui-container mdui-m-y-5 mdui-typo" style="max-width:1024px;display:flex"> <div class="mdui-text-left mdui-typo-body-1-opacity"> Copyright © 2026 ✨小透明・宸✨ <br> Hosted by <a href="https://github.com/TransparentLC/transparentlc.github.io" target="_blank">GitHub Pages</a> </div> <div style="flex-grow:1"></div> <div class="mdui-text-right mdui-typo-body-1-opacity"> Powered by <a href="https://hexo.io" target="_blank">Hexo</a> <span class="mdui-hidden-xs-down">8.1.1</span> <br> Theme - <a href="https://github.com/TransparentLC/hexo-theme-akarin" target="_blank">Akarin</a> </div> </footer>  <script src="https://cdn.jsdelivr.net/combine/gh/TransparentLC/transparentlc.github.io@d890fff5e3f54d08eeb80c40baa290c0b2bfffb6/js/mdui.min.js,npm/medium-zoom@1/dist/medium-zoom.min.js,npm/instant.page@5/instantpage.min.js,gh/TransparentLC/transparentlc.github.io@d890fff5e3f54d08eeb80c40baa290c0b2bfffb6/js/script.min.js"></script> <script defer src="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/js/bsz.min.js"></script> </body></html>