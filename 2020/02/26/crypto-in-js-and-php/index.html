<!doctype html><html lang="zh-Hans"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no" name="viewport"><meta content="webkit" name="renderer"><meta content="webkit" name="force-rendering"><meta content="✨小透明・宸✨" name="author"><meta content="" name="keywords"><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"><link href="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png" rel="icon shortcut" type="image/ico"><link href="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png" rel="icon"><link href="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png" rel="apple-touch-icon"><link href="/atom.xml" rel="alternate" type="application/atom+xml"><title>在 Javascript 和 PHP 中进行加密和解密 | 存在感消失的地方|ω•`)</title><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://akarin.dev/2020/02/26/crypto-in-js-and-php/"},"headline":"在 Javascript 和 PHP 中进行加密和解密","datePublished":"2020-02-26T14:09:56.000Z","dateModified":"2020-02-26T14:09:56.000Z","author":{"@type":"Person","name":"✨小透明・宸✨","image":{"@type":"ImageObject","url":"https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg"},"description":"身处寒夜 把握星光✨"},"publisher":{"@type":"Organization","name":"存在感消失的地方|ω•`)","logo":"https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png"},"keywords":"","description":"学了一学期的（入门）密码学，不自己试着用一下怎么行嘛(´･_･`)"}</script><meta content="存在感消失的地方|ω•`)" property="og:site_name"><meta content="在 Javascript 和 PHP 中进行加密和解密" property="og:title"><meta content="学了一学期的（入门）密码学，不自己试着用一下怎么行嘛(´･_･`)" property="og:description"><meta content="article" property="og:type"><meta content="https://akarin.dev/2020/02/26/crypto-in-js-and-php/" property="og:url"><meta content="https://ae01.alicdn.com/kf/H9ffbbb6a89044b398aa6ec9cd9de2bfb4.jpg" property="og:image"><meta content="2020-02-26T14:09:56.000Z" property="article:published_time"><meta content="2020-02-26T14:09:56.000Z" property="article:modified_time"><meta content="✨小透明・宸✨" property="article:author"><script>document.documentMode&&(location.href="../../../../upgrade-browser.html")</script><script>document.addEventListener("WeixinJSBridgeReady",(()=>{const e=document.createElement("script");e.src="https://fastly.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/js/fuck-wechat.min.js",document.body.appendChild(e)}))</script><link href="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/css/mdui.min.css" rel="stylesheet"><link href="https://gcore.jsdelivr.net/combine/npm/prismjs@1/plugins/line-numbers/prism-line-numbers.min.css,npm/prism-themes@1/themes/prism-vsc-dark-plus.min.css,npm/aplayer@1/dist/APlayer.min.css,gh/TransparentLC/transparentlc.github.io@da8e973/css/style.min.css" rel="stylesheet"><style>*{--sidebar-image:url(https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/sidebar_header.jpg);--sidebar-image-color:#958981;--banner-image:url(https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/daily_pic.png);--banner-image-color:#f09ea3;--post-thumbnail-color:#f09ea3;--copy-code-btn-color:#fff}</style><meta content="Hexo 6.2.0" name="generator"></head><body class="mdui-drawer-body-left mdui-theme-accent-pink mdui-theme-primary-pink"><script>window.switchDark=t=>{const a={auto:"mdui-theme-layout-auto",enable:"mdui-theme-layout-dark",disable:""};(t=t||localStorage.getItem("dark"))in a||(t="auto");for(const e in a)a[e]&&document.body.classList[e===t?"add":"remove"](a[e]);localStorage.setItem("dark",t)},switchDark()</script><button class="mdui-fab mdui-m-a-2 mdui-shadow-0 mdui-text-color-grey-700" mdui-drawer="{target:'#akarin-drawer'}" style="position:fixed;z-index:1"><i class="material-icons mdui-icon">menu</i></button><nav class="mdui-drawer mdui-drawer-full-height mdui-shadow-6" id="akarin-drawer"><div class="akarin-util-bg-cover mdui-p-x-2" id="akarin-drawer-media"><img class="akarin-hover-spin mdui-img-circle mdui-m-t-4" src="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg" id="akarin-drawer-avatar"><div class="akarin-util-text-gradient mdui-card-media-covered"><div class="mdui-card-primary"><div class="mdui-typo-subheading">✨小透明・宸✨</div><div class="akarin-util-opacity-half mdui-typo-caption">存在感消失的地方|ω•`)</div></div></div></div><div class="mdui-list" mdui-collapse><div><a href="../../../../" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">home</i> <span class="mdui-list-item-content">主页</span></a></div><div><a href="../../../../about/" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">person</i> <span class="mdui-list-item-content">关于</span></a></div><div><a href="../../../../friend/" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">link</i> <span class="mdui-list-item-content">友链</span></a></div><div><a href="https://github.com/TransparentLC" target="_blank" rel="noopener" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">code</i> <span class="mdui-list-item-content">GitHub</span></a></div><div><a href="../../../../archives/" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">collections_bookmark</i> <span class="mdui-list-item-content">归档</span> <small class="akarin-drawer-badge mdui-color-theme-accent">32</small></a></div><div><a href="../../../../atom.xml" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">rss_feed</i> <span class="mdui-list-item-content">RSS</span></a></div><div class="mdui-divider"></div><div class="mdui-collapse-item mdui-collapse-item-open"><div class="mdui-ripple mdui-list-item mdui-collapse-item-header"><i class="material-icons mdui-icon mdui-list-item-icon">brightness_4</i> <span class="mdui-list-item-content">深色模式</span> <i class="material-icons mdui-icon mdui-collapse-item-arrow">keyboard_arrow_down</i></div><div class="mdui-list mdui-collapse-item-body"><div class="mdui-ripple mdui-list-item" data-dark="auto"><span class="mdui-list-item-content">根据系统主题切换</span></div><div class="mdui-ripple mdui-list-item" data-dark="enable"><span class="mdui-list-item-content">启用</span></div><div class="mdui-ripple mdui-list-item" data-dark="disable"><span class="mdui-list-item-content">禁用</span></div></div></div><div class="mdui-collapse-item mdui-collapse-item-open"><div class="mdui-ripple mdui-list-item mdui-collapse-item-header"><i class="material-icons mdui-icon mdui-list-item-icon">insert_chart</i> <span class="mdui-list-item-content">访问统计</span> <i class="material-icons mdui-icon mdui-collapse-item-arrow">keyboard_arrow_down</i></div><div class="mdui-list mdui-collapse-item-body"><div class="mdui-ripple mdui-list-item"><span class="mdui-list-item-content">站点访问量</span> <small class="akarin-drawer-badge mdui-color-theme-accent" id="busuanzi_value_site_pv">Loading</small></div><div class="mdui-ripple mdui-list-item"><span class="mdui-list-item-content">站点访客数</span> <small class="akarin-drawer-badge mdui-color-theme-accent" id="busuanzi_value_site_uv">Loading</small></div><div class="mdui-ripple mdui-list-item"><span class="mdui-list-item-content">页面访问量</span> <small class="akarin-drawer-badge mdui-color-theme-accent" id="busuanzi_value_page_pv">Loading</small></div></div></div></div></nav><picture id="akarin-top" title="返回顶部"><source srcset="https://fastly.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/top.avif" type="image/avif"><source srcset="https://fastly.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/top.webp" type="image/webp"><img src="https://fastly.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/top.png"></picture><div style="padding-top:20px"></div><div class="mdui-hidden-sm-down" style="padding-top:40px"></div><div class="mdui-hidden-md-down" style="padding-top:40px"></div><main class="mdui-container" style="max-width:1024px"><div class="akarin-util-rounded-5 mdui-card mdui-shadow-4"><div class="mdui-ripple akarin-post-bg akarin-util-bg-cover" data-src="https://ae01.alicdn.com/kf/H9ffbbb6a89044b398aa6ec9cd9de2bfb4.jpg" data-src-avif="https://vfile.meituan.net/mmdb/1b1f1958fbd8d0cd78f0e3b2e2d4ded323497.jpg" data-src-webp="https://ae01.alicdn.com/kf/Hc8a25c3090c54671aedfc658a11e0ecaz.jpg"><div class="akarin-blurred akarin-post-bg akarin-util-bg-cover" style="background-image:url(data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCAAwAEADASIAAhEBAxEB/8QAGwAAAwEAAwEAAAAAAAAAAAAAAwQFBgABAgf/xAArEAACAQMEAQMDBAMAAAAAAAABAgMABBEFEiExExRBYSKBkTJCUXEGYrH/xAAYAQADAQEAAAAAAAAAAAAAAAACAwQFAP/EACURAAICAQMDBAMAAAAAAAAAAAECAxEABBIhIkFhBRMxUSMycf/aAAwDAQACEQMRAD8A+k1rbO+hhsYfUzKrYOAeyKQ1mC1tIg8cQEjtxzx+Kyrbn5Ykt7mnavWI6qqqbHPOJ9K9IlRnlkkG0igF75tPW20pLLMuPnj/ALWf1PS5NUuUM8/jghbMXhyJDkDJZqFZIrzJHI30jLbfmrjyRruw2SO6xwnWXJsnNV4xC9KSeMg3X+OWl1tMt1eM6/pczFiPzW0s52dAsm3yDvaMA1JaWJM5DHuiLMiFHXrdTo22HxinBcVz4yndXSwADGWPQoVtqXlkCSKBnoiutRt3m2yRjdgYIpCC3kWRXdSoU55rQ/GIyzEChnKkJhJJ6sjapcma5dpFbYMeP+KmI0spIiQcD27q3c2RuYti9/tPXJrM6ba+ruQjzyQ3UDHGOmQ9/epJYwJf24OaKSKsNJXTWEunmso4J/DJlywJHsw5X7tVeKPU5ry2nUBYclZIzjK8gkmtO0alCCuanRT+O+kixkM3B+QorlCoV6bvjIZJTKp7Ec4LVdL9XFF4pBG8b5BIyOiOvjsV4MRSEQx7nCHBJ7I9zTKu3nLeoLgE/RgiiQ790pwN2T30K4gvtXbXOLFIN2+xQ/mG0nUtyeCc4dThWPTU/OfqA+Kzgf07MGj3hu1PXwQaqWk3qEOzOU7Ru/saGWKZ9O4AvaReJeSISqLosLH0cduIfxUeXRbJ5HvULpcKwbg8Z9z969apqM/qGhjYqicce9ct7kzRBv3qCj/NWtp2Co5AIY5NFrlaWWJGYFQbPY4ZDK4I8hFLIjJfxORnxBjjrPFGjkKOVB/2A/uiyhZBuH6gKF4xY4+DlEbk7gDyRiN47xQPcRjLxAvj+QOSKY3phpEYFHAcEV0MtuVlwcdf3UiwzE97p7dwSCSP5jlyw/Bo2q1YYuMbtyNlMh3XlMg03pMe25mJyCU4Fe9mVBFFjUgg9EULOT8cYfsoF+6Njwc//9k)"></div><div class="akarin-util-text-gradient akarin-post-title"><div class="mdui-card-primary"><div class="mdui-card-primary-title mdui-text-color-white-text">在 Javascript 和 PHP 中进行加密和解密</div></div></div></div><div class="mdui-valign mdui-card-header"><div><img class="akarin-hover-spin mdui-card-header-avatar" src="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg"><div class="mdui-card-header-title">✨小透明・宸✨</div><div class="mdui-card-header-subtitle">2020-02-26 22:09:56</div></div></div><article class="mdui-p-a-3 mdui-card-content mdui-typo"><blockquote><p>封面图：<a href="https://www.pixiv.net/artworks/77846017" target="_blank" rel="noopener">Pixiv ID: 77846017 「京あか」 by ネリヲ</a></p></blockquote><p>因为上个学期的课程里有学习到了一点入门的密码学（逃 所以就顺便想尝试一下在编程中进行加密解密相关的操作～(ﾉ*･ω･)ﾉ</p><p>在开始之前，先简单地过一遍相关的一些概念：</p><ul><li>明文：没有加密的数据</li><li>密文：加密后的数据</li><li>对称加密：使用<strong>同一个密钥（如果是除 CBC 以外模式的分组密码，还需要 IV）</strong>进行加密和解密</li><li>非对称加密：任何人都可以使用公开的<strong>公钥</strong>加密，只有藏着<strong>私钥</strong>的人才能解密</li><li>Hash：把任意长度的输入变换成<strong>固定长度的、尽可能避免产生碰撞的</strong>输出，是<strong>不可逆</strong>操作</li><li>Base64：使用可打印的字符表示二进制数据的一种<strong>编码方式</strong>，因为任何人都可以直接进行编码和解码，所以<strong>不是加密算法</strong></li></ul><p>这里的目标是在前端 Javascript 环境和后端 PHP 环境，分别使用一下 RSA 和 AES 这两种常见的非对称和对称加密算法～</p><p>用到的各种开源库：</p><ul><li><a href="https://github.com/brix/crypto-js" target="_blank" rel="noopener">CryptoJS</a>：用 Javascript 实现了多种对称加密算法和 Hash 算法的函数库。</li><li><a href="https://github.com/travist/jsencrypt" target="_blank" rel="noopener">JSEncrypt</a>：用 Javascript 实现了 RSA 的加密解密、验证签名、密钥生成。</li><li><a href="https://www.php.net/manual/zh/book.openssl.php" target="_blank" rel="noopener">OpenSSL</a>：广泛用于安全通信的一个库，支持大多数的加密算法和 Hash 算法，这里用到的是 PHP 自带的相关扩展。</li><li><a href="https://github.com/phpseclib/phpseclib" target="_blank" rel="noopener">phpseclib</a>：一个以面向对象的方式封装了 RSA 和其他一些对称加密算法的 PHP composer 包，实际上还是在调用 PHP 的 OpenSSL 之类的加密扩展。（如果没有安装扩展的话，这个库自己也已经用 PHP 把各种算法实现了一遍……）</li></ul><hr><h1 id="AES-对称加解密"><a href="#AES-对称加解密" class="headerlink" title="AES 对称加解密"></a>AES 对称加解密</h1><h2 id="CryptoJS"><a href="#CryptoJS" class="headerlink" title="CryptoJS"></a>CryptoJS</h2><p>在开始进行加解密之前，有必要先介绍一下 CryptoJS 中的 <code>WordArray</code>～</p><p>由于 JS 中直接操作数值型数据的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Typed_arrays" target="_blank" rel="noopener">TypedArray</a> 是一个相对比较新的标准，而 CryptoJS 这个库开发于 TypedArray 进入 JS 标准之前，所以 CryptoJS 中明文、密文、密钥和 Hash 一直都是使用了一个自建的 WordArray 对象，通过一个相当于 UInt32 数值组成的数组和一个标志位来代表原始的二进制数据：</p><figure class="akarin-blurred-container"><div style="padding-bottom:min(calc(100%/1251*334),334px,480px)"></div><img class="mdui-hoverable mdui-img-rounded" data-src="https://ae01.alicdn.com/kf/Hbab311ab1f324d76a1d1754e72667b3e2.png" data-src-webp="https://ae01.alicdn.com/kf/H180bea62bb834f2080d2986bbc7ae58c1.jpg"> <img class="mdui-hoverable mdui-img-rounded akarin-blurred" src="data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCAAJACADASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAgMEAQf/xAAhEAACAQMDBQAAAAAAAAAAAAABAgADETISUXEhIjFDYf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oADAMBAAIRAxEAPwDuhzsNI+ECOps4varTW52HWKq5ngwduYqYrQufYjcCb37iQjysNclhX//Z"></figure><p>（由于字节序不同，虽然也可以使用 <code>CryptoJS.lib.WordArray.create(new Uint32Array([...]))</code> 得到 WordArray ，但是里面的 <code>words</code> 和输入的 <code>Uint32Array</code> 是不同的）</p><p>加密和解密都是本质上都是对二进制数据进行操作，CryptoJS 也支持一些“编码”标准，可以与 WordArray 相互转换：</p><pre class="language-javascript line-numbers" data-language="javascript"><code class="language-javascript"><span class="token comment">// 三个数据实际上都是QWERTYUIOP123456</span>
<span class="token comment">// 使用CryptoJS.enc.*.parse将数据转换为WordArray</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'QWERTYUIOP123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Hex<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'51574552545955494f50313233343536'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> c <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'UVdFUlRZVUlPUDEyMzQ1Ng=='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用CryptoJS.enc.*.stringify将WordArray转换为数据：</span>
CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "QWERTYUIOP123456"</span>
CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Hex<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "51574552545955494f50313233343536"</span>
CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "UVdFUlRZVUlPUDEyMzQ1Ng=="</span>

<span class="token comment">// 也可以对WordArray使用.toString(CryptoJS.enc.*)，和CryptoJS.enc.*.stringify是等效的</span>
a<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">)</span><span class="token punctuation">;</span>
b<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Hex<span class="token punctuation">)</span><span class="token punctuation">;</span>
c<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>除了已有的编码，还可以在 <code>CryptoJS.enc</code> 中加入一个有 <code>stringify</code> 和 <code>parse</code> 两个函数的对象自行扩充。比如下面的一段代码就添加了对 <code>Uint8Array</code> 的支持（<a href="https://gist.github.com/lettergram/ba6733a854f835bca22b" target="_blank" rel="noopener">原代码出处</a>）：</p><pre class="language-javascript line-numbers" data-language="javascript"><code class="language-javascript">CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Uint8 <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将WordArray转换为数据，虽然是stringify但是不一定要求是字符串</span>
    <span class="token function function-variable">stringify</span><span class="token operator">:</span> <span class="token parameter">wordArray</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> words <span class="token operator">=</span> wordArray<span class="token punctuation">.</span>words<span class="token punctuation">;</span>
        <span class="token keyword">let</span> sigBytes <span class="token operator">=</span> wordArray<span class="token punctuation">.</span>sigBytes<span class="token punctuation">;</span>
        <span class="token keyword">let</span> u8arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>sigBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> sigBytes<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            u8arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>words<span class="token punctuation">[</span>i <span class="token operator">>>></span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">>>></span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">-</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> u8arr<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 将数据转换为WordArray</span>
    <span class="token function function-variable">parse</span><span class="token operator">:</span> <span class="token parameter">u8arr</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> len <span class="token operator">=</span> u8arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token keyword">let</span> words <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            words<span class="token punctuation">[</span>i <span class="token operator">>>></span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">|=</span> <span class="token punctuation">(</span>u8arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">-</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> CryptoJS<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>WordArray<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>words<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// "ABCD"</span>
CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Uint8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0x41</span><span class="token punctuation">,</span> <span class="token number">0x42</span><span class="token punctuation">,</span> <span class="token number">0x43</span><span class="token punctuation">,</span> <span class="token number">0x44</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">)</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>调用 <code>CryptoJS.*.encrypt</code> 函数可以进行加密，并<del>钦定</del>加密模式、填充模式和 IV，比如加密明文 <code>ABCD</code>：</p><pre class="language-javascript line-numbers" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> message <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'ABCD'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> key <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'0123456789ABCDEF'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> iv <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'FEDCBA9876543210'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> cipher <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token constant">AES</span><span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">iv</span><span class="token operator">:</span> iv<span class="token punctuation">,</span> <span class="token comment">// 如果是ECB模式就不需要钦定IV</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span> CryptoJS<span class="token punctuation">.</span>mode<span class="token punctuation">.</span><span class="token constant">CBC</span><span class="token punctuation">,</span> <span class="token comment">// 不钦定的话，默认也是这个</span>
    <span class="token literal-property property">padding</span><span class="token operator">:</span> CryptoJS<span class="token punctuation">.</span>pad<span class="token punctuation">.</span>Pkcs7<span class="token punctuation">,</span> <span class="token comment">// 不钦定的话，默认也是这个</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>容易踩坑的一点是上面的 <code>cipher</code> 并不是 WordArray，而是一个<strong>包含了加密算法、加密模式、密文、密钥、IV 等信息的对象</strong>。对这个 <code>cipher</code> 直接 <code>toString</code> 可以得到 Base64 编码后的数据，但是只有从这个对象的 <code>ciphertext</code> 获取对应的 WordArray 才能使用 <code>CryptoJS.enc.*.stringify</code> 和 <code>.toString(CryptoJS.enc.*)</code> 任意转换为一般的数据，否则就会报错了(´･_･`)</p><figure class="akarin-blurred-container"><div style="padding-bottom:min(calc(100%/1318*677),677px,480px)"></div><img class="mdui-hoverable mdui-img-rounded" data-src="https://ae01.alicdn.com/kf/H799a3635f4a6488f903ed8d099ae48aaZ.png" data-src-webp="https://ae01.alicdn.com/kf/Ha44b615209624032a9e81fc8cae56fac5.jpg"> <img class="mdui-hoverable mdui-img-rounded akarin-blurred" src="data:image/jpeg;base64,/9j/2wBDAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/2wBDAQgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8vNUROQj5CTl9VVV93cXecnNH/wAARCAAQACADASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAwIH/8QAIBAAAQQCAgMBAAAAAAAAAAAAAQACAxExgUFSE1Fxsf/EABUBAQEAAAAAAAAAAAAAAAAAAAIB/8QAFxEBAQEBAAAAAAAAAAAAAAAAAAEhQf/aAAwDAQACEQMRAD8A3VzyyQgEhvNJBI3tLV8UikJEpzpV5TeH57JXmAZrmHMko0rF9nbCKKX2Xj6Qf1KCTya0oUf/2Q"></figure><pre class="language-javascript line-numbers" data-language="javascript"><code class="language-javascript"><span class="token comment">// "1Wl2Kg1/0Vh+fJPX+UsJaA=="</span>
cipher<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cipher<span class="token punctuation">.</span>ciphertext<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">)</span><span class="token punctuation">;</span>
CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cipher<span class="token punctuation">.</span>ciphertext<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// "d569762a0d7fd1587e7c93d7f94b0968"</span>
cipher<span class="token punctuation">.</span>ciphertext<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Hex<span class="token punctuation">)</span><span class="token punctuation">;</span>
CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Hex<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cipher<span class="token punctuation">.</span>ciphertext<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 报错</span>
cipher<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">)</span><span class="token punctuation">;</span>
CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cipher<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>至于解密操作……当然是把 <code>encrypt</code> 改成 <code>decrypt</code> 了，但是和加密一样也有一个坑：</p><p><strong>用来解密的是上面提到的“对象”，而不是 WordArray</strong>。直接传一个 WordArray 进去是无法正常解密的，然而解密之后得到的又是 WordArray。一开始使用 CryptoJS 的时候总是发现解密得到的东西是空白的，其实就是在这个地方踩了坑┐(´-｀)┌</p><p>在实际中，收到的密文显然不会是上面的“对象”的形式（如果把加密算法、密钥、IV 之类的也传过来的话……？！），因此就需要模仿上面的 <code>cipher</code>，<strong>用 WordArray 临时创建一个只有 <code>ciphertext</code> 这个属性的“对象”</strong>用来解密：</p><pre class="language-javascript line-numbers" data-language="javascript"><code class="language-javascript"><span class="token comment">// 使用上面的“对象”解密，可以得到ABCD</span>
CryptoJS<span class="token punctuation">.</span><span class="token constant">AES</span><span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>cipher<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">iv</span><span class="token operator">:</span> iv<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 直接使用WordArray解密，得到的是空字符串</span>
CryptoJS<span class="token punctuation">.</span><span class="token constant">AES</span><span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>
    CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'1Wl2Kg1/0Vh+fJPX+UsJaA=='</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    key<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">iv</span><span class="token operator">:</span> iv<span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 临时用WordArray创建一个“对象”，也能得到ABCD</span>
CryptoJS<span class="token punctuation">.</span><span class="token constant">AES</span><span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span><span class="token literal-property property">ciphertext</span><span class="token operator">:</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'1Wl2Kg1/0Vh+fJPX+UsJaA=='</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    key<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">iv</span><span class="token operator">:</span> iv<span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>嗯……总的来说，使用 CryptoJS 进行加解密是比较麻烦的一件事，而且它的<a href="https://github.com/brix/crypto-js/blob/develop/docs/QuickStartGuide.wiki" target="_blank" rel="noopener">官方文档</a>也只是介绍了一下支持的算法，甚至没有一段演示用的代码（<a href="https://github.com/brix/crypto-js/blob/develop/README.md" target="_blank" rel="noopener">README.md</a> 里面倒是简单地介绍了一下用法）。至于加密和解密时涉及到的那个“对象”和 WordArray 的区别，不自己摸索一下估计就很难弄明白呢……(ฅ́дฅ̀)</p><p>另外，用 CryptoJS 计算 Hash 既可以输入字符串也可以输入 WordArray，得到的还是 WordArray：</p><pre class="language-javascript line-numbers" data-language="javascript"><code class="language-javascript"><span class="token comment">// "cb08ca4a7bb5f9683c19133a84872ca7"</span>
CryptoJS<span class="token punctuation">.</span><span class="token constant">MD5</span><span class="token punctuation">(</span><span class="token string">'ABCD'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Hex<span class="token punctuation">)</span><span class="token punctuation">;</span>
CryptoJS<span class="token punctuation">.</span><span class="token constant">MD5</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Hex<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'41424344'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Hex<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span></span></code></pre><h2 id="OpenSSL"><a href="#OpenSSL" class="headerlink" title="OpenSSL"></a>OpenSSL</h2><p>在 PHP 中进行 AES 加密和解密分别用到的是 <a href="https://www.php.net/manual/zh/function.openssl-encrypt.php" target="_blank" rel="noopener"><code>openssl_encrypt</code></a> 和 <a href="https://www.php.net/manual/zh/function.openssl-decrypt.php" target="_blank" rel="noopener"><code>openssl_decrypt</code></a> 两个函数，参数的顺序也基本相同：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">openssl_encrypt</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$method</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$iv</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">openssl_decrypt</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$method</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$iv</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span></span></code></pre><p><code>$data</code> 是明文和密文，<code>$method</code> 是加密方式，<code>$key</code> 是密钥。<code>$option</code> 可以统一设定调用上面的函数加密和解密时<strong>密文</strong>的格式：默认为 <code>0</code> 代表使用 Base64，设为 <code>OPENSSL_RAW_DATA</code> 就代表直接使用字符串。但是<strong>明文、密钥和 IV</strong> 仍然是固定使用<strong>字符串</strong>而不是 Base64。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">// 使用Base64编码：</span>
<span class="token keyword">echo</span> <span class="token function">openssl_encrypt</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ABCD'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'AES-128-CBC'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'0123456789ABCDEF'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'FEDCBA9876543210'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "1Wl2Kg1/0Vh+fJPX+UsJaA=="</span>
<span class="token keyword">echo</span> <span class="token function">openssl_decrypt</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'1Wl2Kg1/0Vh+fJPX+UsJaA=='</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'AES-128-CBC'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'0123456789ABCDEF'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'FEDCBA9876543210'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "ABCD"</span>

<span class="token comment">// 不使用Base64编码：</span>
<span class="token keyword">echo</span> <span class="token function">bin2hex</span><span class="token punctuation">(</span><span class="token function">openssl_encrypt</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ABCD'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'AES-128-CBC'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'0123456789ABCDEF'</span><span class="token punctuation">,</span> <span class="token constant">OPENSSL_RAW_DATA</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'FEDCBA9876543210'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "d569762a0d7fd1587e7c93d7f94b0968"</span>
<span class="token keyword">echo</span> <span class="token function">openssl_decrypt</span><span class="token punctuation">(</span><span class="token function">hex2bin</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'d569762a0d7fd1587e7c93d7f94b0968'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'AES-128-CBC'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'0123456789ABCDEF'</span><span class="token punctuation">,</span> <span class="token constant">OPENSSL_RAW_DATA</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'FEDCBA9876543210'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "ABCD"</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>前面提到的 CryptoJS 可以在十六进制、Base64 和字符串之间进行转换，而 PHP 这边除了加密时自带的可选的 Base64 编码，也可以直接使用 <code>bin2hex</code> / <code>hex2bin</code>、<code>base64_encode</code> / <code>base64_decode</code> 这些函数实现数据类型的转换，PHP 的字符串本身也是可以用来存储二进制数据的～</p><h2 id="phpseclib"><a href="#phpseclib" class="headerlink" title="phpseclib"></a>phpseclib</h2><pre class="line-numbers language-none"><code class="language-none">composer require phpseclib/phpseclib<span class="line-numbers-rows" aria-hidden="true"><span></span></span></code></pre><p>OpenSSL 扩展使用的是面向过程的写法，一个函数一个函数地调用，调用一次函数时要把明文 / 密文、密钥、加密方式等参数都写一遍，结果是把一行代码弄得很长，参数含义不清晰，比较难看_(:_」∠)_</p><p>phpseclib 采用了面向对象的写法，加密解密前新建一个对象作为“AES 加密 / 解密器”，一次性设定好密钥，就可以直接用来加密 / 解密了∠( ᐛ 」∠)_</p><p>phpseclib 统一使用原始数据也就是字符串进行加密和解密，本身不会进行任何的数据格式转换，需要自己手动调用相关函数。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">require_once</span> <span class="token constant">__DIR__</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/vendor/autoload.php'</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">phpseclib<span class="token punctuation">\</span>Crypt<span class="token punctuation">\</span>AES</span><span class="token punctuation">;</span>

<span class="token variable">$aes</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AES</span><span class="token punctuation">(</span><span class="token class-name static-context">AES</span><span class="token operator">::</span><span class="token constant">MODE_CBC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$aes</span><span class="token operator">-></span><span class="token function">setKey</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'0123456789ABCDEF'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$aes</span><span class="token operator">-></span><span class="token function">setIV</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'FEDCBA9876543210'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$aes</span><span class="token operator">-></span><span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ABCD'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "1Wl2Kg1/0Vh+fJPX+UsJaA=="</span>
<span class="token keyword">echo</span> <span class="token variable">$aes</span><span class="token operator">-></span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token function">hex2bin</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'d569762a0d7fd1587e7c93d7f94b0968'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "ABCD"</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>↑这种写法舒服多了(〃′▽`)</p><h1 id="RSA-非对称加解密"><a href="#RSA-非对称加解密" class="headerlink" title="RSA 非对称加解密"></a>RSA 非对称加解密</h1><h2 id="JSEncrypt"><a href="#JSEncrypt" class="headerlink" title="JSEncrypt"></a>JSEncrypt</h2><p>JSEncrypt 的使用还是比较简单的，生成一对 RSA 公钥和私钥：</p><pre class="language-javascript line-numbers" data-language="javascript"><code class="language-javascript"><span class="token comment">// 钦定使用512位的密钥</span>
<span class="token keyword">let</span> rsa <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSEncrypt</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">default_key_size</span><span class="token operator">:</span> <span class="token number">512</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 随机生成公钥和私钥</span>
<span class="token comment">// 可以填写一个回调函数进行异步操作，不写的话就是同步操作</span>
<span class="token comment">// 异步操作比同步操作明显慢了不少……</span>
rsa<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rsa<span class="token punctuation">.</span><span class="token function">getPrivateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rsa<span class="token punctuation">.</span><span class="token function">getPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>生成密钥需要的时间是随着位数增加而指数上升的。生成 512 位密钥一般需要 10-30 ms，1024 位一般需要 100-200 ms，2048 位需要 1000-2000 ms，至于 4096 位……生成一次需要几十秒，浏览器会直接卡死，在前端直接使用的话大概是不行的(っ’-‘)╮</p><p>JSEncrypt 也支持自己指定密钥，进行加密和解密操作，<strong>密文统一使用 Base64 编码</strong>：</p><pre class="language-javascript line-numbers" data-language="javascript"><code class="language-javascript"><span class="token comment">// 设定公钥并进行加密</span>
rsa<span class="token punctuation">.</span><span class="token function">setPublicKey</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">
-----BEGIN PUBLIC KEY-----
MFswDQYJKoZIhvcNAQEBBQADSgAwRwJAfVNVmlMys1Ur/DHm+Hy+5ZiSYbI1JQWj
LjXOWazsdgHA2dhNeb5lyBeoV0jDY4kxbNIqoK8SC0DdqvSbf43uHQIDAQAB
-----END PUBLIC KEY-----
</span><span class="token string template-punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rsa<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token string">'ABCD'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "YqMFMygirIkg4JHmjH7FUk4AeluSWZjsaoHJlm5flyYQtWPdK+se2BF5WAnxKMS9eckSbijXFwFKDBmwTsirqg=="</span>

<span class="token comment">// 设定私钥并进行解密</span>
rsa<span class="token punctuation">.</span><span class="token function">setPrivateKey</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">
-----BEGIN RSA PRIVATE KEY-----
MIIBOAIBAAJAfVNVmlMys1Ur/DHm+Hy+5ZiSYbI1JQWjLjXOWazsdgHA2dhNeb5l
yBeoV0jDY4kxbNIqoK8SC0DdqvSbf43uHQIDAQABAkBh6TZKsE8+/f60NERvw/3c
IDvUqcaNWv8mvhCtzMScWB79WA5tj78VDeu+c89S3HVRzwp1IpdaKXwLUeeGlvMB
AiEAxl99A8cey501bOFGW/4p6xgePDyGMKCnaxERj7Jn2UECIQChu3wu8fdh3VcY
kyVjqu6Q5zAtbdv4N5npX/F7SWYh3QIgb9TRE1ojwEHmJnVxRtcoJoK4ONkeBTfs
ae17avj2loECICdI8jY5Ah0cdZ57h5Z5G6/I6FPwnoDhiJo+etq2jn9lAiBAGRen
ktqwA3k6arwEpjEj89ZqYiTzIFbCngH1oKbp9A==
-----END RSA PRIVATE KEY-----
</span><span class="token string template-punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rsa<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token string">'YqMFMygirIkg4JHmjH7FUk4AeluSWZjsaoHJlm5flyYQtWPdK+se2BF5WAnxKMS9eckSbijXFwFKDBmwTsirqg=='</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "ABCD"</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>先回想一下 RSA 的基本算法：</p><ol><li>取素数 $p$ 和 $q$。</li><li>计算 $n = pq$，$\phi(n) = (n - 1)(q - 1)$。</li><li>取整数 $e$ 满足 $gcd(e, \phi(n)) = 1$。</li><li>计算 $d = e^{-1} \bmod \phi(n)$。</li><li>私钥是 $d$，公钥是 $(e, n)$。</li><li>加密：$c = m^e \bmod n$，解密：$m = c^d \bmod n$。</li></ol><p>RSA 算法的保密性取决于将 $n$ 分解成 $p$ 和 $q$ 的难度，不过根据<a href="https://en.wikipedia.org/wiki/RSA_numbers#RSA-240" target="_blank" rel="noopener">维基百科上的记录</a>，在 2019 年已经有了 795 位的数被分解的记录，目前的主流是使用至少 1024 位的密钥，不过这里作为测试就还是使用 512 位的密钥了～</p><p>这种以一行“BEGIN”和“END”的分割线标记开始和结束、正文使用 Base64 编码的 RSA 密钥格式就是 PEM 格式（私钥又分为 PKCS#1 和 PKCS#8 两种标准，分别以 <code>BEGIN RSA PRIVATE KEY</code> 和 <code>BEGIN PRIVATE KEY</code> 开头）。虽然按照上面的算法，私钥涉及到的参数比公钥少，但是 PEM 格式中私钥的长度反而比公钥长了很多，这是因为这里的“私钥”实际上还包含了上面涉及到的几乎所有参数（其中就包括 $e$ 和 $n$），因此完全可以从私钥中直接“提取”出公钥，设定了私钥则既可以加密也可以解密，但设定了公钥就只能进行加密。</p><p>由于 RSA 加密的使用的填充方案在密文中添加了一些随机数，所以即使是同样的密钥加密同样的明文，得到的密文也会不同。</p><h2 id="OpenSSL-1"><a href="#OpenSSL-1" class="headerlink" title="OpenSSL"></a>OpenSSL</h2><p>和前面的 AES 加密一样，使用 OpenSSL 扩展弄 RSA 加密也是有点麻烦 ┐(´-｀)┌</p><p>使用 OpenSSL 时，一般也是先生成私钥，再根据私钥提取出公钥。对应到 PHP 这边就是使用 <a href="https://www.php.net/manual/zh/function.openssl-pkey-new.php" target="_blank" rel="noopener"><code>openssl_pkey_new</code></a> 和 <a href="https://www.php.net/manual/zh/function.openssl-pkey-export.php" target="_blank" rel="noopener"><code>openssl_pkey_export</code></a> 两个函数：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">openssl_pkey_new</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'config'</span> <span class="token operator">=></span> <span class="token function">realpath</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'./openssl.cnf'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'private_key_bits'</span> <span class="token operator">=></span> <span class="token number">512</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'private_key_type'</span> <span class="token operator">=></span> <span class="token constant">OPENSSL_KEYTYPE_RSA</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">openssl_pkey_export</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">,</span> <span class="token variable">$private_key</span><span class="token punctuation">,</span> <span class="token constant">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'config'</span> <span class="token operator">=></span> <span class="token function">realpath</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'./openssl.cnf'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$public_key</span> <span class="token operator">=</span> <span class="token function">openssl_pkey_get_details</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这段代码看上去没什么问题，但是官方文档提示“必须安装有效的 <code>openssl.cnf</code> 以保证此函数正确运行”。为什么生成一个 RSA 密钥还需要<strong>额外的配置文件</strong>？为什么获取私钥是<strong>将私钥写入参数中指定的引用的变量</strong>，但是获取公钥（和其他 RSA 算法中涉及到的参数）又使用了<strong>返回关联数组</strong>的形式？这种写法有点特别啊……</p><p>Linux 平台上 OpenSSL 本身就是标配，所以 PHP 可以根据环境变量找到 <code>openssl.cnf</code>。Windows 版的 PHP 也自带了一个 <code>openssl.cnf</code>，但是如果不配置环境变量的话就需要手动指定路径了（也就是上面的 <code>config</code> ）。</p><p>OpenSSL 的加密和解密中的<strong>密文同样是统一使用字符串</strong>，有需要的话可以自己另外使用 Base64 编码 / 解码。然而进行 RSA 加密和解密也是使用了“写入参数中指定的引用变量”的形式，和前面的使用返回值的 AES 加密解密也不一样：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">// 设定公钥并进行加密</span>
<span class="token variable">$public_key</span> <span class="token operator">=</span> <span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span> <span class="token constant">KEY</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token constant">BEGIN</span> <span class="token keyword">PUBLIC</span> <span class="token constant">KEY</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
MFswDQYJKoZIhvcNAQEBBQADSgAwRwJAfVNVmlMys1Ur<span class="token operator">/</span>DHm<span class="token operator">+</span>Hy<span class="token operator">+</span><span class="token number">5</span>ZiSYbI1JQWj
LjXOWazsdgHA2dhNeb5lyBeoV0jDY4kxbNIqoK8SC0DdqvSbf43uHQIDAQAB
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token constant">END</span> <span class="token keyword">PUBLIC</span> <span class="token constant">KEY</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token constant">KEY</span><span class="token punctuation">;</span>
<span class="token function">openssl_public_encrypt</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ABCD'</span><span class="token punctuation">,</span> <span class="token variable">$encrypted</span><span class="token punctuation">,</span> <span class="token variable">$public_key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$encrypted</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "YqMFMygirIkg4JHmjH7FUk4AeluSWZjsaoHJlm5flyYQtWPdK+se2BF5WAnxKMS9eckSbijXFwFKDBmwTsirqg=="</span>

<span class="token comment">// 设定私钥并进行解密</span>
<span class="token variable">$private_key</span> <span class="token operator">=</span> <span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span> <span class="token constant">KEY</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token constant">BEGIN</span> <span class="token constant">RSA</span> <span class="token keyword">PRIVATE</span> <span class="token constant">KEY</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
MIIBOAIBAAJAfVNVmlMys1Ur<span class="token operator">/</span>DHm<span class="token operator">+</span>Hy<span class="token operator">+</span><span class="token number">5</span>ZiSYbI1JQWjLjXOWazsdgHA2dhNeb5l
yBeoV0jDY4kxbNIqoK8SC0DdqvSbf43uHQIDAQABAkBh6TZKsE8<span class="token operator">+</span><span class="token operator">/</span>f60NERvw<span class="token operator">/</span><span class="token number">3</span>c
IDvUqcaNWv8mvhCtzMScWB79WA5tj78VDeu<span class="token operator">+</span>c89S3HVRzwp1IpdaKXwLUeeGlvMB
AiEAxl99A8cey501bOFGW<span class="token operator">/</span><span class="token number">4</span>p6xgePDyGMKCnaxERj7Jn2UECIQChu3wu8fdh3VcY
kyVjqu6Q5zAtbdv4N5npX<span class="token operator">/</span>F7SWYh3QIgb9TRE1ojwEHmJnVxRtcoJoK4ONkeBTfs
ae17avj2loECICdI8jY5Ah0cdZ57h5Z5G6<span class="token operator">/</span>I6FPwnoDhiJo<span class="token operator">+</span>etq2jn9lAiBAGRen
ktqwA3k6arwEpjEj89ZqYiTzIFbCngH1oKbp9A<span class="token operator">==</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token constant">END</span> <span class="token constant">RSA</span> <span class="token keyword">PRIVATE</span> <span class="token constant">KEY</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token constant">KEY</span><span class="token punctuation">;</span>
<span class="token function">openssl_private_decrypt</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'YqMFMygirIkg4JHmjH7FUk4AeluSWZjsaoHJlm5flyYQtWPdK+se2BF5WAnxKMS9eckSbijXFwFKDBmwTsirqg=='</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$decrypted</span><span class="token punctuation">,</span> <span class="token variable">$private_key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$decrypted</span><span class="token punctuation">;</span> <span class="token comment">// "ABCD"</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="phpseclib-1"><a href="#phpseclib-1" class="headerlink" title="phpseclib"></a>phpseclib</h2><p>由于使用了面向对象的写法，使用 phpseclib 的代码仍然是看上去非常舒服，非常清晰……至少不会有“把函数执行的结果写入参数中指定的引用变量”这种特别的写法了|•’-‘•)</p><p>生成密钥：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">require_once</span> <span class="token constant">__DIR__</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/vendor/autoload.php'</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">phpseclib<span class="token punctuation">\</span>Crypt<span class="token punctuation">\</span>RSA</span><span class="token punctuation">;</span>

<span class="token variable">$rsa</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RSA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$rsakey</span> <span class="token operator">=</span> <span class="token variable">$rsa</span><span class="token operator">-></span><span class="token function">createKey</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$rsakey</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'privatekey'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$rsakey</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'publickey'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>加密和解密：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">require_once</span> <span class="token constant">__DIR__</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/vendor/autoload.php'</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">phpseclib<span class="token punctuation">\</span>Crypt<span class="token punctuation">\</span>RSA</span><span class="token punctuation">;</span>

<span class="token variable">$rsa</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RSA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$rsa</span><span class="token operator">-></span><span class="token function">setEncryptionMode</span><span class="token punctuation">(</span><span class="token class-name static-context">RSA</span><span class="token operator">::</span><span class="token constant">ENCRYPTION_PKCS1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 设定公钥并进行加密</span>
<span class="token variable">$public_key</span> <span class="token operator">=</span> <span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span> <span class="token constant">KEY</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token constant">BEGIN</span> <span class="token keyword">PUBLIC</span> <span class="token constant">KEY</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
MFswDQYJKoZIhvcNAQEBBQADSgAwRwJAfVNVmlMys1Ur<span class="token operator">/</span>DHm<span class="token operator">+</span>Hy<span class="token operator">+</span><span class="token number">5</span>ZiSYbI1JQWj
LjXOWazsdgHA2dhNeb5lyBeoV0jDY4kxbNIqoK8SC0DdqvSbf43uHQIDAQAB
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token constant">END</span> <span class="token keyword">PUBLIC</span> <span class="token constant">KEY</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token constant">KEY</span><span class="token punctuation">;</span>
<span class="token variable">$rsa</span><span class="token operator">-></span><span class="token function">loadKey</span><span class="token punctuation">(</span><span class="token variable">$public_key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$rsa</span><span class="token operator">-></span><span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ABCD'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "YqMFMygirIkg4JHmjH7FUk4AeluSWZjsaoHJlm5flyYQtWPdK+se2BF5WAnxKMS9eckSbijXFwFKDBmwTsirqg=="</span>

<span class="token comment">// 设定私钥并进行解密</span>
<span class="token variable">$private_key</span> <span class="token operator">=</span> <span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span> <span class="token constant">KEY</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token constant">BEGIN</span> <span class="token constant">RSA</span> <span class="token keyword">PRIVATE</span> <span class="token constant">KEY</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
MIIBOAIBAAJAfVNVmlMys1Ur<span class="token operator">/</span>DHm<span class="token operator">+</span>Hy<span class="token operator">+</span><span class="token number">5</span>ZiSYbI1JQWjLjXOWazsdgHA2dhNeb5l
yBeoV0jDY4kxbNIqoK8SC0DdqvSbf43uHQIDAQABAkBh6TZKsE8<span class="token operator">+</span><span class="token operator">/</span>f60NERvw<span class="token operator">/</span><span class="token number">3</span>c
IDvUqcaNWv8mvhCtzMScWB79WA5tj78VDeu<span class="token operator">+</span>c89S3HVRzwp1IpdaKXwLUeeGlvMB
AiEAxl99A8cey501bOFGW<span class="token operator">/</span><span class="token number">4</span>p6xgePDyGMKCnaxERj7Jn2UECIQChu3wu8fdh3VcY
kyVjqu6Q5zAtbdv4N5npX<span class="token operator">/</span>F7SWYh3QIgb9TRE1ojwEHmJnVxRtcoJoK4ONkeBTfs
ae17avj2loECICdI8jY5Ah0cdZ57h5Z5G6<span class="token operator">/</span>I6FPwnoDhiJo<span class="token operator">+</span>etq2jn9lAiBAGRen
ktqwA3k6arwEpjEj89ZqYiTzIFbCngH1oKbp9A<span class="token operator">==</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token constant">END</span> <span class="token constant">RSA</span> <span class="token keyword">PRIVATE</span> <span class="token constant">KEY</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token constant">KEY</span><span class="token punctuation">;</span>
<span class="token variable">$rsa</span><span class="token operator">-></span><span class="token function">loadKey</span><span class="token punctuation">(</span><span class="token variable">$private_key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$rsa</span><span class="token operator">-></span><span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'YqMFMygirIkg4JHmjH7FUk4AeluSWZjsaoHJlm5flyYQtWPdK+se2BF5WAnxKMS9eckSbijXFwFKDBmwTsirqg=='</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "ABCD"</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote class="mdui-m-b-0 mdui-m-x-0 mdui-p-y-1" style="border-left:4px solid rgba(0,0,0,.36)"><strong>本作品采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。不允许内容农场类网站、CSDN 用户和微信公众号转载。</strong><br><strong>本文作者：✨小透明・宸✨</strong><br><strong>本文链接：<a href="https://akarin.dev/2020/02/26/crypto-in-js-and-php/">https://akarin.dev/2020/02/26/crypto-in-js-and-php/</a></strong></blockquote></article><div class="mdui-p-a-3 mdui-color-white" id="lv-container" data-id="city" data-uid="MTAyMC80NDUwOC8yMTAzOQ=="><script>(()=>{const e=document.createElement("script");e.src="https://cdn-city.livere.com/js/embed.dist.js",e.async=!0,document.body.appendChild(e)})()</script></div></div><div class="mdui-valign mdui-m-t-2"><a href="../../../03/26/intersection-observer/" class="mdui-ripple mdui-btn mdui-btn-icon"><i class="material-icons mdui-icon">chevron_left</i> </a><span class="mdui-typo-body-1-opacity mdui-text-left mdui-m-l-1" title="用 Intersection Observer 来自己造个图片懒加载的轮子₍₍ (ง ˙ω˙)ว ⁾⁾">上一篇</span> <span class="mdui-typo-body-1-opacity mdui-text-center" style="flex-grow:1"></span> <span class="mdui-typo-body-1-opacity mdui-text-right mdui-m-r-1" title="搞事情：用“图床”传视频，自带免费 CDN 加速（已复活！）">下一篇</span> <a href="../../07/alicdn-video-hosting/" class="mdui-ripple mdui-btn mdui-btn-icon"><i class="material-icons mdui-icon">chevron_right</i></a></div></main><footer class="mdui-container mdui-m-y-5 mdui-typo" style="display:flex;max-width:1024px"><div class="mdui-typo-body-1-opacity mdui-text-left">Copyright © 2022 ✨小透明・宸✨<br>Hosted by <a href="https://github.com/TransparentLC/transparentlc.github.io" target="_blank">Github Pages</a></div><div style="flex-grow:1"></div><div class="mdui-typo-body-1-opacity mdui-text-right">Powered by <a href="https://hexo.io" target="_blank">Hexo</a> <span class="mdui-hidden-xs-down">6.2.0</span><br>Theme - <a href="https://github.com/TransparentLC/hexo-theme-akarin" target="_blank">Akarin</a></div></footer><script src="https://gcore.jsdelivr.net/combine/gh/TransparentLC/transparentlc.github.io/js/mdui.min.js,npm/medium-zoom@1/dist/medium-zoom.min.js,npm/instant.page@5/instantpage.min.js,npm/aplayer@1/dist/APlayer.min.js,gh/TransparentLC/transparentlc.github.io@da8e973/js/script.min.js"></script><script src="https://gcore.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/js/bsz.min.js" async></script><script>window.MathJax={tex:{inlineMath:[["$","$"],["(",")"]],processEscapes:!0},options:{ignoreHtmlClass:"tex2jax_ignore|dno",skipHtmlTags:["script","noscript","style","textarea","pre","code"]}}</script><script src="https://fastly.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script></body></html>