<!doctype html><html lang="zh-Hans"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no" name="viewport"><meta content="webkit" name="renderer"><meta content="webkit" name="force-rendering"><meta content="✨小透明・宸✨" name="author"><meta content="" name="keywords"><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"><link href="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png" rel="icon shortcut" type="image/ico"><link href="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png" rel="icon"><link href="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png" rel="apple-touch-icon"><link href="/atom.xml" rel="alternate" type="application/atom+xml"><title>使用 PowerShell 爬取妹子图网站 | 存在感消失的地方|ω•`)</title><script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":"https://akarin.dev","headline":"使用 PowerShell 爬取妹子图网站","datePublished":"2019-07-30T08:19:56.000Z","dateModified":"2019-07-30T08:19:56.000Z","author":{"@type":"Person","name":"✨小透明・宸✨","image":{"@type":"ImageObject","url":"https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg"},"description":"身处寒夜 把握星光✨"},"publisher":{"@type":"Organization","name":"存在感消失的地方|ω•`)","logo":"https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/favicon.png"},"keywords":"","description":"虽然小透明对那种“妹子图”没什么兴趣啦……σ*ゝω･)"}</script><script>/MSIE|Trident/.test(navigator.userAgent)&&(location.href="../../../../upgrade-browser.html")</script><script>window.switchDark=t=>{const a={auto:"mdui-theme-layout-auto",enable:"mdui-theme-layout-dark",disable:""};(t=t||localStorage.getItem("dark"))in a||(t="auto");for(const e in a)a[e]&&document.body.classList[e===t?"add":"remove"](a[e]);localStorage.setItem("dark",t)},addEventListener("DOMContentLoaded",()=>switchDark());</script><link href="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/css/mdui.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/combine/npm/aplayer@1/dist/APlayer.min.css,npm/prismjs@1/plugins/line-numbers/prism-line-numbers.min.css,npm/prism-themes@1/themes/prism-vsc-dark-plus.min.css,gh/TransparentLC/transparentlc.github.io/css/style.min.css" rel="stylesheet"><style>*{--sidebar-image:url(https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/sidebar_header.jpg);--sidebar-image-color:#958981;--banner-image:url(https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/daily_pic.png);--banner-image-color:#f09ea3;--post-thumbnail-color:#f09ea3;--copy-code-btn-color:#fff}</style><meta content="Hexo 6.0.0" name="generator"></head><body class="mdui-drawer-body-left mdui-theme-accent-pink mdui-theme-primary-pink"><button class="mdui-fab mdui-m-a-2 mdui-shadow-0 mdui-text-color-grey-700" mdui-drawer="{target:'#akarin-drawer'}" style="position:fixed;z-index:1"><i class="material-icons mdui-icon">menu</i></button><nav class="mdui-drawer mdui-drawer-full-height mdui-shadow-6" id="akarin-drawer"><div class="akarin-util-bg-cover mdui-p-x-2" id="akarin-drawer-media"><img src="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg" class="akarin-hover-spin mdui-img-circle mdui-m-t-4" id="akarin-drawer-avatar"><div class="akarin-util-text-gradient mdui-card-media-covered"><div class="mdui-card-primary"><div class="mdui-typo-subheading">✨小透明・宸✨</div><div class="akarin-util-opacity-half mdui-typo-caption">存在感消失的地方|ω•`)</div></div></div></div><div class="mdui-list" mdui-collapse><div><a href="../../../../" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">home</i> <span class="mdui-list-item-content">主页</span></a></div><div><a href="../../../../about" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">person</i> <span class="mdui-list-item-content">关于</span></a></div><div><a href="../../../../friend" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">link</i> <span class="mdui-list-item-content">友链</span></a></div><div><a href="https://github.com/TransparentLC" class="mdui-ripple mdui-list-item" rel="noopener" target="_blank"><i class="material-icons mdui-icon mdui-list-item-icon">code</i> <span class="mdui-list-item-content">GitHub</span></a></div><div><a href="../../../../archives" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">collections_bookmark</i> <span class="mdui-list-item-content">归档</span> <small class="akarin-drawer-badge mdui-color-theme-accent">32</small></a></div><div><a href="../../../../atom.xml" class="mdui-ripple mdui-list-item"><i class="material-icons mdui-icon mdui-list-item-icon">rss_feed</i> <span class="mdui-list-item-content">RSS</span></a></div><div class="mdui-divider"></div><div class="mdui-collapse-item mdui-collapse-item-open"><div class="mdui-ripple mdui-list-item mdui-collapse-item-header"><i class="material-icons mdui-icon mdui-list-item-icon">brightness_4</i> <span class="mdui-list-item-content">深色模式</span> <i class="material-icons mdui-icon mdui-collapse-item-arrow">keyboard_arrow_down</i></div><div class="mdui-list mdui-collapse-item-body"><div class="mdui-ripple mdui-list-item" data-dark="auto"><span class="mdui-list-item-content">根据系统主题切换</span></div><div class="mdui-ripple mdui-list-item" data-dark="enable"><span class="mdui-list-item-content">启用</span></div><div class="mdui-ripple mdui-list-item" data-dark="disable"><span class="mdui-list-item-content">禁用</span></div></div></div><div class="mdui-collapse-item mdui-collapse-item-open"><div class="mdui-ripple mdui-list-item mdui-collapse-item-header"><i class="material-icons mdui-icon mdui-list-item-icon">insert_chart</i> <span class="mdui-list-item-content">访问统计</span> <i class="material-icons mdui-icon mdui-collapse-item-arrow">keyboard_arrow_down</i></div><div class="mdui-list mdui-collapse-item-body"><div class="mdui-ripple mdui-list-item"><span class="mdui-list-item-content">站点访问量</span> <small class="akarin-drawer-badge mdui-color-theme-accent" id="busuanzi_value_site_pv">Loading</small></div><div class="mdui-ripple mdui-list-item"><span class="mdui-list-item-content">站点访客数</span> <small class="akarin-drawer-badge mdui-color-theme-accent" id="busuanzi_value_site_uv">Loading</small></div><div class="mdui-ripple mdui-list-item"><span class="mdui-list-item-content">页面访问量</span> <small class="akarin-drawer-badge mdui-color-theme-accent" id="busuanzi_value_page_pv">Loading</small></div></div></div></div></nav><picture id="akarin-top" title="返回顶部"><source srcset="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/top.avif" type="image/avif"><source srcset="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/top.webp" type="image/webp"><img src="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/top.png"></picture><div style="padding-top:20px"></div><div class="mdui-hidden-sm-down" style="padding-top:40px"></div><div class="mdui-hidden-md-down" style="padding-top:40px"></div><main class="mdui-container" style="max-width:1024px"><div class="akarin-util-rounded-5 mdui-card mdui-shadow-4"><div class="mdui-ripple akarin-post-bg akarin-util-bg-cover" data-src="https://ae01.alicdn.com/kf/U9f5dc29c87d548988ba5d35f5e344e19g.jpg" data-src-avif="https://vfile.meituan.net/mmdb/c4ae2d8c25660b75dd8f1bc7620eedbc40008.jpg" data-src-webp="https://ae01.alicdn.com/kf/Hcfb83ba416544a5189cb752e4dbde989f.jpg"><div class="akarin-util-bg-cover akarin-post-bg akarin-blurred-cover" style="background-image:url(data:image/jpeg;base64,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)"></div><div class="akarin-util-text-gradient akarin-post-title"><div class="mdui-card-primary"><div class="mdui-card-primary-title mdui-text-color-white-text">使用 PowerShell 爬取妹子图网站</div></div></div></div><div class="mdui-valign mdui-card-header"><div><img src="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/img/avatar.jpg" class="akarin-hover-spin mdui-card-header-avatar"><div class="mdui-card-header-title">✨小透明・宸✨</div><div class="mdui-card-header-subtitle">2019-07-30 16:19:56</div></div></div><article class="mdui-p-a-3 mdui-card-content mdui-typo"><blockquote><p>封面图：<a href="https://www.pixiv.net/member_illust.php?mode=medium&illust_id=75886262" target="_blank" rel="noopener">Pixiv ID: 75886262 「お誕生日おめでとうあかり！Happy Birthday!」 by Kyouzama アリンスター</a></p></blockquote><p>不知道是不是被“精准营销”了，总之小透明最近在很多网站上都看到了各种“Python 入门教程”(`へ´*)ノ</p><p>一想到 Python 入门，小透明就记得诸如 C$DN 之类的网站上经常会使用制作各种爬虫作为 Python 入门的案例是。一提到 Python 的入门级爬虫，似乎大部分教程都在爬各种妹子图网站。如果这些网站的站长们发现自己的网站除了吸引肥宅以外居然还能成为<strong>编程入门教具</strong>之一，不知道会有什么感想呢？(´ﾟωﾟ｀)</p><img data-src="https://ae01.alicdn.com/kf/H8dfdab271d724993ba1b2f6ff6253059I.png" data-src-webp="https://ae01.alicdn.com/kf/U8fbdbca6242247859c61bee39181d78fr.jpg"><p><del>迷之声：“给我也整一个！”</del></p><p>由于用 Python 写的妹子图爬虫实在是太多了，复读这些教程也没什么意思，所以小透明还是打算使用熟悉的 PowerShell 来编写爬虫～当然也就不需要装各种包配置各种环境（右键就可以直接运行，Windows 内置了 PowerShell 的运行环境，甚至还内置了一个 IDE），而且诸君看了以下的教程后，也许能举一反三，制作适用于其它（爬取难度较低的）网站的爬虫也说不定？</p><p>当然，制作网站爬虫，基本的网络编程知识还是需要有的～</p><p>这里要爬取的是 <a href="https://www.mzitu.com/" target="_blank" rel="noopener">https://www.mzitu.com/</a> 这个网站。虽然它显然不是唯一的妹子图网站，不过这个网站出现在了大部分爬虫教程中（站长真可怜 233），而且访问速度也很快，所以就用它作为例子(ᴗ•̀ᴗ-)✧ 小透明找到的另外一个妹子图网站是 <a href="https://meizitu.com/" target="_blank" rel="noopener">https://meizitu.com/</a>，但是似乎是需要翻墙才能访问……有条件的话，也可以开着梯子爬一下试试看？</p><h1 id="使用-ParsedHTML-解析网页数据"><a href="#使用-ParsedHTML-解析网页数据" class="headerlink" title="使用 ParsedHTML 解析网页数据"></a>使用 <code>ParsedHTML</code> 解析网页数据</h1><p>PowerShell 访问网页用的是 <code>Invoke-WebRequest</code> 这个 cmdlet，比如要访问妹子图网站的主页：</p><pre class="language-powershell line-numbers" data-language="powershell"><code class="language-powershell"><span class="token variable">$Response</span> = <span class="token function">Invoke-WebRequest</span> <span class="token string">'https://www.mzitu.com/page/1/'</span><span class="line-numbers-rows" aria-hidden="true"><span></span></span></code></pre><p>得到的 <code>$Response</code> 就是包含了网页数据的对象：</p><pre class="line-numbers language-plaintext" data-language="plaintext"><code class="language-plaintext">StatusCode        : 200
StatusDescription : OK
Content           : &lt;!DOCTYPE html&gt;
                    &lt;html&gt;
                    &lt;head&gt;
                    &lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;UTF-8&quot; &#x2F;&gt;
                    &lt;title&gt;妹子图 - 性感美女图片每日更新&lt;&#x2F;title&gt;
                    &lt;meta name&#x3D;&quot;keywords&quot; content&#x3D;&quot;妹子图,妹子,美女图片,性感美女,美女写真&quot; &#x2F;&gt;
                    &lt;meta name&#x3D;...
RawContent        : HTTP&#x2F;1.1 200 OK
                    Connection: keep-alive
                    X-NWS-UUID-VERIFY: ce2a0876df4584dcf4baa32cd89c7195
                    X-NWS-LOG-UUID: 56e2625d-3abc-4866-a94f-6b0e4c316bf0
                    X-Cache-Lookup: Hit From Disktank3,Hit From Inner Cl...
Forms             : &#123;&#125;
Headers           : &#123;[Connection, keep-alive], [X-NWS-UUID-VERIFY, ce2a0876df4584dcf4baa32cd89c7195], [X-NWS-LOG-UUID,
                    56e2625d-3abc-4866-a94f-6b0e4c316bf0], [X-Cache-Lookup, Hit From Disktank3,Hit From Inner Cluster,H
                    it From Upstream]...&#125;
Images            : &#123;@&#123;innerHTML&#x3D;; innerText&#x3D;; outerHTML&#x3D;&lt;IMG class&#x3D;lazy alt&#x3D;&quot;有胸有腿有翘臀 妩媚尤物芝芝Booty黑丝一线裆让你大饱眼福&quot; src&#x3D;&quot;http
                    s:&#x2F;&#x2F;i.meizitu.net&#x2F;pfiles&#x2F;img&#x2F;lazy.png&quot; width&#x3D;236 height&#x3D;354 data-original&#x3D;&quot;https:&#x2F;&#x2F;i.meizitu.net&#x2F;th
                    umbs&#x2F;2019&#x2F;07&#x2F;189007_10b27_236.jpg&quot;&gt;; outerText&#x3D;; tagName&#x3D;IMG; class&#x3D;lazy; alt&#x3D;有胸有腿有翘臀 妩媚尤物芝芝Booty黑丝
                    一线裆让你大饱眼福; src&#x3D;https:&#x2F;&#x2F;i.meizitu.net&#x2F;pfiles&#x2F;img&#x2F;lazy.png; width&#x3D;236; height&#x3D;354; data-original&#x3D;http
                    s:&#x2F;&#x2F;i.meizitu.net&#x2F;thumbs&#x2F;2019&#x2F;07&#x2F;189007_10b27_236.jpg&#125;...&#125;
InputFields       : &#123;@&#123;innerHTML&#x3D;; innerText&#x3D;; outerHTML&#x3D;&lt;INPUT class&#x3D;search-input name&#x3D;s placeholder&#x3D;&quot;搜一搜，看一看&quot;&gt;; outer
                    Text&#x3D;; tagName&#x3D;INPUT; class&#x3D;search-input; name&#x3D;s; placeholder&#x3D;搜一搜，看一看&#125;&#125;
Links             : &#123;@&#123;innerHTML&#x3D;妹子图; innerText&#x3D;妹子图; outerHTML&#x3D;&lt;A href&#x3D;&quot;https:&#x2F;&#x2F;www.mzitu.com&#x2F;&quot;&gt;妹子图&lt;&#x2F;A&gt;; outerText&#x3D;妹子图;
                     tagName&#x3D;A; href&#x3D;https:&#x2F;&#x2F;www.mzitu.com&#x2F;&#125;, @&#123;innerHTML&#x3D;首页; innerText&#x3D;首页; outerHTML&#x3D;&lt;A title&#x3D;首页 href&#x3D;
                    &quot;https:&#x2F;&#x2F;www.mzitu.com&#x2F;&quot; aria-current&#x3D;&quot;page&quot;&gt;首页&lt;&#x2F;A&gt;; outerText&#x3D;首页; tagName&#x3D;A; title&#x3D;首页; href&#x3D;https:
                    &#x2F;&#x2F;www.mzitu.com&#x2F;; aria-current&#x3D;page&#125;...&#125;
ParsedHtml        : mshtml.HTMLDocumentClass
RawContentLength  : 22250<span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>显而易见，<code>$Response.Content</code> 就是网页的所有源代码。小透明很久以前用 PowerShell 写过一个从 <a href="https://ffmpeg.zeranoe.com/builds/" target="_blank" rel="noopener">https://ffmpeg.zeranoe.com/builds/</a> 自动下载更新电脑上的 FFmpeg 的脚本，需要从网页上获取 <code>https://ffmpeg.zeranoe.com/builds/win64/shared/ffmpeg-20190729-43891ea-win64-shared.zip</code> 这样的下载链接。由于当时的姿势水平实在是不怎么高，小透明当时使用的方法就是<strong>直接从网页源代码中使用正则表达式去搜索</strong>……(　ε:)</p><p>能直接查找下载链接是因为<strong>下载链接的格式相当固定</strong>（会改变的元素仅有是八位数字的日期和七位十六进制数字的 Git 提交版本号），但是实在是太不优雅了，而且通用性也不强⊂彡☆))∀`)</p><p>更优雅的查找方式是通过 <code>$Response.ParsedHTML.documentElement</code> 这个使用了 IE 浏览器对网页源代码进行解析的产物（由此可见为什么 IE 浏览器已经严重过时但是仍然没有被 Windows 砍掉，它早就成为了被很多程序在 Windows 系统中使用的访问网络的“基础设施”），有点像用浏览器打开某网页后 <kbd>F12</kbd> 然后找到控制台输入 <code>document</code> 得到的东西，当然也就可以像 JavaScript 一样对 DOM 节点进行很多基本的操作：</p><ul><li>查找元素：<code>getElementById</code>、<code>getElementsByClassName</code>、<code>getElementsByTagName</code>（不包括使用 CSS 进行选择的 <code>querySelector</code> 和 <code>querySelectorAll</code>）</li><li>查找父子兄弟节点： <code>previousSibling</code>、<code>nextSibling</code>、<code>parentElement</code>、<code>children</code></li><li>获取元素内的数据： <code>innerText</code>、<code>innerHTML</code></li><li>获取元素的属性：<code>getAttribute</code></li></ul><p>不过这里有一个坑：<code>$Response.ParsedHTML.documentElement</code> 和 <code>$Response.ParsedHTML</code>非常容易混淆，这两个对象的类型是不同的，能进行的操作也不同。前者可以使用以上的所有操作但是**不能使用 <code>getElementById</code><strong>，后者</strong>只能使用以上操作中的 <code>getElementById</code> 和 <code>getElementsByTagName</code>**……不知道为什么会弄出这种区别(っ’-‘)╮</p><p>另外“查找元素”和“查找父子兄弟节点”得到的对象和 <code>$Response.ParsedHTML.documentElement</code> 是相同的类型。</p><blockquote><p>PowerShell 6 中 <code>ParsedHTML</code> 被<del>微软大刀部</del><a href="https://docs.microsoft.com/zh-cn/powershell/scripting/whats-new/breaking-changes-ps6?view=powershell-6#changes-to-web-cmdlets" target="_blank" rel="noopener">砍掉了</a>，不过 Windows 10 内置的是 PowerShell 5.1，因此不受影响～</p></blockquote><h1 id="分析网页，获取套图信息"><a href="#分析网页，获取套图信息" class="headerlink" title="分析网页，获取套图信息"></a>分析网页，获取套图信息</h1><p>妹子图网站的主页上每一页有若干组套图的链接，对照着网页源代码就可以找到和套图相关的部分(っ’ω’)っ</p><img data-src="https://ae01.alicdn.com/kf/H50c278c9c7b24931b1c7c6a8c134c711A.png" data-src-webp="https://ae01.alicdn.com/kf/U9efcfc066b0f4ba38c039d69df0c83ddp.jpg"><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pins<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://www.mzitu.com/189007<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_blank<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>lazy<span class="token punctuation">'</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>https://i.meizitu.net/pfiles/img/lazy.png<span class="token punctuation">'</span></span> <span class="token attr-name">data-original</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>https://i.meizitu.net/thumbs/2019/07/189007_10b27_236.jpg<span class="token punctuation">'</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>有胸有腿有翘臀 妩媚尤物芝芝Booty黑丝一线裆让你大饱眼福<span class="token punctuation">'</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>236<span class="token punctuation">'</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>354<span class="token punctuation">'</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://www.mzitu.com/189007<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_blank<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>有胸有腿有翘臀 妩媚尤物芝芝Booty黑丝一线裆让你大饱眼福<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>time<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>2019-07-29<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://www.mzitu.com/193773<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_blank<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>lazy<span class="token punctuation">'</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>https://i.meizitu.net/pfiles/img/lazy.png<span class="token punctuation">'</span></span> <span class="token attr-name">data-original</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>https://i.meizitu.net/thumbs/2019/07/193773_07b27_236.jpg<span class="token punctuation">'</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>温柔体贴的小女仆 甜美嫩模toro羽住高清美照梦幻动人<span class="token punctuation">'</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>236<span class="token punctuation">'</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>354<span class="token punctuation">'</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://www.mzitu.com/193773<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_blank<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>温柔体贴的小女仆 甜美嫩模toro羽住高清美照梦幻动人<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>time<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>2019-07-29<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>
        ……
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果要获取套图的链接和标题，也就要获取到 <code>&lt;a href=&quot;（套图链接）&quot; target=&quot;_blank&quot;&gt;（套图标题）&lt;/a&gt;</code> 这样的节点。获取到第一页的所有套图信息的代码如下：</p><pre class="language-powershell line-numbers" data-language="powershell"><code class="language-powershell"><span class="token variable">$Response</span> = <span class="token function">Invoke-WebRequest</span> <span class="token string">'https://www.mzitu.com/page/1/'</span>

<span class="token comment"># 获取document</span>
<span class="token comment"># $Response.ParsedHTML</span>

<span class="token comment"># 获取&lt;ul id="pins"></span>
<span class="token comment"># $Response.ParsedHTML.getElementById('pins')</span>

<span class="token comment"># 每一组套图对应&lt;ul id="pins">中的每一个&lt;li></span>
<span class="token comment"># $Response.ParsedHTML.getElementById('pins').children</span>
<span class="token comment"># $Response.ParsedHTML.getElementById('pins').getElementsByTagName('li')</span>
<span class="token comment"># 显然选择器的写法是不唯一的～</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$li</span> in <span class="token variable">$Response</span><span class="token punctuation">.</span>ParsedHTML<span class="token punctuation">.</span>getElementById<span class="token punctuation">(</span><span class="token string">'pins'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment"># 获取套图链接的&lt;a>外面的&lt;span></span>
    <span class="token comment"># $li.children[1]</span>
    <span class="token comment"># $li.firstChild.nextSibling</span>

    <span class="token comment"># 获取套图链接的&lt;a>本身</span>
    <span class="token comment"># $li.children[1].firstChild</span>
    <span class="token comment"># $li.children[1].children[0]</span>

    <span class="token comment"># 从&lt;a>获取套图的标题和链接</span>
    <span class="token function">Write-Host</span> <span class="token punctuation">(</span><span class="token string">'URL: '</span> <span class="token operator">+</span> <span class="token variable">$li</span><span class="token punctuation">.</span>children<span class="token punctuation">[</span>1<span class="token punctuation">]</span><span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>href<span class="token punctuation">)</span>
    <span class="token function">Write-Host</span> <span class="token punctuation">(</span><span class="token string">'Title: '</span> <span class="token operator">+</span> <span class="token variable">$li</span><span class="token punctuation">.</span>children<span class="token punctuation">[</span>1<span class="token punctuation">]</span><span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>innerText<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>那第二页、第三页……的套图呢？第一页的网址 <code>https://www.mzitu.com/page/1/</code> 里面的这个 <code>1</code>，不就是页数嘛！</p><p>当时妹子图网站的页数是 <code>226</code>，写个循环就可以全部提取了੭ ᐕ)੭*⁾⁾ 不过这次要把所有套图的信息以对象的形式，保存到 <code>$Articles</code> 这个数组中：</p><pre class="language-powershell line-numbers" data-language="powershell"><code class="language-powershell"><span class="token variable">$Articles</span> = @<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> = 1<span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">-le</span> 226<span class="token punctuation">;</span> <span class="token variable">$i</span>+<span class="token operator">+</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$SitePageURL</span> = <span class="token punctuation">(</span><span class="token string">'https://www.mzitu.com/page/'</span> <span class="token operator">+</span> <span class="token variable">$i</span> <span class="token operator">+</span> <span class="token string">'/'</span><span class="token punctuation">)</span>
    <span class="token variable">$SitePage</span> = <span class="token function">Invoke-WebRequest</span> <span class="token variable">$SitePageURL</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$ArticleEntry</span> in <span class="token variable">$SitePage</span><span class="token punctuation">.</span>ParsedHTML<span class="token punctuation">.</span>getElementById<span class="token punctuation">(</span><span class="token string">'pins'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$Articles</span> <span class="token operator">+=</span> @<span class="token punctuation">&#123;</span>
            <span class="token string">'URL'</span> = <span class="token variable">$ArticleEntry</span><span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>href <span class="token operator">+</span> <span class="token string">'/'</span>
            <span class="token string">'Title'</span> = <span class="token variable">$ArticleEntry</span><span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>nextSibling<span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>innerText
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>还可以把套图的信息以 JSON 格式保存到文件中，之后下载时可以直接读取，而不需要重新爬取一遍：</p><pre class="language-powershell line-numbers" data-language="powershell"><code class="language-powershell"><span class="token comment"># 保存</span>
<span class="token variable">$Articles</span> <span class="token punctuation">|</span> <span class="token function">ConvertTo-Json</span> <span class="token punctuation">|</span> <span class="token function">Out-File</span> <span class="token string">'D:\mzitu\mzitu.json'</span>
<span class="token comment"># 读取</span>
<span class="token variable">$Articles</span> = <span class="token function">Get-Content</span> <span class="token string">'D:\mzitu\mzitu.json'</span> <span class="token punctuation">|</span> <span class="token function">ConvertFrom-Json</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span></span></code></pre><p>也可以从<a href="https://files.catbox.moe/3nhtx0.json" target="_blank" rel="noopener">这里</a>下载小透明已经爬取完了的套图信息～一共有 5423 条_(:△」∠)_</p><p>为了方便使用 PowerShell 直接读取，这个文件是使用 <code>UTF-16 LE</code> 编码保存的，因此直接用浏览器打开的话看到的可能是乱码。</p><h1 id="自动下载妹子图"><a href="#自动下载妹子图" class="headerlink" title="自动下载妹子图"></a>自动下载妹子图</h1><p>打开某一组套图的第一页，用同样的方法分析网页源代码，就可以得到每张图片的链接，以及这组套图的图片总数。</p><img data-src="https://ae01.alicdn.com/kf/U847d9c2b35cb4614b3ca493833dce358V.png" data-src-webp="https://ae01.alicdn.com/kf/U4292af3293594f79bcd0a230858c5af5R.jpg"><p>图片的链接在 <code>&lt;div class=&quot;main-image&quot;&gt;</code> 里面的 <code>&lt;img&gt;</code> 中，总页数可以从最后一个跳转页面的按钮获取，也就是 <code>&lt;div class=&quot;pagenavi&quot;&gt;</code> 的最后一个 <code>&lt;a&gt;</code>，写一个循环就可以把这组套图的所有图片下载下来～</p><pre class="language-powershell line-numbers" data-language="powershell"><code class="language-powershell"><span class="token comment"># 读取之前获取的所有套图的信息</span>
<span class="token variable">$Articles</span> = <span class="token function">Get-Content</span> <span class="token string">'D:\mzitu\mzitu.json'</span> <span class="token punctuation">|</span> <span class="token function">ConvertFrom-Json</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> = 0<span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">-lt</span> <span class="token variable">$Articles</span><span class="token punctuation">.</span>Length<span class="token punctuation">;</span> <span class="token variable">$i</span>+<span class="token operator">+</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">Write-Host</span> <span class="token punctuation">(</span><span class="token variable">$Articles</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Title <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> <span class="token variable">$Articles</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">.</span>URL<span class="token punctuation">)</span> <span class="token operator">-</span>NoNewline
    <span class="token variable">$ArticlePage</span> = <span class="token function">Invoke-WebRequest</span> <span class="token variable">$Articles</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">.</span>URL

    <span class="token comment"># 获取每组套图的图片总数</span>
    <span class="token comment"># lastChild指向&lt;div class="pagenavi">的最后一个空文本节点</span>
    <span class="token comment"># lastChild.previousSibling指向“下一页”的按钮</span>
    <span class="token comment"># lastChild.previousSibling.previousSibling指向的就是“下一页”的前一个，也就是可以跳转到最后一页的按钮</span>
    <span class="token comment"># 这个按钮里面的数字就是图片总数，用innerText获取</span>
    <span class="token namespace">[Int32]</span><span class="token variable">$ArticlePageCount</span> = <span class="token variable">$ArticlePage</span><span class="token punctuation">.</span>ParsedHTML<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>getElementsByClassName<span class="token punctuation">(</span><span class="token string">'pagenavi'</span><span class="token punctuation">)</span><span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token punctuation">.</span>lastChild<span class="token punctuation">.</span>previousSibling<span class="token punctuation">.</span>previousSibling<span class="token punctuation">.</span>innerText

    <span class="token comment"># 根据套图名称建立文件夹</span>
    <span class="token comment"># 将函数的执行结果赋值给$null，可以隐藏掉新建文件夹时输出的提示文本，隐藏的方法也不唯一</span>
    <span class="token variable">$null</span> = <span class="token namespace">[IO.Directory]</span>::CreateDirectory<span class="token punctuation">(</span><span class="token string">'D:\mzitu\'</span> <span class="token operator">+</span> <span class="token variable">$Articles</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Title<span class="token punctuation">)</span>
    <span class="token comment"># 使用类型转换：[void][IO.Directory]::CreateDirectory('D:\mzitu\' + $Articles[$i].Title)</span>
    <span class="token comment"># 使用管道接收输出：[IO.Directory]::CreateDirectory('D:\mzitu\' + $Articles[$i].Title) | Out-Null</span>

    <span class="token comment"># 循环下载所有图片</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$j</span> = 1<span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">-le</span> <span class="token variable">$ArticlePageCount</span><span class="token punctuation">;</span> <span class="token variable">$j</span>+<span class="token operator">+</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment"># 根据规律构造网页URL</span>
        <span class="token comment"># 例如 https://www.mzitu.com/189711/2 表示的就是这一组套图的第二张图</span>
        <span class="token variable">$ImagePageURL</span> = <span class="token variable">$Articles</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">.</span>URL <span class="token operator">+</span> <span class="token variable">$j</span>
        <span class="token variable">$ImagePage</span> = <span class="token function">Invoke-WebRequest</span> <span class="token variable">$ImagePageURL</span>

        <span class="token comment"># 获取图片的URL，构造保存路径</span>
        <span class="token variable">$ImageURL</span> = <span class="token variable">$ImagePage</span><span class="token punctuation">.</span>ParsedHTML<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>getElementsByClassName<span class="token punctuation">(</span><span class="token string">'main-image'</span><span class="token punctuation">)</span><span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token punctuation">.</span>getElementsByTagName<span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token punctuation">.</span>src
        <span class="token variable">$ImagePath</span> = <span class="token string">'D:\mzitu\'</span> <span class="token operator">+</span> <span class="token variable">$Articles</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Title <span class="token operator">+</span> <span class="token string">'\'</span> <span class="token operator">+</span> <span class="token namespace">[IO.Path]</span>::GetFileName<span class="token punctuation">(</span><span class="token variable">$ImageURL</span><span class="token punctuation">)</span>
        <span class="token function">Write-Host</span> <span class="token variable">$ImageURL</span> <span class="token operator">-</span>NoNewline

        <span class="token comment"># 下载图片，保存到对应路径中</span>
        <span class="token comment"># 妹子图网站似乎有防盗链，在网页上可以正常加载图片，但是直接打开图片的URL会遇到403错误</span>
        <span class="token comment"># 在请求头中加上妹子图网站的链接就可以回避这一限制～</span>
        <span class="token comment"># 由于下载的是文件，不需要进行网页解析，所以可以加上-UseBasicParsing这个参数禁用解析，提高一点点速度</span>
        <span class="token function">Invoke-WebRequest</span> <span class="token operator">-</span>Uri <span class="token variable">$ImageURL</span> <span class="token operator">-</span>Headers @<span class="token punctuation">&#123;</span><span class="token string">'Referer'</span> = <span class="token string">'https://www.mzitu.com'</span><span class="token punctuation">&#125;</span> <span class="token operator">-</span>OutFile <span class="token variable">$ImagePath</span> <span class="token operator">-</span>UseBasicParsing <span class="token operator">-</span>UserAgent <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:68.0) Gecko/20100101 Firefox/68.0'</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>只要运行了这段脚本，就可以源源不断地下载妹子图了～(⑉･̆-･̆⑉)</p><h1 id="脚本优化"><a href="#脚本优化" class="headerlink" title="脚本优化"></a>脚本优化</h1><h2 id="自动重连"><a href="#自动重连" class="headerlink" title="自动重连"></a>自动重连</h2><p>如果因为网络问题导致页面加载失败的话，那么某一张妹子图的下载就会因为出错被<strong>直接跳过</strong>，这样的程序显然是缺少健壮性（？）的，因此就需要在页面加载失败时自动重新加载。把加载页面的代码放到 <code>try &#123;...&#125; catch &#123;...&#125;</code> 语句中就可以实现：</p><pre class="language-powershell line-numbers" data-language="powershell"><code class="language-powershell"><span class="token comment"># 用一个变量标记是否加载成功</span>
<span class="token variable">$Success</span> = <span class="token boolean">$false</span>

<span class="token comment"># 除非加载成功一次，否则一直加载</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$Success</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token comment"># 设定十秒的连接时间限制，超时的话也会按加载失败处理</span>
        <span class="token function">Invoke-WebRequest</span> <span class="token string">'...'</span> <span class="token operator">-</span>TimeoutSec 10

        <span class="token comment"># Invoke-WebRequest的加载成功就会继续执行try部分的代码，并在控制台上输出绿色的Success</span>
        <span class="token variable">$Success</span> = <span class="token boolean">$true</span>
        <span class="token function">Write-Host</span> <span class="token string">'Success'</span> <span class="token operator">-</span>BackgroundColor DarkGreen <span class="token operator">-</span>ForegroundColor White <span class="token operator">-</span>NoNewLine
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>
        <span class="token comment"># 加载失败就会跳转到catch部分，并在控制台上输出红色的Fail</span>
        <span class="token variable">$Success</span> = <span class="token boolean">$false</span>
        <span class="token function">Write-Host</span> <span class="token string">'Fail'</span> <span class="token operator">-</span>BackgroundColor DarkRed <span class="token operator">-</span>ForegroundColor White <span class="token operator">-</span>NoNewline
    <span class="token punctuation">&#125;</span>
    <span class="token function">Write-Host</span> <span class="token string">' '</span> <span class="token operator">-</span>NoNewline
<span class="token punctuation">&#125;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如图所示，每次加载网页都会在控制台上输出一次加载结果，自动重连，一直到加载成功为止～</p><p>截图中还输出了文件大小和百分比之类的信息，是小透明自己添加的使用 <code>jpegtran</code> 对图片进行优化的效果。通过对图像数据进行重新排列，这个工具可以在不影响 JPEG 图片质量的情况下把图片变成渐进式，而且还能减少 5~7% 的文件大小٩( ‘ω’ )و</p><img data-src="https://ae01.alicdn.com/kf/H99de6874fa664e38be7bb9c544161fb9B.png" data-src-webp="https://ae01.alicdn.com/kf/U200d6cbc8baf441bae400c7e5f85ebceS.jpg"><h2 id="断点续爬"><a href="#断点续爬" class="headerlink" title="断点续爬"></a>断点续爬</h2><p>妹子图网站一共有五千多张套图，一次性爬取完成显然是不可能的，因此也有必要实现断点续爬的功能～</p><p>实现的原理也不难，把爬取的进度保存到一个文件中，每次运行脚本的时候读取一下就可以了，还可以跳过已经下载过的图片，避免重复下载。</p><pre class="language-powershell line-numbers" data-language="powershell"><code class="language-powershell"><span class="token variable">$Articles</span> = <span class="token function">Get-Content</span> <span class="token string">'D:\mzitu\mzitu.json'</span> <span class="token punctuation">|</span> <span class="token function">ConvertFrom-Json</span>

<span class="token comment"># 读取爬取进度</span>
<span class="token comment"># 文件的内容是从0开始的一个数，表示目前爬取到了第几份套图</span>
<span class="token namespace">[Int32]</span><span class="token variable">$Start</span> = <span class="token function">Get-Content</span> <span class="token string">'D:\mzitu\progress.txt'</span>

<span class="token comment"># 循环也是从$Start开始的</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> = <span class="token variable">$Start</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">-lt</span> <span class="token variable">$Articles</span><span class="token punctuation">.</span>Length<span class="token punctuation">;</span> <span class="token variable">$i</span>+<span class="token operator">+</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment"># 将当前的爬取进度保存到文件中</span>
    <span class="token variable">$i</span> > <span class="token string">'D:\mzitu\progress.txt'</span>

    <span class="token comment"># 获取套图的图片数量……</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$j</span> = 1<span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">-le</span> <span class="token variable">$ArticlePageCount</span><span class="token punctuation">;</span> <span class="token variable">$j</span>+<span class="token operator">+</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment"># 获取每张图片的URL并构造保存路径……</span>

        <span class="token comment"># 如果图片已经存在，就直接下载下一张图片，而不是重复下载</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token namespace">[IO.File]</span>::Exists<span class="token punctuation">(</span><span class="token variable">$ImagePath</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">continue</span> <span class="token punctuation">&#125;</span>

        <span class="token comment"># 根据URL下载图片……</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="line-numbers-rows" aria-hidden="true"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p>最后来一张爬取结果，一晚上爬了三百多份套图，一共一万多张图……|ω•`)</p><img data-src="https://ae01.alicdn.com/kf/Ua79b5c13aaed4b2f90f636ff29983f55u.png" data-src-webp="https://ae01.alicdn.com/kf/Uc787435230d34253a5243b98da640903B.jpg"><p>（然后被服务器<strong>关进小黑屋</strong>了，打开这个网站的所有图片都是 403，所以运行爬虫还得用代理啊喂！）</p><p>那么……妹子图呢？<a href="https://tooup.fun/file/get/659/mzitu.7z" target="_blank" rel="noopener">( ･᷄ὢ･᷅ )</a></p><img data-src="https://ae01.alicdn.com/kf/HTB14hiye.GF3KVjSZFm5jbqPXXaA.gif" data-src-webp="https://ae01.alicdn.com/kf/H534a3364b07b4f8d9d17f75a45bdf129z.jpg"><p><del>这种妹子图有什么好看的，还是纸片人更可爱！σ*ゝω･)</del></p><blockquote class="mdui-m-b-0 mdui-m-x-0 mdui-p-y-1" style="border-left:4px solid rgba(0,0,0,.36)"><strong>本作品采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。不允许内容农场类网站转载。</strong><br><strong>本文作者：✨小透明・宸✨</strong><br><strong>本文链接：<a href="https://akarin.dev/2019/07/30/powershell-mzitu-crawler/">https://akarin.dev/2019/07/30/powershell-mzitu-crawler/</a></strong></blockquote></article><div class="mdui-p-a-3 mdui-color-white" id="lv-container" data-id="city" data-uid="MTAyMC80NDUwOC8yMTAzOQ=="><script>(()=>{const e=document.createElement("script");e.src="https://cdn-city.livere.com/js/embed.dist.js",e.async=!0,document.body.appendChild(e)})()</script></div></div><div class="mdui-valign mdui-m-t-2"><a href="../../../08/03/use-ass-in-premiere/" class="mdui-ripple mdui-btn mdui-btn-icon"><i class="material-icons mdui-icon">chevron_left</i> </a><span class="mdui-typo-body-1-opacity mdui-text-left mdui-m-l-1" title="通过 VapourSynth 在 Premiere 中使用 ASS 字幕">上一篇</span> <span class="mdui-typo-body-1-opacity mdui-text-center" style="flex-grow:1"></span> <span class="mdui-typo-body-1-opacity mdui-text-right mdui-m-r-1" title="提高摸鱼技术：用 IDA 破解录屏软件 OverSpeed">下一篇</span> <a href="../../09/overspeed-crack/" class="mdui-ripple mdui-btn mdui-btn-icon"><i class="material-icons mdui-icon">chevron_right</i></a></div></main><footer class="mdui-container mdui-m-y-5 mdui-typo" style="display:flex;max-width:1024px"><div class="mdui-typo-body-1-opacity mdui-text-left">Copyright © 2022 ✨小透明・宸✨<br>Hosted by <a href="https://github.com/TransparentLC/transparentlc.github.io" target="_blank">Github Pages</a></div><div style="flex-grow:1"></div><div class="mdui-typo-body-1-opacity mdui-text-right">Powered by <a href="https://hexo.io" target="_blank">Hexo</a> <span class="mdui-hidden-xs-down">6.0.0</span><br>Theme - <a href="https://github.com/TransparentLC/hexo-theme-akarin" target="_blank">Akarin</a></div></footer><script src="https://cdn.jsdelivr.net/combine/npm/aplayer@1/dist/APlayer.min.js,gh/TransparentLC/transparentlc.github.io/js/mdui.min.js,npm/medium-zoom@1/dist/medium-zoom.min.js,npm/instant.page@5/instantpage.min.js,gh/TransparentLC/transparentlc.github.io/js/script.min.js"></script><script src="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/js/bsz.min.js" async></script><script>/MicroMessenger/.test(navigator.userAgent)&&(()=>{const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/gh/TransparentLC/transparentlc.github.io/js/fuck-wechat.min.js",document.body.appendChild(e)})()</script></body></html>